<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 12.3.0"/>
    <title>pricegenerator.PriceGenerator API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../pricegenerator.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;pricegenerator</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



        <h2>API Documentation</h2>
            <ul class="memberlist">
            <li>
                    <a class="class" href="#PriceGenerator">PriceGenerator</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#PriceGenerator.__init__">PriceGenerator</a>
                        </li>
                        <li>
                                <a class="variable" href="#PriceGenerator.prices">prices</a>
                        </li>
                        <li>
                                <a class="variable" href="#PriceGenerator.csvHeaders">csvHeaders</a>
                        </li>
                        <li>
                                <a class="variable" href="#PriceGenerator.dfHeaders">dfHeaders</a>
                        </li>
                        <li>
                                <a class="variable" href="#PriceGenerator.sep">sep</a>
                        </li>
                        <li>
                                <a class="variable" href="#PriceGenerator.j2template">j2template</a>
                        </li>
                        <li>
                                <a class="variable" href="#PriceGenerator.j2model">j2model</a>
                        </li>
                        <li>
                                <a class="variable" href="#PriceGenerator.ticker">ticker</a>
                        </li>
                        <li>
                                <a class="variable" href="#PriceGenerator.timeframe">timeframe</a>
                        </li>
                        <li>
                                <a class="variable" href="#PriceGenerator.timeStart">timeStart</a>
                        </li>
                        <li>
                                <a class="variable" href="#PriceGenerator.horizon">horizon</a>
                        </li>
                        <li>
                                <a class="variable" href="#PriceGenerator.trendSplit">trendSplit</a>
                        </li>
                        <li>
                                <a class="variable" href="#PriceGenerator.splitCount">splitCount</a>
                        </li>
                        <li>
                                <a class="variable" href="#PriceGenerator.maxClose">maxClose</a>
                        </li>
                        <li>
                                <a class="variable" href="#PriceGenerator.minClose">minClose</a>
                        </li>
                        <li>
                                <a class="variable" href="#PriceGenerator.initClose">initClose</a>
                        </li>
                        <li>
                                <a class="variable" href="#PriceGenerator.maxOutlier">maxOutlier</a>
                        </li>
                        <li>
                                <a class="variable" href="#PriceGenerator.maxCandleBody">maxCandleBody</a>
                        </li>
                        <li>
                                <a class="variable" href="#PriceGenerator.upCandlesProb">upCandlesProb</a>
                        </li>
                        <li>
                                <a class="variable" href="#PriceGenerator.outliersProb">outliersProb</a>
                        </li>
                        <li>
                                <a class="variable" href="#PriceGenerator.trendDeviation">trendDeviation</a>
                        </li>
                        <li>
                                <a class="variable" href="#PriceGenerator.maxVolume">maxVolume</a>
                        </li>
                        <li>
                                <a class="variable" href="#PriceGenerator.stat">stat</a>
                        </li>
                        <li>
                                <a class="variable" href="#PriceGenerator.precision">precision</a>
                        </li>
                        <li>
                                <a class="variable" href="#PriceGenerator.zigZagDeviation">zigZagDeviation</a>
                        </li>
                        <li>
                                <a class="function" href="#PriceGenerator.FormattedDelta">FormattedDelta</a>
                        </li>
                        <li>
                                <a class="function" href="#PriceGenerator.DetectPrecision">DetectPrecision</a>
                        </li>
                        <li>
                                <a class="function" href="#PriceGenerator.DetectTimeframe">DetectTimeframe</a>
                        </li>
                        <li>
                                <a class="function" href="#PriceGenerator.LoadFromFile">LoadFromFile</a>
                        </li>
                        <li>
                                <a class="function" href="#PriceGenerator.SaveToFile">SaveToFile</a>
                        </li>
                        <li>
                                <a class="function" href="#PriceGenerator.GetTrend">GetTrend</a>
                        </li>
                        <li>
                                <a class="function" href="#PriceGenerator.ZigZagFilter">ZigZagFilter</a>
                        </li>
                        <li>
                                <a class="function" href="#PriceGenerator.GetStatistics">GetStatistics</a>
                        </li>
                        <li>
                                <a class="function" href="#PriceGenerator.Generate">Generate</a>
                        </li>
                        <li>
                                <a class="function" href="#PriceGenerator.RenderBokeh">RenderBokeh</a>
                        </li>
                        <li>
                                <a class="function" href="#PriceGenerator.RenderGoogle">RenderGoogle</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#ParseArgs">ParseArgs</a>
            </li>
            <li>
                    <a class="function" href="#Main">Main</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../pricegenerator.html">pricegenerator</a><wbr>.PriceGenerator    </h1>

                        <div class="docstring"><p><strong>PriceGenerator</strong> is the platform for generating prices similar to real stock prices, but you can control the statistics of their distribution. Generates chain of candlesticks with predefined statistical parameters, return Pandas DataFrame or saving as .CSV-file with OHLCV-candlestick in every string. Use PriceGenerator to generate synthetic data to test your trading strategy.</p>

<p>In additional you can view some statistical and probability parameters of generated or loaded prices.</p>

<p>Sample example:</p>

<p><a href="https://github.com/Tim55667757/PriceGenerator"><img src="https://github.com/Tim55667757/PriceGenerator/blob/master/media/index_google.html.png?raw=true" alt="Chart" width="780" target="_blank" /></a></p>
</div>

                        <input id="mod-PriceGenerator-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-PriceGenerator-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="c1"># -*- coding: utf-8 -*-</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a><span class="c1"># Author: Timur Gilmullin</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a><span class="sd">**PriceGenerator** is the platform for generating prices similar to real stock prices, but you can control the statistics of their distribution. Generates chain of candlesticks with predefined statistical parameters, return Pandas DataFrame or saving as .CSV-file with OHLCV-candlestick in every string. Use PriceGenerator to generate synthetic data to test your trading strategy.</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a><span class="sd">In additional you can view some statistical and probability parameters of generated or loaded prices.</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a><span class="sd">Sample example:</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a><span class="sd">&lt;a href=&quot;https://github.com/Tim55667757/PriceGenerator&quot;&gt;&lt;img src=&quot;https://github.com/Tim55667757/PriceGenerator/blob/master/media/index_google.html.png?raw=true&quot; alt=&quot;Chart&quot; width=&quot;780&quot; target=&quot;_blank&quot; /&gt;&lt;/a&gt;</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a><span class="c1"># Copyright (c) 2022 Gilmillin Timur Mansurovich</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a><span class="c1">#</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a><span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a><span class="c1"># you may not use this file except in compliance with the License.</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a><span class="c1"># You may obtain a copy of the License at</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a><span class="c1">#</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a><span class="c1">#     http://www.apache.org/licenses/LICENSE-2.0</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a><span class="c1">#</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a><span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a><span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a><span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a><span class="c1"># See the License for the specific language governing permissions and</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a><span class="c1"># limitations under the License.</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a><span class="kn">import</span> <span class="nn">os</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a><span class="kn">import</span> <span class="nn">sys</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a><span class="kn">from</span> <span class="nn">dateutil.tz</span> <span class="kn">import</span> <span class="n">tzlocal</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a><span class="kn">from</span> <span class="nn">argparse</span> <span class="kn">import</span> <span class="n">ArgumentParser</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">pi</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a><span class="kn">from</span> <span class="nn">statistics</span> <span class="kn">import</span> <span class="n">mode</span><span class="p">,</span> <span class="n">pstdev</span><span class="p">,</span> <span class="n">StatisticsError</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">groupby</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a><span class="kn">import</span> <span class="nn">pandas_ta</span> <span class="k">as</span> <span class="nn">ta</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a><span class="kn">import</span> <span class="nn">random</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a><span class="kn">from</span> <span class="nn">bokeh.plotting</span> <span class="kn">import</span> <span class="n">figure</span><span class="p">,</span> <span class="n">save</span><span class="p">,</span> <span class="n">output_file</span><span class="p">,</span> <span class="n">ColumnDataSource</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a><span class="kn">from</span> <span class="nn">bokeh.models</span> <span class="kn">import</span> <span class="n">Legend</span><span class="p">,</span> <span class="n">HoverTool</span><span class="p">,</span> <span class="n">Range1d</span><span class="p">,</span> <span class="n">NumeralTickFormatter</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a><span class="kn">from</span> <span class="nn">bokeh.layouts</span> <span class="kn">import</span> <span class="n">gridplot</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a><span class="kn">from</span> <span class="nn">bokeh.io</span> <span class="kn">import</span> <span class="n">output_notebook</span><span class="p">,</span> <span class="n">show</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a><span class="kn">from</span> <span class="nn">bokeh.resources</span> <span class="kn">import</span> <span class="n">INLINE</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a><span class="kn">import</span> <span class="nn">jinja2</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a><span class="kn">import</span> <span class="nn">pricegenerator.UniLogger</span> <span class="k">as</span> <span class="nn">uLog</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a><span class="kn">import</span> <span class="nn">traceback</span> <span class="k">as</span> <span class="nn">tb</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a><span class="c1"># --- Common technical parameters:</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a><span class="n">uLogger</span> <span class="o">=</span> <span class="n">uLog</span><span class="o">.</span><span class="n">UniLogger</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a><span class="n">uLogger</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># debug level by default</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a><span class="n">uLogger</span><span class="o">.</span><span class="n">handlers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c1"># info level by default for STDOUT</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a><span class="c1"># uLogger.handlers[1].level = 10  # debug level by default for log.txt</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a><span class="c1"># Simple internal jinja2 template for rendering static html-page with Google Candlestick chart. `GOOGLE_TEMPLATE_J2` may use with `j2template` variable.</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a><span class="n">GOOGLE_TEMPLATE_J2</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;{# This template based on Jinja markup language: https://jinja.palletsprojects.com/en/latest/ #}</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a><span class="s2">&lt;!DOCTYPE html&gt;</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a><span class="s2">&lt;html&gt;</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a><span class="s2">&lt;head&gt;</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a><span class="s2">    &lt;title&gt;{{ title }}&lt;/title&gt;</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a><span class="s2">    &lt;meta charset=&quot;utf-8&quot;&gt;</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a><span class="s2">    &lt;script type=&quot;text/javascript&quot; src=&quot;https://code.jquery.com/jquery-latest.min.js&quot;&gt;&lt;/script&gt;</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a><span class="s2">    &lt;script type=&quot;text/javascript&quot; src=&quot;https://www.gstatic.com/charts/loader.js&quot;&gt;&lt;/script&gt;</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a><span class="s2">    &lt;script type=&quot;text/javascript&quot;&gt;google.charts.load(&#39;current&#39;, {&#39;packages&#39;: [&#39;corechart&#39;]});&lt;/script&gt;</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a><span class="s2">    &lt;style type=&quot;text/css&quot;&gt;</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a><span class="s2">    #preloader {</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a><span class="s2">        position: fixed;</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a><span class="s2">        top: 0;</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a><span class="s2">        left: 0;</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a><span class="s2">        right: 0;</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a><span class="s2">        bottom: 0;</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a><span class="s2">        background-color: #FFFFFF;</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a><span class="s2">        z-index: 99;</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a><span class="s2">    }</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a><span class="s2">    #status {</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a><span class="s2">        width: 300px;</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a><span class="s2">        height: 150px;</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a><span class="s2">        position: absolute;</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a><span class="s2">        left: 50%;</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a><span class="s2">        top: 50%;</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a><span class="s2">        background-image: url(https://raw.githubusercontent.com/niklausgerber/PreLoadMe/master/img/status.gif);</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a><span class="s2">        background-repeat: no-repeat;</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a><span class="s2">        background-position: left;</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a><span class="s2">        margin: -100px 0 0 -100px;</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a><span class="s2">        font-family: &quot;Segoe UI&quot;, &quot;Frutiger&quot;, &quot;Frutiger Linotype&quot;, &quot;Dejavu Sans&quot;, &quot;Helvetica Neue&quot;, &quot;Arial&quot;, sans-serif;</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a><span class="s2">        font-size: 14px;</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a><span class="s2">    }</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a><span class="s2">    pre {</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a><span class="s2">        font-family: &quot;Lucida Console&quot;, sans-serif;</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a><span class="s2">        font-size: 11px;</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a><span class="s2">        padding: 0;</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a><span class="s2">        border-width: 0 0 0 0;</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a><span class="s2">    }</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a><span class="s2">    table {</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a><span class="s2">        font-family: &quot;Segoe UI&quot;, &quot;Frutiger&quot;, &quot;Frutiger Linotype&quot;, &quot;Dejavu Sans&quot;, &quot;Helvetica Neue&quot;, &quot;Arial&quot;, sans-serif;</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a><span class="s2">        font-size: 12px;</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a><span class="s2">        border-spacing: 0;</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a><span class="s2">        text-align: left;</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a><span class="s2">        background: white;</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a><span class="s2">        width: 100%;</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a><span class="s2">    }</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a><span class="s2">    th {</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a><span class="s2">        border-radius: 10px 10px 10px 10px;</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a><span class="s2">        border-style: solid;</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a><span class="s2">        border-width: 0 1px 1px 0;</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a><span class="s2">        border-color: white;</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a><span class="s2">        padding: 6px;</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a><span class="s2">        vertical-align: middle;</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a><span class="s2">        padding-left: 1em;</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a><span class="s2">        background: #E6E6E6;</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a><span class="s2">        height: 50px;</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a><span class="s2">    }</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a><span class="s2">    td {</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a><span class="s2">        border-radius: 10px 10px 10px 10px;</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a><span class="s2">        border-style: solid;</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a><span class="s2">        border-width: 0 1px 1px 0;</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a><span class="s2">        border-color: white;</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a><span class="s2">        padding: 6px;</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a><span class="s2">        vertical-align: top;</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a><span class="s2">        padding-left: 1em;</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a><span class="s2">        background: white;</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a><span class="s2">    }</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a><span class="s2">    &lt;/style&gt;</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a><span class="s2">    &lt;script&gt;</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a><span class="s2">    function drawChartCandlesticks(candlesData) {</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a><span class="s2">        var chartOptions = {</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a><span class="s2">            legend: &quot;none&quot;,</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a><span class="s2">            titlePosition: &quot;in&quot;,</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a><span class="s2">            chartArea: {width: &quot;100%&quot;, height: &quot;100%&quot;},</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a><span class="s2">            fontSize: 11,</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a><span class="s2">            candlestick: {</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a><span class="s2">                fallingColor: {stroke: &quot;#000000&quot;, strokeWidth: 1, fill: &quot;#999999&quot;},</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a><span class="s2">                risingColor: {stroke: &quot;#000000&quot;,  strokeWidth: 1, fill: &quot;#FFFFFF&quot;},</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a><span class="s2">            },</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a><span class="s2">            colors: [&quot;#000000&quot;],</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a><span class="s2">            hAxis: {textPosition: &quot;none&quot;},</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a><span class="s2">            vAxis: {textPosition: &quot;in&quot;, textStyle: </span><span class="si">{fontSize: 12}</span><span class="s2">},</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a><span class="s2">        }</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a><span class="s2">        if (typeof candlesData !== &quot;undefined&quot;) {</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a><span class="s2">            var data = google.visualization.arrayToDataTable(candlesData, true);</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a><span class="s2">            var chart = new google.visualization.CandlestickChart(document.getElementById(&quot;candlestickChart&quot;));</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a><span class="s2">            chart.draw(data, chartOptions);</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a><span class="s2">        }</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a><span class="s2">    }</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a><span class="s2">    &lt;/script&gt;</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a><span class="s2">&lt;/head&gt;</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a><span class="s2">&lt;body onload=&quot;drawChartCandlesticks({{ candlesData }})&quot;&gt;</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a><span class="s2">&lt;!-- Preloader --&gt;</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a><span class="s2">&lt;script&gt;</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a><span class="s2">    $(window).on(&#39;load&#39;, function() {</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a><span class="s2">        $(&#39;#status&#39;).fadeOut(&#39;slow&#39;);</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a><span class="s2">        $(&#39;#preloader&#39;).fadeOut(&#39;slow&#39;);</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a><span class="s2">    })</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a><span class="s2">&lt;/script&gt;</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a><span class="s2">&lt;div id=&quot;preloader&quot;&gt;</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a><span class="s2">    &lt;div id=&quot;status&quot;&gt;Wait...&lt;/div&gt;</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a><span class="s2">&lt;/div&gt;</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a><span class="s2">&lt;!-- Chart part --&gt;</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a><span class="s2">&lt;table id=&quot;chart&quot;&gt;</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a><span class="s2">    &lt;tr&gt;</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a><span class="s2">        &lt;th style=&quot;width: 80%;&quot;&gt;</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a><span class="s2">            &lt;b&gt;{{ title }}&lt;/b&gt;</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a><span class="s2">        &lt;/th&gt;</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a><span class="s2">        &lt;th&gt;</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a><span class="s2">            &lt;b&gt;Info&lt;/b&gt;</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a><span class="s2">        &lt;/th&gt;</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a><span class="s2">    &lt;/tr&gt;</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a><span class="s2">    &lt;tr&gt;</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a><span class="s2">        &lt;td&gt;</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a><span class="s2">            &lt;div id=&quot;candlestickChart&quot; style=&quot;height: 800px; width: 100%;&quot;&gt;&lt;/div&gt;</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a><span class="s2">        &lt;/td&gt;</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a><span class="s2">        &lt;td&gt;</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a><span class="s2">            {</span><span class="si">% f</span><span class="s2">or line in info %}</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a><span class="s2">                &lt;pre&gt;{{ line }}&lt;/pre&gt;</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a><span class="s2">            {</span><span class="si">% e</span><span class="s2">ndfor %}</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a><span class="s2">        &lt;/td&gt;</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a><span class="s2">    &lt;/tr&gt;</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a><span class="s2">&lt;/table&gt;</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a><span class="s2">&lt;!-- Footer --&gt;</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a><span class="s2">&lt;table&gt;</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a><span class="s2">    &lt;tr&gt;</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a><span class="s2">        &lt;th&gt;&lt;b&gt;Generated by &lt;a href=&quot;https://github.com/Tim55667757/PriceGenerator&quot;&gt;PriceGenerator&lt;/a&gt;&lt;/b&gt;&lt;/th&gt;</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a><span class="s2">    &lt;/tr&gt;</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a><span class="s2">&lt;/table&gt;</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a><span class="s2">&lt;/body&gt;</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a><span class="s2">&lt;/html&gt;</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a><span class="k">class</span> <span class="nc">PriceGenerator</span><span class="p">:</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a><span class="sd">    This class implements methods to generation of prices statistically similar to real ones.</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a><span class="sd">    **Model generated: OHLCV-candlesticks (open, high, low, close, volume).**</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a>        <span class="sd">&quot;&quot;&quot;Main class init.&quot;&quot;&quot;</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a>        <span class="sd">&quot;&quot;&quot;Generated or loaded prices will be available in this Pandas DataFrame variable.&quot;&quot;&quot;</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">csvHeaders</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;open&quot;</span><span class="p">,</span> <span class="s2">&quot;high&quot;</span><span class="p">,</span> <span class="s2">&quot;low&quot;</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">,</span> <span class="s2">&quot;volume&quot;</span><span class="p">]</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a>        <span class="sd">&quot;&quot;&quot;Headers in .CSV-file. Default: `[&quot;date&quot;, &quot;time&quot;, &quot;open&quot;, &quot;high&quot;, &quot;low&quot;, &quot;close&quot;, &quot;volume&quot;]`.&quot;&quot;&quot;</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dfHeaders</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;datetime&quot;</span><span class="p">,</span> <span class="s2">&quot;open&quot;</span><span class="p">,</span> <span class="s2">&quot;high&quot;</span><span class="p">,</span> <span class="s2">&quot;low&quot;</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">,</span> <span class="s2">&quot;volume&quot;</span><span class="p">]</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a>        <span class="sd">&quot;&quot;&quot;Headers in Pandas DataFrame. Default: `[&quot;datetime&quot;, &quot;open&quot;, &quot;high&quot;, &quot;low&quot;, &quot;close&quot;, &quot;volume&quot;]`.&quot;&quot;&quot;</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a>        <span class="sd">&quot;&quot;&quot;Separator in csv - file. Default: `,`&quot;&quot;&quot;</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">j2template</span> <span class="o">=</span> <span class="n">GOOGLE_TEMPLATE_J2</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a>        <span class="sd">&quot;&quot;&quot;Full path to custom jinja2 html-template file (e.g. `google_template_example.j2`) or just set here a long multi-string variable. Default: `GOOGLE_TEMPLATE_J2` is a multi-string variable with internal template.&quot;&quot;&quot;</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">j2model</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a>        <span class="sd">&quot;&quot;&quot;Dictionary of variables for jinja2 template. If `None` then used default variables for internal `GOOGLE_TEMPLATE_J2`&quot;&quot;&quot;</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_precision</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a>        <span class="sd">&quot;&quot;&quot;Signs after comma. Default: `2`.&quot;&quot;&quot;</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_deg10prec</span> <span class="o">=</span> <span class="mi">100</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a>        <span class="sd">&quot;&quot;&quot;Constant 10^precision is used by some formulas. Not recommended to change it. Default: `100` (`10 ** precision`).&quot;&quot;&quot;</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ticker</span> <span class="o">=</span> <span class="s2">&quot;TEST&quot;</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a>        <span class="sd">&quot;&quot;&quot;Some fake ticker name. Default: `Test`.&quot;&quot;&quot;</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a>        <span class="sd">&quot;&quot;&quot;Time delta between two neighbour candles. Default: `timedelta(hours=1)`.&quot;&quot;&quot;</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">timeStart</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">tzlocal</span><span class="p">())</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">microsecond</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">second</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a>        <span class="sd">&quot;&quot;&quot;First date and time for candles chain.&quot;&quot;&quot;</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a>        <span class="sd">&quot;&quot;&quot;Candlesticks count in generated or loaded chain of prices, must be &gt;= 5. Default: `None` (means auto-detect length of chain if loaded from file).&quot;&quot;&quot;</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a>        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Set different trends, e.g. `trendSplit=&quot;/\-&quot;` means that generated candles has uptrend at first part, next downtrend and then no trend. Used only together with `splitCount` variable. Also, you can use words: `up`, `down`, `no` or chars: `u`, `d`, `n` with the hyphen symbol as separator, e.g. `trendSplit=up-down-no-up`, `trendSplit=u-d-n-u` etc. Default: `&quot;&quot;`, empty string mean that will be used random trend directions.&quot;&quot;&quot;</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a>        <span class="sd">&quot;&quot;&quot;Set candles count in different trends, e.g. `splitCount=[5, 10, 15]` means that generated candles has 3 trends with 5, 10 and 15 candles in chain, with sum must be equal to horizon. Used only together with `trendSplit` variable. Default: `[]`, empty list mean that will be used random candles count in trends.&quot;&quot;&quot;</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">maxClose</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">70</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a>        <span class="sd">&quot;&quot;&quot;Maximum of close prices must be &gt;= `minClose`. Default: random in interval `(70, 90)`.&quot;&quot;&quot;</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">minClose</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">70</span><span class="p">)</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a>        <span class="sd">&quot;&quot;&quot;Minimum of close prices must be &lt;= `maxClose`. Default: random in interval `(60, 70)`.&quot;&quot;&quot;</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initClose</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a>        <span class="sd">&quot;&quot;&quot;First candle close price value. If `None` then used random number in interval between `minClose` and `maxClose`. Default: `None`.&quot;&quot;&quot;</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">maxOutlier</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a>        <span class="sd">&quot;&quot;&quot;Maximum size of outliers. If `None` then used value `(maxClose - minClose) / 10`. Default: `None`.&quot;&quot;&quot;</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">maxCandleBody</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a>        <span class="sd">&quot;&quot;&quot;Maximum of candle body sizes: `abs(open - close)`. If `None` then used value `maxOutlier * 90%`. Default: `None`.&quot;&quot;&quot;</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_maxVolume</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100000</span><span class="p">)</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a>        <span class="sd">&quot;&quot;&quot;Maximum of generated trade volumes. Default: random in interval `(0, 100000)`.&quot;&quot;&quot;</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_upCandlesProb</span> <span class="o">=</span> <span class="mf">0.5</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a>        <span class="sd">&quot;&quot;&quot;Probability that next candle is up. Default: `0.5` (means 50% of probability).&quot;&quot;&quot;</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_outliersProb</span> <span class="o">=</span> <span class="mf">0.03</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a>        <span class="sd">&quot;&quot;&quot;Outlier probability (price tails). Default: `0.03` (means 3% of probability).&quot;&quot;&quot;</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trendDeviation</span> <span class="o">=</span> <span class="mf">0.005</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a>        <span class="sd">&quot;&quot;&quot;Relative deviation for trend detection. &quot;NO trend&quot; if `(1st_close - last_close) / 1st_close &lt;= self.trendDeviation`. Default: `0.005` (means ±0.5% of price deviation).&quot;&quot;&quot;</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_chartTitle</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a>        <span class="sd">&quot;&quot;&quot;Chart title. It will be auto-generated when loading or creating chain of candlesticks.&quot;&quot;&quot;</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_zigZagDeviation</span> <span class="o">=</span> <span class="mf">0.03</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a>        <span class="sd">&quot;&quot;&quot;Relative deviation to detection next points used by Zig-Zag indicator. Default: `0.03` (means 3% of price deviation).&quot;&quot;&quot;</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a>            <span class="s2">&quot;candles&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># generated candlesticks count</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a>            <span class="s2">&quot;precision&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>  <span class="c1"># generated candlesticks count</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a>            <span class="s2">&quot;closeFirst&quot;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>  <span class="c1"># first close price</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a>            <span class="s2">&quot;closeLast&quot;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>  <span class="c1"># last close price</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a>            <span class="s2">&quot;closeMax&quot;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>  <span class="c1"># max close price</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a>            <span class="s2">&quot;closeMix&quot;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>  <span class="c1"># min close price</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a>            <span class="s2">&quot;diapason&quot;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>  <span class="c1"># diapason = closeMax - closeMin</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a>            <span class="s2">&quot;trend&quot;</span><span class="p">:</span> <span class="s2">&quot;NO trend&quot;</span><span class="p">,</span>  <span class="c1"># &quot;UP trend&quot; or &quot;DOWN trend&quot; with uses ±self.trendDeviation</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a>            <span class="s2">&quot;trendDev&quot;</span><span class="p">:</span> <span class="mf">0.005</span><span class="p">,</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a>            <span class="s2">&quot;upCount&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># count of up candles</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a>            <span class="s2">&quot;downCount&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># count of down candles</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a>            <span class="s2">&quot;upCountChainMax&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># max chain count of up candles</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a>            <span class="s2">&quot;downCountChainMax&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># max chain count of down candles</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a>            <span class="s2">&quot;deltas&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a>                <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>  <span class="c1"># delta max = max(close_prices)</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a>                <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>  <span class="c1"># delta min = min(close_prices)</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a>                <span class="s2">&quot;stDev&quot;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>  <span class="c1"># standard deviation</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a>                <span class="s2">&quot;q99&quot;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>  <span class="c1"># 99 percentile</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a>                <span class="s2">&quot;q95&quot;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>  <span class="c1"># 95 percentile</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a>                <span class="s2">&quot;q80&quot;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>  <span class="c1"># 80 percentile</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a>                <span class="s2">&quot;q50&quot;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>  <span class="c1"># 50 percentile</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a>            <span class="p">},</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a>            <span class="s2">&quot;cumSumVolumes&quot;</span><span class="p">:</span> <span class="mi">0</span>  <span class="c1"># cumulative sum of volumes</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a>        <span class="p">}</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a>        <span class="sd">&quot;&quot;&quot;Some statistics available after candles loaded or generated.&quot;&quot;&quot;</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a>    <span class="nd">@property</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a>    <span class="k">def</span> <span class="nf">upCandlesProb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a>        <span class="sd">&quot;&quot;&quot;Probability that next candle is up. Default: `0.5` (means 50% of probability).&quot;&quot;&quot;</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upCandlesProb</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a>    <span class="nd">@upCandlesProb</span><span class="o">.</span><span class="n">setter</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a>    <span class="k">def</span> <span class="nf">upCandlesProb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a>        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_upCandlesProb</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a>        <span class="k">elif</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_upCandlesProb</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_upCandlesProb</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a>    <span class="nd">@property</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a>    <span class="k">def</span> <span class="nf">outliersProb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a>        <span class="sd">&quot;&quot;&quot;Outlier probability (price tails). Default: `0.03` (means 3% of probability).&quot;&quot;&quot;</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outliersProb</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a>    <span class="nd">@outliersProb</span><span class="o">.</span><span class="n">setter</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a>    <span class="k">def</span> <span class="nf">outliersProb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a>        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_outliersProb</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a>        <span class="k">elif</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_outliersProb</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_outliersProb</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a>    <span class="nd">@property</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a>    <span class="k">def</span> <span class="nf">trendDeviation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a>        <span class="sd">&quot;&quot;&quot;Relative deviation for trend detection. &quot;NO trend&quot; if `(1st_close - last_close) / 1st_close &lt;= self.trendDeviation`. Default: `0.005` (means ±0.5% of price deviation).&quot;&quot;&quot;</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trendDeviation</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a>    <span class="nd">@trendDeviation</span><span class="o">.</span><span class="n">setter</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a>    <span class="k">def</span> <span class="nf">trendDeviation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a>        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_trendDeviation</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a>        <span class="k">elif</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_trendDeviation</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_trendDeviation</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a>    <span class="nd">@property</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a>    <span class="k">def</span> <span class="nf">maxVolume</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a>        <span class="sd">&quot;&quot;&quot;Maximum of generated trade volumes. Default: random in interval `(0, 100000)`.&quot;&quot;&quot;</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maxVolume</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a>    <span class="nd">@maxVolume</span><span class="o">.</span><span class="n">setter</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a>    <span class="k">def</span> <span class="nf">maxVolume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a>        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_maxVolume</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_maxVolume</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a>    <span class="nd">@property</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a>    <span class="k">def</span> <span class="nf">stat</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a>        <span class="sd">&quot;&quot;&quot;Some statistics available after candles loaded or generated.&quot;&quot;&quot;</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a>    <span class="nd">@property</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a>    <span class="k">def</span> <span class="nf">precision</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a>        <span class="sd">&quot;&quot;&quot;Signs after comma.&quot;&quot;&quot;</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precision</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a>    <span class="nd">@precision</span><span class="o">.</span><span class="n">setter</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a>    <span class="k">def</span> <span class="nf">precision</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_precision</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># default</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_deg10prec</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># default</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a>            <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_precision</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_deg10prec</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">value</span>  <span class="c1"># 10^precision</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a>    <span class="nd">@property</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a>    <span class="k">def</span> <span class="nf">zigZagDeviation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a>        <span class="sd">&quot;&quot;&quot;Relative deviation to detection next points used by Zig-Zag indicator. Default: 0.03 (means 3% of price deviation).&quot;&quot;&quot;</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zigZagDeviation</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a>    <span class="nd">@zigZagDeviation</span><span class="o">.</span><span class="n">setter</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a>    <span class="k">def</span> <span class="nf">zigZagDeviation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a>        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_zigZagDeviation</span> <span class="o">=</span> <span class="mf">0.03</span>  <span class="c1"># by default</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a>        <span class="k">elif</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_zigZagDeviation</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_zigZagDeviation</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a>    <span class="k">def</span> <span class="nf">FormattedDelta</span><span class="p">(</span><span class="n">tDelta</span><span class="p">:</span> <span class="n">timedelta</span><span class="p">,</span> <span class="n">fmt</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a><span class="sd">        Pretty format for timedelta objects.</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a><span class="sd">        Example: `FormattedDelta(timedelta(days=2, hours=3, minutes=15, seconds=35), &quot;{days} days {hours}:{minutes}:{seconds}&quot;) -&gt; &quot;2 days 3:15:35&quot;`.</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a><span class="sd">        :return: timedelta object formatted as a string.</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a>        <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;days&quot;</span><span class="p">:</span> <span class="n">tDelta</span><span class="o">.</span><span class="n">days</span><span class="p">}</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a>        <span class="n">d</span><span class="p">[</span><span class="s2">&quot;hours&quot;</span><span class="p">],</span> <span class="n">rem</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">tDelta</span><span class="o">.</span><span class="n">seconds</span><span class="p">,</span> <span class="mi">3600</span><span class="p">)</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a>        <span class="n">d</span><span class="p">[</span><span class="s2">&quot;minutes&quot;</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;seconds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">rem</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a>        <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">)</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a>    <span class="k">def</span> <span class="nf">DetectPrecision</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">examples</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="nb">list</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a><span class="sd">        Auto-detect precision from example values. E.g. `0.123 -&gt; 3`, `0.12345 -&gt; 5` and so on.</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a><span class="sd">        This method change `precision` variable after detect precision.</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a><span class="sd">        See also about statistics.mode: https://docs.python.org/3.9/library/statistics.html#statistics.mode</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a><span class="sd">        Changed in Python version &gt;= 3.8: Now mode() method handles multimodal datasets by returning the first mode encountered.</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a><span class="sd">        Previously, it raised StatisticsError when more than one mode was found.</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a><span class="sd">        :param examples: chain with examples of float values.</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Detecting precision of data values...&quot;</span><span class="p">)</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a>        <span class="n">precision</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a>            <span class="n">precision</span> <span class="o">=</span> <span class="n">mode</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">examples</span><span class="p">)))</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a>        <span class="k">except</span> <span class="n">StatisticsError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Statistic mode() method return an error! Precision is set to 2 (default). StatisticsError: &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a>            <span class="n">precision</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a>        <span class="k">finally</span><span class="p">:</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Auto-detected precision: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">precision</span><span class="p">))</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">precision</span> <span class="o">=</span> <span class="n">precision</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a>        <span class="k">return</span> <span class="n">precision</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a>    <span class="k">def</span> <span class="nf">DetectTimeframe</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">timedelta</span><span class="p">:</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a><span class="sd">        Auto-detect time delta between last two neighbour candles.</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a><span class="sd">        :return: timedelta object, also saved to `timeframe`.</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">datetime</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">datetime</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">datetime</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a>        <span class="p">)</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Auto-detected timeframe: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span><span class="p">))</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a>    <span class="k">def</span> <span class="nf">LoadFromFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a><span class="sd">        Create Pandas OHLCV-model from CSV-file.</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a><span class="sd">        Default columns in CSV-file are `[&quot;date&quot;, &quot;time&quot;, &quot;open&quot;, &quot;high&quot;, &quot;low&quot;, &quot;close&quot;, &quot;volume&quot;]`.</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a><span class="sd">        :param fileName: path to CSV-file with OHLCV columns.</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a><span class="sd">        :return: Pandas DataFrame.</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Loading, parse and preparing input data from [</span><span class="si">{}</span><span class="s2">]...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">fileName</span><span class="p">)))</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">csvHeaders</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;python&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;datetime&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">]})</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">):</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">)</span>  <span class="c1"># use loaded file &quot;as is&quot; with all candles</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">prices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">horizon</span><span class="p">)</span>  <span class="c1"># remove old candles, leave only the &quot;tail&quot; ...</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">horizon</span><span class="p">)</span>  <span class="c1"># ... and reindex</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ticker</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">DetectTimeframe</span><span class="p">()</span>  <span class="c1"># auto-detect time delta between last two neighbour candles</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;It was read </span><span class="si">{}</span><span class="s2"> rows&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">horizon</span><span class="p">))</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Showing last 5 rows as Pandas DataFrame:&quot;</span><span class="p">)</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a>        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dfHeaders</span><span class="p">][</span><span class="o">-</span><span class="mi">5</span><span class="p">:],</span> <span class="n">max_cols</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a>    <span class="k">def</span> <span class="nf">SaveToFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a><span class="sd">        Save Pandas OHLCV model to CSV-file.</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a><span class="sd">        :param fileName: path to CSV-file.</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Saving [</span><span class="si">{}</span><span class="s2">] rows of Pandas DataFrame with columns: </span><span class="si">{}</span><span class="s2">...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">csvHeaders</span><span class="p">))</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Delimeter: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sep</span><span class="p">))</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a>            <span class="n">dataReplacedDateTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a>            <span class="n">dataReplacedDateTime</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">date</span><span class="p">()</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dataReplacedDateTime</span><span class="p">[</span><span class="s2">&quot;datetime&quot;</span><span class="p">]]</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a>            <span class="n">dataReplacedDateTime</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dataReplacedDateTime</span><span class="p">[</span><span class="s2">&quot;datetime&quot;</span><span class="p">]]</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a>            <span class="k">del</span> <span class="n">dataReplacedDateTime</span><span class="p">[</span><span class="s2">&quot;datetime&quot;</span><span class="p">]</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a>            <span class="n">dataReplacedDateTime</span> <span class="o">=</span> <span class="n">dataReplacedDateTime</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">csvHeaders</span><span class="p">]</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a>            <span class="n">dataReplacedDateTime</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Pandas DataFrame saved to .CSV-file [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">fileName</span><span class="p">)))</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Empty price data! Generate or load prices before saving!&quot;</span><span class="p">)</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a>    <span class="k">def</span> <span class="nf">GetTrend</span><span class="p">(</span><span class="n">firstClose</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">lastClose</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">trendDeviation</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.005</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a><span class="sd">        Get string with trend: `&quot;UP trend&quot;`, `&quot;DOWN trend&quot;` or `&quot;NO trend&quot;`.</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a><span class="sd">        :param firstClose: close of first candle.</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a><span class="sd">        :param lastClose: close of last candle.</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a><span class="sd">        :param trendDeviation: relative deviation for trend detection, 0.005 mean ±0.5% by default.</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a><span class="sd">        :return: string with trend direction `&quot;NO trend&quot;`, `&quot;UP trend&quot;` or `&quot;DOWN trend&quot;`.</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a>        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">firstClose</span> <span class="o">-</span> <span class="n">lastClose</span><span class="p">)</span> <span class="o">/</span> <span class="n">firstClose</span> <span class="o">&lt;=</span> <span class="n">trendDeviation</span><span class="p">:</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a>            <span class="n">trend</span> <span class="o">=</span> <span class="s2">&quot;NO trend&quot;</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a>            <span class="n">trend</span> <span class="o">=</span> <span class="s2">&quot;UP trend&quot;</span> <span class="k">if</span> <span class="n">firstClose</span> <span class="o">&lt;=</span> <span class="n">lastClose</span> <span class="k">else</span> <span class="s2">&quot;DOWN trend&quot;</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a>        <span class="k">return</span> <span class="n">trend</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a>    <span class="k">def</span> <span class="nf">ZigZagFilter</span><span class="p">(</span><span class="n">datetimes</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="nb">list</span><span class="p">],</span> <span class="n">deviation</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a><span class="sd">        This method filter input data as Zig-Zag indicator: when input value of candlestick price (e.g. close price)</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a><span class="sd">        is difference with next values with define percent then this point is a point of Zig-Zag indicator.</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a><span class="sd">        :param datetimes: input Pandas Series with datetime values.</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a><span class="sd">        :param values: input Pandas Series or list, e.g. list of closes values of candlesticks.</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a><span class="sd">        :param deviation: float number in `[0, 1]` interval is a relative difference between `i` and `i + 1` values to set as Zig-Zag point.</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a><span class="sd">        :return: dict with Pandas Series filtered data `{&quot;datetimes&quot;: filtered_datetimes, &quot;filtered&quot;: filtered_values}`.</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a>        <span class="n">filteredPoints</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a>        <span class="n">prev</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)):</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a>            <span class="n">difference</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">prev</span><span class="p">)</span> <span class="o">/</span> <span class="n">prev</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a>            <span class="k">if</span> <span class="n">difference</span> <span class="o">&gt;=</span> <span class="n">deviation</span><span class="p">:</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a>                <span class="n">filteredPoints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a>                <span class="n">prev</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a>                <span class="n">filteredPoints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a>        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;datetimes&quot;</span><span class="p">:</span> <span class="n">datetimes</span><span class="p">[</span><span class="n">filteredPoints</span><span class="p">],</span> <span class="s2">&quot;filtered&quot;</span><span class="p">:</span> <span class="n">values</span><span class="p">[</span><span class="n">filteredPoints</span><span class="p">]}</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a>    <span class="k">def</span> <span class="nf">GetStatistics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a><span class="sd">        Calculates statistics of candles chain.</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a><span class="sd">        :return: list with text in Markdown format with statistics.</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Calculating column with deltas between high and low values...&quot;</span><span class="p">)</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;delta&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">high</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">low</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Calculating column with average values...&quot;</span><span class="p">)</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;avg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">high</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">low</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precision</span><span class="p">)</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Calculating some technical analysis indicators...&quot;</span><span class="p">)</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;sma5&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">sma</span><span class="p">(</span><span class="n">close</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;sma20&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">sma</span><span class="p">(</span><span class="n">close</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;sma50&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">sma</span><span class="p">(</span><span class="n">close</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;sma200&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">sma</span><span class="p">(</span><span class="n">close</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;hma5&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">hma</span><span class="p">(</span><span class="n">close</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;hma20&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">hma</span><span class="p">(</span><span class="n">close</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;vwma5&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">vwma</span><span class="p">(</span><span class="n">close</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">volume</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">volume</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;vwma20&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">vwma</span><span class="p">(</span><span class="n">close</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">volume</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">volume</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a>        <span class="n">bbands</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">bbands</span><span class="p">(</span><span class="n">close</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mamode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a>        <span class="n">bbands</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;lower&quot;</span><span class="p">,</span> <span class="s2">&quot;mid&quot;</span><span class="p">,</span> <span class="s2">&quot;upper&quot;</span><span class="p">,</span> <span class="s2">&quot;bandwidth&quot;</span><span class="p">,</span> <span class="s2">&quot;percent&quot;</span><span class="p">]</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a>        <span class="n">psar</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">psar</span><span class="p">(</span><span class="n">high</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">high</span><span class="p">,</span> <span class="n">low</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">low</span><span class="p">,</span> <span class="n">close</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">af</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">max_af</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a>        <span class="n">psar</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;long&quot;</span><span class="p">,</span> <span class="s2">&quot;short&quot;</span><span class="p">,</span> <span class="s2">&quot;af&quot;</span><span class="p">,</span> <span class="s2">&quot;reversal&quot;</span><span class="p">]</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;hma13&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">hma</span><span class="p">(</span><span class="n">close</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>  <span class="c1"># alligator Jaw</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;hma8&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">hma</span><span class="p">(</span><span class="n">close</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>  <span class="c1"># alligator Teeth</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;hma5&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">hma</span><span class="p">(</span><span class="n">close</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># alligator Lips</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a>        <span class="n">zigzag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ZigZagFilter</span><span class="p">(</span><span class="n">datetimes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">deviation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zigZagDeviation</span><span class="p">)</span>  <span class="c1"># ZigZag indicator</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">DetectPrecision</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>  <span class="c1"># auto-detect precision</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_chartTitle</span> <span class="o">=</span> <span class="s2">&quot;Instrument: </span><span class="si">{}</span><span class="s2">, timeframe: </span><span class="si">{}</span><span class="s2">, horizon length: </span><span class="si">{}</span><span class="s2"> (from </span><span class="si">{}</span><span class="s2"> to </span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">ticker</span><span class="p">,</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">FormattedDelta</span><span class="p">(</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{days}</span><span class="s2"> days </span><span class="si">{hours}</span><span class="s2">h </span><span class="si">{minutes}</span><span class="s2">m </span><span class="si">{seconds}</span><span class="s2">s&quot;</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a>            <span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span> <span class="o">&gt;=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">FormattedDelta</span><span class="p">(</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{hours}</span><span class="s2">h </span><span class="si">{minutes}</span><span class="s2">m </span><span class="si">{seconds}</span><span class="s2">s&quot;</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a>            <span class="p">),</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span><span class="p">,</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a>            <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">),</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a>            <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">),</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a>        <span class="p">)</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;candles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">)</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;precision&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;closeFirst&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;closeLast&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;closeMax&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;closeMin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;diapason&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;closeMax&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;closeMin&quot;</span><span class="p">]</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;trend&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetTrend</span><span class="p">(</span><span class="n">firstClose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;closeFirst&quot;</span><span class="p">],</span> <span class="n">lastClose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;closeLast&quot;</span><span class="p">],</span> <span class="n">trendDeviation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trendDeviation</span><span class="p">)</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;up&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">open</span>  <span class="c1"># True mean that is up candle, and False mean down</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a>        <span class="n">upList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">up</span><span class="p">)</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a>        <span class="n">upChainsLengths</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">chain</span><span class="p">))</span> <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">chain</span> <span class="ow">in</span> <span class="n">groupby</span><span class="p">(</span><span class="n">upList</span><span class="p">)</span> <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">]</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a>        <span class="n">downChainsLengths</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">chain</span><span class="p">))</span> <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">chain</span> <span class="ow">in</span> <span class="n">groupby</span><span class="p">(</span><span class="n">upList</span><span class="p">)</span> <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">]</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;trendDev&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendDeviation</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;upCount&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">up</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">up</span> <span class="o">==</span> <span class="kc">True</span><span class="p">])</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;downCount&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">up</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">up</span> <span class="o">==</span> <span class="kc">False</span><span class="p">])</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;upCountChainMax&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">upChainsLengths</span><span class="p">)</span> <span class="k">if</span> <span class="n">upChainsLengths</span> <span class="k">else</span> <span class="mi">1</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;downCountChainMax&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">downChainsLengths</span><span class="p">)</span> <span class="k">if</span> <span class="n">downChainsLengths</span> <span class="k">else</span> <span class="mi">1</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;deltas&quot;</span><span class="p">][</span><span class="s2">&quot;max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">delta</span><span class="p">)</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;deltas&quot;</span><span class="p">][</span><span class="s2">&quot;min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">delta</span><span class="p">)</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;deltas&quot;</span><span class="p">][</span><span class="s2">&quot;stDev&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">pstdev</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">delta</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precision</span><span class="p">)</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;deltas&quot;</span><span class="p">][</span><span class="s2">&quot;q99&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">delta</span><span class="p">)</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precision</span><span class="p">)</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;deltas&quot;</span><span class="p">][</span><span class="s2">&quot;q95&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">delta</span><span class="p">)</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precision</span><span class="p">)</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;deltas&quot;</span><span class="p">][</span><span class="s2">&quot;q80&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">delta</span><span class="p">)</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="mf">0.80</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precision</span><span class="p">)</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;deltas&quot;</span><span class="p">][</span><span class="s2">&quot;q50&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">delta</span><span class="p">)</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="mf">0.50</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precision</span><span class="p">)</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;cumSumVolumes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">volume</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;sma5&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;sma5&quot;</span><span class="p">]</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;sma20&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;sma20&quot;</span><span class="p">]</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;sma50&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;sma50&quot;</span><span class="p">]</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;sma200&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;sma200&quot;</span><span class="p">]</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;hma5&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;hma5&quot;</span><span class="p">]</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;hma20&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;hma20&quot;</span><span class="p">]</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;vwma5&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;vwma5&quot;</span><span class="p">]</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;vwma20&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;vwma20&quot;</span><span class="p">]</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;bbands&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bbands</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;psar&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">psar</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;hma13&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;hma13&quot;</span><span class="p">]</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;hma8&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;hma8&quot;</span><span class="p">]</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;hma5&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;hma5&quot;</span><span class="p">]</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;zigzag3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">zigzag</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a>        <span class="n">summary</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a>            <span class="s2">&quot;# Summary&quot;</span><span class="p">,</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a>            <span class="s2">&quot;- Candles count: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;candles&quot;</span><span class="p">]),</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a>            <span class="s2">&quot;- Timeframe: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span><span class="p">),</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a>            <span class="s2">&quot;- Precision (signs after comma): </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;precision&quot;</span><span class="p">]),</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a>            <span class="s2">&quot;- Close, first: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;closeFirst&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)),</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a>            <span class="s2">&quot;- Close, last: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;closeLast&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)),</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a>            <span class="s2">&quot;- Close, max: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;closeMax&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)),</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a>            <span class="s2">&quot;- Close, min: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;closeMin&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)),</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a>            <span class="s2">&quot;- Diapason, |close_max - close_min|: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;diapason&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)),</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a>            <span class="s2">&quot;- Trend, |close_1st - close_last|: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;trend&quot;</span><span class="p">]),</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a>            <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a>            <span class="s2">&quot;# Statistics&quot;</span><span class="p">,</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a>            <span class="s2">&quot;- Up candles count: </span><span class="si">{}</span><span class="s2"> (</span><span class="si">{}</span><span class="s2">%)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;upCount&quot;</span><span class="p">],</span> <span class="nb">round</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;upCount&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;candles&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)),</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a>            <span class="s2">&quot;- Down candles count: </span><span class="si">{}</span><span class="s2"> (</span><span class="si">{}</span><span class="s2">%)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;downCount&quot;</span><span class="p">],</span> <span class="nb">round</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;downCount&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;candles&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)),</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a>            <span class="s2">&quot;- Max of up / down candle chains: </span><span class="si">{}</span><span class="s2"> / </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;upCountChainMax&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;downCountChainMax&quot;</span><span class="p">]),</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a>            <span class="s2">&quot;- Max delta, |high - low|: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;deltas&quot;</span><span class="p">][</span><span class="s2">&quot;max&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)),</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a>            <span class="s2">&quot;- Min delta, |high - low|: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;deltas&quot;</span><span class="p">][</span><span class="s2">&quot;min&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)),</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a>            <span class="s2">&quot;- Delta&#39;s std. dev.: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;deltas&quot;</span><span class="p">][</span><span class="s2">&quot;stDev&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)),</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a>            <span class="s2">&quot;  - 99 percentile: ≤ </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;deltas&quot;</span><span class="p">][</span><span class="s2">&quot;q99&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)),</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a>            <span class="s2">&quot;  - 95 percentile: ≤ </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;deltas&quot;</span><span class="p">][</span><span class="s2">&quot;q95&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)),</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a>            <span class="s2">&quot;  - 80 percentile: ≤ </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;deltas&quot;</span><span class="p">][</span><span class="s2">&quot;q80&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)),</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a>            <span class="s2">&quot;- Cumulative sum of volumes: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;cumSumVolumes&quot;</span><span class="p">]),</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a>        <span class="p">]</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Some statistics:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">summary</span><span class="p">)))</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a>        <span class="k">return</span> <span class="n">summary</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a>    <span class="k">def</span> <span class="nf">_GenNextCandle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lastClose</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a><span class="sd">        Generator for creating 1 next candle based on global probability parameters.</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a><span class="sd">        :param lastClose: value of last close price.</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a><span class="sd">        :return: one OHLCV-candle as dict.</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a>        <span class="n">candle</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a>            <span class="s2">&quot;open&quot;</span><span class="p">:</span> <span class="n">lastClose</span><span class="p">,</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a>            <span class="s2">&quot;high&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a>            <span class="s2">&quot;low&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a>            <span class="s2">&quot;close&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a>            <span class="s2">&quot;volume&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">maxVolume</span><span class="p">)</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a>        <span class="p">}</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a>        <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">upCandlesProb</span><span class="p">:</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a>            <span class="n">maxBody</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxClose</span><span class="p">,</span> <span class="n">candle</span><span class="p">[</span><span class="s2">&quot;open&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxCandleBody</span><span class="p">)</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a>            <span class="n">candle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">candle</span><span class="p">[</span><span class="s2">&quot;open&quot;</span><span class="p">],</span> <span class="n">b</span><span class="o">=</span><span class="n">maxBody</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)</span>  <span class="c1"># up candle</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a>            <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outliersProb</span><span class="p">:</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a>                <span class="n">candle</span><span class="p">[</span><span class="s2">&quot;high&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">candle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">],</span> <span class="n">b</span><span class="o">=</span><span class="n">candle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxOutlier</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)</span>  <span class="c1"># with outlier price &quot;tails&quot;</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a>                <span class="n">candle</span><span class="p">[</span><span class="s2">&quot;low&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">candle</span><span class="p">[</span><span class="s2">&quot;open&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxOutlier</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">candle</span><span class="p">[</span><span class="s2">&quot;open&quot;</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a>                <span class="n">halfBody</span> <span class="o">=</span> <span class="p">(</span><span class="n">candle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">candle</span><span class="p">[</span><span class="s2">&quot;open&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a>                <span class="n">candle</span><span class="p">[</span><span class="s2">&quot;high&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">candle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">],</span> <span class="n">b</span><span class="o">=</span><span class="n">candle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">halfBody</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)</span>  <span class="c1"># without outlier price &quot;tails&quot;</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a>                <span class="n">candle</span><span class="p">[</span><span class="s2">&quot;low&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">candle</span><span class="p">[</span><span class="s2">&quot;open&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">halfBody</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">candle</span><span class="p">[</span><span class="s2">&quot;open&quot;</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a>            <span class="n">minBody</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minClose</span><span class="p">,</span> <span class="n">candle</span><span class="p">[</span><span class="s2">&quot;open&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxCandleBody</span><span class="p">)</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a>            <span class="n">candle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">minBody</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">candle</span><span class="p">[</span><span class="s2">&quot;open&quot;</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)</span>  <span class="c1"># down candle</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a>            <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outliersProb</span><span class="p">:</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a>                <span class="n">candle</span><span class="p">[</span><span class="s2">&quot;high&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">candle</span><span class="p">[</span><span class="s2">&quot;open&quot;</span><span class="p">],</span> <span class="n">b</span><span class="o">=</span><span class="n">candle</span><span class="p">[</span><span class="s2">&quot;open&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxOutlier</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)</span>  <span class="c1"># with outlier price &quot;tails&quot;</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a>                <span class="n">candle</span><span class="p">[</span><span class="s2">&quot;low&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">candle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxOutlier</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">candle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a>                <span class="n">halfBody</span> <span class="o">=</span> <span class="p">(</span><span class="n">candle</span><span class="p">[</span><span class="s2">&quot;open&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">candle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a>                <span class="n">candle</span><span class="p">[</span><span class="s2">&quot;high&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">candle</span><span class="p">[</span><span class="s2">&quot;open&quot;</span><span class="p">],</span> <span class="n">b</span><span class="o">=</span><span class="n">candle</span><span class="p">[</span><span class="s2">&quot;open&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">halfBody</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)</span>  <span class="c1"># without outlier price &quot;tails&quot;</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a>                <span class="n">candle</span><span class="p">[</span><span class="s2">&quot;low&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">candle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">halfBody</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">candle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a>        <span class="k">return</span> <span class="n">candle</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a>    <span class="k">def</span> <span class="nf">Generate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a><span class="sd">        Main method to generating prices.</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a><span class="sd">        :return Pandas DataFrame object with OHLCV-candlestick in every row and also saving it to the `prices`.</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Horizon length less than 5! It is set to 5 by default.&quot;</span><span class="p">)</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a>            <span class="c1"># Detecting input trend:</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a>            <span class="k">if</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span> <span class="ow">or</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span><span class="p">:</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a>                <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Detected old-style string for split trend: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span><span class="p">))</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;-no-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;-up-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;-down-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a>                <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Detected new-style string for split trend: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span><span class="p">))</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span> <span class="o">=</span> <span class="s2">&quot;-</span><span class="si">{}</span><span class="s2">-&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span><span class="p">)</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-u-&quot;</span><span class="p">,</span> <span class="s2">&quot;-up-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-d-&quot;</span><span class="p">,</span> <span class="s2">&quot;-down-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-n-&quot;</span><span class="p">,</span> <span class="s2">&quot;-no-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;New style string for trend split is set: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span><span class="p">))</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a>            <span class="n">trends</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Trends list: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trends</span><span class="p">))</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trends</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span><span class="p">:</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a>                <span class="n">trends</span> <span class="o">=</span> <span class="n">trends</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a>                <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Trend parts count (</span><span class="si">{}</span><span class="s2">) must be less than horizon (</span><span class="si">{}</span><span class="s2">)! New trend will be used: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">trends</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span><span class="p">,</span> <span class="n">trends</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a>            <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">trends</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">horizon</span><span class="p">]</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a>                <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Only one trend will be used with length equal to horizon: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span><span class="p">))</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">trends</span><span class="p">):</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a>                <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Random trend direction will be used, because trends count not equal to split count!&quot;</span><span class="p">)</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a>            <span class="n">trends</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a>        <span class="c1"># maximum of candle sizes: (high - low), if None then used (maxClose - minClose) / 10</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxOutlier</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">maxOutlier</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxClose</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">minClose</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a>        <span class="c1"># maximum of candle body sizes: abs(open - close), if None then used maxOutlier * 90%</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxCandleBody</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">maxCandleBody</span> <span class="o">=</span> <span class="mf">0.9</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxOutlier</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a>        <span class="c1"># initClose is the last close price (left on chart or &quot;before&quot; 1st generated candle), 1st candle[&quot;open&quot;] = initClose</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initClose</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">initClose</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">minClose</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">maxClose</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generating prices...&quot;</span><span class="p">)</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;- Ticker name: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ticker</span><span class="p">))</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;- Precision: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">))</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;- Interval or timeframe (time delta between two neighbour candles): </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span><span class="p">))</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;- Horizon length (candlesticks count): </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">horizon</span><span class="p">))</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span><span class="p">:</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;- Trend type: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span><span class="p">))</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;- Candlesticks count in every mini-trend: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span><span class="p">))</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;- Start time: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeStart</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)))</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;  |-&gt; end time: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">timeStart</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)))</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;- Maximum of close prices: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxClose</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)))</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;- Minimum of close prices: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minClose</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)))</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;- Maximum of candle body sizes: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxCandleBody</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)))</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;- Maximum of candle tails outlier sizes: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxOutlier</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)))</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;- Init close (1st open price in chain): </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initClose</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)))</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;- Maximum of volume of one candle: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxVolume</span><span class="p">))</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;- Probability that next candle is up: </span><span class="si">{}</span><span class="s2">%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">upCandlesProb</span> <span class="o">*</span> <span class="mi">100</span><span class="p">))</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;- Statistical outliers probability: </span><span class="si">{}</span><span class="s2">%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outliersProb</span> <span class="o">*</span> <span class="mi">100</span><span class="p">))</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a>        <span class="c1"># -- Preparing candles chain:</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span><span class="p">:</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a>            <span class="n">userProb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">upCandlesProb</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a>            <span class="n">userHorizon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a>            <span class="n">userInitC</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initClose</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a>            <span class="n">candles</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a>            <span class="k">for</span> <span class="n">trendNum</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">trends</span><span class="p">)):</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span><span class="p">[</span><span class="n">trendNum</span><span class="p">]</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">initClose</span> <span class="o">=</span> <span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">trendNum</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">initClose</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a>                <span class="c1"># change probability of candles direction in next trend:</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a>                <span class="k">if</span> <span class="n">trends</span><span class="p">[</span><span class="n">trendNum</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;up&quot;</span><span class="p">:</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">upCandlesProb</span> <span class="o">=</span> <span class="mf">0.51</span> <span class="k">if</span> <span class="n">userProb</span> <span class="o">&lt;=</span> <span class="mf">0.5</span> <span class="k">else</span> <span class="n">userProb</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a>                <span class="k">elif</span> <span class="n">trends</span><span class="p">[</span><span class="n">trendNum</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;down&quot;</span><span class="p">:</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">upCandlesProb</span> <span class="o">=</span> <span class="mf">0.49</span> <span class="k">if</span> <span class="n">userProb</span> <span class="o">&gt;=</span> <span class="mf">0.5</span> <span class="k">else</span> <span class="n">userProb</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a>                <span class="k">elif</span> <span class="n">trends</span><span class="p">[</span><span class="n">trendNum</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;no&quot;</span><span class="p">:</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">upCandlesProb</span> <span class="o">=</span> <span class="mf">0.5</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a>                    <span class="n">uLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Unknown direction used: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trends</span><span class="p">[</span><span class="n">trendNum</span><span class="p">]))</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a>                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unknown direction&quot;</span><span class="p">)</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a>                <span class="n">firstCandle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_GenNextCandle</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initClose</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">))</span>  <span class="c1"># first candle in next trend</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a>                <span class="n">candles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">firstCandle</span><span class="p">)</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a>                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span><span class="p">):</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a>                    <span class="n">candles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_GenNextCandle</span><span class="p">(</span><span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;close&quot;</span><span class="p">]))</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a>                <span class="n">highDelta</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;high&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="nb">max</span><span class="p">(</span><span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;open&quot;</span><span class="p">],</span> <span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;close&quot;</span><span class="p">]))</span>  <span class="c1"># save higher shadow</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a>                <span class="n">lowDelta</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;open&quot;</span><span class="p">],</span> <span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;close&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;low&quot;</span><span class="p">])</span>  <span class="c1"># save lower shadow</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a>                <span class="c1"># -- Change last candle in every trend:</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a>                <span class="k">if</span> <span class="n">trends</span><span class="p">[</span><span class="n">trendNum</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;up&quot;</span><span class="p">:</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a>                    <span class="k">if</span> <span class="n">firstCandle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;close&quot;</span><span class="p">]:</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a>                        <span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">firstCandle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">],</span> <span class="n">b</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">maxClose</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a>                <span class="k">elif</span> <span class="n">trends</span><span class="p">[</span><span class="n">trendNum</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;down&quot;</span><span class="p">:</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a>                    <span class="k">if</span> <span class="n">firstCandle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;close&quot;</span><span class="p">]:</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a>                        <span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">minClose</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">firstCandle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a>                <span class="k">else</span><span class="p">:</span>  <span class="c1"># if NO trend:</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a>                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">firstCandle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;close&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="n">firstCandle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendDeviation</span><span class="p">:</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a>                        <span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a>                            <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a>                                <span class="n">a</span><span class="o">=</span><span class="n">firstCandle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">firstCandle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendDeviation</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a>                                <span class="n">b</span><span class="o">=</span><span class="n">firstCandle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">firstCandle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendDeviation</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a>                            <span class="p">),</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">,</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a>                        <span class="p">)</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a>                <span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;high&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;open&quot;</span><span class="p">],</span> <span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;close&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="n">highDelta</span>  <span class="c1"># fixing higher shadow</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a>                <span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;low&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;open&quot;</span><span class="p">],</span> <span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;close&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="n">lowDelta</span>  <span class="c1"># fixing lower shadow</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">upCandlesProb</span> <span class="o">=</span> <span class="n">userProb</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span> <span class="o">=</span> <span class="n">userHorizon</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">initClose</span> <span class="o">=</span> <span class="n">userInitC</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a>            <span class="n">candles</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_GenNextCandle</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initClose</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">))]</span>  <span class="c1"># first candle in chain</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a>            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span><span class="p">):</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a>                <span class="n">candles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_GenNextCandle</span><span class="p">(</span><span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;close&quot;</span><span class="p">]))</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a>        <span class="c1"># prepare Dataframe from generated prices:</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a>        <span class="n">indx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a>            <span class="n">start</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeStart</span><span class="p">,</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a>            <span class="n">end</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeStart</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">horizon</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span><span class="p">,</span>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a>            <span class="n">freq</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span><span class="p">,</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a>            <span class="n">tz</span><span class="o">=</span><span class="n">tzlocal</span><span class="p">(),</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a>        <span class="p">)</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">candles</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dfHeaders</span><span class="p">)</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span> <span class="o">=</span> <span class="n">indx</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Showing last 5 rows of Pandas generated dataframe object:&quot;</span><span class="p">)</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a>        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dfHeaders</span><span class="p">][</span><span class="o">-</span><span class="mi">5</span><span class="p">:],</span> <span class="n">max_cols</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a>    <span class="k">def</span> <span class="nf">RenderBokeh</span><span class="p">(</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;index.html&quot;</span><span class="p">,</span> <span class="n">viewInBrowser</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a>            <span class="n">darkTheme</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">markers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">lines</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a>            <span class="n">title</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1800</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">940</span><span class="p">,</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a>            <span class="n">showControlsOnChart</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">showStatOnChart</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">inline</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">gridplot</span><span class="p">]:</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a><span class="sd">        Rendering prices from Pandas DataFrame as OHLCV Bokeh chart of candlesticks and save it to HTML-file.</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a><span class="sd">        Pandas DataFrame in `prices` variable must contain &quot;datetime&quot;, &quot;open&quot;, &quot;high&quot;, &quot;low&quot;, &quot;close&quot; and &quot;volume&quot; columns.</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a><span class="sd">        See also: https://docs.bokeh.org/en/latest/docs/gallery/candlestick.html</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a><span class="sd">        :param fileName: HTML-file path to save Bokeh chart. `index.html` by default.</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a><span class="sd">        :param viewInBrowser: If `True`, then immediately opens HTML chart in browser after rendering. `False` by default.</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a><span class="sd">        :param darkTheme: chart theme. `False` by default, mean that will be used light theme, `False` mean dark theme.</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a><span class="sd">        :param markers: Pandas DataFrame with additional markers that will be placed on main series. `None` by default.</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a><span class="sd">                        Marker is a custom symbol, example: ×, ↓ or ↑. Dataframe with markers must contain at least two columns.</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a><span class="sd">                        There are `datetime` with date and time and some markers columns (`markersUpper`, `markersCenter` or `markersLower`).</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a><span class="sd">                        Length of markers series must be equal to the length of main candles series.</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a><span class="sd">        :param lines: list with custom series, where additional chart-lines will place on main series. `None` by default.</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a><span class="sd">                      Line data must contain at least two columns. There are `datetime` with date and time and</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a><span class="sd">                      `custom_line_name` with y-coordinates. Length of the chart-line dataframes must be equal to the length of main candle series.</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a><span class="sd">        :param title: specific chart title. If `None`, then used auto-generated title. `None` by default.</span>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a><span class="sd">        :param width: chart width. If `None`, then used auto-width. 1800 px by default.</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a><span class="sd">        :param height: chart height. If `None`, then used auto-height. 940 px by default.</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a><span class="sd">        :param showControlsOnChart: enable controls block in legend to hide/show some elements on chart, `True` by default.</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a><span class="sd">        :param showStatOnChart: show statistics block on chart, `True` (by default) mean that will be calculating additional</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a><span class="sd">                                series, like as Trend and Average Points. And some classical indicators, like as SMA, HMA,</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a><span class="sd">                                VWMA, Bollinger Bands, Parabolic Stop and Reverse, Alligator and Zig-Zag indicator.</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a><span class="sd">                                Warning! Calculate statistic takes more time. If you want to decrease chart rendering time,</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a><span class="sd">                                then set this parameter to `False`.</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a><span class="sd">        :param inline: if `True`, then output chart in Jupyter Notebook cell. `False` by default.</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a><span class="sd">        :return: bokeh.layouts.gridplot with all layouts objects or None.</span>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Empty price data! Generate or load prices before show as Bokeh chart!&quot;</span><span class="p">)</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Rendering Pandas DataFrame as Bokeh chart...&quot;</span><span class="p">)</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">DetectTimeframe</span><span class="p">()</span>  <span class="c1"># auto-detect time delta between last two neighbour candles</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a>            <span class="n">infoBlock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetStatistics</span><span class="p">()</span> <span class="k">if</span> <span class="n">showStatOnChart</span> <span class="k">else</span> <span class="p">[]</span>  <span class="c1"># calculating some indicators</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chartTitle</span> <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">title</span> <span class="k">else</span> <span class="n">title</span>  <span class="c1"># chart title</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a>            <span class="n">width</span> <span class="o">=</span> <span class="mi">1200</span> <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">width</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">width</span>  <span class="c1"># chart summary width</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a>            <span class="n">height</span> <span class="o">=</span> <span class="mi">800</span> <span class="k">if</span> <span class="n">height</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">height</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">height</span> <span class="o">-</span> <span class="mi">90</span>  <span class="c1"># chart summary height</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Preparing Bokeh chart configuration...&quot;</span><span class="p">)</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Title: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">title</span><span class="p">))</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a>            <span class="k">if</span> <span class="n">inline</span><span class="p">:</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a>                <span class="n">output_notebook</span><span class="p">(</span><span class="n">resources</span><span class="o">=</span><span class="n">INLINE</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">hide_banner</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># set output to notebook cell</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a>            <span class="c1"># --- Preparing Main chart:</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a>            <span class="n">chart</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a>                <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a>                <span class="n">x_axis_type</span><span class="o">=</span><span class="s2">&quot;datetime&quot;</span><span class="p">,</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a>                <span class="n">x_axis_label</span><span class="o">=</span><span class="s2">&quot;Date and time&quot;</span><span class="p">,</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a>                <span class="n">y_axis_label</span><span class="o">=</span><span class="s2">&quot;Price&quot;</span><span class="p">,</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a>                <span class="n">outline_line_width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a>                <span class="n">outline_line_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a>                <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pan&quot;</span><span class="p">,</span> <span class="s2">&quot;wheel_zoom&quot;</span><span class="p">,</span> <span class="s2">&quot;box_zoom&quot;</span><span class="p">,</span> <span class="s2">&quot;hover&quot;</span><span class="p">,</span> <span class="s2">&quot;reset&quot;</span><span class="p">,</span> <span class="s2">&quot;save&quot;</span><span class="p">],</span>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a>                <span class="n">toolbar_location</span><span class="o">=</span><span class="s2">&quot;above&quot;</span><span class="p">,</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a>                <span class="n">active_scroll</span><span class="o">=</span><span class="s2">&quot;wheel_zoom&quot;</span><span class="p">,</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a>                <span class="n">min_width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a>                <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a>                <span class="n">sizing_mode</span><span class="o">=</span><span class="s2">&quot;scale_width&quot;</span><span class="p">,</span>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a>                <span class="n">background_fill_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a>                <span class="n">min_border_left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a>                <span class="n">min_border_right</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a>                <span class="n">min_border_top</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a>                <span class="n">min_border_bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a>                <span class="n">y_range</span><span class="o">=</span><span class="n">Range1d</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">low</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">high</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span><span class="p">),</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a>            <span class="p">)</span>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a>            <span class="n">chart</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">logo</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># remove bokeh logo and link to https://bokeh.org/</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a>            <span class="n">chart</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">major_label_orientation</span> <span class="o">=</span> <span class="n">pi</span> <span class="o">/</span> <span class="mi">6</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a>            <span class="n">chart</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">grid_line_dash</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a>            <span class="n">chart</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">grid_line_alpha</span> <span class="o">=</span> <span class="mf">0.4</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a>            <span class="n">chart</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">minor_grid_line_dash</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a>            <span class="n">chart</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">minor_grid_line_alpha</span> <span class="o">=</span> <span class="mf">0.4</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a>            <span class="n">chart</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">minor_grid_line_dash</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a>            <span class="n">chart</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">minor_grid_line_alpha</span> <span class="o">=</span> <span class="mf">0.3</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a>            <span class="n">chart</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">minor_grid_line_color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;gray&quot;</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a>            <span class="n">chart</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">minor_grid_line_dash</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a>            <span class="n">chart</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">minor_grid_line_alpha</span> <span class="o">=</span> <span class="mf">0.3</span>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a>            <span class="n">chart</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">minor_grid_line_color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;gray&quot;</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a>            <span class="k">if</span> <span class="n">showStatOnChart</span><span class="p">:</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a>                <span class="n">summaryItems</span> <span class="o">=</span> <span class="p">[(</span><span class="n">info</span><span class="p">,</span> <span class="p">[])</span> <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">infoBlock</span><span class="p">]</span>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a>                <span class="k">if</span> <span class="n">showControlsOnChart</span><span class="p">:</span>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a>                    <span class="n">summaryItems</span> <span class="o">+=</span> <span class="p">[(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="p">[]),</span> <span class="p">(</span><span class="s2">&quot;Click to show/hide on chart:&quot;</span><span class="p">,</span> <span class="p">[])]</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a>                <span class="n">summaryItems</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;Click to show/hide on chart:&quot;</span><span class="p">,</span> <span class="p">[])]</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="p">[(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="p">[])]</span>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a>            <span class="n">summaryInfo</span> <span class="o">=</span> <span class="n">Legend</span><span class="p">(</span>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a>                <span class="n">click_policy</span><span class="o">=</span><span class="s2">&quot;hide&quot;</span><span class="p">,</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a>                <span class="n">items</span><span class="o">=</span><span class="n">summaryItems</span><span class="p">,</span>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a>                <span class="n">location</span><span class="o">=</span><span class="s2">&quot;top_right&quot;</span><span class="p">,</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a>                <span class="n">label_text_font_size</span><span class="o">=</span><span class="s2">&quot;8pt&quot;</span><span class="p">,</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a>                <span class="n">margin</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a>                <span class="n">padding</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a>                <span class="n">spacing</span><span class="o">=-</span><span class="mi">5</span><span class="p">,</span>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a>                <span class="n">label_text_font</span><span class="o">=</span><span class="s2">&quot;Lucida Console&quot;</span><span class="p">,</span>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a>            <span class="p">)</span>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a>            <span class="n">chart</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">summaryInfo</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">)</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a>            <span class="c1"># preparing data for candles:</span>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a>            <span class="n">inc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">open</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a>            <span class="n">dec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">open</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a>            <span class="n">candleWidth</span> <span class="o">=</span> <span class="mi">108000</span>  <span class="c1"># as for 5 minutes by default</span>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span> <span class="o">&lt;=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">31</span><span class="p">):</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a>                <span class="n">candleWidth</span> <span class="o">=</span> <span class="mi">864000000</span>  <span class="c1"># 12 * 60 * 60 * 25 * 800  # for 43200 minutes</span>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span> <span class="o">&lt;=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">):</span>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a>                <span class="n">candleWidth</span> <span class="o">=</span> <span class="mi">216000000</span>  <span class="c1"># 12 * 60 * 60 * 25 * 200  # for 10080 minutes</span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span> <span class="o">&lt;=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a>                <span class="n">candleWidth</span> <span class="o">=</span> <span class="mi">32400000</span>  <span class="c1"># 12 * 60 * 60 * 25 * 30  # for 1440 minutes</span>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span> <span class="o">&lt;=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a>                <span class="n">candleWidth</span> <span class="o">=</span> <span class="mi">6480000</span>  <span class="c1"># 12 * 60 * 60 * 25 * 6  # for 240 minutes</span>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span> <span class="o">&lt;=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a>                <span class="n">candleWidth</span> <span class="o">=</span> <span class="mi">1620000</span>  <span class="c1"># 12 * 60 * 60 * 25 * 1.5  # for 60 minutes</span>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span> <span class="o">&lt;=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a>                <span class="n">candleWidth</span> <span class="o">=</span> <span class="mi">648000</span>  <span class="c1"># 12 * 60 * 60 * 15  # for 30 minutes</span>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span> <span class="o">&lt;=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">15</span><span class="p">):</span>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a>                <span class="n">candleWidth</span> <span class="o">=</span> <span class="mi">345600</span>  <span class="c1"># 12 * 60 * 60 * 8  # for 15 minutes</span>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span> <span class="o">&lt;=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a>                <span class="n">candleWidth</span> <span class="o">=</span> <span class="mi">108000</span>  <span class="c1"># 12 * 60 * 60 * 2.5  # for 5 minutes</span>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span> <span class="o">&lt;=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a>                <span class="n">candleWidth</span> <span class="o">=</span> <span class="mi">21600</span>  <span class="c1"># 12 * 60 * 30   # for 1 minute</span>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a>            <span class="n">disabledObjects</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># bokeh objects to hide by default when page is loaded</span>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a>
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a>            <span class="c1"># preparing data for hover tooltips:</span>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a>            <span class="n">source</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a>                <span class="s2">&quot;candle&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a>                <span class="s2">&quot;datetime&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a>                <span class="s2">&quot;open&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">open</span><span class="p">,</span>
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a>                <span class="s2">&quot;high&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">high</span><span class="p">,</span>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a>                <span class="s2">&quot;low&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">low</span><span class="p">,</span>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a>                <span class="s2">&quot;close&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">,</span>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a>                <span class="s2">&quot;volume&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">volume</span><span class="p">,</span>
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a>            <span class="p">}</span>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a>            <span class="n">hoverData</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">source</span><span class="p">)</span>
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a>            <span class="n">hover</span> <span class="o">=</span> <span class="n">chart</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">HoverTool</span><span class="p">))</span>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a>            <span class="n">hover</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;candle&quot;</span>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a>            <span class="n">hover</span><span class="o">.</span><span class="n">tooltips</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a>                <span class="p">(</span><span class="s2">&quot;Candle&quot;</span><span class="p">,</span> <span class="s2">&quot;@candle&quot;</span><span class="p">),</span>
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a>                <span class="p">(</span><span class="s2">&quot;Date&quot;</span><span class="p">,</span> <span class="s2">&quot;@datetime{%Y-%m-</span><span class="si">%d</span><span class="s2">}&quot;</span><span class="p">),</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a>                <span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">,</span> <span class="s2">&quot;@datetime{%H:%M:%S}&quot;</span><span class="p">),</span>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a>                <span class="p">(</span><span class="s2">&quot;Open&quot;</span><span class="p">,</span> <span class="s2">&quot;@open</span><span class="si">{0.0000}</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a>                <span class="p">(</span><span class="s2">&quot;High&quot;</span><span class="p">,</span> <span class="s2">&quot;@high</span><span class="si">{0.0000}</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a>                <span class="p">(</span><span class="s2">&quot;Low&quot;</span><span class="p">,</span> <span class="s2">&quot;@low</span><span class="si">{0.0000}</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a>                <span class="p">(</span><span class="s2">&quot;Close&quot;</span><span class="p">,</span> <span class="s2">&quot;@close</span><span class="si">{0.0000}</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a>                <span class="p">(</span><span class="s2">&quot;Volume&quot;</span><span class="p">,</span> <span class="s2">&quot;@volume&quot;</span><span class="p">),</span>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a>            <span class="p">]</span>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a>            <span class="n">hover</span><span class="o">.</span><span class="n">formatters</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a>                <span class="s2">&quot;@datetime&quot;</span><span class="p">:</span> <span class="s2">&quot;datetime&quot;</span><span class="p">,</span>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a>                <span class="s2">&quot;@open&quot;</span><span class="p">:</span> <span class="s2">&quot;numeral&quot;</span><span class="p">,</span>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a>                <span class="s2">&quot;@high&quot;</span><span class="p">:</span> <span class="s2">&quot;numeral&quot;</span><span class="p">,</span>
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a>                <span class="s2">&quot;@low&quot;</span><span class="p">:</span> <span class="s2">&quot;numeral&quot;</span><span class="p">,</span>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a>                <span class="s2">&quot;@close&quot;</span><span class="p">:</span> <span class="s2">&quot;numeral&quot;</span><span class="p">,</span>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a>            <span class="p">}</span>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a>            <span class="n">hover</span><span class="o">.</span><span class="n">point_policy</span> <span class="o">=</span> <span class="s2">&quot;snap_to_data&quot;</span>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a>            <span class="n">hover</span><span class="o">.</span><span class="n">line_policy</span> <span class="o">=</span> <span class="s2">&quot;nearest&quot;</span>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a>            <span class="n">hover</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;vline&quot;</span>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a>            <span class="c1"># --- preparing body of candles:</span>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a>            <span class="n">hoverOnCandles</span> <span class="o">=</span> <span class="n">chart</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a>                <span class="n">x0</span><span class="o">=</span><span class="s2">&quot;datetime&quot;</span><span class="p">,</span> <span class="n">y0</span><span class="o">=</span><span class="s2">&quot;high&quot;</span><span class="p">,</span> <span class="n">x1</span><span class="o">=</span><span class="s2">&quot;datetime&quot;</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="s2">&quot;low&quot;</span><span class="p">,</span>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a>                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#20ff00&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a>                <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;candle&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">hoverData</span><span class="p">,</span>
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a>            <span class="p">)</span>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a>            <span class="n">hover</span><span class="o">.</span><span class="n">renderers</span> <span class="o">=</span> <span class="p">[</span><span class="n">hoverOnCandles</span><span class="p">]</span>  <span class="c1"># hover on only for candle bodies</span>
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a>            <span class="n">chart</span><span class="o">.</span><span class="n">vbar</span><span class="p">(</span>
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a>                <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">[</span><span class="n">inc</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="n">candleWidth</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">open</span><span class="p">[</span><span class="n">inc</span><span class="p">],</span> <span class="n">top</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">[</span><span class="n">inc</span><span class="p">],</span>
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a>                <span class="n">fill_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#20ff00&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a>                <span class="n">line_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fill_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a>            <span class="p">)</span>
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a>            <span class="n">chart</span><span class="o">.</span><span class="n">vbar</span><span class="p">(</span>
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a>                <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">[</span><span class="n">dec</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="n">candleWidth</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">open</span><span class="p">[</span><span class="n">dec</span><span class="p">],</span> <span class="n">top</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">[</span><span class="n">dec</span><span class="p">],</span>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a>                <span class="n">fill_color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#999999&quot;</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#20ff00&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a>                <span class="n">line_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fill_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a>            <span class="p">)</span>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a>
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a>            <span class="k">if</span> <span class="n">showStatOnChart</span><span class="p">:</span>
</span><span id="L-1082"><a href="#L-1082"><span class="linenos">1082</span></a>                <span class="c1"># Summary section and controls:</span>
</span><span id="L-1083"><a href="#L-1083"><span class="linenos">1083</span></a>                <span class="n">legendNameMain</span> <span class="o">=</span> <span class="s2">&quot;Max close / Min close / Trend line&quot;</span>
</span><span id="L-1084"><a href="#L-1084"><span class="linenos">1084</span></a>                <span class="n">legendNameAvg</span> <span class="o">=</span> <span class="s2">&quot;Averages points (highs - deltas/2)&quot;</span>
</span><span id="L-1085"><a href="#L-1085"><span class="linenos">1085</span></a>                <span class="n">legendNameSMA</span> <span class="o">=</span> <span class="s2">&quot;Simple Moving Averages (SMA: 5, 20)&quot;</span>
</span><span id="L-1086"><a href="#L-1086"><span class="linenos">1086</span></a>                <span class="n">legendNameSMAlong</span> <span class="o">=</span> <span class="s2">&quot;Long Simple Moving Averages (SMA: 50, 200)&quot;</span>
</span><span id="L-1087"><a href="#L-1087"><span class="linenos">1087</span></a>                <span class="n">legendNameHMA</span> <span class="o">=</span> <span class="s2">&quot;Hull Moving Averages (HMA: 5, 20)&quot;</span>
</span><span id="L-1088"><a href="#L-1088"><span class="linenos">1088</span></a>                <span class="n">legendNameVWMA</span> <span class="o">=</span> <span class="s2">&quot;Volume Weighted Moving Averages (VWMA: 5, 20)&quot;</span>
</span><span id="L-1089"><a href="#L-1089"><span class="linenos">1089</span></a>                <span class="n">legendNameBBANDS</span> <span class="o">=</span> <span class="s2">&quot;Bollinger Bands (BBands)&quot;</span>
</span><span id="L-1090"><a href="#L-1090"><span class="linenos">1090</span></a>                <span class="n">legendNamePsar</span> <span class="o">=</span> <span class="s2">&quot;Parabolic Stop and Reverse (psar)&quot;</span>
</span><span id="L-1091"><a href="#L-1091"><span class="linenos">1091</span></a>                <span class="n">legendNameAlligator</span> <span class="o">=</span> <span class="s2">&quot;Alligator (based on HMA: 13, 8, 5)&quot;</span>
</span><span id="L-1092"><a href="#L-1092"><span class="linenos">1092</span></a>                <span class="n">legendNameZigZag</span> <span class="o">=</span> <span class="s2">&quot;Zig-Zag indicator (with </span><span class="si">{}% o</span><span class="s2">f difference)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zigZagDeviation</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="L-1093"><a href="#L-1093"><span class="linenos">1093</span></a>
</span><span id="L-1094"><a href="#L-1094"><span class="linenos">1094</span></a>                <span class="c1"># preparing for highest close line:</span>
</span><span id="L-1095"><a href="#L-1095"><span class="linenos">1095</span></a>                <span class="n">highestClose</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precision</span><span class="p">)</span>
</span><span id="L-1096"><a href="#L-1096"><span class="linenos">1096</span></a>                <span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="L-1097"><a href="#L-1097"><span class="linenos">1097</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">highestClose</span><span class="p">,</span>
</span><span id="L-1098"><a href="#L-1098"><span class="linenos">1098</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#339933&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-1099"><a href="#L-1099"><span class="linenos">1099</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameMain</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1100"><a href="#L-1100"><span class="linenos">1100</span></a>                <span class="p">)</span>
</span><span id="L-1101"><a href="#L-1101"><span class="linenos">1101</span></a>                <span class="n">chart</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
</span><span id="L-1102"><a href="#L-1102"><span class="linenos">1102</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">highestClose</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deg10prec</span><span class="p">,</span>
</span><span id="L-1103"><a href="#L-1103"><span class="linenos">1103</span></a>                    <span class="n">text</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">highestClose</span><span class="p">)],</span> <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">text_color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#339933&quot;</span><span class="p">,</span> <span class="n">text_font_size</span><span class="o">=</span><span class="s2">&quot;9pt&quot;</span><span class="p">,</span>
</span><span id="L-1104"><a href="#L-1104"><span class="linenos">1104</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameMain</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1105"><a href="#L-1105"><span class="linenos">1105</span></a>                <span class="p">)</span>
</span><span id="L-1106"><a href="#L-1106"><span class="linenos">1106</span></a>
</span><span id="L-1107"><a href="#L-1107"><span class="linenos">1107</span></a>                <span class="c1"># preparing for lowest close line:</span>
</span><span id="L-1108"><a href="#L-1108"><span class="linenos">1108</span></a>                <span class="n">lowestClose</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precision</span><span class="p">)</span>
</span><span id="L-1109"><a href="#L-1109"><span class="linenos">1109</span></a>                <span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="L-1110"><a href="#L-1110"><span class="linenos">1110</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">lowestClose</span><span class="p">,</span>
</span><span id="L-1111"><a href="#L-1111"><span class="linenos">1111</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#339933&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-1112"><a href="#L-1112"><span class="linenos">1112</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameMain</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1113"><a href="#L-1113"><span class="linenos">1113</span></a>                <span class="p">)</span>
</span><span id="L-1114"><a href="#L-1114"><span class="linenos">1114</span></a>                <span class="n">chart</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
</span><span id="L-1115"><a href="#L-1115"><span class="linenos">1115</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">lowestClose</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deg10prec</span><span class="p">,</span>
</span><span id="L-1116"><a href="#L-1116"><span class="linenos">1116</span></a>                    <span class="n">text</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">lowestClose</span><span class="p">)],</span> <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">text_color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#339933&quot;</span><span class="p">,</span> <span class="n">text_font_size</span><span class="o">=</span><span class="s2">&quot;9pt&quot;</span><span class="p">,</span>
</span><span id="L-1117"><a href="#L-1117"><span class="linenos">1117</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameMain</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1118"><a href="#L-1118"><span class="linenos">1118</span></a>                <span class="p">)</span>
</span><span id="L-1119"><a href="#L-1119"><span class="linenos">1119</span></a>
</span><span id="L-1120"><a href="#L-1120"><span class="linenos">1120</span></a>                <span class="c1"># preparing direction lines for all trends:</span>
</span><span id="L-1121"><a href="#L-1121"><span class="linenos">1121</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span><span class="p">:</span>
</span><span id="L-1122"><a href="#L-1122"><span class="linenos">1122</span></a>                    <span class="n">left</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1123"><a href="#L-1123"><span class="linenos">1123</span></a>                    <span class="k">for</span> <span class="n">trendNum</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span><span class="p">)):</span>
</span><span id="L-1124"><a href="#L-1124"><span class="linenos">1124</span></a>                        <span class="n">right</span> <span class="o">=</span> <span class="n">left</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span><span class="p">[</span><span class="n">trendNum</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="L-1125"><a href="#L-1125"><span class="linenos">1125</span></a>                        <span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="L-1126"><a href="#L-1126"><span class="linenos">1126</span></a>                            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">left</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">right</span><span class="p">]],</span>
</span><span id="L-1127"><a href="#L-1127"><span class="linenos">1127</span></a>                            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">left</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">right</span><span class="p">]],</span>
</span><span id="L-1128"><a href="#L-1128"><span class="linenos">1128</span></a>                            <span class="n">line_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#666666&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">line_dash</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
</span><span id="L-1129"><a href="#L-1129"><span class="linenos">1129</span></a>                            <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameMain</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1130"><a href="#L-1130"><span class="linenos">1130</span></a>                        <span class="p">)</span>
</span><span id="L-1131"><a href="#L-1131"><span class="linenos">1131</span></a>                        <span class="n">left</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span><span class="p">[</span><span class="n">trendNum</span><span class="p">]</span>
</span><span id="L-1132"><a href="#L-1132"><span class="linenos">1132</span></a>
</span><span id="L-1133"><a href="#L-1133"><span class="linenos">1133</span></a>                <span class="c1"># preparing for main direction line:</span>
</span><span id="L-1134"><a href="#L-1134"><span class="linenos">1134</span></a>                <span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="L-1135"><a href="#L-1135"><span class="linenos">1135</span></a>                    <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span>
</span><span id="L-1136"><a href="#L-1136"><span class="linenos">1136</span></a>                    <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span>
</span><span id="L-1137"><a href="#L-1137"><span class="linenos">1137</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#666666&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">line_dash</span><span class="o">=</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
</span><span id="L-1138"><a href="#L-1138"><span class="linenos">1138</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameMain</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1139"><a href="#L-1139"><span class="linenos">1139</span></a>                <span class="p">)</span>
</span><span id="L-1140"><a href="#L-1140"><span class="linenos">1140</span></a>
</span><span id="L-1141"><a href="#L-1141"><span class="linenos">1141</span></a>                <span class="c1"># preparing candle&#39;s average points:</span>
</span><span id="L-1142"><a href="#L-1142"><span class="linenos">1142</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span>
</span><span id="L-1143"><a href="#L-1143"><span class="linenos">1143</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">avg</span><span class="p">,</span>
</span><span id="L-1144"><a href="#L-1144"><span class="linenos">1144</span></a>                    <span class="n">size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-1145"><a href="#L-1145"><span class="linenos">1145</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameAvg</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1146"><a href="#L-1146"><span class="linenos">1146</span></a>                <span class="p">))</span>
</span><span id="L-1147"><a href="#L-1147"><span class="linenos">1147</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="L-1148"><a href="#L-1148"><span class="linenos">1148</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">avg</span><span class="p">,</span>
</span><span id="L-1149"><a href="#L-1149"><span class="linenos">1149</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-1150"><a href="#L-1150"><span class="linenos">1150</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameAvg</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1151"><a href="#L-1151"><span class="linenos">1151</span></a>                <span class="p">))</span>
</span><span id="L-1152"><a href="#L-1152"><span class="linenos">1152</span></a>
</span><span id="L-1153"><a href="#L-1153"><span class="linenos">1153</span></a>                <span class="c1"># --- Preparing a lot of TA lines:</span>
</span><span id="L-1154"><a href="#L-1154"><span class="linenos">1154</span></a>
</span><span id="L-1155"><a href="#L-1155"><span class="linenos">1155</span></a>                <span class="c1"># Simple Moving Averages (SMA) 5, 20</span>
</span><span id="L-1156"><a href="#L-1156"><span class="linenos">1156</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="L-1157"><a href="#L-1157"><span class="linenos">1157</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;sma5&quot;</span><span class="p">],</span>
</span><span id="L-1158"><a href="#L-1158"><span class="linenos">1158</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#999432&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-1159"><a href="#L-1159"><span class="linenos">1159</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameSMA</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1160"><a href="#L-1160"><span class="linenos">1160</span></a>                <span class="p">))</span>
</span><span id="L-1161"><a href="#L-1161"><span class="linenos">1161</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="L-1162"><a href="#L-1162"><span class="linenos">1162</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;sma20&quot;</span><span class="p">],</span>
</span><span id="L-1163"><a href="#L-1163"><span class="linenos">1163</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-1164"><a href="#L-1164"><span class="linenos">1164</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameSMA</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1165"><a href="#L-1165"><span class="linenos">1165</span></a>                <span class="p">))</span>
</span><span id="L-1166"><a href="#L-1166"><span class="linenos">1166</span></a>
</span><span id="L-1167"><a href="#L-1167"><span class="linenos">1167</span></a>                <span class="c1"># Long Simple Moving Averages (SMA) 50, 200</span>
</span><span id="L-1168"><a href="#L-1168"><span class="linenos">1168</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="L-1169"><a href="#L-1169"><span class="linenos">1169</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;sma50&quot;</span><span class="p">],</span>
</span><span id="L-1170"><a href="#L-1170"><span class="linenos">1170</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#ffbf00&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-1171"><a href="#L-1171"><span class="linenos">1171</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameSMAlong</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1172"><a href="#L-1172"><span class="linenos">1172</span></a>                <span class="p">))</span>
</span><span id="L-1173"><a href="#L-1173"><span class="linenos">1173</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="L-1174"><a href="#L-1174"><span class="linenos">1174</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;sma200&quot;</span><span class="p">],</span>
</span><span id="L-1175"><a href="#L-1175"><span class="linenos">1175</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#ff0040&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-1176"><a href="#L-1176"><span class="linenos">1176</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameSMAlong</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1177"><a href="#L-1177"><span class="linenos">1177</span></a>                <span class="p">))</span>
</span><span id="L-1178"><a href="#L-1178"><span class="linenos">1178</span></a>
</span><span id="L-1179"><a href="#L-1179"><span class="linenos">1179</span></a>                <span class="c1"># Hull Moving Averages (HMA) 5, 20</span>
</span><span id="L-1180"><a href="#L-1180"><span class="linenos">1180</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="L-1181"><a href="#L-1181"><span class="linenos">1181</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;hma5&quot;</span><span class="p">],</span>
</span><span id="L-1182"><a href="#L-1182"><span class="linenos">1182</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#00ffff&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#336633&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-1183"><a href="#L-1183"><span class="linenos">1183</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameHMA</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1184"><a href="#L-1184"><span class="linenos">1184</span></a>                <span class="p">))</span>
</span><span id="L-1185"><a href="#L-1185"><span class="linenos">1185</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="L-1186"><a href="#L-1186"><span class="linenos">1186</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;hma20&quot;</span><span class="p">],</span>
</span><span id="L-1187"><a href="#L-1187"><span class="linenos">1187</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#ff00ff&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#333333&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-1188"><a href="#L-1188"><span class="linenos">1188</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameHMA</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1189"><a href="#L-1189"><span class="linenos">1189</span></a>                <span class="p">))</span>
</span><span id="L-1190"><a href="#L-1190"><span class="linenos">1190</span></a>
</span><span id="L-1191"><a href="#L-1191"><span class="linenos">1191</span></a>                <span class="c1"># Volume Weighted Moving Averages (VWMA) 5, 20</span>
</span><span id="L-1192"><a href="#L-1192"><span class="linenos">1192</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="L-1193"><a href="#L-1193"><span class="linenos">1193</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;vwma5&quot;</span><span class="p">],</span>
</span><span id="L-1194"><a href="#L-1194"><span class="linenos">1194</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#666633&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-1195"><a href="#L-1195"><span class="linenos">1195</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameVWMA</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1196"><a href="#L-1196"><span class="linenos">1196</span></a>                <span class="p">))</span>
</span><span id="L-1197"><a href="#L-1197"><span class="linenos">1197</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="L-1198"><a href="#L-1198"><span class="linenos">1198</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;vwma20&quot;</span><span class="p">],</span>
</span><span id="L-1199"><a href="#L-1199"><span class="linenos">1199</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#ff8000&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#333333&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-1200"><a href="#L-1200"><span class="linenos">1200</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameVWMA</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1201"><a href="#L-1201"><span class="linenos">1201</span></a>                <span class="p">))</span>
</span><span id="L-1202"><a href="#L-1202"><span class="linenos">1202</span></a>
</span><span id="L-1203"><a href="#L-1203"><span class="linenos">1203</span></a>                <span class="c1"># Bollinger Bands (BBands)</span>
</span><span id="L-1204"><a href="#L-1204"><span class="linenos">1204</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="L-1205"><a href="#L-1205"><span class="linenos">1205</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;bbands&quot;</span><span class="p">][</span><span class="s2">&quot;lower&quot;</span><span class="p">],</span>
</span><span id="L-1206"><a href="#L-1206"><span class="linenos">1206</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#66ffff&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#333333&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-1207"><a href="#L-1207"><span class="linenos">1207</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameBBANDS</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1208"><a href="#L-1208"><span class="linenos">1208</span></a>                <span class="p">))</span>
</span><span id="L-1209"><a href="#L-1209"><span class="linenos">1209</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="L-1210"><a href="#L-1210"><span class="linenos">1210</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;bbands&quot;</span><span class="p">][</span><span class="s2">&quot;mid&quot;</span><span class="p">],</span>
</span><span id="L-1211"><a href="#L-1211"><span class="linenos">1211</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#66ffff&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#333333&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-1212"><a href="#L-1212"><span class="linenos">1212</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameBBANDS</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1213"><a href="#L-1213"><span class="linenos">1213</span></a>                <span class="p">))</span>
</span><span id="L-1214"><a href="#L-1214"><span class="linenos">1214</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="L-1215"><a href="#L-1215"><span class="linenos">1215</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;bbands&quot;</span><span class="p">][</span><span class="s2">&quot;upper&quot;</span><span class="p">],</span>
</span><span id="L-1216"><a href="#L-1216"><span class="linenos">1216</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#66ffff&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#333333&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-1217"><a href="#L-1217"><span class="linenos">1217</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameBBANDS</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1218"><a href="#L-1218"><span class="linenos">1218</span></a>                <span class="p">))</span>
</span><span id="L-1219"><a href="#L-1219"><span class="linenos">1219</span></a>
</span><span id="L-1220"><a href="#L-1220"><span class="linenos">1220</span></a>                <span class="c1"># Parabolic Stop and Reverse (psar)</span>
</span><span id="L-1221"><a href="#L-1221"><span class="linenos">1221</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span>
</span><span id="L-1222"><a href="#L-1222"><span class="linenos">1222</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;psar&quot;</span><span class="p">][</span><span class="s2">&quot;long&quot;</span><span class="p">],</span>
</span><span id="L-1223"><a href="#L-1223"><span class="linenos">1223</span></a>                    <span class="n">size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#00ffff&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#336633&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-1224"><a href="#L-1224"><span class="linenos">1224</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNamePsar</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1225"><a href="#L-1225"><span class="linenos">1225</span></a>                <span class="p">))</span>
</span><span id="L-1226"><a href="#L-1226"><span class="linenos">1226</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span>
</span><span id="L-1227"><a href="#L-1227"><span class="linenos">1227</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;psar&quot;</span><span class="p">][</span><span class="s2">&quot;short&quot;</span><span class="p">],</span>
</span><span id="L-1228"><a href="#L-1228"><span class="linenos">1228</span></a>                    <span class="n">size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#ff00ff&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#663333&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-1229"><a href="#L-1229"><span class="linenos">1229</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNamePsar</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1230"><a href="#L-1230"><span class="linenos">1230</span></a>                <span class="p">))</span>
</span><span id="L-1231"><a href="#L-1231"><span class="linenos">1231</span></a>
</span><span id="L-1232"><a href="#L-1232"><span class="linenos">1232</span></a>                <span class="c1"># Alligator (based on HMA 13, 8, 5) for the Alligator indicator (Jaw, Teeth, and Lips)</span>
</span><span id="L-1233"><a href="#L-1233"><span class="linenos">1233</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="L-1234"><a href="#L-1234"><span class="linenos">1234</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;hma13&quot;</span><span class="p">],</span>
</span><span id="L-1235"><a href="#L-1235"><span class="linenos">1235</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#1a1aff&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#2100A6&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-1236"><a href="#L-1236"><span class="linenos">1236</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameAlligator</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1237"><a href="#L-1237"><span class="linenos">1237</span></a>                <span class="p">))</span>
</span><span id="L-1238"><a href="#L-1238"><span class="linenos">1238</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="L-1239"><a href="#L-1239"><span class="linenos">1239</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;hma8&quot;</span><span class="p">],</span>
</span><span id="L-1240"><a href="#L-1240"><span class="linenos">1240</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#ff1a1a&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#A6000C&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-1241"><a href="#L-1241"><span class="linenos">1241</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameAlligator</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1242"><a href="#L-1242"><span class="linenos">1242</span></a>                <span class="p">))</span>
</span><span id="L-1243"><a href="#L-1243"><span class="linenos">1243</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="L-1244"><a href="#L-1244"><span class="linenos">1244</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;hma5&quot;</span><span class="p">],</span>
</span><span id="L-1245"><a href="#L-1245"><span class="linenos">1245</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#40ff00&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#17A600&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-1246"><a href="#L-1246"><span class="linenos">1246</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameAlligator</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1247"><a href="#L-1247"><span class="linenos">1247</span></a>                <span class="p">))</span>
</span><span id="L-1248"><a href="#L-1248"><span class="linenos">1248</span></a>
</span><span id="L-1249"><a href="#L-1249"><span class="linenos">1249</span></a>                <span class="c1"># Zig-Zag indicator with self.zigZagDeviation of difference parameter</span>
</span><span id="L-1250"><a href="#L-1250"><span class="linenos">1250</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="L-1251"><a href="#L-1251"><span class="linenos">1251</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;zigzag3&quot;</span><span class="p">][</span><span class="s2">&quot;datetimes&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;zigzag3&quot;</span><span class="p">][</span><span class="s2">&quot;filtered&quot;</span><span class="p">],</span>
</span><span id="L-1252"><a href="#L-1252"><span class="linenos">1252</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;cyan&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#333333&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-1253"><a href="#L-1253"><span class="linenos">1253</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameZigZag</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1254"><a href="#L-1254"><span class="linenos">1254</span></a>                <span class="p">))</span>
</span><span id="L-1255"><a href="#L-1255"><span class="linenos">1255</span></a>
</span><span id="L-1256"><a href="#L-1256"><span class="linenos">1256</span></a>                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">disabledObjects</span><span class="p">:</span>
</span><span id="L-1257"><a href="#L-1257"><span class="linenos">1257</span></a>                    <span class="n">item</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1258"><a href="#L-1258"><span class="linenos">1258</span></a>
</span><span id="L-1259"><a href="#L-1259"><span class="linenos">1259</span></a>            <span class="c1"># --- Preparing custom markers:</span>
</span><span id="L-1260"><a href="#L-1260"><span class="linenos">1260</span></a>
</span><span id="L-1261"><a href="#L-1261"><span class="linenos">1261</span></a>            <span class="k">if</span> <span class="n">markers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">markers</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">markers</span><span class="o">.</span><span class="n">empty</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">markers</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="s2">&quot;datetime&quot;</span> <span class="ow">in</span> <span class="n">markers</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;markersUpper&quot;</span> <span class="ow">in</span> <span class="n">markers</span><span class="o">.</span><span class="n">columns</span> <span class="ow">or</span> <span class="s2">&quot;markersCenter&quot;</span> <span class="ow">in</span> <span class="n">markers</span><span class="o">.</span><span class="n">columns</span> <span class="ow">or</span> <span class="s2">&quot;markersLower&quot;</span> <span class="ow">in</span> <span class="n">markers</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
</span><span id="L-1262"><a href="#L-1262"><span class="linenos">1262</span></a>                <span class="k">if</span> <span class="s2">&quot;markersUpper&quot;</span> <span class="ow">in</span> <span class="n">markers</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-1263"><a href="#L-1263"><span class="linenos">1263</span></a>                    <span class="n">chart</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
</span><span id="L-1264"><a href="#L-1264"><span class="linenos">1264</span></a>                        <span class="n">markers</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">high</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span>
</span><span id="L-1265"><a href="#L-1265"><span class="linenos">1265</span></a>                        <span class="n">text_align</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">text_baseline</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">markers</span><span class="o">.</span><span class="n">markersUpper</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
</span><span id="L-1266"><a href="#L-1266"><span class="linenos">1266</span></a>                        <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">text_color</span><span class="o">=</span><span class="s2">&quot;lime&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">text_font_size</span><span class="o">=</span><span class="s2">&quot;13pt&quot;</span><span class="p">,</span>
</span><span id="L-1267"><a href="#L-1267"><span class="linenos">1267</span></a>                        <span class="n">legend_label</span><span class="o">=</span><span class="s2">&quot;Markers: upper (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">markers</span><span class="o">.</span><span class="n">markersUpper</span><span class="p">[</span><span class="n">markers</span><span class="o">.</span><span class="n">markersUpper</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">]))</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1268"><a href="#L-1268"><span class="linenos">1268</span></a>                    <span class="p">)</span>
</span><span id="L-1269"><a href="#L-1269"><span class="linenos">1269</span></a>
</span><span id="L-1270"><a href="#L-1270"><span class="linenos">1270</span></a>                <span class="k">if</span> <span class="s2">&quot;markersCenter&quot;</span> <span class="ow">in</span> <span class="n">markers</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-1271"><a href="#L-1271"><span class="linenos">1271</span></a>                    <span class="k">if</span> <span class="s2">&quot;avg&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-1272"><a href="#L-1272"><span class="linenos">1272</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;avg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">high</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">low</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precision</span><span class="p">)</span>
</span><span id="L-1273"><a href="#L-1273"><span class="linenos">1273</span></a>
</span><span id="L-1274"><a href="#L-1274"><span class="linenos">1274</span></a>                    <span class="n">chart</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
</span><span id="L-1275"><a href="#L-1275"><span class="linenos">1275</span></a>                        <span class="n">markers</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">avg</span><span class="p">,</span>
</span><span id="L-1276"><a href="#L-1276"><span class="linenos">1276</span></a>                        <span class="n">text_align</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">text_baseline</span><span class="o">=</span><span class="s2">&quot;middle&quot;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">markers</span><span class="o">.</span><span class="n">markersCenter</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
</span><span id="L-1277"><a href="#L-1277"><span class="linenos">1277</span></a>                        <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">text_color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">text_font_size</span><span class="o">=</span><span class="s2">&quot;13pt&quot;</span><span class="p">,</span>
</span><span id="L-1278"><a href="#L-1278"><span class="linenos">1278</span></a>                        <span class="n">legend_label</span><span class="o">=</span><span class="s2">&quot;Markers: center (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">markers</span><span class="o">.</span><span class="n">markersCenter</span><span class="p">[</span><span class="n">markers</span><span class="o">.</span><span class="n">markersCenter</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">]))</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1279"><a href="#L-1279"><span class="linenos">1279</span></a>                    <span class="p">)</span>
</span><span id="L-1280"><a href="#L-1280"><span class="linenos">1280</span></a>
</span><span id="L-1281"><a href="#L-1281"><span class="linenos">1281</span></a>                <span class="k">if</span> <span class="s2">&quot;markersLower&quot;</span> <span class="ow">in</span> <span class="n">markers</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-1282"><a href="#L-1282"><span class="linenos">1282</span></a>                    <span class="n">chart</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
</span><span id="L-1283"><a href="#L-1283"><span class="linenos">1283</span></a>                        <span class="n">markers</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">low</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span>
</span><span id="L-1284"><a href="#L-1284"><span class="linenos">1284</span></a>                        <span class="n">text_align</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">text_baseline</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">markers</span><span class="o">.</span><span class="n">markersLower</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
</span><span id="L-1285"><a href="#L-1285"><span class="linenos">1285</span></a>                        <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">text_color</span><span class="o">=</span><span class="s2">&quot;lime&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">text_font_size</span><span class="o">=</span><span class="s2">&quot;13pt&quot;</span><span class="p">,</span>
</span><span id="L-1286"><a href="#L-1286"><span class="linenos">1286</span></a>                        <span class="n">legend_label</span><span class="o">=</span><span class="s2">&quot;Markers: lower (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">markers</span><span class="o">.</span><span class="n">markersLower</span><span class="p">[</span><span class="n">markers</span><span class="o">.</span><span class="n">markersLower</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">]))</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1287"><a href="#L-1287"><span class="linenos">1287</span></a>                    <span class="p">)</span>
</span><span id="L-1288"><a href="#L-1288"><span class="linenos">1288</span></a>
</span><span id="L-1289"><a href="#L-1289"><span class="linenos">1289</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1290"><a href="#L-1290"><span class="linenos">1290</span></a>                <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Marker data must be the Pandas DataFrame object! Or `None` (by default). Marker is a custom symbol, example: ×, ↓ or ↑. Dataframe with markers must contain at least two columns. There are `datetime` with date and time and some markers columns (`markersUpper`, `markersCenter` or `markersLower`). Length of markers series must be equal to the length of main candles series.&quot;</span><span class="p">)</span>
</span><span id="L-1291"><a href="#L-1291"><span class="linenos">1291</span></a>
</span><span id="L-1292"><a href="#L-1292"><span class="linenos">1292</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">showControlsOnChart</span> <span class="ow">or</span> <span class="n">showStatOnChart</span><span class="p">):</span>
</span><span id="L-1293"><a href="#L-1293"><span class="linenos">1293</span></a>                <span class="n">summaryInfo</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1294"><a href="#L-1294"><span class="linenos">1294</span></a>
</span><span id="L-1295"><a href="#L-1295"><span class="linenos">1295</span></a>            <span class="c1"># --- Preparing custom lines:</span>
</span><span id="L-1296"><a href="#L-1296"><span class="linenos">1296</span></a>
</span><span id="L-1297"><a href="#L-1297"><span class="linenos">1297</span></a>            <span class="k">if</span> <span class="n">lines</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="n">lines</span><span class="p">:</span>
</span><span id="L-1298"><a href="#L-1298"><span class="linenos">1298</span></a>                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
</span><span id="L-1299"><a href="#L-1299"><span class="linenos">1299</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="s2">&quot;datetime&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-1300"><a href="#L-1300"><span class="linenos">1300</span></a>                        <span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="L-1301"><a href="#L-1301"><span class="linenos">1301</span></a>                            <span class="n">line</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">line</span><span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
</span><span id="L-1302"><a href="#L-1302"><span class="linenos">1302</span></a>                            <span class="n">line_width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#666666&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-1303"><a href="#L-1303"><span class="linenos">1303</span></a>                            <span class="n">legend_label</span><span class="o">=</span><span class="s2">&quot;Line: &quot;</span> <span class="o">+</span> <span class="n">line</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1304"><a href="#L-1304"><span class="linenos">1304</span></a>                        <span class="p">)</span>
</span><span id="L-1305"><a href="#L-1305"><span class="linenos">1305</span></a>
</span><span id="L-1306"><a href="#L-1306"><span class="linenos">1306</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1307"><a href="#L-1307"><span class="linenos">1307</span></a>                        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Every custom line must be the Pandas DataFrame object! Line data must contain at least two columns: `datetime` with date and time and 2-nd column `custom_line_name` with y-coordinates. Length of the chart-line dataframes must be equal to the length of main candle series.&quot;</span><span class="p">)</span>
</span><span id="L-1308"><a href="#L-1308"><span class="linenos">1308</span></a>
</span><span id="L-1309"><a href="#L-1309"><span class="linenos">1309</span></a>            <span class="c1"># --- Volume chart options:</span>
</span><span id="L-1310"><a href="#L-1310"><span class="linenos">1310</span></a>            <span class="n">volumeChart</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span>
</span><span id="L-1311"><a href="#L-1311"><span class="linenos">1311</span></a>                <span class="n">x_axis_type</span><span class="o">=</span><span class="s2">&quot;datetime&quot;</span><span class="p">,</span>
</span><span id="L-1312"><a href="#L-1312"><span class="linenos">1312</span></a>                <span class="n">y_axis_label</span><span class="o">=</span><span class="s2">&quot;Volume&quot;</span><span class="p">,</span>
</span><span id="L-1313"><a href="#L-1313"><span class="linenos">1313</span></a>                <span class="n">outline_line_width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
</span><span id="L-1314"><a href="#L-1314"><span class="linenos">1314</span></a>                <span class="n">outline_line_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span>
</span><span id="L-1315"><a href="#L-1315"><span class="linenos">1315</span></a>                <span class="n">min_width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
</span><span id="L-1316"><a href="#L-1316"><span class="linenos">1316</span></a>                <span class="n">height</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
</span><span id="L-1317"><a href="#L-1317"><span class="linenos">1317</span></a>                <span class="n">sizing_mode</span><span class="o">=</span><span class="s2">&quot;scale_width&quot;</span><span class="p">,</span>
</span><span id="L-1318"><a href="#L-1318"><span class="linenos">1318</span></a>                <span class="n">background_fill_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span>
</span><span id="L-1319"><a href="#L-1319"><span class="linenos">1319</span></a>                <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pan&quot;</span><span class="p">,</span> <span class="s2">&quot;wheel_zoom&quot;</span><span class="p">,</span> <span class="s2">&quot;hover&quot;</span><span class="p">],</span>
</span><span id="L-1320"><a href="#L-1320"><span class="linenos">1320</span></a>                <span class="n">toolbar_location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-1321"><a href="#L-1321"><span class="linenos">1321</span></a>                <span class="n">active_scroll</span><span class="o">=</span><span class="s2">&quot;wheel_zoom&quot;</span><span class="p">,</span>
</span><span id="L-1322"><a href="#L-1322"><span class="linenos">1322</span></a>                <span class="n">min_border_left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="L-1323"><a href="#L-1323"><span class="linenos">1323</span></a>                <span class="n">min_border_right</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="L-1324"><a href="#L-1324"><span class="linenos">1324</span></a>                <span class="n">min_border_top</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="L-1325"><a href="#L-1325"><span class="linenos">1325</span></a>                <span class="n">min_border_bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="L-1326"><a href="#L-1326"><span class="linenos">1326</span></a>                <span class="n">x_range</span><span class="o">=</span><span class="n">chart</span><span class="o">.</span><span class="n">x_range</span><span class="p">,</span>
</span><span id="L-1327"><a href="#L-1327"><span class="linenos">1327</span></a>                <span class="n">y_range</span><span class="o">=</span><span class="n">Range1d</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">volume</span><span class="p">),</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">volume</span><span class="p">))),</span>
</span><span id="L-1328"><a href="#L-1328"><span class="linenos">1328</span></a>            <span class="p">)</span>
</span><span id="L-1329"><a href="#L-1329"><span class="linenos">1329</span></a>            <span class="n">volumeChart</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">logo</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># remove bokeh logo and link to https://bokeh.org/</span>
</span><span id="L-1330"><a href="#L-1330"><span class="linenos">1330</span></a>            <span class="n">volumeChart</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">major_label_orientation</span> <span class="o">=</span> <span class="n">pi</span> <span class="o">/</span> <span class="mi">6</span>
</span><span id="L-1331"><a href="#L-1331"><span class="linenos">1331</span></a>            <span class="n">volumeChart</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1332"><a href="#L-1332"><span class="linenos">1332</span></a>            <span class="n">volumeChart</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">formatter</span> <span class="o">=</span> <span class="n">NumeralTickFormatter</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s2">&quot;0a&quot;</span><span class="p">)</span>
</span><span id="L-1333"><a href="#L-1333"><span class="linenos">1333</span></a>            <span class="n">volumeChart</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">grid_line_dash</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</span><span id="L-1334"><a href="#L-1334"><span class="linenos">1334</span></a>            <span class="n">volumeChart</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">grid_line_alpha</span> <span class="o">=</span> <span class="mf">0.5</span>
</span><span id="L-1335"><a href="#L-1335"><span class="linenos">1335</span></a>            <span class="n">volumeChart</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">minor_grid_line_dash</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</span><span id="L-1336"><a href="#L-1336"><span class="linenos">1336</span></a>            <span class="n">volumeChart</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">minor_grid_line_alpha</span> <span class="o">=</span> <span class="mf">0.5</span>
</span><span id="L-1337"><a href="#L-1337"><span class="linenos">1337</span></a>            <span class="n">volumeChart</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">minor_grid_line_dash</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</span><span id="L-1338"><a href="#L-1338"><span class="linenos">1338</span></a>            <span class="n">volumeChart</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">minor_grid_line_alpha</span> <span class="o">=</span> <span class="mf">0.3</span>
</span><span id="L-1339"><a href="#L-1339"><span class="linenos">1339</span></a>            <span class="n">volumeChart</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">minor_grid_line_color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;gray&quot;</span>
</span><span id="L-1340"><a href="#L-1340"><span class="linenos">1340</span></a>
</span><span id="L-1341"><a href="#L-1341"><span class="linenos">1341</span></a>            <span class="c1"># preparing data for hover tooltips:</span>
</span><span id="L-1342"><a href="#L-1342"><span class="linenos">1342</span></a>            <span class="n">volSource</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-1343"><a href="#L-1343"><span class="linenos">1343</span></a>                <span class="s2">&quot;candle&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span>
</span><span id="L-1344"><a href="#L-1344"><span class="linenos">1344</span></a>                <span class="s2">&quot;datetime&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
</span><span id="L-1345"><a href="#L-1345"><span class="linenos">1345</span></a>                <span class="s2">&quot;volume&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">volume</span><span class="p">,</span>
</span><span id="L-1346"><a href="#L-1346"><span class="linenos">1346</span></a>                <span class="s2">&quot;zero&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">volume</span><span class="p">),</span>
</span><span id="L-1347"><a href="#L-1347"><span class="linenos">1347</span></a>            <span class="p">}</span>
</span><span id="L-1348"><a href="#L-1348"><span class="linenos">1348</span></a>            <span class="n">volHoverData</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">volSource</span><span class="p">)</span>
</span><span id="L-1349"><a href="#L-1349"><span class="linenos">1349</span></a>            <span class="n">volHover</span> <span class="o">=</span> <span class="n">volumeChart</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">HoverTool</span><span class="p">))</span>
</span><span id="L-1350"><a href="#L-1350"><span class="linenos">1350</span></a>            <span class="n">volHover</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;volumes&quot;</span>
</span><span id="L-1351"><a href="#L-1351"><span class="linenos">1351</span></a>            <span class="n">volHover</span><span class="o">.</span><span class="n">tooltips</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-1352"><a href="#L-1352"><span class="linenos">1352</span></a>                <span class="p">(</span><span class="s2">&quot;Candle&quot;</span><span class="p">,</span> <span class="s2">&quot;@candle&quot;</span><span class="p">),</span>
</span><span id="L-1353"><a href="#L-1353"><span class="linenos">1353</span></a>                <span class="p">(</span><span class="s2">&quot;Date&quot;</span><span class="p">,</span> <span class="s2">&quot;@datetime{%Y-%m-</span><span class="si">%d</span><span class="s2">}&quot;</span><span class="p">),</span>
</span><span id="L-1354"><a href="#L-1354"><span class="linenos">1354</span></a>                <span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">,</span> <span class="s2">&quot;@datetime{%H:%M:%S}&quot;</span><span class="p">),</span>
</span><span id="L-1355"><a href="#L-1355"><span class="linenos">1355</span></a>                <span class="p">(</span><span class="s2">&quot;Volume&quot;</span><span class="p">,</span> <span class="s2">&quot;@volume&quot;</span><span class="p">),</span>
</span><span id="L-1356"><a href="#L-1356"><span class="linenos">1356</span></a>            <span class="p">]</span>
</span><span id="L-1357"><a href="#L-1357"><span class="linenos">1357</span></a>            <span class="n">volHover</span><span class="o">.</span><span class="n">formatters</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-1358"><a href="#L-1358"><span class="linenos">1358</span></a>                <span class="s2">&quot;@datetime&quot;</span><span class="p">:</span> <span class="s2">&quot;datetime&quot;</span><span class="p">,</span>
</span><span id="L-1359"><a href="#L-1359"><span class="linenos">1359</span></a>            <span class="p">}</span>
</span><span id="L-1360"><a href="#L-1360"><span class="linenos">1360</span></a>            <span class="n">volHover</span><span class="o">.</span><span class="n">point_policy</span> <span class="o">=</span> <span class="s2">&quot;snap_to_data&quot;</span>
</span><span id="L-1361"><a href="#L-1361"><span class="linenos">1361</span></a>            <span class="n">volHover</span><span class="o">.</span><span class="n">line_policy</span> <span class="o">=</span> <span class="s2">&quot;nearest&quot;</span>
</span><span id="L-1362"><a href="#L-1362"><span class="linenos">1362</span></a>            <span class="n">volHover</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;vline&quot;</span>
</span><span id="L-1363"><a href="#L-1363"><span class="linenos">1363</span></a>
</span><span id="L-1364"><a href="#L-1364"><span class="linenos">1364</span></a>            <span class="c1"># preparing volume chart:</span>
</span><span id="L-1365"><a href="#L-1365"><span class="linenos">1365</span></a>            <span class="n">hoverOnVolumes</span> <span class="o">=</span> <span class="n">volumeChart</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span>
</span><span id="L-1366"><a href="#L-1366"><span class="linenos">1366</span></a>                <span class="n">x0</span><span class="o">=</span><span class="s2">&quot;datetime&quot;</span><span class="p">,</span> <span class="n">y0</span><span class="o">=</span><span class="s2">&quot;volume&quot;</span><span class="p">,</span> <span class="n">x1</span><span class="o">=</span><span class="s2">&quot;datetime&quot;</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="s2">&quot;zero&quot;</span><span class="p">,</span>
</span><span id="L-1367"><a href="#L-1367"><span class="linenos">1367</span></a>                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;volumes&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">volHoverData</span><span class="p">,</span>
</span><span id="L-1368"><a href="#L-1368"><span class="linenos">1368</span></a>            <span class="p">)</span>
</span><span id="L-1369"><a href="#L-1369"><span class="linenos">1369</span></a>            <span class="n">volHover</span><span class="o">.</span><span class="n">renderers</span> <span class="o">=</span> <span class="p">[</span><span class="n">hoverOnVolumes</span><span class="p">]</span>  <span class="c1"># hover on only for volume bars</span>
</span><span id="L-1370"><a href="#L-1370"><span class="linenos">1370</span></a>            <span class="n">volumeChart</span><span class="o">.</span><span class="n">vbar</span><span class="p">(</span>
</span><span id="L-1371"><a href="#L-1371"><span class="linenos">1371</span></a>                <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">[</span><span class="n">inc</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="n">candleWidth</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">volume</span><span class="p">[</span><span class="n">inc</span><span class="p">],</span>
</span><span id="L-1372"><a href="#L-1372"><span class="linenos">1372</span></a>                <span class="n">fill_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#20ff00&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>
</span><span id="L-1373"><a href="#L-1373"><span class="linenos">1373</span></a>                <span class="n">line_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fill_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-1374"><a href="#L-1374"><span class="linenos">1374</span></a>            <span class="p">)</span>
</span><span id="L-1375"><a href="#L-1375"><span class="linenos">1375</span></a>            <span class="n">volumeChart</span><span class="o">.</span><span class="n">vbar</span><span class="p">(</span>
</span><span id="L-1376"><a href="#L-1376"><span class="linenos">1376</span></a>                <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">[</span><span class="n">dec</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="n">candleWidth</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">volume</span><span class="p">[</span><span class="n">dec</span><span class="p">],</span>
</span><span id="L-1377"><a href="#L-1377"><span class="linenos">1377</span></a>                <span class="n">fill_color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#999999&quot;</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#20ff00&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>
</span><span id="L-1378"><a href="#L-1378"><span class="linenos">1378</span></a>                <span class="n">line_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fill_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-1379"><a href="#L-1379"><span class="linenos">1379</span></a>            <span class="p">)</span>
</span><span id="L-1380"><a href="#L-1380"><span class="linenos">1380</span></a>
</span><span id="L-1381"><a href="#L-1381"><span class="linenos">1381</span></a>            <span class="c1"># Merge Main and Volume charts in one Bokeh gridplot object:</span>
</span><span id="L-1382"><a href="#L-1382"><span class="linenos">1382</span></a>            <span class="n">unionChart</span> <span class="o">=</span> <span class="n">gridplot</span><span class="p">(</span>
</span><span id="L-1383"><a href="#L-1383"><span class="linenos">1383</span></a>                <span class="n">children</span><span class="o">=</span><span class="p">[[</span><span class="n">chart</span><span class="p">],</span> <span class="p">[</span><span class="n">volumeChart</span><span class="p">]],</span>
</span><span id="L-1384"><a href="#L-1384"><span class="linenos">1384</span></a>                <span class="n">sizing_mode</span><span class="o">=</span><span class="s2">&quot;stretch_both&quot;</span><span class="p">,</span>
</span><span id="L-1385"><a href="#L-1385"><span class="linenos">1385</span></a>                <span class="n">merge_tools</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-1386"><a href="#L-1386"><span class="linenos">1386</span></a>                <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
</span><span id="L-1387"><a href="#L-1387"><span class="linenos">1387</span></a>            <span class="p">)</span>
</span><span id="L-1388"><a href="#L-1388"><span class="linenos">1388</span></a>            <span class="n">unionChart</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">logo</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1389"><a href="#L-1389"><span class="linenos">1389</span></a>
</span><span id="L-1390"><a href="#L-1390"><span class="linenos">1390</span></a>            <span class="k">if</span> <span class="n">inline</span><span class="p">:</span>
</span><span id="L-1391"><a href="#L-1391"><span class="linenos">1391</span></a>                <span class="n">show</span><span class="p">(</span><span class="n">unionChart</span><span class="p">,</span> <span class="n">notebook_handle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1392"><a href="#L-1392"><span class="linenos">1392</span></a>
</span><span id="L-1393"><a href="#L-1393"><span class="linenos">1393</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1394"><a href="#L-1394"><span class="linenos">1394</span></a>                <span class="c1"># preparing HTML-file chart and statistics in markdown:</span>
</span><span id="L-1395"><a href="#L-1395"><span class="linenos">1395</span></a>                <span class="k">if</span> <span class="n">fileName</span><span class="p">:</span>
</span><span id="L-1396"><a href="#L-1396"><span class="linenos">1396</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="L-1397"><a href="#L-1397"><span class="linenos">1397</span></a>                        <span class="n">output_file</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;cdn&quot;</span><span class="p">)</span>
</span><span id="L-1398"><a href="#L-1398"><span class="linenos">1398</span></a>                        <span class="n">save</span><span class="p">(</span><span class="n">unionChart</span><span class="p">,</span> <span class="n">fileName</span><span class="p">)</span>
</span><span id="L-1399"><a href="#L-1399"><span class="linenos">1399</span></a>
</span><span id="L-1400"><a href="#L-1400"><span class="linenos">1400</span></a>                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-1401"><a href="#L-1401"><span class="linenos">1401</span></a>                        <span class="n">uLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Can&#39;t render HTML! Error message: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="L-1402"><a href="#L-1402"><span class="linenos">1402</span></a>
</span><span id="L-1403"><a href="#L-1403"><span class="linenos">1403</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1404"><a href="#L-1404"><span class="linenos">1404</span></a>                        <span class="n">uLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Pandas DataFrame saved as HTML-file [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">fileName</span><span class="p">)))</span>
</span><span id="L-1405"><a href="#L-1405"><span class="linenos">1405</span></a>
</span><span id="L-1406"><a href="#L-1406"><span class="linenos">1406</span></a>                    <span class="k">if</span> <span class="n">showStatOnChart</span><span class="p">:</span>
</span><span id="L-1407"><a href="#L-1407"><span class="linenos">1407</span></a>                        <span class="n">mdFile</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.md&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>
</span><span id="L-1408"><a href="#L-1408"><span class="linenos">1408</span></a>                        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">mdFile</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fH</span><span class="p">:</span>
</span><span id="L-1409"><a href="#L-1409"><span class="linenos">1409</span></a>                            <span class="n">fH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">infoBlock</span><span class="p">))</span>
</span><span id="L-1410"><a href="#L-1410"><span class="linenos">1410</span></a>
</span><span id="L-1411"><a href="#L-1411"><span class="linenos">1411</span></a>                            <span class="n">uLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Statistics saved to [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">mdFile</span><span class="p">)))</span>
</span><span id="L-1412"><a href="#L-1412"><span class="linenos">1412</span></a>
</span><span id="L-1413"><a href="#L-1413"><span class="linenos">1413</span></a>                    <span class="k">if</span> <span class="n">viewInBrowser</span><span class="p">:</span>
</span><span id="L-1414"><a href="#L-1414"><span class="linenos">1414</span></a>                        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">fileName</span><span class="p">))</span>  <span class="c1"># view forecast chart in default browser immediately</span>
</span><span id="L-1415"><a href="#L-1415"><span class="linenos">1415</span></a>
</span><span id="L-1416"><a href="#L-1416"><span class="linenos">1416</span></a>            <span class="k">return</span> <span class="n">unionChart</span>
</span><span id="L-1417"><a href="#L-1417"><span class="linenos">1417</span></a>
</span><span id="L-1418"><a href="#L-1418"><span class="linenos">1418</span></a>    <span class="k">def</span> <span class="nf">RenderGoogle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;index.html&quot;</span><span class="p">,</span> <span class="n">viewInBrowser</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1419"><a href="#L-1419"><span class="linenos">1419</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1420"><a href="#L-1420"><span class="linenos">1420</span></a><span class="sd">        Rendering prices from Pandas DataFrame as non-interactive Google Candlestick chart and save it to HTML-file.</span>
</span><span id="L-1421"><a href="#L-1421"><span class="linenos">1421</span></a>
</span><span id="L-1422"><a href="#L-1422"><span class="linenos">1422</span></a><span class="sd">        See also: https://developers.google.com/chart/interactive/docs/gallery/candlestickchart</span>
</span><span id="L-1423"><a href="#L-1423"><span class="linenos">1423</span></a>
</span><span id="L-1424"><a href="#L-1424"><span class="linenos">1424</span></a><span class="sd">        :param fileName: HTML-file path to save Google Candlestick chart.</span>
</span><span id="L-1425"><a href="#L-1425"><span class="linenos">1425</span></a><span class="sd">        :param viewInBrowser: If `True`, then immediately opens html in browser after rendering.</span>
</span><span id="L-1426"><a href="#L-1426"><span class="linenos">1426</span></a><span class="sd">        :param title: specific chart title. If `None`, then used auto-generated title. `None` by default.</span>
</span><span id="L-1427"><a href="#L-1427"><span class="linenos">1427</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1428"><a href="#L-1428"><span class="linenos">1428</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="L-1429"><a href="#L-1429"><span class="linenos">1429</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Empty price data! Generate or load prices before show as Google Candlestick chart!&quot;</span><span class="p">)</span>
</span><span id="L-1430"><a href="#L-1430"><span class="linenos">1430</span></a>
</span><span id="L-1431"><a href="#L-1431"><span class="linenos">1431</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1432"><a href="#L-1432"><span class="linenos">1432</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Rendering Pandas DataFrame as Google Candlestick chart...&quot;</span><span class="p">)</span>
</span><span id="L-1433"><a href="#L-1433"><span class="linenos">1433</span></a>
</span><span id="L-1434"><a href="#L-1434"><span class="linenos">1434</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">DetectTimeframe</span><span class="p">()</span>  <span class="c1"># auto-detect time delta between last two neighbour candles</span>
</span><span id="L-1435"><a href="#L-1435"><span class="linenos">1435</span></a>            <span class="n">infoBlock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetStatistics</span><span class="p">()</span>  <span class="c1"># calculating some indicators</span>
</span><span id="L-1436"><a href="#L-1436"><span class="linenos">1436</span></a>
</span><span id="L-1437"><a href="#L-1437"><span class="linenos">1437</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chartTitle</span> <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">title</span> <span class="k">else</span> <span class="n">title</span>  <span class="c1"># chart title</span>
</span><span id="L-1438"><a href="#L-1438"><span class="linenos">1438</span></a>
</span><span id="L-1439"><a href="#L-1439"><span class="linenos">1439</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">j2model</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">j2model</span><span class="p">:</span>
</span><span id="L-1440"><a href="#L-1440"><span class="linenos">1440</span></a>                <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Preparing Google Candlestick chart configuration...&quot;</span><span class="p">)</span>
</span><span id="L-1441"><a href="#L-1441"><span class="linenos">1441</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">j2model</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;info&quot;</span><span class="p">:</span> <span class="n">infoBlock</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">title</span><span class="p">}</span>
</span><span id="L-1442"><a href="#L-1442"><span class="linenos">1442</span></a>                <span class="n">googleDates</span> <span class="o">=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">date</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
</span><span id="L-1443"><a href="#L-1443"><span class="linenos">1443</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">googleDates</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">low</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">open</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">high</span><span class="p">)</span>
</span><span id="L-1444"><a href="#L-1444"><span class="linenos">1444</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">j2model</span><span class="p">[</span><span class="s2">&quot;candlesData&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
</span><span id="L-1445"><a href="#L-1445"><span class="linenos">1445</span></a>
</span><span id="L-1446"><a href="#L-1446"><span class="linenos">1446</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1447"><a href="#L-1447"><span class="linenos">1447</span></a>                <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Using custom chart model&quot;</span><span class="p">)</span>
</span><span id="L-1448"><a href="#L-1448"><span class="linenos">1448</span></a>
</span><span id="L-1449"><a href="#L-1449"><span class="linenos">1449</span></a>            <span class="c1"># --- Rendering and saving chart as HTML-file and markdown-file with statistics:</span>
</span><span id="L-1450"><a href="#L-1450"><span class="linenos">1450</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">j2template</span><span class="p">):</span>
</span><span id="L-1451"><a href="#L-1451"><span class="linenos">1451</span></a>                <span class="n">renderedTemplate</span> <span class="o">=</span> <span class="n">jinja2</span><span class="o">.</span><span class="n">Template</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">j2template</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span><span id="L-1452"><a href="#L-1452"><span class="linenos">1452</span></a>
</span><span id="L-1453"><a href="#L-1453"><span class="linenos">1453</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1454"><a href="#L-1454"><span class="linenos">1454</span></a>                <span class="n">renderedTemplate</span> <span class="o">=</span> <span class="n">jinja2</span><span class="o">.</span><span class="n">Template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">j2template</span><span class="p">)</span>
</span><span id="L-1455"><a href="#L-1455"><span class="linenos">1455</span></a>
</span><span id="L-1456"><a href="#L-1456"><span class="linenos">1456</span></a>            <span class="n">htmlMain</span> <span class="o">=</span> <span class="n">renderedTemplate</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">j2model</span><span class="p">)</span>
</span><span id="L-1457"><a href="#L-1457"><span class="linenos">1457</span></a>
</span><span id="L-1458"><a href="#L-1458"><span class="linenos">1458</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fH</span><span class="p">:</span>
</span><span id="L-1459"><a href="#L-1459"><span class="linenos">1459</span></a>                <span class="n">fH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">htmlMain</span><span class="p">)</span>
</span><span id="L-1460"><a href="#L-1460"><span class="linenos">1460</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.md&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fileName</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fH</span><span class="p">:</span>
</span><span id="L-1461"><a href="#L-1461"><span class="linenos">1461</span></a>                <span class="n">fH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">infoBlock</span><span class="p">))</span>
</span><span id="L-1462"><a href="#L-1462"><span class="linenos">1462</span></a>
</span><span id="L-1463"><a href="#L-1463"><span class="linenos">1463</span></a>            <span class="k">if</span> <span class="n">viewInBrowser</span><span class="p">:</span>
</span><span id="L-1464"><a href="#L-1464"><span class="linenos">1464</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">fileName</span><span class="p">))</span>  <span class="c1"># view forecast chart in default browser immediately</span>
</span><span id="L-1465"><a href="#L-1465"><span class="linenos">1465</span></a>
</span><span id="L-1466"><a href="#L-1466"><span class="linenos">1466</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Pandas DataFrame rendered as HTML-file [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">fileName</span><span class="p">)))</span>
</span><span id="L-1467"><a href="#L-1467"><span class="linenos">1467</span></a>
</span><span id="L-1468"><a href="#L-1468"><span class="linenos">1468</span></a>
</span><span id="L-1469"><a href="#L-1469"><span class="linenos">1469</span></a><span class="k">def</span> <span class="nf">ParseArgs</span><span class="p">():</span>
</span><span id="L-1470"><a href="#L-1470"><span class="linenos">1470</span></a>    <span class="sd">&quot;&quot;&quot;This function get and parse command line keys.&quot;&quot;&quot;</span>
</span><span id="L-1471"><a href="#L-1471"><span class="linenos">1471</span></a>    <span class="n">parser</span> <span class="o">=</span> <span class="n">ArgumentParser</span><span class="p">()</span>  <span class="c1"># command-line string parser</span>
</span><span id="L-1472"><a href="#L-1472"><span class="linenos">1472</span></a>
</span><span id="L-1473"><a href="#L-1473"><span class="linenos">1473</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;PriceGenerator is the platform for generating prices similar to real stock prices, but you can control the statistics of their distribution. Generates chain of candlesticks with predefined statistical parameters, return Pandas DataFrame or saving as .CSV-file with OHLCV-candlestick in every string. Use PriceGenerator to generate synthetic data to test your trading strategy. See examples: https://tim55667757.github.io/PriceGenerator&quot;</span>
</span><span id="L-1474"><a href="#L-1474"><span class="linenos">1474</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">usage</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">/as module/ python PriceGenerator.py [some options] [one command]</span><span class="se">\n</span><span class="s2">/as CLI tool/ pricegenerator [some options] [one command]&quot;</span>
</span><span id="L-1475"><a href="#L-1475"><span class="linenos">1475</span></a>
</span><span id="L-1476"><a href="#L-1476"><span class="linenos">1476</span></a>    <span class="c1"># options:</span>
</span><span id="L-1477"><a href="#L-1477"><span class="linenos">1477</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--ticker&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;TEST&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Option: some fake ticker name, &#39;TEST&#39; by default.&quot;</span><span class="p">)</span>
</span><span id="L-1478"><a href="#L-1478"><span class="linenos">1478</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--precision&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Option: precision is count of digits after comma, 2 by default.&quot;</span><span class="p">)</span>
</span><span id="L-1479"><a href="#L-1479"><span class="linenos">1479</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--timeframe&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Option: time delta between two neighbour candles in minutes, 60 (1 hour) by default.&quot;</span><span class="p">)</span>
</span><span id="L-1480"><a href="#L-1480"><span class="linenos">1480</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--start&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Option: start time of 1st candle as string with format &#39;year-month-day hour:min&#39;, e.g. &#39;2021-01-02 12:00&#39;.&quot;</span><span class="p">)</span>
</span><span id="L-1481"><a href="#L-1481"><span class="linenos">1481</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--horizon&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Option: candlesticks count. Default: 30.&quot;</span><span class="p">)</span>
</span><span id="L-1482"><a href="#L-1482"><span class="linenos">1482</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--split-trend&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Option: set different trends, e.g. `--split-trend=/\-` means that generated candles has uptrend at first part, next downtrend and then no trend. Used only together with `--split-count` key. Also, you can use words: `up`, `down`, `no` or chars: `u`, `d`, `n` with the hyphen symbol as separator, e.g. `--split-trend=up-down-no-up`, `--split-trend=u-d-n-u` etc. Default: empty string, mean that will be used random trend directions.&quot;</span><span class="p">)</span>
</span><span id="L-1483"><a href="#L-1483"><span class="linenos">1483</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--split-count&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Option: set candles count in different trends, e.g. `--split-count 5 10 15` means that generated candles has 3 trends with 5, 10 and 15 candles in chain, with sum must be equal to `--horizon` value. Used only together with `--split-trend` key. Default: [], empty list mean that will be used random candles count in trends.&quot;</span><span class="p">)</span>
</span><span id="L-1484"><a href="#L-1484"><span class="linenos">1484</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--max-close&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Option: maximum of all close prices.&quot;</span><span class="p">)</span>
</span><span id="L-1485"><a href="#L-1485"><span class="linenos">1485</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--min-close&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Option: minimum of all close prices.&quot;</span><span class="p">)</span>
</span><span id="L-1486"><a href="#L-1486"><span class="linenos">1486</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--init-close&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Option: generator started 1st open price equal to this last close price.&quot;</span><span class="p">)</span>
</span><span id="L-1487"><a href="#L-1487"><span class="linenos">1487</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--max-outlier&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Option: maximum of outlier size of candle tails, by default used (max_close - min_close) / 10.&quot;</span><span class="p">)</span>
</span><span id="L-1488"><a href="#L-1488"><span class="linenos">1488</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--max-body&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Option: maximum of candle body sizes: abs(open - close), by default used max_outlier * 0.9.&quot;</span><span class="p">)</span>
</span><span id="L-1489"><a href="#L-1489"><span class="linenos">1489</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--max-volume&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Option: maximum of trade volumes.&quot;</span><span class="p">)</span>
</span><span id="L-1490"><a href="#L-1490"><span class="linenos">1490</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--up-candles-prob&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Option: float number in [0; 1] is a probability that next candle is up, 0.5 by default.&quot;</span><span class="p">)</span>
</span><span id="L-1491"><a href="#L-1491"><span class="linenos">1491</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--outliers-prob&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.03</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Option: float number in [0; 1] is an outliers probability (price tails), 0.03 by default.&quot;</span><span class="p">)</span>
</span><span id="L-1492"><a href="#L-1492"><span class="linenos">1492</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--trend-deviation&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.005</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Option: relative deviation for trend detection, 0.005 mean ±0.005 by default. No trend if (1st_close - last_close) / 1st_close &lt;= trend_deviation.&quot;</span><span class="p">)</span>
</span><span id="L-1493"><a href="#L-1493"><span class="linenos">1493</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--zigzag&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.03</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Option: relative deviation to detection points of Zig-Zag indicator, 0.03 by default.&quot;</span><span class="p">)</span>
</span><span id="L-1494"><a href="#L-1494"><span class="linenos">1494</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--sep&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Option: separator in CSV-file, if None then auto-detecting enable.&quot;</span><span class="p">)</span>
</span><span id="L-1495"><a href="#L-1495"><span class="linenos">1495</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--dark&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Option: if key present, then will be used dark theme for the `--render-bokeh` key. `False` by default for light theme.&quot;</span><span class="p">)</span>
</span><span id="L-1496"><a href="#L-1496"><span class="linenos">1496</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--debug-level&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Option: showing STDOUT messages of minimal debug level, e.g., 10 = DEBUG, 20 = INFO, 30 = WARNING, 40 = ERROR, 50 = CRITICAL.&quot;</span><span class="p">)</span>
</span><span id="L-1497"><a href="#L-1497"><span class="linenos">1497</span></a>
</span><span id="L-1498"><a href="#L-1498"><span class="linenos">1498</span></a>    <span class="c1"># commands:</span>
</span><span id="L-1499"><a href="#L-1499"><span class="linenos">1499</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--load-from&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Command: load .cvs-file to Pandas DataFrame. You can draw chart in additional with `--render-bokeh` or `--render-google` key.&quot;</span><span class="p">)</span>
</span><span id="L-1500"><a href="#L-1500"><span class="linenos">1500</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--generate&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Command: generates chain of candlesticks with predefined statistical parameters and save stock history as Pandas DataFrame or .CSV-file if `--save-to` key is defined. You can draw chart in additional with `--render-bokeh` or `--render-google` keys.&quot;</span><span class="p">)</span>
</span><span id="L-1501"><a href="#L-1501"><span class="linenos">1501</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--save-to&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Command: save generated or loaded dataframe to .CSV-file. You can draw chart in additional with `--render-bokeh` or `--render-google` keys.&quot;</span><span class="p">)</span>
</span><span id="L-1502"><a href="#L-1502"><span class="linenos">1502</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--render-bokeh&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Command: show chain of candlesticks as interactive Bokeh chart. Used only together with `--load-from` or `--generate` keys.&quot;</span><span class="p">)</span>
</span><span id="L-1503"><a href="#L-1503"><span class="linenos">1503</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--render-google&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Command: show chain of candlesticks as non-interactive Google Candlestick chart. Used only together with `--load-from` or `--generate` keys.&quot;</span><span class="p">)</span>
</span><span id="L-1504"><a href="#L-1504"><span class="linenos">1504</span></a>
</span><span id="L-1505"><a href="#L-1505"><span class="linenos">1505</span></a>    <span class="n">cmdArgs</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</span><span id="L-1506"><a href="#L-1506"><span class="linenos">1506</span></a>    <span class="k">return</span> <span class="n">cmdArgs</span>
</span><span id="L-1507"><a href="#L-1507"><span class="linenos">1507</span></a>
</span><span id="L-1508"><a href="#L-1508"><span class="linenos">1508</span></a>
</span><span id="L-1509"><a href="#L-1509"><span class="linenos">1509</span></a><span class="k">def</span> <span class="nf">Main</span><span class="p">():</span>
</span><span id="L-1510"><a href="#L-1510"><span class="linenos">1510</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1511"><a href="#L-1511"><span class="linenos">1511</span></a><span class="sd">    Main function for work with PriceGenerator in the console.</span>
</span><span id="L-1512"><a href="#L-1512"><span class="linenos">1512</span></a>
</span><span id="L-1513"><a href="#L-1513"><span class="linenos">1513</span></a><span class="sd">    See examples:</span>
</span><span id="L-1514"><a href="#L-1514"><span class="linenos">1514</span></a><span class="sd">    - in english: https://github.com/Tim55667757/PriceGenerator/blob/master/README.md</span>
</span><span id="L-1515"><a href="#L-1515"><span class="linenos">1515</span></a><span class="sd">    - in russian: https://github.com/Tim55667757/PriceGenerator/blob/master/README_RU.md</span>
</span><span id="L-1516"><a href="#L-1516"><span class="linenos">1516</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1517"><a href="#L-1517"><span class="linenos">1517</span></a>    <span class="n">args</span> <span class="o">=</span> <span class="n">ParseArgs</span><span class="p">()</span>  <span class="c1"># get and parse command-line parameters</span>
</span><span id="L-1518"><a href="#L-1518"><span class="linenos">1518</span></a>    <span class="n">exitCode</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1519"><a href="#L-1519"><span class="linenos">1519</span></a>
</span><span id="L-1520"><a href="#L-1520"><span class="linenos">1520</span></a>    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">debug_level</span><span class="p">:</span>
</span><span id="L-1521"><a href="#L-1521"><span class="linenos">1521</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># always debug level by default</span>
</span><span id="L-1522"><a href="#L-1522"><span class="linenos">1522</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">handlers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">debug_level</span>  <span class="c1"># level for STDOUT</span>
</span><span id="L-1523"><a href="#L-1523"><span class="linenos">1523</span></a>        <span class="c1"># uLogger.handlers[1].level = 10  # always debug level for log.txt</span>
</span><span id="L-1524"><a href="#L-1524"><span class="linenos">1524</span></a>
</span><span id="L-1525"><a href="#L-1525"><span class="linenos">1525</span></a>    <span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">tzlocal</span><span class="p">())</span>
</span><span id="L-1526"><a href="#L-1526"><span class="linenos">1526</span></a>    <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">uLog</span><span class="o">.</span><span class="n">sepLine</span><span class="p">)</span>
</span><span id="L-1527"><a href="#L-1527"><span class="linenos">1527</span></a>    <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;PriceGenerator started: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">start</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)))</span>
</span><span id="L-1528"><a href="#L-1528"><span class="linenos">1528</span></a>
</span><span id="L-1529"><a href="#L-1529"><span class="linenos">1529</span></a>    <span class="n">priceModel</span> <span class="o">=</span> <span class="n">PriceGenerator</span><span class="p">()</span>
</span><span id="L-1530"><a href="#L-1530"><span class="linenos">1530</span></a>
</span><span id="L-1531"><a href="#L-1531"><span class="linenos">1531</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-1532"><a href="#L-1532"><span class="linenos">1532</span></a>        <span class="c1"># --- set options:</span>
</span><span id="L-1533"><a href="#L-1533"><span class="linenos">1533</span></a>
</span><span id="L-1534"><a href="#L-1534"><span class="linenos">1534</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">sep</span><span class="p">:</span>
</span><span id="L-1535"><a href="#L-1535"><span class="linenos">1535</span></a>            <span class="n">priceModel</span><span class="o">.</span><span class="n">sep</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">sep</span>  <span class="c1"># separator in .CSV-file</span>
</span><span id="L-1536"><a href="#L-1536"><span class="linenos">1536</span></a>
</span><span id="L-1537"><a href="#L-1537"><span class="linenos">1537</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">ticker</span><span class="p">:</span>
</span><span id="L-1538"><a href="#L-1538"><span class="linenos">1538</span></a>            <span class="n">priceModel</span><span class="o">.</span><span class="n">ticker</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">ticker</span>  <span class="c1"># some fake ticker name, &quot;TEST&quot; by default</span>
</span><span id="L-1539"><a href="#L-1539"><span class="linenos">1539</span></a>
</span><span id="L-1540"><a href="#L-1540"><span class="linenos">1540</span></a>        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">precision</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1541"><a href="#L-1541"><span class="linenos">1541</span></a>            <span class="n">priceModel</span><span class="o">.</span><span class="n">precision</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">precision</span>  <span class="c1"># precision is count of digits after comma, 2 by default</span>
</span><span id="L-1542"><a href="#L-1542"><span class="linenos">1542</span></a>
</span><span id="L-1543"><a href="#L-1543"><span class="linenos">1543</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">timeframe</span><span class="p">:</span>
</span><span id="L-1544"><a href="#L-1544"><span class="linenos">1544</span></a>            <span class="n">priceModel</span><span class="o">.</span><span class="n">timeframe</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">timeframe</span><span class="p">)</span>  <span class="c1"># time delta between two neighbour candles in minutes, 60 (1 hour) by default</span>
</span><span id="L-1545"><a href="#L-1545"><span class="linenos">1545</span></a>
</span><span id="L-1546"><a href="#L-1546"><span class="linenos">1546</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">start</span><span class="p">:</span>
</span><span id="L-1547"><a href="#L-1547"><span class="linenos">1547</span></a>            <span class="n">priceModel</span><span class="o">.</span><span class="n">timeStart</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M&quot;</span><span class="p">)</span>
</span><span id="L-1548"><a href="#L-1548"><span class="linenos">1548</span></a>
</span><span id="L-1549"><a href="#L-1549"><span class="linenos">1549</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">horizon</span><span class="p">:</span>
</span><span id="L-1550"><a href="#L-1550"><span class="linenos">1550</span></a>            <span class="n">priceModel</span><span class="o">.</span><span class="n">horizon</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">horizon</span>  <span class="c1"># generating candlesticks count</span>
</span><span id="L-1551"><a href="#L-1551"><span class="linenos">1551</span></a>
</span><span id="L-1552"><a href="#L-1552"><span class="linenos">1552</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">split_trend</span><span class="p">:</span>
</span><span id="L-1553"><a href="#L-1553"><span class="linenos">1553</span></a>            <span class="n">priceModel</span><span class="o">.</span><span class="n">trendSplit</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">split_trend</span>  <span class="c1"># difference periods</span>
</span><span id="L-1554"><a href="#L-1554"><span class="linenos">1554</span></a>
</span><span id="L-1555"><a href="#L-1555"><span class="linenos">1555</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">split_count</span><span class="p">:</span>
</span><span id="L-1556"><a href="#L-1556"><span class="linenos">1556</span></a>            <span class="n">priceModel</span><span class="o">.</span><span class="n">splitCount</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">split_count</span>  <span class="c1"># candles in every period</span>
</span><span id="L-1557"><a href="#L-1557"><span class="linenos">1557</span></a>
</span><span id="L-1558"><a href="#L-1558"><span class="linenos">1558</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">min_close</span><span class="p">:</span>
</span><span id="L-1559"><a href="#L-1559"><span class="linenos">1559</span></a>            <span class="n">priceModel</span><span class="o">.</span><span class="n">minClose</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">min_close</span>  <span class="c1"># minimum of all close prices</span>
</span><span id="L-1560"><a href="#L-1560"><span class="linenos">1560</span></a>
</span><span id="L-1561"><a href="#L-1561"><span class="linenos">1561</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">init_close</span><span class="p">:</span>
</span><span id="L-1562"><a href="#L-1562"><span class="linenos">1562</span></a>            <span class="n">priceModel</span><span class="o">.</span><span class="n">initClose</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">init_close</span>  <span class="c1"># generator started 1st open price of chain from this &quot;last&quot; close price</span>
</span><span id="L-1563"><a href="#L-1563"><span class="linenos">1563</span></a>
</span><span id="L-1564"><a href="#L-1564"><span class="linenos">1564</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">max_outlier</span><span class="p">:</span>
</span><span id="L-1565"><a href="#L-1565"><span class="linenos">1565</span></a>            <span class="n">priceModel</span><span class="o">.</span><span class="n">maxOutlier</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">max_outlier</span>  <span class="c1"># maximum of outlier size of candle tails, by default used (max-close - min-close) / 10</span>
</span><span id="L-1566"><a href="#L-1566"><span class="linenos">1566</span></a>
</span><span id="L-1567"><a href="#L-1567"><span class="linenos">1567</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">max_body</span><span class="p">:</span>
</span><span id="L-1568"><a href="#L-1568"><span class="linenos">1568</span></a>            <span class="n">priceModel</span><span class="o">.</span><span class="n">maxCandleBody</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">max_body</span>  <span class="c1"># maximum of candle body sizes: abs(open - close), by default used max-outlier * 90%</span>
</span><span id="L-1569"><a href="#L-1569"><span class="linenos">1569</span></a>
</span><span id="L-1570"><a href="#L-1570"><span class="linenos">1570</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">max_volume</span><span class="p">:</span>
</span><span id="L-1571"><a href="#L-1571"><span class="linenos">1571</span></a>            <span class="n">priceModel</span><span class="o">.</span><span class="n">maxVolume</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">max_volume</span>  <span class="c1"># maximum of trade volumes</span>
</span><span id="L-1572"><a href="#L-1572"><span class="linenos">1572</span></a>
</span><span id="L-1573"><a href="#L-1573"><span class="linenos">1573</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">up_candles_prob</span><span class="p">:</span>
</span><span id="L-1574"><a href="#L-1574"><span class="linenos">1574</span></a>            <span class="n">priceModel</span><span class="o">.</span><span class="n">upCandlesProb</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">up_candles_prob</span>  <span class="c1"># float number in [0; 1] is a probability that next candle is up, 0.5 = 50% by default</span>
</span><span id="L-1575"><a href="#L-1575"><span class="linenos">1575</span></a>
</span><span id="L-1576"><a href="#L-1576"><span class="linenos">1576</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">outliers_prob</span><span class="p">:</span>
</span><span id="L-1577"><a href="#L-1577"><span class="linenos">1577</span></a>            <span class="n">priceModel</span><span class="o">.</span><span class="n">outliersProb</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">outliers_prob</span>  <span class="c1"># float number in [0; 1] is a statistical outlier probability (price &quot;tails&quot;), 0.03 = 3% by default</span>
</span><span id="L-1578"><a href="#L-1578"><span class="linenos">1578</span></a>
</span><span id="L-1579"><a href="#L-1579"><span class="linenos">1579</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">trend_deviation</span><span class="p">:</span>
</span><span id="L-1580"><a href="#L-1580"><span class="linenos">1580</span></a>            <span class="n">priceModel</span><span class="o">.</span><span class="n">trendDeviation</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">trend_deviation</span>  <span class="c1"># relative deviation for trend detection, 0.005 mean ±0.5% by default. &quot;NO trend&quot; if (1st_close - last_close) / 1st_close &lt;= trend-deviation</span>
</span><span id="L-1581"><a href="#L-1581"><span class="linenos">1581</span></a>
</span><span id="L-1582"><a href="#L-1582"><span class="linenos">1582</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">zigzag</span><span class="p">:</span>
</span><span id="L-1583"><a href="#L-1583"><span class="linenos">1583</span></a>            <span class="n">priceModel</span><span class="o">.</span><span class="n">zigZagDeviation</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">zigzag</span>  <span class="c1"># relative deviation to detection points of ZigZag indicator, 0.03 by default</span>
</span><span id="L-1584"><a href="#L-1584"><span class="linenos">1584</span></a>
</span><span id="L-1585"><a href="#L-1585"><span class="linenos">1585</span></a>        <span class="c1"># --- do one or more commands:</span>
</span><span id="L-1586"><a href="#L-1586"><span class="linenos">1586</span></a>
</span><span id="L-1587"><a href="#L-1587"><span class="linenos">1587</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">load_from</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">generate</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">save_to</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">render_bokeh</span><span class="p">:</span>
</span><span id="L-1588"><a href="#L-1588"><span class="linenos">1588</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;At least one command must be selected! See: python PriceGenerator.py --help&quot;</span><span class="p">)</span>
</span><span id="L-1589"><a href="#L-1589"><span class="linenos">1589</span></a>
</span><span id="L-1590"><a href="#L-1590"><span class="linenos">1590</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">load_from</span><span class="p">:</span>
</span><span id="L-1591"><a href="#L-1591"><span class="linenos">1591</span></a>            <span class="n">priceModel</span><span class="o">.</span><span class="n">LoadFromFile</span><span class="p">(</span><span class="n">fileName</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">load_from</span><span class="p">)</span>
</span><span id="L-1592"><a href="#L-1592"><span class="linenos">1592</span></a>
</span><span id="L-1593"><a href="#L-1593"><span class="linenos">1593</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">generate</span><span class="p">:</span>
</span><span id="L-1594"><a href="#L-1594"><span class="linenos">1594</span></a>            <span class="n">priceModel</span><span class="o">.</span><span class="n">Generate</span><span class="p">()</span>
</span><span id="L-1595"><a href="#L-1595"><span class="linenos">1595</span></a>
</span><span id="L-1596"><a href="#L-1596"><span class="linenos">1596</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">save_to</span><span class="p">:</span>
</span><span id="L-1597"><a href="#L-1597"><span class="linenos">1597</span></a>            <span class="n">priceModel</span><span class="o">.</span><span class="n">SaveToFile</span><span class="p">(</span><span class="n">fileName</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">save_to</span><span class="p">)</span>
</span><span id="L-1598"><a href="#L-1598"><span class="linenos">1598</span></a>
</span><span id="L-1599"><a href="#L-1599"><span class="linenos">1599</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">render_bokeh</span><span class="p">:</span>
</span><span id="L-1600"><a href="#L-1600"><span class="linenos">1600</span></a>            <span class="n">priceModel</span><span class="o">.</span><span class="n">RenderBokeh</span><span class="p">(</span>
</span><span id="L-1601"><a href="#L-1601"><span class="linenos">1601</span></a>                <span class="n">fileName</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">render_bokeh</span><span class="p">,</span>
</span><span id="L-1602"><a href="#L-1602"><span class="linenos">1602</span></a>                <span class="n">viewInBrowser</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1603"><a href="#L-1603"><span class="linenos">1603</span></a>                <span class="n">darkTheme</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">dark</span><span class="p">,</span>
</span><span id="L-1604"><a href="#L-1604"><span class="linenos">1604</span></a>                <span class="n">width</span><span class="o">=</span><span class="mi">1800</span><span class="p">,</span>
</span><span id="L-1605"><a href="#L-1605"><span class="linenos">1605</span></a>                <span class="n">height</span><span class="o">=</span><span class="mi">940</span><span class="p">,</span>
</span><span id="L-1606"><a href="#L-1606"><span class="linenos">1606</span></a>                <span class="n">showControlsOnChart</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1607"><a href="#L-1607"><span class="linenos">1607</span></a>                <span class="n">showStatOnChart</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1608"><a href="#L-1608"><span class="linenos">1608</span></a>                <span class="n">inline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-1609"><a href="#L-1609"><span class="linenos">1609</span></a>            <span class="p">)</span>
</span><span id="L-1610"><a href="#L-1610"><span class="linenos">1610</span></a>
</span><span id="L-1611"><a href="#L-1611"><span class="linenos">1611</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">render_google</span><span class="p">:</span>
</span><span id="L-1612"><a href="#L-1612"><span class="linenos">1612</span></a>            <span class="n">priceModel</span><span class="o">.</span><span class="n">RenderGoogle</span><span class="p">(</span>
</span><span id="L-1613"><a href="#L-1613"><span class="linenos">1613</span></a>                <span class="n">fileName</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">render_google</span><span class="p">,</span>
</span><span id="L-1614"><a href="#L-1614"><span class="linenos">1614</span></a>                <span class="n">viewInBrowser</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1615"><a href="#L-1615"><span class="linenos">1615</span></a>            <span class="p">)</span>
</span><span id="L-1616"><a href="#L-1616"><span class="linenos">1616</span></a>
</span><span id="L-1617"><a href="#L-1617"><span class="linenos">1617</span></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-1618"><a href="#L-1618"><span class="linenos">1618</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="L-1619"><a href="#L-1619"><span class="linenos">1619</span></a>        <span class="n">exc</span> <span class="o">=</span> <span class="n">tb</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1620"><a href="#L-1620"><span class="linenos">1620</span></a>        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">exc</span><span class="p">:</span>
</span><span id="L-1621"><a href="#L-1621"><span class="linenos">1621</span></a>            <span class="k">if</span> <span class="n">line</span><span class="p">:</span>
</span><span id="L-1622"><a href="#L-1622"><span class="linenos">1622</span></a>                <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span><span id="L-1623"><a href="#L-1623"><span class="linenos">1623</span></a>        <span class="n">exitCode</span> <span class="o">=</span> <span class="mi">255</span>
</span><span id="L-1624"><a href="#L-1624"><span class="linenos">1624</span></a>
</span><span id="L-1625"><a href="#L-1625"><span class="linenos">1625</span></a>    <span class="k">finally</span><span class="p">:</span>
</span><span id="L-1626"><a href="#L-1626"><span class="linenos">1626</span></a>        <span class="n">finish</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">tzlocal</span><span class="p">())</span>
</span><span id="L-1627"><a href="#L-1627"><span class="linenos">1627</span></a>
</span><span id="L-1628"><a href="#L-1628"><span class="linenos">1628</span></a>        <span class="k">if</span> <span class="n">exitCode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1629"><a href="#L-1629"><span class="linenos">1629</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;All PriceGenerator operations are finished success (summary code is 0).&quot;</span><span class="p">)</span>
</span><span id="L-1630"><a href="#L-1630"><span class="linenos">1630</span></a>
</span><span id="L-1631"><a href="#L-1631"><span class="linenos">1631</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1632"><a href="#L-1632"><span class="linenos">1632</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;An errors occurred during the work! See full debug log with --debug-level 10. Summary code: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">exitCode</span><span class="p">))</span>
</span><span id="L-1633"><a href="#L-1633"><span class="linenos">1633</span></a>
</span><span id="L-1634"><a href="#L-1634"><span class="linenos">1634</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;PriceGenerator work duration: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">finish</span> <span class="o">-</span> <span class="n">start</span><span class="p">))</span>
</span><span id="L-1635"><a href="#L-1635"><span class="linenos">1635</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;PriceGenerator work finished: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">finish</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)))</span>
</span><span id="L-1636"><a href="#L-1636"><span class="linenos">1636</span></a>
</span><span id="L-1637"><a href="#L-1637"><span class="linenos">1637</span></a>        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">exitCode</span><span class="p">)</span>
</span><span id="L-1638"><a href="#L-1638"><span class="linenos">1638</span></a>
</span><span id="L-1639"><a href="#L-1639"><span class="linenos">1639</span></a>
</span><span id="L-1640"><a href="#L-1640"><span class="linenos">1640</span></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="L-1641"><a href="#L-1641"><span class="linenos">1641</span></a>    <span class="n">Main</span><span class="p">()</span>
</span></pre></div>


            </section>
                <section id="PriceGenerator">
                            <input id="PriceGenerator-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">PriceGenerator</span>:

                <label class="view-source-button" for="PriceGenerator-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PriceGenerator"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PriceGenerator-212"><a href="#PriceGenerator-212"><span class="linenos"> 212</span></a><span class="k">class</span> <span class="nc">PriceGenerator</span><span class="p">:</span>
</span><span id="PriceGenerator-213"><a href="#PriceGenerator-213"><span class="linenos"> 213</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="PriceGenerator-214"><a href="#PriceGenerator-214"><span class="linenos"> 214</span></a><span class="sd">    This class implements methods to generation of prices statistically similar to real ones.</span>
</span><span id="PriceGenerator-215"><a href="#PriceGenerator-215"><span class="linenos"> 215</span></a>
</span><span id="PriceGenerator-216"><a href="#PriceGenerator-216"><span class="linenos"> 216</span></a><span class="sd">    **Model generated: OHLCV-candlesticks (open, high, low, close, volume).**</span>
</span><span id="PriceGenerator-217"><a href="#PriceGenerator-217"><span class="linenos"> 217</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="PriceGenerator-218"><a href="#PriceGenerator-218"><span class="linenos"> 218</span></a>
</span><span id="PriceGenerator-219"><a href="#PriceGenerator-219"><span class="linenos"> 219</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="PriceGenerator-220"><a href="#PriceGenerator-220"><span class="linenos"> 220</span></a>        <span class="sd">&quot;&quot;&quot;Main class init.&quot;&quot;&quot;</span>
</span><span id="PriceGenerator-221"><a href="#PriceGenerator-221"><span class="linenos"> 221</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PriceGenerator-222"><a href="#PriceGenerator-222"><span class="linenos"> 222</span></a>        <span class="sd">&quot;&quot;&quot;Generated or loaded prices will be available in this Pandas DataFrame variable.&quot;&quot;&quot;</span>
</span><span id="PriceGenerator-223"><a href="#PriceGenerator-223"><span class="linenos"> 223</span></a>
</span><span id="PriceGenerator-224"><a href="#PriceGenerator-224"><span class="linenos"> 224</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">csvHeaders</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;open&quot;</span><span class="p">,</span> <span class="s2">&quot;high&quot;</span><span class="p">,</span> <span class="s2">&quot;low&quot;</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">,</span> <span class="s2">&quot;volume&quot;</span><span class="p">]</span>
</span><span id="PriceGenerator-225"><a href="#PriceGenerator-225"><span class="linenos"> 225</span></a>        <span class="sd">&quot;&quot;&quot;Headers in .CSV-file. Default: `[&quot;date&quot;, &quot;time&quot;, &quot;open&quot;, &quot;high&quot;, &quot;low&quot;, &quot;close&quot;, &quot;volume&quot;]`.&quot;&quot;&quot;</span>
</span><span id="PriceGenerator-226"><a href="#PriceGenerator-226"><span class="linenos"> 226</span></a>
</span><span id="PriceGenerator-227"><a href="#PriceGenerator-227"><span class="linenos"> 227</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dfHeaders</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;datetime&quot;</span><span class="p">,</span> <span class="s2">&quot;open&quot;</span><span class="p">,</span> <span class="s2">&quot;high&quot;</span><span class="p">,</span> <span class="s2">&quot;low&quot;</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">,</span> <span class="s2">&quot;volume&quot;</span><span class="p">]</span>
</span><span id="PriceGenerator-228"><a href="#PriceGenerator-228"><span class="linenos"> 228</span></a>        <span class="sd">&quot;&quot;&quot;Headers in Pandas DataFrame. Default: `[&quot;datetime&quot;, &quot;open&quot;, &quot;high&quot;, &quot;low&quot;, &quot;close&quot;, &quot;volume&quot;]`.&quot;&quot;&quot;</span>
</span><span id="PriceGenerator-229"><a href="#PriceGenerator-229"><span class="linenos"> 229</span></a>
</span><span id="PriceGenerator-230"><a href="#PriceGenerator-230"><span class="linenos"> 230</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span>
</span><span id="PriceGenerator-231"><a href="#PriceGenerator-231"><span class="linenos"> 231</span></a>        <span class="sd">&quot;&quot;&quot;Separator in csv - file. Default: `,`&quot;&quot;&quot;</span>
</span><span id="PriceGenerator-232"><a href="#PriceGenerator-232"><span class="linenos"> 232</span></a>
</span><span id="PriceGenerator-233"><a href="#PriceGenerator-233"><span class="linenos"> 233</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">j2template</span> <span class="o">=</span> <span class="n">GOOGLE_TEMPLATE_J2</span>
</span><span id="PriceGenerator-234"><a href="#PriceGenerator-234"><span class="linenos"> 234</span></a>        <span class="sd">&quot;&quot;&quot;Full path to custom jinja2 html-template file (e.g. `google_template_example.j2`) or just set here a long multi-string variable. Default: `GOOGLE_TEMPLATE_J2` is a multi-string variable with internal template.&quot;&quot;&quot;</span>
</span><span id="PriceGenerator-235"><a href="#PriceGenerator-235"><span class="linenos"> 235</span></a>
</span><span id="PriceGenerator-236"><a href="#PriceGenerator-236"><span class="linenos"> 236</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">j2model</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PriceGenerator-237"><a href="#PriceGenerator-237"><span class="linenos"> 237</span></a>        <span class="sd">&quot;&quot;&quot;Dictionary of variables for jinja2 template. If `None` then used default variables for internal `GOOGLE_TEMPLATE_J2`&quot;&quot;&quot;</span>
</span><span id="PriceGenerator-238"><a href="#PriceGenerator-238"><span class="linenos"> 238</span></a>
</span><span id="PriceGenerator-239"><a href="#PriceGenerator-239"><span class="linenos"> 239</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_precision</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="PriceGenerator-240"><a href="#PriceGenerator-240"><span class="linenos"> 240</span></a>        <span class="sd">&quot;&quot;&quot;Signs after comma. Default: `2`.&quot;&quot;&quot;</span>
</span><span id="PriceGenerator-241"><a href="#PriceGenerator-241"><span class="linenos"> 241</span></a>
</span><span id="PriceGenerator-242"><a href="#PriceGenerator-242"><span class="linenos"> 242</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_deg10prec</span> <span class="o">=</span> <span class="mi">100</span>
</span><span id="PriceGenerator-243"><a href="#PriceGenerator-243"><span class="linenos"> 243</span></a>        <span class="sd">&quot;&quot;&quot;Constant 10^precision is used by some formulas. Not recommended to change it. Default: `100` (`10 ** precision`).&quot;&quot;&quot;</span>
</span><span id="PriceGenerator-244"><a href="#PriceGenerator-244"><span class="linenos"> 244</span></a>
</span><span id="PriceGenerator-245"><a href="#PriceGenerator-245"><span class="linenos"> 245</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ticker</span> <span class="o">=</span> <span class="s2">&quot;TEST&quot;</span>
</span><span id="PriceGenerator-246"><a href="#PriceGenerator-246"><span class="linenos"> 246</span></a>        <span class="sd">&quot;&quot;&quot;Some fake ticker name. Default: `Test`.&quot;&quot;&quot;</span>
</span><span id="PriceGenerator-247"><a href="#PriceGenerator-247"><span class="linenos"> 247</span></a>
</span><span id="PriceGenerator-248"><a href="#PriceGenerator-248"><span class="linenos"> 248</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="PriceGenerator-249"><a href="#PriceGenerator-249"><span class="linenos"> 249</span></a>        <span class="sd">&quot;&quot;&quot;Time delta between two neighbour candles. Default: `timedelta(hours=1)`.&quot;&quot;&quot;</span>
</span><span id="PriceGenerator-250"><a href="#PriceGenerator-250"><span class="linenos"> 250</span></a>
</span><span id="PriceGenerator-251"><a href="#PriceGenerator-251"><span class="linenos"> 251</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">timeStart</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">tzlocal</span><span class="p">())</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">microsecond</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">second</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="PriceGenerator-252"><a href="#PriceGenerator-252"><span class="linenos"> 252</span></a>        <span class="sd">&quot;&quot;&quot;First date and time for candles chain.&quot;&quot;&quot;</span>
</span><span id="PriceGenerator-253"><a href="#PriceGenerator-253"><span class="linenos"> 253</span></a>
</span><span id="PriceGenerator-254"><a href="#PriceGenerator-254"><span class="linenos"> 254</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PriceGenerator-255"><a href="#PriceGenerator-255"><span class="linenos"> 255</span></a>        <span class="sd">&quot;&quot;&quot;Candlesticks count in generated or loaded chain of prices, must be &gt;= 5. Default: `None` (means auto-detect length of chain if loaded from file).&quot;&quot;&quot;</span>
</span><span id="PriceGenerator-256"><a href="#PriceGenerator-256"><span class="linenos"> 256</span></a>
</span><span id="PriceGenerator-257"><a href="#PriceGenerator-257"><span class="linenos"> 257</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="PriceGenerator-258"><a href="#PriceGenerator-258"><span class="linenos"> 258</span></a>        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Set different trends, e.g. `trendSplit=&quot;/\-&quot;` means that generated candles has uptrend at first part, next downtrend and then no trend. Used only together with `splitCount` variable. Also, you can use words: `up`, `down`, `no` or chars: `u`, `d`, `n` with the hyphen symbol as separator, e.g. `trendSplit=up-down-no-up`, `trendSplit=u-d-n-u` etc. Default: `&quot;&quot;`, empty string mean that will be used random trend directions.&quot;&quot;&quot;</span>
</span><span id="PriceGenerator-259"><a href="#PriceGenerator-259"><span class="linenos"> 259</span></a>
</span><span id="PriceGenerator-260"><a href="#PriceGenerator-260"><span class="linenos"> 260</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="PriceGenerator-261"><a href="#PriceGenerator-261"><span class="linenos"> 261</span></a>        <span class="sd">&quot;&quot;&quot;Set candles count in different trends, e.g. `splitCount=[5, 10, 15]` means that generated candles has 3 trends with 5, 10 and 15 candles in chain, with sum must be equal to horizon. Used only together with `trendSplit` variable. Default: `[]`, empty list mean that will be used random candles count in trends.&quot;&quot;&quot;</span>
</span><span id="PriceGenerator-262"><a href="#PriceGenerator-262"><span class="linenos"> 262</span></a>
</span><span id="PriceGenerator-263"><a href="#PriceGenerator-263"><span class="linenos"> 263</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">maxClose</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">70</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
</span><span id="PriceGenerator-264"><a href="#PriceGenerator-264"><span class="linenos"> 264</span></a>        <span class="sd">&quot;&quot;&quot;Maximum of close prices must be &gt;= `minClose`. Default: random in interval `(70, 90)`.&quot;&quot;&quot;</span>
</span><span id="PriceGenerator-265"><a href="#PriceGenerator-265"><span class="linenos"> 265</span></a>
</span><span id="PriceGenerator-266"><a href="#PriceGenerator-266"><span class="linenos"> 266</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">minClose</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">70</span><span class="p">)</span>
</span><span id="PriceGenerator-267"><a href="#PriceGenerator-267"><span class="linenos"> 267</span></a>        <span class="sd">&quot;&quot;&quot;Minimum of close prices must be &lt;= `maxClose`. Default: random in interval `(60, 70)`.&quot;&quot;&quot;</span>
</span><span id="PriceGenerator-268"><a href="#PriceGenerator-268"><span class="linenos"> 268</span></a>
</span><span id="PriceGenerator-269"><a href="#PriceGenerator-269"><span class="linenos"> 269</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initClose</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PriceGenerator-270"><a href="#PriceGenerator-270"><span class="linenos"> 270</span></a>        <span class="sd">&quot;&quot;&quot;First candle close price value. If `None` then used random number in interval between `minClose` and `maxClose`. Default: `None`.&quot;&quot;&quot;</span>
</span><span id="PriceGenerator-271"><a href="#PriceGenerator-271"><span class="linenos"> 271</span></a>
</span><span id="PriceGenerator-272"><a href="#PriceGenerator-272"><span class="linenos"> 272</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">maxOutlier</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PriceGenerator-273"><a href="#PriceGenerator-273"><span class="linenos"> 273</span></a>        <span class="sd">&quot;&quot;&quot;Maximum size of outliers. If `None` then used value `(maxClose - minClose) / 10`. Default: `None`.&quot;&quot;&quot;</span>
</span><span id="PriceGenerator-274"><a href="#PriceGenerator-274"><span class="linenos"> 274</span></a>
</span><span id="PriceGenerator-275"><a href="#PriceGenerator-275"><span class="linenos"> 275</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">maxCandleBody</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PriceGenerator-276"><a href="#PriceGenerator-276"><span class="linenos"> 276</span></a>        <span class="sd">&quot;&quot;&quot;Maximum of candle body sizes: `abs(open - close)`. If `None` then used value `maxOutlier * 90%`. Default: `None`.&quot;&quot;&quot;</span>
</span><span id="PriceGenerator-277"><a href="#PriceGenerator-277"><span class="linenos"> 277</span></a>
</span><span id="PriceGenerator-278"><a href="#PriceGenerator-278"><span class="linenos"> 278</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_maxVolume</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100000</span><span class="p">)</span>
</span><span id="PriceGenerator-279"><a href="#PriceGenerator-279"><span class="linenos"> 279</span></a>        <span class="sd">&quot;&quot;&quot;Maximum of generated trade volumes. Default: random in interval `(0, 100000)`.&quot;&quot;&quot;</span>
</span><span id="PriceGenerator-280"><a href="#PriceGenerator-280"><span class="linenos"> 280</span></a>
</span><span id="PriceGenerator-281"><a href="#PriceGenerator-281"><span class="linenos"> 281</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_upCandlesProb</span> <span class="o">=</span> <span class="mf">0.5</span>
</span><span id="PriceGenerator-282"><a href="#PriceGenerator-282"><span class="linenos"> 282</span></a>        <span class="sd">&quot;&quot;&quot;Probability that next candle is up. Default: `0.5` (means 50% of probability).&quot;&quot;&quot;</span>
</span><span id="PriceGenerator-283"><a href="#PriceGenerator-283"><span class="linenos"> 283</span></a>
</span><span id="PriceGenerator-284"><a href="#PriceGenerator-284"><span class="linenos"> 284</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_outliersProb</span> <span class="o">=</span> <span class="mf">0.03</span>
</span><span id="PriceGenerator-285"><a href="#PriceGenerator-285"><span class="linenos"> 285</span></a>        <span class="sd">&quot;&quot;&quot;Outlier probability (price tails). Default: `0.03` (means 3% of probability).&quot;&quot;&quot;</span>
</span><span id="PriceGenerator-286"><a href="#PriceGenerator-286"><span class="linenos"> 286</span></a>
</span><span id="PriceGenerator-287"><a href="#PriceGenerator-287"><span class="linenos"> 287</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trendDeviation</span> <span class="o">=</span> <span class="mf">0.005</span>
</span><span id="PriceGenerator-288"><a href="#PriceGenerator-288"><span class="linenos"> 288</span></a>        <span class="sd">&quot;&quot;&quot;Relative deviation for trend detection. &quot;NO trend&quot; if `(1st_close - last_close) / 1st_close &lt;= self.trendDeviation`. Default: `0.005` (means ±0.5% of price deviation).&quot;&quot;&quot;</span>
</span><span id="PriceGenerator-289"><a href="#PriceGenerator-289"><span class="linenos"> 289</span></a>
</span><span id="PriceGenerator-290"><a href="#PriceGenerator-290"><span class="linenos"> 290</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_chartTitle</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="PriceGenerator-291"><a href="#PriceGenerator-291"><span class="linenos"> 291</span></a>        <span class="sd">&quot;&quot;&quot;Chart title. It will be auto-generated when loading or creating chain of candlesticks.&quot;&quot;&quot;</span>
</span><span id="PriceGenerator-292"><a href="#PriceGenerator-292"><span class="linenos"> 292</span></a>
</span><span id="PriceGenerator-293"><a href="#PriceGenerator-293"><span class="linenos"> 293</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_zigZagDeviation</span> <span class="o">=</span> <span class="mf">0.03</span>
</span><span id="PriceGenerator-294"><a href="#PriceGenerator-294"><span class="linenos"> 294</span></a>        <span class="sd">&quot;&quot;&quot;Relative deviation to detection next points used by Zig-Zag indicator. Default: `0.03` (means 3% of price deviation).&quot;&quot;&quot;</span>
</span><span id="PriceGenerator-295"><a href="#PriceGenerator-295"><span class="linenos"> 295</span></a>
</span><span id="PriceGenerator-296"><a href="#PriceGenerator-296"><span class="linenos"> 296</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="PriceGenerator-297"><a href="#PriceGenerator-297"><span class="linenos"> 297</span></a>            <span class="s2">&quot;candles&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># generated candlesticks count</span>
</span><span id="PriceGenerator-298"><a href="#PriceGenerator-298"><span class="linenos"> 298</span></a>            <span class="s2">&quot;precision&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>  <span class="c1"># generated candlesticks count</span>
</span><span id="PriceGenerator-299"><a href="#PriceGenerator-299"><span class="linenos"> 299</span></a>            <span class="s2">&quot;closeFirst&quot;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>  <span class="c1"># first close price</span>
</span><span id="PriceGenerator-300"><a href="#PriceGenerator-300"><span class="linenos"> 300</span></a>            <span class="s2">&quot;closeLast&quot;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>  <span class="c1"># last close price</span>
</span><span id="PriceGenerator-301"><a href="#PriceGenerator-301"><span class="linenos"> 301</span></a>            <span class="s2">&quot;closeMax&quot;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>  <span class="c1"># max close price</span>
</span><span id="PriceGenerator-302"><a href="#PriceGenerator-302"><span class="linenos"> 302</span></a>            <span class="s2">&quot;closeMix&quot;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>  <span class="c1"># min close price</span>
</span><span id="PriceGenerator-303"><a href="#PriceGenerator-303"><span class="linenos"> 303</span></a>            <span class="s2">&quot;diapason&quot;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>  <span class="c1"># diapason = closeMax - closeMin</span>
</span><span id="PriceGenerator-304"><a href="#PriceGenerator-304"><span class="linenos"> 304</span></a>            <span class="s2">&quot;trend&quot;</span><span class="p">:</span> <span class="s2">&quot;NO trend&quot;</span><span class="p">,</span>  <span class="c1"># &quot;UP trend&quot; or &quot;DOWN trend&quot; with uses ±self.trendDeviation</span>
</span><span id="PriceGenerator-305"><a href="#PriceGenerator-305"><span class="linenos"> 305</span></a>            <span class="s2">&quot;trendDev&quot;</span><span class="p">:</span> <span class="mf">0.005</span><span class="p">,</span>
</span><span id="PriceGenerator-306"><a href="#PriceGenerator-306"><span class="linenos"> 306</span></a>            <span class="s2">&quot;upCount&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># count of up candles</span>
</span><span id="PriceGenerator-307"><a href="#PriceGenerator-307"><span class="linenos"> 307</span></a>            <span class="s2">&quot;downCount&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># count of down candles</span>
</span><span id="PriceGenerator-308"><a href="#PriceGenerator-308"><span class="linenos"> 308</span></a>            <span class="s2">&quot;upCountChainMax&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># max chain count of up candles</span>
</span><span id="PriceGenerator-309"><a href="#PriceGenerator-309"><span class="linenos"> 309</span></a>            <span class="s2">&quot;downCountChainMax&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># max chain count of down candles</span>
</span><span id="PriceGenerator-310"><a href="#PriceGenerator-310"><span class="linenos"> 310</span></a>            <span class="s2">&quot;deltas&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="PriceGenerator-311"><a href="#PriceGenerator-311"><span class="linenos"> 311</span></a>                <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>  <span class="c1"># delta max = max(close_prices)</span>
</span><span id="PriceGenerator-312"><a href="#PriceGenerator-312"><span class="linenos"> 312</span></a>                <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>  <span class="c1"># delta min = min(close_prices)</span>
</span><span id="PriceGenerator-313"><a href="#PriceGenerator-313"><span class="linenos"> 313</span></a>                <span class="s2">&quot;stDev&quot;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>  <span class="c1"># standard deviation</span>
</span><span id="PriceGenerator-314"><a href="#PriceGenerator-314"><span class="linenos"> 314</span></a>                <span class="s2">&quot;q99&quot;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>  <span class="c1"># 99 percentile</span>
</span><span id="PriceGenerator-315"><a href="#PriceGenerator-315"><span class="linenos"> 315</span></a>                <span class="s2">&quot;q95&quot;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>  <span class="c1"># 95 percentile</span>
</span><span id="PriceGenerator-316"><a href="#PriceGenerator-316"><span class="linenos"> 316</span></a>                <span class="s2">&quot;q80&quot;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>  <span class="c1"># 80 percentile</span>
</span><span id="PriceGenerator-317"><a href="#PriceGenerator-317"><span class="linenos"> 317</span></a>                <span class="s2">&quot;q50&quot;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>  <span class="c1"># 50 percentile</span>
</span><span id="PriceGenerator-318"><a href="#PriceGenerator-318"><span class="linenos"> 318</span></a>            <span class="p">},</span>
</span><span id="PriceGenerator-319"><a href="#PriceGenerator-319"><span class="linenos"> 319</span></a>            <span class="s2">&quot;cumSumVolumes&quot;</span><span class="p">:</span> <span class="mi">0</span>  <span class="c1"># cumulative sum of volumes</span>
</span><span id="PriceGenerator-320"><a href="#PriceGenerator-320"><span class="linenos"> 320</span></a>        <span class="p">}</span>
</span><span id="PriceGenerator-321"><a href="#PriceGenerator-321"><span class="linenos"> 321</span></a>        <span class="sd">&quot;&quot;&quot;Some statistics available after candles loaded or generated.&quot;&quot;&quot;</span>
</span><span id="PriceGenerator-322"><a href="#PriceGenerator-322"><span class="linenos"> 322</span></a>
</span><span id="PriceGenerator-323"><a href="#PriceGenerator-323"><span class="linenos"> 323</span></a>    <span class="nd">@property</span>
</span><span id="PriceGenerator-324"><a href="#PriceGenerator-324"><span class="linenos"> 324</span></a>    <span class="k">def</span> <span class="nf">upCandlesProb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="PriceGenerator-325"><a href="#PriceGenerator-325"><span class="linenos"> 325</span></a>        <span class="sd">&quot;&quot;&quot;Probability that next candle is up. Default: `0.5` (means 50% of probability).&quot;&quot;&quot;</span>
</span><span id="PriceGenerator-326"><a href="#PriceGenerator-326"><span class="linenos"> 326</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upCandlesProb</span>
</span><span id="PriceGenerator-327"><a href="#PriceGenerator-327"><span class="linenos"> 327</span></a>
</span><span id="PriceGenerator-328"><a href="#PriceGenerator-328"><span class="linenos"> 328</span></a>    <span class="nd">@upCandlesProb</span><span class="o">.</span><span class="n">setter</span>
</span><span id="PriceGenerator-329"><a href="#PriceGenerator-329"><span class="linenos"> 329</span></a>    <span class="k">def</span> <span class="nf">upCandlesProb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="PriceGenerator-330"><a href="#PriceGenerator-330"><span class="linenos"> 330</span></a>        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="PriceGenerator-331"><a href="#PriceGenerator-331"><span class="linenos"> 331</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_upCandlesProb</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="PriceGenerator-332"><a href="#PriceGenerator-332"><span class="linenos"> 332</span></a>
</span><span id="PriceGenerator-333"><a href="#PriceGenerator-333"><span class="linenos"> 333</span></a>        <span class="k">elif</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="PriceGenerator-334"><a href="#PriceGenerator-334"><span class="linenos"> 334</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_upCandlesProb</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="PriceGenerator-335"><a href="#PriceGenerator-335"><span class="linenos"> 335</span></a>
</span><span id="PriceGenerator-336"><a href="#PriceGenerator-336"><span class="linenos"> 336</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PriceGenerator-337"><a href="#PriceGenerator-337"><span class="linenos"> 337</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_upCandlesProb</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="PriceGenerator-338"><a href="#PriceGenerator-338"><span class="linenos"> 338</span></a>
</span><span id="PriceGenerator-339"><a href="#PriceGenerator-339"><span class="linenos"> 339</span></a>    <span class="nd">@property</span>
</span><span id="PriceGenerator-340"><a href="#PriceGenerator-340"><span class="linenos"> 340</span></a>    <span class="k">def</span> <span class="nf">outliersProb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="PriceGenerator-341"><a href="#PriceGenerator-341"><span class="linenos"> 341</span></a>        <span class="sd">&quot;&quot;&quot;Outlier probability (price tails). Default: `0.03` (means 3% of probability).&quot;&quot;&quot;</span>
</span><span id="PriceGenerator-342"><a href="#PriceGenerator-342"><span class="linenos"> 342</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outliersProb</span>
</span><span id="PriceGenerator-343"><a href="#PriceGenerator-343"><span class="linenos"> 343</span></a>
</span><span id="PriceGenerator-344"><a href="#PriceGenerator-344"><span class="linenos"> 344</span></a>    <span class="nd">@outliersProb</span><span class="o">.</span><span class="n">setter</span>
</span><span id="PriceGenerator-345"><a href="#PriceGenerator-345"><span class="linenos"> 345</span></a>    <span class="k">def</span> <span class="nf">outliersProb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="PriceGenerator-346"><a href="#PriceGenerator-346"><span class="linenos"> 346</span></a>        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="PriceGenerator-347"><a href="#PriceGenerator-347"><span class="linenos"> 347</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_outliersProb</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="PriceGenerator-348"><a href="#PriceGenerator-348"><span class="linenos"> 348</span></a>
</span><span id="PriceGenerator-349"><a href="#PriceGenerator-349"><span class="linenos"> 349</span></a>        <span class="k">elif</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="PriceGenerator-350"><a href="#PriceGenerator-350"><span class="linenos"> 350</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_outliersProb</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="PriceGenerator-351"><a href="#PriceGenerator-351"><span class="linenos"> 351</span></a>
</span><span id="PriceGenerator-352"><a href="#PriceGenerator-352"><span class="linenos"> 352</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PriceGenerator-353"><a href="#PriceGenerator-353"><span class="linenos"> 353</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_outliersProb</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="PriceGenerator-354"><a href="#PriceGenerator-354"><span class="linenos"> 354</span></a>
</span><span id="PriceGenerator-355"><a href="#PriceGenerator-355"><span class="linenos"> 355</span></a>    <span class="nd">@property</span>
</span><span id="PriceGenerator-356"><a href="#PriceGenerator-356"><span class="linenos"> 356</span></a>    <span class="k">def</span> <span class="nf">trendDeviation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="PriceGenerator-357"><a href="#PriceGenerator-357"><span class="linenos"> 357</span></a>        <span class="sd">&quot;&quot;&quot;Relative deviation for trend detection. &quot;NO trend&quot; if `(1st_close - last_close) / 1st_close &lt;= self.trendDeviation`. Default: `0.005` (means ±0.5% of price deviation).&quot;&quot;&quot;</span>
</span><span id="PriceGenerator-358"><a href="#PriceGenerator-358"><span class="linenos"> 358</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trendDeviation</span>
</span><span id="PriceGenerator-359"><a href="#PriceGenerator-359"><span class="linenos"> 359</span></a>
</span><span id="PriceGenerator-360"><a href="#PriceGenerator-360"><span class="linenos"> 360</span></a>    <span class="nd">@trendDeviation</span><span class="o">.</span><span class="n">setter</span>
</span><span id="PriceGenerator-361"><a href="#PriceGenerator-361"><span class="linenos"> 361</span></a>    <span class="k">def</span> <span class="nf">trendDeviation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="PriceGenerator-362"><a href="#PriceGenerator-362"><span class="linenos"> 362</span></a>        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="PriceGenerator-363"><a href="#PriceGenerator-363"><span class="linenos"> 363</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_trendDeviation</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="PriceGenerator-364"><a href="#PriceGenerator-364"><span class="linenos"> 364</span></a>
</span><span id="PriceGenerator-365"><a href="#PriceGenerator-365"><span class="linenos"> 365</span></a>        <span class="k">elif</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="PriceGenerator-366"><a href="#PriceGenerator-366"><span class="linenos"> 366</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_trendDeviation</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="PriceGenerator-367"><a href="#PriceGenerator-367"><span class="linenos"> 367</span></a>
</span><span id="PriceGenerator-368"><a href="#PriceGenerator-368"><span class="linenos"> 368</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PriceGenerator-369"><a href="#PriceGenerator-369"><span class="linenos"> 369</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_trendDeviation</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="PriceGenerator-370"><a href="#PriceGenerator-370"><span class="linenos"> 370</span></a>
</span><span id="PriceGenerator-371"><a href="#PriceGenerator-371"><span class="linenos"> 371</span></a>    <span class="nd">@property</span>
</span><span id="PriceGenerator-372"><a href="#PriceGenerator-372"><span class="linenos"> 372</span></a>    <span class="k">def</span> <span class="nf">maxVolume</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="PriceGenerator-373"><a href="#PriceGenerator-373"><span class="linenos"> 373</span></a>        <span class="sd">&quot;&quot;&quot;Maximum of generated trade volumes. Default: random in interval `(0, 100000)`.&quot;&quot;&quot;</span>
</span><span id="PriceGenerator-374"><a href="#PriceGenerator-374"><span class="linenos"> 374</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maxVolume</span>
</span><span id="PriceGenerator-375"><a href="#PriceGenerator-375"><span class="linenos"> 375</span></a>
</span><span id="PriceGenerator-376"><a href="#PriceGenerator-376"><span class="linenos"> 376</span></a>    <span class="nd">@maxVolume</span><span class="o">.</span><span class="n">setter</span>
</span><span id="PriceGenerator-377"><a href="#PriceGenerator-377"><span class="linenos"> 377</span></a>    <span class="k">def</span> <span class="nf">maxVolume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="PriceGenerator-378"><a href="#PriceGenerator-378"><span class="linenos"> 378</span></a>        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="PriceGenerator-379"><a href="#PriceGenerator-379"><span class="linenos"> 379</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_maxVolume</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="PriceGenerator-380"><a href="#PriceGenerator-380"><span class="linenos"> 380</span></a>
</span><span id="PriceGenerator-381"><a href="#PriceGenerator-381"><span class="linenos"> 381</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PriceGenerator-382"><a href="#PriceGenerator-382"><span class="linenos"> 382</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_maxVolume</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="PriceGenerator-383"><a href="#PriceGenerator-383"><span class="linenos"> 383</span></a>
</span><span id="PriceGenerator-384"><a href="#PriceGenerator-384"><span class="linenos"> 384</span></a>    <span class="nd">@property</span>
</span><span id="PriceGenerator-385"><a href="#PriceGenerator-385"><span class="linenos"> 385</span></a>    <span class="k">def</span> <span class="nf">stat</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="PriceGenerator-386"><a href="#PriceGenerator-386"><span class="linenos"> 386</span></a>        <span class="sd">&quot;&quot;&quot;Some statistics available after candles loaded or generated.&quot;&quot;&quot;</span>
</span><span id="PriceGenerator-387"><a href="#PriceGenerator-387"><span class="linenos"> 387</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span>
</span><span id="PriceGenerator-388"><a href="#PriceGenerator-388"><span class="linenos"> 388</span></a>
</span><span id="PriceGenerator-389"><a href="#PriceGenerator-389"><span class="linenos"> 389</span></a>    <span class="nd">@property</span>
</span><span id="PriceGenerator-390"><a href="#PriceGenerator-390"><span class="linenos"> 390</span></a>    <span class="k">def</span> <span class="nf">precision</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="PriceGenerator-391"><a href="#PriceGenerator-391"><span class="linenos"> 391</span></a>        <span class="sd">&quot;&quot;&quot;Signs after comma.&quot;&quot;&quot;</span>
</span><span id="PriceGenerator-392"><a href="#PriceGenerator-392"><span class="linenos"> 392</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precision</span>
</span><span id="PriceGenerator-393"><a href="#PriceGenerator-393"><span class="linenos"> 393</span></a>
</span><span id="PriceGenerator-394"><a href="#PriceGenerator-394"><span class="linenos"> 394</span></a>    <span class="nd">@precision</span><span class="o">.</span><span class="n">setter</span>
</span><span id="PriceGenerator-395"><a href="#PriceGenerator-395"><span class="linenos"> 395</span></a>    <span class="k">def</span> <span class="nf">precision</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="PriceGenerator-396"><a href="#PriceGenerator-396"><span class="linenos"> 396</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_precision</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># default</span>
</span><span id="PriceGenerator-397"><a href="#PriceGenerator-397"><span class="linenos"> 397</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_deg10prec</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># default</span>
</span><span id="PriceGenerator-398"><a href="#PriceGenerator-398"><span class="linenos"> 398</span></a>
</span><span id="PriceGenerator-399"><a href="#PriceGenerator-399"><span class="linenos"> 399</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="PriceGenerator-400"><a href="#PriceGenerator-400"><span class="linenos"> 400</span></a>            <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="PriceGenerator-401"><a href="#PriceGenerator-401"><span class="linenos"> 401</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_precision</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="PriceGenerator-402"><a href="#PriceGenerator-402"><span class="linenos"> 402</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_deg10prec</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">value</span>  <span class="c1"># 10^precision</span>
</span><span id="PriceGenerator-403"><a href="#PriceGenerator-403"><span class="linenos"> 403</span></a>
</span><span id="PriceGenerator-404"><a href="#PriceGenerator-404"><span class="linenos"> 404</span></a>    <span class="nd">@property</span>
</span><span id="PriceGenerator-405"><a href="#PriceGenerator-405"><span class="linenos"> 405</span></a>    <span class="k">def</span> <span class="nf">zigZagDeviation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="PriceGenerator-406"><a href="#PriceGenerator-406"><span class="linenos"> 406</span></a>        <span class="sd">&quot;&quot;&quot;Relative deviation to detection next points used by Zig-Zag indicator. Default: 0.03 (means 3% of price deviation).&quot;&quot;&quot;</span>
</span><span id="PriceGenerator-407"><a href="#PriceGenerator-407"><span class="linenos"> 407</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zigZagDeviation</span>
</span><span id="PriceGenerator-408"><a href="#PriceGenerator-408"><span class="linenos"> 408</span></a>
</span><span id="PriceGenerator-409"><a href="#PriceGenerator-409"><span class="linenos"> 409</span></a>    <span class="nd">@zigZagDeviation</span><span class="o">.</span><span class="n">setter</span>
</span><span id="PriceGenerator-410"><a href="#PriceGenerator-410"><span class="linenos"> 410</span></a>    <span class="k">def</span> <span class="nf">zigZagDeviation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="PriceGenerator-411"><a href="#PriceGenerator-411"><span class="linenos"> 411</span></a>        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="PriceGenerator-412"><a href="#PriceGenerator-412"><span class="linenos"> 412</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_zigZagDeviation</span> <span class="o">=</span> <span class="mf">0.03</span>  <span class="c1"># by default</span>
</span><span id="PriceGenerator-413"><a href="#PriceGenerator-413"><span class="linenos"> 413</span></a>
</span><span id="PriceGenerator-414"><a href="#PriceGenerator-414"><span class="linenos"> 414</span></a>        <span class="k">elif</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="PriceGenerator-415"><a href="#PriceGenerator-415"><span class="linenos"> 415</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_zigZagDeviation</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="PriceGenerator-416"><a href="#PriceGenerator-416"><span class="linenos"> 416</span></a>
</span><span id="PriceGenerator-417"><a href="#PriceGenerator-417"><span class="linenos"> 417</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PriceGenerator-418"><a href="#PriceGenerator-418"><span class="linenos"> 418</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_zigZagDeviation</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="PriceGenerator-419"><a href="#PriceGenerator-419"><span class="linenos"> 419</span></a>
</span><span id="PriceGenerator-420"><a href="#PriceGenerator-420"><span class="linenos"> 420</span></a>    <span class="nd">@staticmethod</span>
</span><span id="PriceGenerator-421"><a href="#PriceGenerator-421"><span class="linenos"> 421</span></a>    <span class="k">def</span> <span class="nf">FormattedDelta</span><span class="p">(</span><span class="n">tDelta</span><span class="p">:</span> <span class="n">timedelta</span><span class="p">,</span> <span class="n">fmt</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="PriceGenerator-422"><a href="#PriceGenerator-422"><span class="linenos"> 422</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="PriceGenerator-423"><a href="#PriceGenerator-423"><span class="linenos"> 423</span></a><span class="sd">        Pretty format for timedelta objects.</span>
</span><span id="PriceGenerator-424"><a href="#PriceGenerator-424"><span class="linenos"> 424</span></a>
</span><span id="PriceGenerator-425"><a href="#PriceGenerator-425"><span class="linenos"> 425</span></a><span class="sd">        Example: `FormattedDelta(timedelta(days=2, hours=3, minutes=15, seconds=35), &quot;{days} days {hours}:{minutes}:{seconds}&quot;) -&gt; &quot;2 days 3:15:35&quot;`.</span>
</span><span id="PriceGenerator-426"><a href="#PriceGenerator-426"><span class="linenos"> 426</span></a>
</span><span id="PriceGenerator-427"><a href="#PriceGenerator-427"><span class="linenos"> 427</span></a><span class="sd">        :return: timedelta object formatted as a string.</span>
</span><span id="PriceGenerator-428"><a href="#PriceGenerator-428"><span class="linenos"> 428</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PriceGenerator-429"><a href="#PriceGenerator-429"><span class="linenos"> 429</span></a>        <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;days&quot;</span><span class="p">:</span> <span class="n">tDelta</span><span class="o">.</span><span class="n">days</span><span class="p">}</span>
</span><span id="PriceGenerator-430"><a href="#PriceGenerator-430"><span class="linenos"> 430</span></a>        <span class="n">d</span><span class="p">[</span><span class="s2">&quot;hours&quot;</span><span class="p">],</span> <span class="n">rem</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">tDelta</span><span class="o">.</span><span class="n">seconds</span><span class="p">,</span> <span class="mi">3600</span><span class="p">)</span>
</span><span id="PriceGenerator-431"><a href="#PriceGenerator-431"><span class="linenos"> 431</span></a>        <span class="n">d</span><span class="p">[</span><span class="s2">&quot;minutes&quot;</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;seconds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">rem</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
</span><span id="PriceGenerator-432"><a href="#PriceGenerator-432"><span class="linenos"> 432</span></a>
</span><span id="PriceGenerator-433"><a href="#PriceGenerator-433"><span class="linenos"> 433</span></a>        <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">)</span>
</span><span id="PriceGenerator-434"><a href="#PriceGenerator-434"><span class="linenos"> 434</span></a>
</span><span id="PriceGenerator-435"><a href="#PriceGenerator-435"><span class="linenos"> 435</span></a>    <span class="k">def</span> <span class="nf">DetectPrecision</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">examples</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="nb">list</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="PriceGenerator-436"><a href="#PriceGenerator-436"><span class="linenos"> 436</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="PriceGenerator-437"><a href="#PriceGenerator-437"><span class="linenos"> 437</span></a><span class="sd">        Auto-detect precision from example values. E.g. `0.123 -&gt; 3`, `0.12345 -&gt; 5` and so on.</span>
</span><span id="PriceGenerator-438"><a href="#PriceGenerator-438"><span class="linenos"> 438</span></a><span class="sd">        This method change `precision` variable after detect precision.</span>
</span><span id="PriceGenerator-439"><a href="#PriceGenerator-439"><span class="linenos"> 439</span></a>
</span><span id="PriceGenerator-440"><a href="#PriceGenerator-440"><span class="linenos"> 440</span></a><span class="sd">        See also about statistics.mode: https://docs.python.org/3.9/library/statistics.html#statistics.mode</span>
</span><span id="PriceGenerator-441"><a href="#PriceGenerator-441"><span class="linenos"> 441</span></a><span class="sd">        Changed in Python version &gt;= 3.8: Now mode() method handles multimodal datasets by returning the first mode encountered.</span>
</span><span id="PriceGenerator-442"><a href="#PriceGenerator-442"><span class="linenos"> 442</span></a><span class="sd">        Previously, it raised StatisticsError when more than one mode was found.</span>
</span><span id="PriceGenerator-443"><a href="#PriceGenerator-443"><span class="linenos"> 443</span></a>
</span><span id="PriceGenerator-444"><a href="#PriceGenerator-444"><span class="linenos"> 444</span></a><span class="sd">        :param examples: chain with examples of float values.</span>
</span><span id="PriceGenerator-445"><a href="#PriceGenerator-445"><span class="linenos"> 445</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PriceGenerator-446"><a href="#PriceGenerator-446"><span class="linenos"> 446</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Detecting precision of data values...&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator-447"><a href="#PriceGenerator-447"><span class="linenos"> 447</span></a>        <span class="n">precision</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="PriceGenerator-448"><a href="#PriceGenerator-448"><span class="linenos"> 448</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="PriceGenerator-449"><a href="#PriceGenerator-449"><span class="linenos"> 449</span></a>            <span class="n">precision</span> <span class="o">=</span> <span class="n">mode</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">examples</span><span class="p">)))</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="PriceGenerator-450"><a href="#PriceGenerator-450"><span class="linenos"> 450</span></a>
</span><span id="PriceGenerator-451"><a href="#PriceGenerator-451"><span class="linenos"> 451</span></a>        <span class="k">except</span> <span class="n">StatisticsError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="PriceGenerator-452"><a href="#PriceGenerator-452"><span class="linenos"> 452</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Statistic mode() method return an error! Precision is set to 2 (default). StatisticsError: &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="PriceGenerator-453"><a href="#PriceGenerator-453"><span class="linenos"> 453</span></a>            <span class="n">precision</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="PriceGenerator-454"><a href="#PriceGenerator-454"><span class="linenos"> 454</span></a>
</span><span id="PriceGenerator-455"><a href="#PriceGenerator-455"><span class="linenos"> 455</span></a>        <span class="k">finally</span><span class="p">:</span>
</span><span id="PriceGenerator-456"><a href="#PriceGenerator-456"><span class="linenos"> 456</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Auto-detected precision: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">precision</span><span class="p">))</span>
</span><span id="PriceGenerator-457"><a href="#PriceGenerator-457"><span class="linenos"> 457</span></a>
</span><span id="PriceGenerator-458"><a href="#PriceGenerator-458"><span class="linenos"> 458</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">precision</span> <span class="o">=</span> <span class="n">precision</span>
</span><span id="PriceGenerator-459"><a href="#PriceGenerator-459"><span class="linenos"> 459</span></a>
</span><span id="PriceGenerator-460"><a href="#PriceGenerator-460"><span class="linenos"> 460</span></a>        <span class="k">return</span> <span class="n">precision</span>
</span><span id="PriceGenerator-461"><a href="#PriceGenerator-461"><span class="linenos"> 461</span></a>
</span><span id="PriceGenerator-462"><a href="#PriceGenerator-462"><span class="linenos"> 462</span></a>    <span class="k">def</span> <span class="nf">DetectTimeframe</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">timedelta</span><span class="p">:</span>
</span><span id="PriceGenerator-463"><a href="#PriceGenerator-463"><span class="linenos"> 463</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="PriceGenerator-464"><a href="#PriceGenerator-464"><span class="linenos"> 464</span></a><span class="sd">        Auto-detect time delta between last two neighbour candles.</span>
</span><span id="PriceGenerator-465"><a href="#PriceGenerator-465"><span class="linenos"> 465</span></a>
</span><span id="PriceGenerator-466"><a href="#PriceGenerator-466"><span class="linenos"> 466</span></a><span class="sd">        :return: timedelta object, also saved to `timeframe`.</span>
</span><span id="PriceGenerator-467"><a href="#PriceGenerator-467"><span class="linenos"> 467</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PriceGenerator-468"><a href="#PriceGenerator-468"><span class="linenos"> 468</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
</span><span id="PriceGenerator-469"><a href="#PriceGenerator-469"><span class="linenos"> 469</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">datetime</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
</span><span id="PriceGenerator-470"><a href="#PriceGenerator-470"><span class="linenos"> 470</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">datetime</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">datetime</span>
</span><span id="PriceGenerator-471"><a href="#PriceGenerator-471"><span class="linenos"> 471</span></a>        <span class="p">)</span>
</span><span id="PriceGenerator-472"><a href="#PriceGenerator-472"><span class="linenos"> 472</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Auto-detected timeframe: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span><span class="p">))</span>
</span><span id="PriceGenerator-473"><a href="#PriceGenerator-473"><span class="linenos"> 473</span></a>
</span><span id="PriceGenerator-474"><a href="#PriceGenerator-474"><span class="linenos"> 474</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span>
</span><span id="PriceGenerator-475"><a href="#PriceGenerator-475"><span class="linenos"> 475</span></a>
</span><span id="PriceGenerator-476"><a href="#PriceGenerator-476"><span class="linenos"> 476</span></a>    <span class="k">def</span> <span class="nf">LoadFromFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="PriceGenerator-477"><a href="#PriceGenerator-477"><span class="linenos"> 477</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="PriceGenerator-478"><a href="#PriceGenerator-478"><span class="linenos"> 478</span></a><span class="sd">        Create Pandas OHLCV-model from CSV-file.</span>
</span><span id="PriceGenerator-479"><a href="#PriceGenerator-479"><span class="linenos"> 479</span></a><span class="sd">        Default columns in CSV-file are `[&quot;date&quot;, &quot;time&quot;, &quot;open&quot;, &quot;high&quot;, &quot;low&quot;, &quot;close&quot;, &quot;volume&quot;]`.</span>
</span><span id="PriceGenerator-480"><a href="#PriceGenerator-480"><span class="linenos"> 480</span></a>
</span><span id="PriceGenerator-481"><a href="#PriceGenerator-481"><span class="linenos"> 481</span></a><span class="sd">        :param fileName: path to CSV-file with OHLCV columns.</span>
</span><span id="PriceGenerator-482"><a href="#PriceGenerator-482"><span class="linenos"> 482</span></a><span class="sd">        :return: Pandas DataFrame.</span>
</span><span id="PriceGenerator-483"><a href="#PriceGenerator-483"><span class="linenos"> 483</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PriceGenerator-484"><a href="#PriceGenerator-484"><span class="linenos"> 484</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Loading, parse and preparing input data from [</span><span class="si">{}</span><span class="s2">]...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">fileName</span><span class="p">)))</span>
</span><span id="PriceGenerator-485"><a href="#PriceGenerator-485"><span class="linenos"> 485</span></a>
</span><span id="PriceGenerator-486"><a href="#PriceGenerator-486"><span class="linenos"> 486</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">csvHeaders</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;python&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;datetime&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">]})</span>
</span><span id="PriceGenerator-487"><a href="#PriceGenerator-487"><span class="linenos"> 487</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">):</span>
</span><span id="PriceGenerator-488"><a href="#PriceGenerator-488"><span class="linenos"> 488</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">)</span>  <span class="c1"># use loaded file &quot;as is&quot; with all candles</span>
</span><span id="PriceGenerator-489"><a href="#PriceGenerator-489"><span class="linenos"> 489</span></a>
</span><span id="PriceGenerator-490"><a href="#PriceGenerator-490"><span class="linenos"> 490</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PriceGenerator-491"><a href="#PriceGenerator-491"><span class="linenos"> 491</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">prices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">horizon</span><span class="p">)</span>  <span class="c1"># remove old candles, leave only the &quot;tail&quot; ...</span>
</span><span id="PriceGenerator-492"><a href="#PriceGenerator-492"><span class="linenos"> 492</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">horizon</span><span class="p">)</span>  <span class="c1"># ... and reindex</span>
</span><span id="PriceGenerator-493"><a href="#PriceGenerator-493"><span class="linenos"> 493</span></a>
</span><span id="PriceGenerator-494"><a href="#PriceGenerator-494"><span class="linenos"> 494</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ticker</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>
</span><span id="PriceGenerator-495"><a href="#PriceGenerator-495"><span class="linenos"> 495</span></a>
</span><span id="PriceGenerator-496"><a href="#PriceGenerator-496"><span class="linenos"> 496</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">DetectTimeframe</span><span class="p">()</span>  <span class="c1"># auto-detect time delta between last two neighbour candles</span>
</span><span id="PriceGenerator-497"><a href="#PriceGenerator-497"><span class="linenos"> 497</span></a>
</span><span id="PriceGenerator-498"><a href="#PriceGenerator-498"><span class="linenos"> 498</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;It was read </span><span class="si">{}</span><span class="s2"> rows&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">horizon</span><span class="p">))</span>
</span><span id="PriceGenerator-499"><a href="#PriceGenerator-499"><span class="linenos"> 499</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Showing last 5 rows as Pandas DataFrame:&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator-500"><a href="#PriceGenerator-500"><span class="linenos"> 500</span></a>        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dfHeaders</span><span class="p">][</span><span class="o">-</span><span class="mi">5</span><span class="p">:],</span> <span class="n">max_cols</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
</span><span id="PriceGenerator-501"><a href="#PriceGenerator-501"><span class="linenos"> 501</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span><span id="PriceGenerator-502"><a href="#PriceGenerator-502"><span class="linenos"> 502</span></a>
</span><span id="PriceGenerator-503"><a href="#PriceGenerator-503"><span class="linenos"> 503</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span>
</span><span id="PriceGenerator-504"><a href="#PriceGenerator-504"><span class="linenos"> 504</span></a>
</span><span id="PriceGenerator-505"><a href="#PriceGenerator-505"><span class="linenos"> 505</span></a>    <span class="k">def</span> <span class="nf">SaveToFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PriceGenerator-506"><a href="#PriceGenerator-506"><span class="linenos"> 506</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="PriceGenerator-507"><a href="#PriceGenerator-507"><span class="linenos"> 507</span></a><span class="sd">        Save Pandas OHLCV model to CSV-file.</span>
</span><span id="PriceGenerator-508"><a href="#PriceGenerator-508"><span class="linenos"> 508</span></a>
</span><span id="PriceGenerator-509"><a href="#PriceGenerator-509"><span class="linenos"> 509</span></a><span class="sd">        :param fileName: path to CSV-file.</span>
</span><span id="PriceGenerator-510"><a href="#PriceGenerator-510"><span class="linenos"> 510</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PriceGenerator-511"><a href="#PriceGenerator-511"><span class="linenos"> 511</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="PriceGenerator-512"><a href="#PriceGenerator-512"><span class="linenos"> 512</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Saving [</span><span class="si">{}</span><span class="s2">] rows of Pandas DataFrame with columns: </span><span class="si">{}</span><span class="s2">...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">csvHeaders</span><span class="p">))</span>
</span><span id="PriceGenerator-513"><a href="#PriceGenerator-513"><span class="linenos"> 513</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Delimeter: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sep</span><span class="p">))</span>
</span><span id="PriceGenerator-514"><a href="#PriceGenerator-514"><span class="linenos"> 514</span></a>            <span class="n">dataReplacedDateTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="PriceGenerator-515"><a href="#PriceGenerator-515"><span class="linenos"> 515</span></a>            <span class="n">dataReplacedDateTime</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">date</span><span class="p">()</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dataReplacedDateTime</span><span class="p">[</span><span class="s2">&quot;datetime&quot;</span><span class="p">]]</span>
</span><span id="PriceGenerator-516"><a href="#PriceGenerator-516"><span class="linenos"> 516</span></a>            <span class="n">dataReplacedDateTime</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dataReplacedDateTime</span><span class="p">[</span><span class="s2">&quot;datetime&quot;</span><span class="p">]]</span>
</span><span id="PriceGenerator-517"><a href="#PriceGenerator-517"><span class="linenos"> 517</span></a>            <span class="k">del</span> <span class="n">dataReplacedDateTime</span><span class="p">[</span><span class="s2">&quot;datetime&quot;</span><span class="p">]</span>
</span><span id="PriceGenerator-518"><a href="#PriceGenerator-518"><span class="linenos"> 518</span></a>            <span class="n">dataReplacedDateTime</span> <span class="o">=</span> <span class="n">dataReplacedDateTime</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">csvHeaders</span><span class="p">]</span>
</span><span id="PriceGenerator-519"><a href="#PriceGenerator-519"><span class="linenos"> 519</span></a>            <span class="n">dataReplacedDateTime</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="PriceGenerator-520"><a href="#PriceGenerator-520"><span class="linenos"> 520</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Pandas DataFrame saved to .CSV-file [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">fileName</span><span class="p">)))</span>
</span><span id="PriceGenerator-521"><a href="#PriceGenerator-521"><span class="linenos"> 521</span></a>
</span><span id="PriceGenerator-522"><a href="#PriceGenerator-522"><span class="linenos"> 522</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PriceGenerator-523"><a href="#PriceGenerator-523"><span class="linenos"> 523</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Empty price data! Generate or load prices before saving!&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator-524"><a href="#PriceGenerator-524"><span class="linenos"> 524</span></a>
</span><span id="PriceGenerator-525"><a href="#PriceGenerator-525"><span class="linenos"> 525</span></a>    <span class="nd">@staticmethod</span>
</span><span id="PriceGenerator-526"><a href="#PriceGenerator-526"><span class="linenos"> 526</span></a>    <span class="k">def</span> <span class="nf">GetTrend</span><span class="p">(</span><span class="n">firstClose</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">lastClose</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">trendDeviation</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.005</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="PriceGenerator-527"><a href="#PriceGenerator-527"><span class="linenos"> 527</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="PriceGenerator-528"><a href="#PriceGenerator-528"><span class="linenos"> 528</span></a><span class="sd">        Get string with trend: `&quot;UP trend&quot;`, `&quot;DOWN trend&quot;` or `&quot;NO trend&quot;`.</span>
</span><span id="PriceGenerator-529"><a href="#PriceGenerator-529"><span class="linenos"> 529</span></a>
</span><span id="PriceGenerator-530"><a href="#PriceGenerator-530"><span class="linenos"> 530</span></a><span class="sd">        :param firstClose: close of first candle.</span>
</span><span id="PriceGenerator-531"><a href="#PriceGenerator-531"><span class="linenos"> 531</span></a><span class="sd">        :param lastClose: close of last candle.</span>
</span><span id="PriceGenerator-532"><a href="#PriceGenerator-532"><span class="linenos"> 532</span></a><span class="sd">        :param trendDeviation: relative deviation for trend detection, 0.005 mean ±0.5% by default.</span>
</span><span id="PriceGenerator-533"><a href="#PriceGenerator-533"><span class="linenos"> 533</span></a><span class="sd">        :return: string with trend direction `&quot;NO trend&quot;`, `&quot;UP trend&quot;` or `&quot;DOWN trend&quot;`.</span>
</span><span id="PriceGenerator-534"><a href="#PriceGenerator-534"><span class="linenos"> 534</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PriceGenerator-535"><a href="#PriceGenerator-535"><span class="linenos"> 535</span></a>        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">firstClose</span> <span class="o">-</span> <span class="n">lastClose</span><span class="p">)</span> <span class="o">/</span> <span class="n">firstClose</span> <span class="o">&lt;=</span> <span class="n">trendDeviation</span><span class="p">:</span>
</span><span id="PriceGenerator-536"><a href="#PriceGenerator-536"><span class="linenos"> 536</span></a>            <span class="n">trend</span> <span class="o">=</span> <span class="s2">&quot;NO trend&quot;</span>
</span><span id="PriceGenerator-537"><a href="#PriceGenerator-537"><span class="linenos"> 537</span></a>
</span><span id="PriceGenerator-538"><a href="#PriceGenerator-538"><span class="linenos"> 538</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PriceGenerator-539"><a href="#PriceGenerator-539"><span class="linenos"> 539</span></a>            <span class="n">trend</span> <span class="o">=</span> <span class="s2">&quot;UP trend&quot;</span> <span class="k">if</span> <span class="n">firstClose</span> <span class="o">&lt;=</span> <span class="n">lastClose</span> <span class="k">else</span> <span class="s2">&quot;DOWN trend&quot;</span>
</span><span id="PriceGenerator-540"><a href="#PriceGenerator-540"><span class="linenos"> 540</span></a>
</span><span id="PriceGenerator-541"><a href="#PriceGenerator-541"><span class="linenos"> 541</span></a>        <span class="k">return</span> <span class="n">trend</span>
</span><span id="PriceGenerator-542"><a href="#PriceGenerator-542"><span class="linenos"> 542</span></a>
</span><span id="PriceGenerator-543"><a href="#PriceGenerator-543"><span class="linenos"> 543</span></a>    <span class="nd">@staticmethod</span>
</span><span id="PriceGenerator-544"><a href="#PriceGenerator-544"><span class="linenos"> 544</span></a>    <span class="k">def</span> <span class="nf">ZigZagFilter</span><span class="p">(</span><span class="n">datetimes</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="nb">list</span><span class="p">],</span> <span class="n">deviation</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="PriceGenerator-545"><a href="#PriceGenerator-545"><span class="linenos"> 545</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="PriceGenerator-546"><a href="#PriceGenerator-546"><span class="linenos"> 546</span></a><span class="sd">        This method filter input data as Zig-Zag indicator: when input value of candlestick price (e.g. close price)</span>
</span><span id="PriceGenerator-547"><a href="#PriceGenerator-547"><span class="linenos"> 547</span></a><span class="sd">        is difference with next values with define percent then this point is a point of Zig-Zag indicator.</span>
</span><span id="PriceGenerator-548"><a href="#PriceGenerator-548"><span class="linenos"> 548</span></a>
</span><span id="PriceGenerator-549"><a href="#PriceGenerator-549"><span class="linenos"> 549</span></a><span class="sd">        :param datetimes: input Pandas Series with datetime values.</span>
</span><span id="PriceGenerator-550"><a href="#PriceGenerator-550"><span class="linenos"> 550</span></a><span class="sd">        :param values: input Pandas Series or list, e.g. list of closes values of candlesticks.</span>
</span><span id="PriceGenerator-551"><a href="#PriceGenerator-551"><span class="linenos"> 551</span></a><span class="sd">        :param deviation: float number in `[0, 1]` interval is a relative difference between `i` and `i + 1` values to set as Zig-Zag point.</span>
</span><span id="PriceGenerator-552"><a href="#PriceGenerator-552"><span class="linenos"> 552</span></a><span class="sd">        :return: dict with Pandas Series filtered data `{&quot;datetimes&quot;: filtered_datetimes, &quot;filtered&quot;: filtered_values}`.</span>
</span><span id="PriceGenerator-553"><a href="#PriceGenerator-553"><span class="linenos"> 553</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PriceGenerator-554"><a href="#PriceGenerator-554"><span class="linenos"> 554</span></a>        <span class="n">filteredPoints</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span>
</span><span id="PriceGenerator-555"><a href="#PriceGenerator-555"><span class="linenos"> 555</span></a>        <span class="n">prev</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="PriceGenerator-556"><a href="#PriceGenerator-556"><span class="linenos"> 556</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)):</span>
</span><span id="PriceGenerator-557"><a href="#PriceGenerator-557"><span class="linenos"> 557</span></a>            <span class="n">difference</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">prev</span><span class="p">)</span> <span class="o">/</span> <span class="n">prev</span>
</span><span id="PriceGenerator-558"><a href="#PriceGenerator-558"><span class="linenos"> 558</span></a>            <span class="k">if</span> <span class="n">difference</span> <span class="o">&gt;=</span> <span class="n">deviation</span><span class="p">:</span>
</span><span id="PriceGenerator-559"><a href="#PriceGenerator-559"><span class="linenos"> 559</span></a>                <span class="n">filteredPoints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span><span id="PriceGenerator-560"><a href="#PriceGenerator-560"><span class="linenos"> 560</span></a>                <span class="n">prev</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="PriceGenerator-561"><a href="#PriceGenerator-561"><span class="linenos"> 561</span></a>
</span><span id="PriceGenerator-562"><a href="#PriceGenerator-562"><span class="linenos"> 562</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PriceGenerator-563"><a href="#PriceGenerator-563"><span class="linenos"> 563</span></a>                <span class="n">filteredPoints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</span><span id="PriceGenerator-564"><a href="#PriceGenerator-564"><span class="linenos"> 564</span></a>
</span><span id="PriceGenerator-565"><a href="#PriceGenerator-565"><span class="linenos"> 565</span></a>        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;datetimes&quot;</span><span class="p">:</span> <span class="n">datetimes</span><span class="p">[</span><span class="n">filteredPoints</span><span class="p">],</span> <span class="s2">&quot;filtered&quot;</span><span class="p">:</span> <span class="n">values</span><span class="p">[</span><span class="n">filteredPoints</span><span class="p">]}</span>
</span><span id="PriceGenerator-566"><a href="#PriceGenerator-566"><span class="linenos"> 566</span></a>
</span><span id="PriceGenerator-567"><a href="#PriceGenerator-567"><span class="linenos"> 567</span></a>    <span class="k">def</span> <span class="nf">GetStatistics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="PriceGenerator-568"><a href="#PriceGenerator-568"><span class="linenos"> 568</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="PriceGenerator-569"><a href="#PriceGenerator-569"><span class="linenos"> 569</span></a><span class="sd">        Calculates statistics of candles chain.</span>
</span><span id="PriceGenerator-570"><a href="#PriceGenerator-570"><span class="linenos"> 570</span></a>
</span><span id="PriceGenerator-571"><a href="#PriceGenerator-571"><span class="linenos"> 571</span></a><span class="sd">        :return: list with text in Markdown format with statistics.</span>
</span><span id="PriceGenerator-572"><a href="#PriceGenerator-572"><span class="linenos"> 572</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PriceGenerator-573"><a href="#PriceGenerator-573"><span class="linenos"> 573</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Calculating column with deltas between high and low values...&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator-574"><a href="#PriceGenerator-574"><span class="linenos"> 574</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;delta&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">high</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">low</span><span class="o">.</span><span class="n">values</span>
</span><span id="PriceGenerator-575"><a href="#PriceGenerator-575"><span class="linenos"> 575</span></a>
</span><span id="PriceGenerator-576"><a href="#PriceGenerator-576"><span class="linenos"> 576</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Calculating column with average values...&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator-577"><a href="#PriceGenerator-577"><span class="linenos"> 577</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;avg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">high</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">low</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precision</span><span class="p">)</span>
</span><span id="PriceGenerator-578"><a href="#PriceGenerator-578"><span class="linenos"> 578</span></a>
</span><span id="PriceGenerator-579"><a href="#PriceGenerator-579"><span class="linenos"> 579</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Calculating some technical analysis indicators...&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator-580"><a href="#PriceGenerator-580"><span class="linenos"> 580</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;sma5&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">sma</span><span class="p">(</span><span class="n">close</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="PriceGenerator-581"><a href="#PriceGenerator-581"><span class="linenos"> 581</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;sma20&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">sma</span><span class="p">(</span><span class="n">close</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="PriceGenerator-582"><a href="#PriceGenerator-582"><span class="linenos"> 582</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;sma50&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">sma</span><span class="p">(</span><span class="n">close</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="PriceGenerator-583"><a href="#PriceGenerator-583"><span class="linenos"> 583</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;sma200&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">sma</span><span class="p">(</span><span class="n">close</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="PriceGenerator-584"><a href="#PriceGenerator-584"><span class="linenos"> 584</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;hma5&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">hma</span><span class="p">(</span><span class="n">close</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="PriceGenerator-585"><a href="#PriceGenerator-585"><span class="linenos"> 585</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;hma20&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">hma</span><span class="p">(</span><span class="n">close</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="PriceGenerator-586"><a href="#PriceGenerator-586"><span class="linenos"> 586</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;vwma5&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">vwma</span><span class="p">(</span><span class="n">close</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">volume</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">volume</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="PriceGenerator-587"><a href="#PriceGenerator-587"><span class="linenos"> 587</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;vwma20&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">vwma</span><span class="p">(</span><span class="n">close</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">volume</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">volume</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="PriceGenerator-588"><a href="#PriceGenerator-588"><span class="linenos"> 588</span></a>        <span class="n">bbands</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">bbands</span><span class="p">(</span><span class="n">close</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mamode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="PriceGenerator-589"><a href="#PriceGenerator-589"><span class="linenos"> 589</span></a>        <span class="n">bbands</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;lower&quot;</span><span class="p">,</span> <span class="s2">&quot;mid&quot;</span><span class="p">,</span> <span class="s2">&quot;upper&quot;</span><span class="p">,</span> <span class="s2">&quot;bandwidth&quot;</span><span class="p">,</span> <span class="s2">&quot;percent&quot;</span><span class="p">]</span>
</span><span id="PriceGenerator-590"><a href="#PriceGenerator-590"><span class="linenos"> 590</span></a>        <span class="n">psar</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">psar</span><span class="p">(</span><span class="n">high</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">high</span><span class="p">,</span> <span class="n">low</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">low</span><span class="p">,</span> <span class="n">close</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">af</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">max_af</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="PriceGenerator-591"><a href="#PriceGenerator-591"><span class="linenos"> 591</span></a>        <span class="n">psar</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;long&quot;</span><span class="p">,</span> <span class="s2">&quot;short&quot;</span><span class="p">,</span> <span class="s2">&quot;af&quot;</span><span class="p">,</span> <span class="s2">&quot;reversal&quot;</span><span class="p">]</span>
</span><span id="PriceGenerator-592"><a href="#PriceGenerator-592"><span class="linenos"> 592</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;hma13&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">hma</span><span class="p">(</span><span class="n">close</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>  <span class="c1"># alligator Jaw</span>
</span><span id="PriceGenerator-593"><a href="#PriceGenerator-593"><span class="linenos"> 593</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;hma8&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">hma</span><span class="p">(</span><span class="n">close</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>  <span class="c1"># alligator Teeth</span>
</span><span id="PriceGenerator-594"><a href="#PriceGenerator-594"><span class="linenos"> 594</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;hma5&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">hma</span><span class="p">(</span><span class="n">close</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># alligator Lips</span>
</span><span id="PriceGenerator-595"><a href="#PriceGenerator-595"><span class="linenos"> 595</span></a>        <span class="n">zigzag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ZigZagFilter</span><span class="p">(</span><span class="n">datetimes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">deviation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zigZagDeviation</span><span class="p">)</span>  <span class="c1"># ZigZag indicator</span>
</span><span id="PriceGenerator-596"><a href="#PriceGenerator-596"><span class="linenos"> 596</span></a>
</span><span id="PriceGenerator-597"><a href="#PriceGenerator-597"><span class="linenos"> 597</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">DetectPrecision</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>  <span class="c1"># auto-detect precision</span>
</span><span id="PriceGenerator-598"><a href="#PriceGenerator-598"><span class="linenos"> 598</span></a>
</span><span id="PriceGenerator-599"><a href="#PriceGenerator-599"><span class="linenos"> 599</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_chartTitle</span> <span class="o">=</span> <span class="s2">&quot;Instrument: </span><span class="si">{}</span><span class="s2">, timeframe: </span><span class="si">{}</span><span class="s2">, horizon length: </span><span class="si">{}</span><span class="s2"> (from </span><span class="si">{}</span><span class="s2"> to </span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PriceGenerator-600"><a href="#PriceGenerator-600"><span class="linenos"> 600</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">ticker</span><span class="p">,</span>
</span><span id="PriceGenerator-601"><a href="#PriceGenerator-601"><span class="linenos"> 601</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">FormattedDelta</span><span class="p">(</span>
</span><span id="PriceGenerator-602"><a href="#PriceGenerator-602"><span class="linenos"> 602</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{days}</span><span class="s2"> days </span><span class="si">{hours}</span><span class="s2">h </span><span class="si">{minutes}</span><span class="s2">m </span><span class="si">{seconds}</span><span class="s2">s&quot;</span>
</span><span id="PriceGenerator-603"><a href="#PriceGenerator-603"><span class="linenos"> 603</span></a>            <span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span> <span class="o">&gt;=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">FormattedDelta</span><span class="p">(</span>
</span><span id="PriceGenerator-604"><a href="#PriceGenerator-604"><span class="linenos"> 604</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{hours}</span><span class="s2">h </span><span class="si">{minutes}</span><span class="s2">m </span><span class="si">{seconds}</span><span class="s2">s&quot;</span>
</span><span id="PriceGenerator-605"><a href="#PriceGenerator-605"><span class="linenos"> 605</span></a>            <span class="p">),</span>
</span><span id="PriceGenerator-606"><a href="#PriceGenerator-606"><span class="linenos"> 606</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span><span class="p">,</span>
</span><span id="PriceGenerator-607"><a href="#PriceGenerator-607"><span class="linenos"> 607</span></a>            <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">),</span>
</span><span id="PriceGenerator-608"><a href="#PriceGenerator-608"><span class="linenos"> 608</span></a>            <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">),</span>
</span><span id="PriceGenerator-609"><a href="#PriceGenerator-609"><span class="linenos"> 609</span></a>        <span class="p">)</span>
</span><span id="PriceGenerator-610"><a href="#PriceGenerator-610"><span class="linenos"> 610</span></a>
</span><span id="PriceGenerator-611"><a href="#PriceGenerator-611"><span class="linenos"> 611</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;candles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">)</span>
</span><span id="PriceGenerator-612"><a href="#PriceGenerator-612"><span class="linenos"> 612</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;precision&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span>
</span><span id="PriceGenerator-613"><a href="#PriceGenerator-613"><span class="linenos"> 613</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;closeFirst&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="PriceGenerator-614"><a href="#PriceGenerator-614"><span class="linenos"> 614</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;closeLast&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="PriceGenerator-615"><a href="#PriceGenerator-615"><span class="linenos"> 615</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;closeMax&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
</span><span id="PriceGenerator-616"><a href="#PriceGenerator-616"><span class="linenos"> 616</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;closeMin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
</span><span id="PriceGenerator-617"><a href="#PriceGenerator-617"><span class="linenos"> 617</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;diapason&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;closeMax&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;closeMin&quot;</span><span class="p">]</span>
</span><span id="PriceGenerator-618"><a href="#PriceGenerator-618"><span class="linenos"> 618</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;trend&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetTrend</span><span class="p">(</span><span class="n">firstClose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;closeFirst&quot;</span><span class="p">],</span> <span class="n">lastClose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;closeLast&quot;</span><span class="p">],</span> <span class="n">trendDeviation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trendDeviation</span><span class="p">)</span>
</span><span id="PriceGenerator-619"><a href="#PriceGenerator-619"><span class="linenos"> 619</span></a>
</span><span id="PriceGenerator-620"><a href="#PriceGenerator-620"><span class="linenos"> 620</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;up&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">open</span>  <span class="c1"># True mean that is up candle, and False mean down</span>
</span><span id="PriceGenerator-621"><a href="#PriceGenerator-621"><span class="linenos"> 621</span></a>        <span class="n">upList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">up</span><span class="p">)</span>
</span><span id="PriceGenerator-622"><a href="#PriceGenerator-622"><span class="linenos"> 622</span></a>        <span class="n">upChainsLengths</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">chain</span><span class="p">))</span> <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">chain</span> <span class="ow">in</span> <span class="n">groupby</span><span class="p">(</span><span class="n">upList</span><span class="p">)</span> <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">]</span>
</span><span id="PriceGenerator-623"><a href="#PriceGenerator-623"><span class="linenos"> 623</span></a>        <span class="n">downChainsLengths</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">chain</span><span class="p">))</span> <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">chain</span> <span class="ow">in</span> <span class="n">groupby</span><span class="p">(</span><span class="n">upList</span><span class="p">)</span> <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">]</span>
</span><span id="PriceGenerator-624"><a href="#PriceGenerator-624"><span class="linenos"> 624</span></a>
</span><span id="PriceGenerator-625"><a href="#PriceGenerator-625"><span class="linenos"> 625</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;trendDev&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendDeviation</span>
</span><span id="PriceGenerator-626"><a href="#PriceGenerator-626"><span class="linenos"> 626</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;upCount&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">up</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">up</span> <span class="o">==</span> <span class="kc">True</span><span class="p">])</span>
</span><span id="PriceGenerator-627"><a href="#PriceGenerator-627"><span class="linenos"> 627</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;downCount&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">up</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">up</span> <span class="o">==</span> <span class="kc">False</span><span class="p">])</span>
</span><span id="PriceGenerator-628"><a href="#PriceGenerator-628"><span class="linenos"> 628</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;upCountChainMax&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">upChainsLengths</span><span class="p">)</span> <span class="k">if</span> <span class="n">upChainsLengths</span> <span class="k">else</span> <span class="mi">1</span>
</span><span id="PriceGenerator-629"><a href="#PriceGenerator-629"><span class="linenos"> 629</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;downCountChainMax&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">downChainsLengths</span><span class="p">)</span> <span class="k">if</span> <span class="n">downChainsLengths</span> <span class="k">else</span> <span class="mi">1</span>
</span><span id="PriceGenerator-630"><a href="#PriceGenerator-630"><span class="linenos"> 630</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;deltas&quot;</span><span class="p">][</span><span class="s2">&quot;max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">delta</span><span class="p">)</span>
</span><span id="PriceGenerator-631"><a href="#PriceGenerator-631"><span class="linenos"> 631</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;deltas&quot;</span><span class="p">][</span><span class="s2">&quot;min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">delta</span><span class="p">)</span>
</span><span id="PriceGenerator-632"><a href="#PriceGenerator-632"><span class="linenos"> 632</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;deltas&quot;</span><span class="p">][</span><span class="s2">&quot;stDev&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">pstdev</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">delta</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precision</span><span class="p">)</span>
</span><span id="PriceGenerator-633"><a href="#PriceGenerator-633"><span class="linenos"> 633</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;deltas&quot;</span><span class="p">][</span><span class="s2">&quot;q99&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">delta</span><span class="p">)</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precision</span><span class="p">)</span>
</span><span id="PriceGenerator-634"><a href="#PriceGenerator-634"><span class="linenos"> 634</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;deltas&quot;</span><span class="p">][</span><span class="s2">&quot;q95&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">delta</span><span class="p">)</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precision</span><span class="p">)</span>
</span><span id="PriceGenerator-635"><a href="#PriceGenerator-635"><span class="linenos"> 635</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;deltas&quot;</span><span class="p">][</span><span class="s2">&quot;q80&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">delta</span><span class="p">)</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="mf">0.80</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precision</span><span class="p">)</span>
</span><span id="PriceGenerator-636"><a href="#PriceGenerator-636"><span class="linenos"> 636</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;deltas&quot;</span><span class="p">][</span><span class="s2">&quot;q50&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">delta</span><span class="p">)</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="mf">0.50</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precision</span><span class="p">)</span>
</span><span id="PriceGenerator-637"><a href="#PriceGenerator-637"><span class="linenos"> 637</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;cumSumVolumes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">volume</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span id="PriceGenerator-638"><a href="#PriceGenerator-638"><span class="linenos"> 638</span></a>
</span><span id="PriceGenerator-639"><a href="#PriceGenerator-639"><span class="linenos"> 639</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;sma5&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;sma5&quot;</span><span class="p">]</span>
</span><span id="PriceGenerator-640"><a href="#PriceGenerator-640"><span class="linenos"> 640</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;sma20&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;sma20&quot;</span><span class="p">]</span>
</span><span id="PriceGenerator-641"><a href="#PriceGenerator-641"><span class="linenos"> 641</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;sma50&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;sma50&quot;</span><span class="p">]</span>
</span><span id="PriceGenerator-642"><a href="#PriceGenerator-642"><span class="linenos"> 642</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;sma200&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;sma200&quot;</span><span class="p">]</span>
</span><span id="PriceGenerator-643"><a href="#PriceGenerator-643"><span class="linenos"> 643</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;hma5&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;hma5&quot;</span><span class="p">]</span>
</span><span id="PriceGenerator-644"><a href="#PriceGenerator-644"><span class="linenos"> 644</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;hma20&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;hma20&quot;</span><span class="p">]</span>
</span><span id="PriceGenerator-645"><a href="#PriceGenerator-645"><span class="linenos"> 645</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;vwma5&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;vwma5&quot;</span><span class="p">]</span>
</span><span id="PriceGenerator-646"><a href="#PriceGenerator-646"><span class="linenos"> 646</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;vwma20&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;vwma20&quot;</span><span class="p">]</span>
</span><span id="PriceGenerator-647"><a href="#PriceGenerator-647"><span class="linenos"> 647</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;bbands&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bbands</span>
</span><span id="PriceGenerator-648"><a href="#PriceGenerator-648"><span class="linenos"> 648</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;psar&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">psar</span>
</span><span id="PriceGenerator-649"><a href="#PriceGenerator-649"><span class="linenos"> 649</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;hma13&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;hma13&quot;</span><span class="p">]</span>
</span><span id="PriceGenerator-650"><a href="#PriceGenerator-650"><span class="linenos"> 650</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;hma8&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;hma8&quot;</span><span class="p">]</span>
</span><span id="PriceGenerator-651"><a href="#PriceGenerator-651"><span class="linenos"> 651</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;hma5&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;hma5&quot;</span><span class="p">]</span>
</span><span id="PriceGenerator-652"><a href="#PriceGenerator-652"><span class="linenos"> 652</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;zigzag3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">zigzag</span>
</span><span id="PriceGenerator-653"><a href="#PriceGenerator-653"><span class="linenos"> 653</span></a>
</span><span id="PriceGenerator-654"><a href="#PriceGenerator-654"><span class="linenos"> 654</span></a>        <span class="n">summary</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="PriceGenerator-655"><a href="#PriceGenerator-655"><span class="linenos"> 655</span></a>            <span class="s2">&quot;# Summary&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-656"><a href="#PriceGenerator-656"><span class="linenos"> 656</span></a>            <span class="s2">&quot;- Candles count: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;candles&quot;</span><span class="p">]),</span>
</span><span id="PriceGenerator-657"><a href="#PriceGenerator-657"><span class="linenos"> 657</span></a>            <span class="s2">&quot;- Timeframe: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span><span class="p">),</span>
</span><span id="PriceGenerator-658"><a href="#PriceGenerator-658"><span class="linenos"> 658</span></a>            <span class="s2">&quot;- Precision (signs after comma): </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;precision&quot;</span><span class="p">]),</span>
</span><span id="PriceGenerator-659"><a href="#PriceGenerator-659"><span class="linenos"> 659</span></a>            <span class="s2">&quot;- Close, first: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;closeFirst&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)),</span>
</span><span id="PriceGenerator-660"><a href="#PriceGenerator-660"><span class="linenos"> 660</span></a>            <span class="s2">&quot;- Close, last: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;closeLast&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)),</span>
</span><span id="PriceGenerator-661"><a href="#PriceGenerator-661"><span class="linenos"> 661</span></a>            <span class="s2">&quot;- Close, max: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;closeMax&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)),</span>
</span><span id="PriceGenerator-662"><a href="#PriceGenerator-662"><span class="linenos"> 662</span></a>            <span class="s2">&quot;- Close, min: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;closeMin&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)),</span>
</span><span id="PriceGenerator-663"><a href="#PriceGenerator-663"><span class="linenos"> 663</span></a>            <span class="s2">&quot;- Diapason, |close_max - close_min|: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;diapason&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)),</span>
</span><span id="PriceGenerator-664"><a href="#PriceGenerator-664"><span class="linenos"> 664</span></a>            <span class="s2">&quot;- Trend, |close_1st - close_last|: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;trend&quot;</span><span class="p">]),</span>
</span><span id="PriceGenerator-665"><a href="#PriceGenerator-665"><span class="linenos"> 665</span></a>            <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-666"><a href="#PriceGenerator-666"><span class="linenos"> 666</span></a>            <span class="s2">&quot;# Statistics&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-667"><a href="#PriceGenerator-667"><span class="linenos"> 667</span></a>            <span class="s2">&quot;- Up candles count: </span><span class="si">{}</span><span class="s2"> (</span><span class="si">{}</span><span class="s2">%)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;upCount&quot;</span><span class="p">],</span> <span class="nb">round</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;upCount&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;candles&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)),</span>
</span><span id="PriceGenerator-668"><a href="#PriceGenerator-668"><span class="linenos"> 668</span></a>            <span class="s2">&quot;- Down candles count: </span><span class="si">{}</span><span class="s2"> (</span><span class="si">{}</span><span class="s2">%)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;downCount&quot;</span><span class="p">],</span> <span class="nb">round</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;downCount&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;candles&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)),</span>
</span><span id="PriceGenerator-669"><a href="#PriceGenerator-669"><span class="linenos"> 669</span></a>            <span class="s2">&quot;- Max of up / down candle chains: </span><span class="si">{}</span><span class="s2"> / </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;upCountChainMax&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;downCountChainMax&quot;</span><span class="p">]),</span>
</span><span id="PriceGenerator-670"><a href="#PriceGenerator-670"><span class="linenos"> 670</span></a>            <span class="s2">&quot;- Max delta, |high - low|: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;deltas&quot;</span><span class="p">][</span><span class="s2">&quot;max&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)),</span>
</span><span id="PriceGenerator-671"><a href="#PriceGenerator-671"><span class="linenos"> 671</span></a>            <span class="s2">&quot;- Min delta, |high - low|: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;deltas&quot;</span><span class="p">][</span><span class="s2">&quot;min&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)),</span>
</span><span id="PriceGenerator-672"><a href="#PriceGenerator-672"><span class="linenos"> 672</span></a>            <span class="s2">&quot;- Delta&#39;s std. dev.: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;deltas&quot;</span><span class="p">][</span><span class="s2">&quot;stDev&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)),</span>
</span><span id="PriceGenerator-673"><a href="#PriceGenerator-673"><span class="linenos"> 673</span></a>            <span class="s2">&quot;  - 99 percentile: ≤ </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;deltas&quot;</span><span class="p">][</span><span class="s2">&quot;q99&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)),</span>
</span><span id="PriceGenerator-674"><a href="#PriceGenerator-674"><span class="linenos"> 674</span></a>            <span class="s2">&quot;  - 95 percentile: ≤ </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;deltas&quot;</span><span class="p">][</span><span class="s2">&quot;q95&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)),</span>
</span><span id="PriceGenerator-675"><a href="#PriceGenerator-675"><span class="linenos"> 675</span></a>            <span class="s2">&quot;  - 80 percentile: ≤ </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;deltas&quot;</span><span class="p">][</span><span class="s2">&quot;q80&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)),</span>
</span><span id="PriceGenerator-676"><a href="#PriceGenerator-676"><span class="linenos"> 676</span></a>            <span class="s2">&quot;- Cumulative sum of volumes: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;cumSumVolumes&quot;</span><span class="p">]),</span>
</span><span id="PriceGenerator-677"><a href="#PriceGenerator-677"><span class="linenos"> 677</span></a>        <span class="p">]</span>
</span><span id="PriceGenerator-678"><a href="#PriceGenerator-678"><span class="linenos"> 678</span></a>
</span><span id="PriceGenerator-679"><a href="#PriceGenerator-679"><span class="linenos"> 679</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Some statistics:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">summary</span><span class="p">)))</span>
</span><span id="PriceGenerator-680"><a href="#PriceGenerator-680"><span class="linenos"> 680</span></a>
</span><span id="PriceGenerator-681"><a href="#PriceGenerator-681"><span class="linenos"> 681</span></a>        <span class="k">return</span> <span class="n">summary</span>
</span><span id="PriceGenerator-682"><a href="#PriceGenerator-682"><span class="linenos"> 682</span></a>
</span><span id="PriceGenerator-683"><a href="#PriceGenerator-683"><span class="linenos"> 683</span></a>    <span class="k">def</span> <span class="nf">_GenNextCandle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lastClose</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="PriceGenerator-684"><a href="#PriceGenerator-684"><span class="linenos"> 684</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="PriceGenerator-685"><a href="#PriceGenerator-685"><span class="linenos"> 685</span></a><span class="sd">        Generator for creating 1 next candle based on global probability parameters.</span>
</span><span id="PriceGenerator-686"><a href="#PriceGenerator-686"><span class="linenos"> 686</span></a>
</span><span id="PriceGenerator-687"><a href="#PriceGenerator-687"><span class="linenos"> 687</span></a><span class="sd">        :param lastClose: value of last close price.</span>
</span><span id="PriceGenerator-688"><a href="#PriceGenerator-688"><span class="linenos"> 688</span></a><span class="sd">        :return: one OHLCV-candle as dict.</span>
</span><span id="PriceGenerator-689"><a href="#PriceGenerator-689"><span class="linenos"> 689</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PriceGenerator-690"><a href="#PriceGenerator-690"><span class="linenos"> 690</span></a>        <span class="n">candle</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="PriceGenerator-691"><a href="#PriceGenerator-691"><span class="linenos"> 691</span></a>            <span class="s2">&quot;open&quot;</span><span class="p">:</span> <span class="n">lastClose</span><span class="p">,</span>
</span><span id="PriceGenerator-692"><a href="#PriceGenerator-692"><span class="linenos"> 692</span></a>            <span class="s2">&quot;high&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="PriceGenerator-693"><a href="#PriceGenerator-693"><span class="linenos"> 693</span></a>            <span class="s2">&quot;low&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="PriceGenerator-694"><a href="#PriceGenerator-694"><span class="linenos"> 694</span></a>            <span class="s2">&quot;close&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="PriceGenerator-695"><a href="#PriceGenerator-695"><span class="linenos"> 695</span></a>            <span class="s2">&quot;volume&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">maxVolume</span><span class="p">)</span>
</span><span id="PriceGenerator-696"><a href="#PriceGenerator-696"><span class="linenos"> 696</span></a>        <span class="p">}</span>
</span><span id="PriceGenerator-697"><a href="#PriceGenerator-697"><span class="linenos"> 697</span></a>
</span><span id="PriceGenerator-698"><a href="#PriceGenerator-698"><span class="linenos"> 698</span></a>        <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">upCandlesProb</span><span class="p">:</span>
</span><span id="PriceGenerator-699"><a href="#PriceGenerator-699"><span class="linenos"> 699</span></a>            <span class="n">maxBody</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxClose</span><span class="p">,</span> <span class="n">candle</span><span class="p">[</span><span class="s2">&quot;open&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxCandleBody</span><span class="p">)</span>
</span><span id="PriceGenerator-700"><a href="#PriceGenerator-700"><span class="linenos"> 700</span></a>            <span class="n">candle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">candle</span><span class="p">[</span><span class="s2">&quot;open&quot;</span><span class="p">],</span> <span class="n">b</span><span class="o">=</span><span class="n">maxBody</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)</span>  <span class="c1"># up candle</span>
</span><span id="PriceGenerator-701"><a href="#PriceGenerator-701"><span class="linenos"> 701</span></a>
</span><span id="PriceGenerator-702"><a href="#PriceGenerator-702"><span class="linenos"> 702</span></a>            <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outliersProb</span><span class="p">:</span>
</span><span id="PriceGenerator-703"><a href="#PriceGenerator-703"><span class="linenos"> 703</span></a>                <span class="n">candle</span><span class="p">[</span><span class="s2">&quot;high&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">candle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">],</span> <span class="n">b</span><span class="o">=</span><span class="n">candle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxOutlier</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)</span>  <span class="c1"># with outlier price &quot;tails&quot;</span>
</span><span id="PriceGenerator-704"><a href="#PriceGenerator-704"><span class="linenos"> 704</span></a>                <span class="n">candle</span><span class="p">[</span><span class="s2">&quot;low&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">candle</span><span class="p">[</span><span class="s2">&quot;open&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxOutlier</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">candle</span><span class="p">[</span><span class="s2">&quot;open&quot;</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)</span>
</span><span id="PriceGenerator-705"><a href="#PriceGenerator-705"><span class="linenos"> 705</span></a>
</span><span id="PriceGenerator-706"><a href="#PriceGenerator-706"><span class="linenos"> 706</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PriceGenerator-707"><a href="#PriceGenerator-707"><span class="linenos"> 707</span></a>                <span class="n">halfBody</span> <span class="o">=</span> <span class="p">(</span><span class="n">candle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">candle</span><span class="p">[</span><span class="s2">&quot;open&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="PriceGenerator-708"><a href="#PriceGenerator-708"><span class="linenos"> 708</span></a>                <span class="n">candle</span><span class="p">[</span><span class="s2">&quot;high&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">candle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">],</span> <span class="n">b</span><span class="o">=</span><span class="n">candle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">halfBody</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)</span>  <span class="c1"># without outlier price &quot;tails&quot;</span>
</span><span id="PriceGenerator-709"><a href="#PriceGenerator-709"><span class="linenos"> 709</span></a>                <span class="n">candle</span><span class="p">[</span><span class="s2">&quot;low&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">candle</span><span class="p">[</span><span class="s2">&quot;open&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">halfBody</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">candle</span><span class="p">[</span><span class="s2">&quot;open&quot;</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)</span>
</span><span id="PriceGenerator-710"><a href="#PriceGenerator-710"><span class="linenos"> 710</span></a>
</span><span id="PriceGenerator-711"><a href="#PriceGenerator-711"><span class="linenos"> 711</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PriceGenerator-712"><a href="#PriceGenerator-712"><span class="linenos"> 712</span></a>            <span class="n">minBody</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minClose</span><span class="p">,</span> <span class="n">candle</span><span class="p">[</span><span class="s2">&quot;open&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxCandleBody</span><span class="p">)</span>
</span><span id="PriceGenerator-713"><a href="#PriceGenerator-713"><span class="linenos"> 713</span></a>            <span class="n">candle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">minBody</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">candle</span><span class="p">[</span><span class="s2">&quot;open&quot;</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)</span>  <span class="c1"># down candle</span>
</span><span id="PriceGenerator-714"><a href="#PriceGenerator-714"><span class="linenos"> 714</span></a>
</span><span id="PriceGenerator-715"><a href="#PriceGenerator-715"><span class="linenos"> 715</span></a>            <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outliersProb</span><span class="p">:</span>
</span><span id="PriceGenerator-716"><a href="#PriceGenerator-716"><span class="linenos"> 716</span></a>                <span class="n">candle</span><span class="p">[</span><span class="s2">&quot;high&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">candle</span><span class="p">[</span><span class="s2">&quot;open&quot;</span><span class="p">],</span> <span class="n">b</span><span class="o">=</span><span class="n">candle</span><span class="p">[</span><span class="s2">&quot;open&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxOutlier</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)</span>  <span class="c1"># with outlier price &quot;tails&quot;</span>
</span><span id="PriceGenerator-717"><a href="#PriceGenerator-717"><span class="linenos"> 717</span></a>                <span class="n">candle</span><span class="p">[</span><span class="s2">&quot;low&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">candle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxOutlier</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">candle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)</span>
</span><span id="PriceGenerator-718"><a href="#PriceGenerator-718"><span class="linenos"> 718</span></a>
</span><span id="PriceGenerator-719"><a href="#PriceGenerator-719"><span class="linenos"> 719</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PriceGenerator-720"><a href="#PriceGenerator-720"><span class="linenos"> 720</span></a>                <span class="n">halfBody</span> <span class="o">=</span> <span class="p">(</span><span class="n">candle</span><span class="p">[</span><span class="s2">&quot;open&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">candle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="PriceGenerator-721"><a href="#PriceGenerator-721"><span class="linenos"> 721</span></a>                <span class="n">candle</span><span class="p">[</span><span class="s2">&quot;high&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">candle</span><span class="p">[</span><span class="s2">&quot;open&quot;</span><span class="p">],</span> <span class="n">b</span><span class="o">=</span><span class="n">candle</span><span class="p">[</span><span class="s2">&quot;open&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">halfBody</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)</span>  <span class="c1"># without outlier price &quot;tails&quot;</span>
</span><span id="PriceGenerator-722"><a href="#PriceGenerator-722"><span class="linenos"> 722</span></a>                <span class="n">candle</span><span class="p">[</span><span class="s2">&quot;low&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">candle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">halfBody</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">candle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)</span>
</span><span id="PriceGenerator-723"><a href="#PriceGenerator-723"><span class="linenos"> 723</span></a>
</span><span id="PriceGenerator-724"><a href="#PriceGenerator-724"><span class="linenos"> 724</span></a>        <span class="k">return</span> <span class="n">candle</span>
</span><span id="PriceGenerator-725"><a href="#PriceGenerator-725"><span class="linenos"> 725</span></a>
</span><span id="PriceGenerator-726"><a href="#PriceGenerator-726"><span class="linenos"> 726</span></a>    <span class="k">def</span> <span class="nf">Generate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="PriceGenerator-727"><a href="#PriceGenerator-727"><span class="linenos"> 727</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="PriceGenerator-728"><a href="#PriceGenerator-728"><span class="linenos"> 728</span></a><span class="sd">        Main method to generating prices.</span>
</span><span id="PriceGenerator-729"><a href="#PriceGenerator-729"><span class="linenos"> 729</span></a>
</span><span id="PriceGenerator-730"><a href="#PriceGenerator-730"><span class="linenos"> 730</span></a><span class="sd">        :return Pandas DataFrame object with OHLCV-candlestick in every row and also saving it to the `prices`.</span>
</span><span id="PriceGenerator-731"><a href="#PriceGenerator-731"><span class="linenos"> 731</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PriceGenerator-732"><a href="#PriceGenerator-732"><span class="linenos"> 732</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
</span><span id="PriceGenerator-733"><a href="#PriceGenerator-733"><span class="linenos"> 733</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="PriceGenerator-734"><a href="#PriceGenerator-734"><span class="linenos"> 734</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Horizon length less than 5! It is set to 5 by default.&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator-735"><a href="#PriceGenerator-735"><span class="linenos"> 735</span></a>
</span><span id="PriceGenerator-736"><a href="#PriceGenerator-736"><span class="linenos"> 736</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PriceGenerator-737"><a href="#PriceGenerator-737"><span class="linenos"> 737</span></a>            <span class="c1"># Detecting input trend:</span>
</span><span id="PriceGenerator-738"><a href="#PriceGenerator-738"><span class="linenos"> 738</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="PriceGenerator-739"><a href="#PriceGenerator-739"><span class="linenos"> 739</span></a>            <span class="k">if</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span> <span class="ow">or</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span><span class="p">:</span>
</span><span id="PriceGenerator-740"><a href="#PriceGenerator-740"><span class="linenos"> 740</span></a>                <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Detected old-style string for split trend: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span><span class="p">))</span>
</span><span id="PriceGenerator-741"><a href="#PriceGenerator-741"><span class="linenos"> 741</span></a>
</span><span id="PriceGenerator-742"><a href="#PriceGenerator-742"><span class="linenos"> 742</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;-no-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;-up-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;-down-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator-743"><a href="#PriceGenerator-743"><span class="linenos"> 743</span></a>
</span><span id="PriceGenerator-744"><a href="#PriceGenerator-744"><span class="linenos"> 744</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PriceGenerator-745"><a href="#PriceGenerator-745"><span class="linenos"> 745</span></a>                <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Detected new-style string for split trend: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span><span class="p">))</span>
</span><span id="PriceGenerator-746"><a href="#PriceGenerator-746"><span class="linenos"> 746</span></a>
</span><span id="PriceGenerator-747"><a href="#PriceGenerator-747"><span class="linenos"> 747</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span> <span class="o">=</span> <span class="s2">&quot;-</span><span class="si">{}</span><span class="s2">-&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span><span class="p">)</span>
</span><span id="PriceGenerator-748"><a href="#PriceGenerator-748"><span class="linenos"> 748</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-u-&quot;</span><span class="p">,</span> <span class="s2">&quot;-up-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-d-&quot;</span><span class="p">,</span> <span class="s2">&quot;-down-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-n-&quot;</span><span class="p">,</span> <span class="s2">&quot;-no-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator-749"><a href="#PriceGenerator-749"><span class="linenos"> 749</span></a>
</span><span id="PriceGenerator-750"><a href="#PriceGenerator-750"><span class="linenos"> 750</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;New style string for trend split is set: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span><span class="p">))</span>
</span><span id="PriceGenerator-751"><a href="#PriceGenerator-751"><span class="linenos"> 751</span></a>
</span><span id="PriceGenerator-752"><a href="#PriceGenerator-752"><span class="linenos"> 752</span></a>            <span class="n">trends</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator-753"><a href="#PriceGenerator-753"><span class="linenos"> 753</span></a>
</span><span id="PriceGenerator-754"><a href="#PriceGenerator-754"><span class="linenos"> 754</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Trends list: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trends</span><span class="p">))</span>
</span><span id="PriceGenerator-755"><a href="#PriceGenerator-755"><span class="linenos"> 755</span></a>
</span><span id="PriceGenerator-756"><a href="#PriceGenerator-756"><span class="linenos"> 756</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trends</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span><span class="p">:</span>
</span><span id="PriceGenerator-757"><a href="#PriceGenerator-757"><span class="linenos"> 757</span></a>                <span class="n">trends</span> <span class="o">=</span> <span class="n">trends</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="PriceGenerator-758"><a href="#PriceGenerator-758"><span class="linenos"> 758</span></a>
</span><span id="PriceGenerator-759"><a href="#PriceGenerator-759"><span class="linenos"> 759</span></a>                <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Trend parts count (</span><span class="si">{}</span><span class="s2">) must be less than horizon (</span><span class="si">{}</span><span class="s2">)! New trend will be used: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">trends</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span><span class="p">,</span> <span class="n">trends</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="PriceGenerator-760"><a href="#PriceGenerator-760"><span class="linenos"> 760</span></a>
</span><span id="PriceGenerator-761"><a href="#PriceGenerator-761"><span class="linenos"> 761</span></a>            <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">trends</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="PriceGenerator-762"><a href="#PriceGenerator-762"><span class="linenos"> 762</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">horizon</span><span class="p">]</span>
</span><span id="PriceGenerator-763"><a href="#PriceGenerator-763"><span class="linenos"> 763</span></a>
</span><span id="PriceGenerator-764"><a href="#PriceGenerator-764"><span class="linenos"> 764</span></a>                <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Only one trend will be used with length equal to horizon: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span><span class="p">))</span>
</span><span id="PriceGenerator-765"><a href="#PriceGenerator-765"><span class="linenos"> 765</span></a>
</span><span id="PriceGenerator-766"><a href="#PriceGenerator-766"><span class="linenos"> 766</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">trends</span><span class="p">):</span>
</span><span id="PriceGenerator-767"><a href="#PriceGenerator-767"><span class="linenos"> 767</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PriceGenerator-768"><a href="#PriceGenerator-768"><span class="linenos"> 768</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PriceGenerator-769"><a href="#PriceGenerator-769"><span class="linenos"> 769</span></a>
</span><span id="PriceGenerator-770"><a href="#PriceGenerator-770"><span class="linenos"> 770</span></a>                <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Random trend direction will be used, because trends count not equal to split count!&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator-771"><a href="#PriceGenerator-771"><span class="linenos"> 771</span></a>
</span><span id="PriceGenerator-772"><a href="#PriceGenerator-772"><span class="linenos"> 772</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PriceGenerator-773"><a href="#PriceGenerator-773"><span class="linenos"> 773</span></a>            <span class="n">trends</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="PriceGenerator-774"><a href="#PriceGenerator-774"><span class="linenos"> 774</span></a>
</span><span id="PriceGenerator-775"><a href="#PriceGenerator-775"><span class="linenos"> 775</span></a>        <span class="c1"># maximum of candle sizes: (high - low), if None then used (maxClose - minClose) / 10</span>
</span><span id="PriceGenerator-776"><a href="#PriceGenerator-776"><span class="linenos"> 776</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxOutlier</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PriceGenerator-777"><a href="#PriceGenerator-777"><span class="linenos"> 777</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">maxOutlier</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxClose</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">minClose</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span>
</span><span id="PriceGenerator-778"><a href="#PriceGenerator-778"><span class="linenos"> 778</span></a>
</span><span id="PriceGenerator-779"><a href="#PriceGenerator-779"><span class="linenos"> 779</span></a>        <span class="c1"># maximum of candle body sizes: abs(open - close), if None then used maxOutlier * 90%</span>
</span><span id="PriceGenerator-780"><a href="#PriceGenerator-780"><span class="linenos"> 780</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxCandleBody</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PriceGenerator-781"><a href="#PriceGenerator-781"><span class="linenos"> 781</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">maxCandleBody</span> <span class="o">=</span> <span class="mf">0.9</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxOutlier</span>
</span><span id="PriceGenerator-782"><a href="#PriceGenerator-782"><span class="linenos"> 782</span></a>
</span><span id="PriceGenerator-783"><a href="#PriceGenerator-783"><span class="linenos"> 783</span></a>        <span class="c1"># initClose is the last close price (left on chart or &quot;before&quot; 1st generated candle), 1st candle[&quot;open&quot;] = initClose</span>
</span><span id="PriceGenerator-784"><a href="#PriceGenerator-784"><span class="linenos"> 784</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initClose</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PriceGenerator-785"><a href="#PriceGenerator-785"><span class="linenos"> 785</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">initClose</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">minClose</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">maxClose</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)</span>
</span><span id="PriceGenerator-786"><a href="#PriceGenerator-786"><span class="linenos"> 786</span></a>
</span><span id="PriceGenerator-787"><a href="#PriceGenerator-787"><span class="linenos"> 787</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generating prices...&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator-788"><a href="#PriceGenerator-788"><span class="linenos"> 788</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;- Ticker name: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ticker</span><span class="p">))</span>
</span><span id="PriceGenerator-789"><a href="#PriceGenerator-789"><span class="linenos"> 789</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;- Precision: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">))</span>
</span><span id="PriceGenerator-790"><a href="#PriceGenerator-790"><span class="linenos"> 790</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;- Interval or timeframe (time delta between two neighbour candles): </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span><span class="p">))</span>
</span><span id="PriceGenerator-791"><a href="#PriceGenerator-791"><span class="linenos"> 791</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;- Horizon length (candlesticks count): </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">horizon</span><span class="p">))</span>
</span><span id="PriceGenerator-792"><a href="#PriceGenerator-792"><span class="linenos"> 792</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span><span class="p">:</span>
</span><span id="PriceGenerator-793"><a href="#PriceGenerator-793"><span class="linenos"> 793</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;- Trend type: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span><span class="p">))</span>
</span><span id="PriceGenerator-794"><a href="#PriceGenerator-794"><span class="linenos"> 794</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;- Candlesticks count in every mini-trend: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span><span class="p">))</span>
</span><span id="PriceGenerator-795"><a href="#PriceGenerator-795"><span class="linenos"> 795</span></a>
</span><span id="PriceGenerator-796"><a href="#PriceGenerator-796"><span class="linenos"> 796</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;- Start time: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeStart</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)))</span>
</span><span id="PriceGenerator-797"><a href="#PriceGenerator-797"><span class="linenos"> 797</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;  |-&gt; end time: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">timeStart</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)))</span>
</span><span id="PriceGenerator-798"><a href="#PriceGenerator-798"><span class="linenos"> 798</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;- Maximum of close prices: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxClose</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)))</span>
</span><span id="PriceGenerator-799"><a href="#PriceGenerator-799"><span class="linenos"> 799</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;- Minimum of close prices: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minClose</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)))</span>
</span><span id="PriceGenerator-800"><a href="#PriceGenerator-800"><span class="linenos"> 800</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;- Maximum of candle body sizes: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxCandleBody</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)))</span>
</span><span id="PriceGenerator-801"><a href="#PriceGenerator-801"><span class="linenos"> 801</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;- Maximum of candle tails outlier sizes: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxOutlier</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)))</span>
</span><span id="PriceGenerator-802"><a href="#PriceGenerator-802"><span class="linenos"> 802</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;- Init close (1st open price in chain): </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initClose</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)))</span>
</span><span id="PriceGenerator-803"><a href="#PriceGenerator-803"><span class="linenos"> 803</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;- Maximum of volume of one candle: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxVolume</span><span class="p">))</span>
</span><span id="PriceGenerator-804"><a href="#PriceGenerator-804"><span class="linenos"> 804</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;- Probability that next candle is up: </span><span class="si">{}</span><span class="s2">%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">upCandlesProb</span> <span class="o">*</span> <span class="mi">100</span><span class="p">))</span>
</span><span id="PriceGenerator-805"><a href="#PriceGenerator-805"><span class="linenos"> 805</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;- Statistical outliers probability: </span><span class="si">{}</span><span class="s2">%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outliersProb</span> <span class="o">*</span> <span class="mi">100</span><span class="p">))</span>
</span><span id="PriceGenerator-806"><a href="#PriceGenerator-806"><span class="linenos"> 806</span></a>
</span><span id="PriceGenerator-807"><a href="#PriceGenerator-807"><span class="linenos"> 807</span></a>        <span class="c1"># -- Preparing candles chain:</span>
</span><span id="PriceGenerator-808"><a href="#PriceGenerator-808"><span class="linenos"> 808</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span><span class="p">:</span>
</span><span id="PriceGenerator-809"><a href="#PriceGenerator-809"><span class="linenos"> 809</span></a>            <span class="n">userProb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">upCandlesProb</span>
</span><span id="PriceGenerator-810"><a href="#PriceGenerator-810"><span class="linenos"> 810</span></a>            <span class="n">userHorizon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span>
</span><span id="PriceGenerator-811"><a href="#PriceGenerator-811"><span class="linenos"> 811</span></a>            <span class="n">userInitC</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initClose</span>
</span><span id="PriceGenerator-812"><a href="#PriceGenerator-812"><span class="linenos"> 812</span></a>            <span class="n">candles</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="PriceGenerator-813"><a href="#PriceGenerator-813"><span class="linenos"> 813</span></a>
</span><span id="PriceGenerator-814"><a href="#PriceGenerator-814"><span class="linenos"> 814</span></a>            <span class="k">for</span> <span class="n">trendNum</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">trends</span><span class="p">)):</span>
</span><span id="PriceGenerator-815"><a href="#PriceGenerator-815"><span class="linenos"> 815</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span><span class="p">[</span><span class="n">trendNum</span><span class="p">]</span>
</span><span id="PriceGenerator-816"><a href="#PriceGenerator-816"><span class="linenos"> 816</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">initClose</span> <span class="o">=</span> <span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">trendNum</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">initClose</span>
</span><span id="PriceGenerator-817"><a href="#PriceGenerator-817"><span class="linenos"> 817</span></a>
</span><span id="PriceGenerator-818"><a href="#PriceGenerator-818"><span class="linenos"> 818</span></a>                <span class="c1"># change probability of candles direction in next trend:</span>
</span><span id="PriceGenerator-819"><a href="#PriceGenerator-819"><span class="linenos"> 819</span></a>                <span class="k">if</span> <span class="n">trends</span><span class="p">[</span><span class="n">trendNum</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;up&quot;</span><span class="p">:</span>
</span><span id="PriceGenerator-820"><a href="#PriceGenerator-820"><span class="linenos"> 820</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">upCandlesProb</span> <span class="o">=</span> <span class="mf">0.51</span> <span class="k">if</span> <span class="n">userProb</span> <span class="o">&lt;=</span> <span class="mf">0.5</span> <span class="k">else</span> <span class="n">userProb</span>
</span><span id="PriceGenerator-821"><a href="#PriceGenerator-821"><span class="linenos"> 821</span></a>
</span><span id="PriceGenerator-822"><a href="#PriceGenerator-822"><span class="linenos"> 822</span></a>                <span class="k">elif</span> <span class="n">trends</span><span class="p">[</span><span class="n">trendNum</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;down&quot;</span><span class="p">:</span>
</span><span id="PriceGenerator-823"><a href="#PriceGenerator-823"><span class="linenos"> 823</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">upCandlesProb</span> <span class="o">=</span> <span class="mf">0.49</span> <span class="k">if</span> <span class="n">userProb</span> <span class="o">&gt;=</span> <span class="mf">0.5</span> <span class="k">else</span> <span class="n">userProb</span>
</span><span id="PriceGenerator-824"><a href="#PriceGenerator-824"><span class="linenos"> 824</span></a>
</span><span id="PriceGenerator-825"><a href="#PriceGenerator-825"><span class="linenos"> 825</span></a>                <span class="k">elif</span> <span class="n">trends</span><span class="p">[</span><span class="n">trendNum</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;no&quot;</span><span class="p">:</span>
</span><span id="PriceGenerator-826"><a href="#PriceGenerator-826"><span class="linenos"> 826</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">upCandlesProb</span> <span class="o">=</span> <span class="mf">0.5</span>
</span><span id="PriceGenerator-827"><a href="#PriceGenerator-827"><span class="linenos"> 827</span></a>
</span><span id="PriceGenerator-828"><a href="#PriceGenerator-828"><span class="linenos"> 828</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="PriceGenerator-829"><a href="#PriceGenerator-829"><span class="linenos"> 829</span></a>                    <span class="n">uLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Unknown direction used: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trends</span><span class="p">[</span><span class="n">trendNum</span><span class="p">]))</span>
</span><span id="PriceGenerator-830"><a href="#PriceGenerator-830"><span class="linenos"> 830</span></a>
</span><span id="PriceGenerator-831"><a href="#PriceGenerator-831"><span class="linenos"> 831</span></a>                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unknown direction&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator-832"><a href="#PriceGenerator-832"><span class="linenos"> 832</span></a>
</span><span id="PriceGenerator-833"><a href="#PriceGenerator-833"><span class="linenos"> 833</span></a>                <span class="n">firstCandle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_GenNextCandle</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initClose</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">))</span>  <span class="c1"># first candle in next trend</span>
</span><span id="PriceGenerator-834"><a href="#PriceGenerator-834"><span class="linenos"> 834</span></a>                <span class="n">candles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">firstCandle</span><span class="p">)</span>
</span><span id="PriceGenerator-835"><a href="#PriceGenerator-835"><span class="linenos"> 835</span></a>
</span><span id="PriceGenerator-836"><a href="#PriceGenerator-836"><span class="linenos"> 836</span></a>                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span><span class="p">):</span>
</span><span id="PriceGenerator-837"><a href="#PriceGenerator-837"><span class="linenos"> 837</span></a>                    <span class="n">candles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_GenNextCandle</span><span class="p">(</span><span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;close&quot;</span><span class="p">]))</span>
</span><span id="PriceGenerator-838"><a href="#PriceGenerator-838"><span class="linenos"> 838</span></a>
</span><span id="PriceGenerator-839"><a href="#PriceGenerator-839"><span class="linenos"> 839</span></a>                <span class="n">highDelta</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;high&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="nb">max</span><span class="p">(</span><span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;open&quot;</span><span class="p">],</span> <span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;close&quot;</span><span class="p">]))</span>  <span class="c1"># save higher shadow</span>
</span><span id="PriceGenerator-840"><a href="#PriceGenerator-840"><span class="linenos"> 840</span></a>                <span class="n">lowDelta</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;open&quot;</span><span class="p">],</span> <span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;close&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;low&quot;</span><span class="p">])</span>  <span class="c1"># save lower shadow</span>
</span><span id="PriceGenerator-841"><a href="#PriceGenerator-841"><span class="linenos"> 841</span></a>
</span><span id="PriceGenerator-842"><a href="#PriceGenerator-842"><span class="linenos"> 842</span></a>                <span class="c1"># -- Change last candle in every trend:</span>
</span><span id="PriceGenerator-843"><a href="#PriceGenerator-843"><span class="linenos"> 843</span></a>                <span class="k">if</span> <span class="n">trends</span><span class="p">[</span><span class="n">trendNum</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;up&quot;</span><span class="p">:</span>
</span><span id="PriceGenerator-844"><a href="#PriceGenerator-844"><span class="linenos"> 844</span></a>                    <span class="k">if</span> <span class="n">firstCandle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;close&quot;</span><span class="p">]:</span>
</span><span id="PriceGenerator-845"><a href="#PriceGenerator-845"><span class="linenos"> 845</span></a>                        <span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">firstCandle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">],</span> <span class="n">b</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">maxClose</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)</span>
</span><span id="PriceGenerator-846"><a href="#PriceGenerator-846"><span class="linenos"> 846</span></a>
</span><span id="PriceGenerator-847"><a href="#PriceGenerator-847"><span class="linenos"> 847</span></a>                <span class="k">elif</span> <span class="n">trends</span><span class="p">[</span><span class="n">trendNum</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;down&quot;</span><span class="p">:</span>
</span><span id="PriceGenerator-848"><a href="#PriceGenerator-848"><span class="linenos"> 848</span></a>                    <span class="k">if</span> <span class="n">firstCandle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;close&quot;</span><span class="p">]:</span>
</span><span id="PriceGenerator-849"><a href="#PriceGenerator-849"><span class="linenos"> 849</span></a>                        <span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">minClose</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">firstCandle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)</span>
</span><span id="PriceGenerator-850"><a href="#PriceGenerator-850"><span class="linenos"> 850</span></a>
</span><span id="PriceGenerator-851"><a href="#PriceGenerator-851"><span class="linenos"> 851</span></a>                <span class="k">else</span><span class="p">:</span>  <span class="c1"># if NO trend:</span>
</span><span id="PriceGenerator-852"><a href="#PriceGenerator-852"><span class="linenos"> 852</span></a>                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">firstCandle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;close&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="n">firstCandle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendDeviation</span><span class="p">:</span>
</span><span id="PriceGenerator-853"><a href="#PriceGenerator-853"><span class="linenos"> 853</span></a>                        <span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span>
</span><span id="PriceGenerator-854"><a href="#PriceGenerator-854"><span class="linenos"> 854</span></a>                            <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
</span><span id="PriceGenerator-855"><a href="#PriceGenerator-855"><span class="linenos"> 855</span></a>                                <span class="n">a</span><span class="o">=</span><span class="n">firstCandle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">firstCandle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendDeviation</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="PriceGenerator-856"><a href="#PriceGenerator-856"><span class="linenos"> 856</span></a>                                <span class="n">b</span><span class="o">=</span><span class="n">firstCandle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">firstCandle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendDeviation</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="PriceGenerator-857"><a href="#PriceGenerator-857"><span class="linenos"> 857</span></a>                            <span class="p">),</span>
</span><span id="PriceGenerator-858"><a href="#PriceGenerator-858"><span class="linenos"> 858</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">,</span>
</span><span id="PriceGenerator-859"><a href="#PriceGenerator-859"><span class="linenos"> 859</span></a>                        <span class="p">)</span>
</span><span id="PriceGenerator-860"><a href="#PriceGenerator-860"><span class="linenos"> 860</span></a>
</span><span id="PriceGenerator-861"><a href="#PriceGenerator-861"><span class="linenos"> 861</span></a>                <span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;high&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;open&quot;</span><span class="p">],</span> <span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;close&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="n">highDelta</span>  <span class="c1"># fixing higher shadow</span>
</span><span id="PriceGenerator-862"><a href="#PriceGenerator-862"><span class="linenos"> 862</span></a>                <span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;low&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;open&quot;</span><span class="p">],</span> <span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;close&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="n">lowDelta</span>  <span class="c1"># fixing lower shadow</span>
</span><span id="PriceGenerator-863"><a href="#PriceGenerator-863"><span class="linenos"> 863</span></a>
</span><span id="PriceGenerator-864"><a href="#PriceGenerator-864"><span class="linenos"> 864</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">upCandlesProb</span> <span class="o">=</span> <span class="n">userProb</span>
</span><span id="PriceGenerator-865"><a href="#PriceGenerator-865"><span class="linenos"> 865</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span> <span class="o">=</span> <span class="n">userHorizon</span>
</span><span id="PriceGenerator-866"><a href="#PriceGenerator-866"><span class="linenos"> 866</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">initClose</span> <span class="o">=</span> <span class="n">userInitC</span>
</span><span id="PriceGenerator-867"><a href="#PriceGenerator-867"><span class="linenos"> 867</span></a>
</span><span id="PriceGenerator-868"><a href="#PriceGenerator-868"><span class="linenos"> 868</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PriceGenerator-869"><a href="#PriceGenerator-869"><span class="linenos"> 869</span></a>            <span class="n">candles</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_GenNextCandle</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initClose</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">))]</span>  <span class="c1"># first candle in chain</span>
</span><span id="PriceGenerator-870"><a href="#PriceGenerator-870"><span class="linenos"> 870</span></a>            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span><span class="p">):</span>
</span><span id="PriceGenerator-871"><a href="#PriceGenerator-871"><span class="linenos"> 871</span></a>                <span class="n">candles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_GenNextCandle</span><span class="p">(</span><span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;close&quot;</span><span class="p">]))</span>
</span><span id="PriceGenerator-872"><a href="#PriceGenerator-872"><span class="linenos"> 872</span></a>
</span><span id="PriceGenerator-873"><a href="#PriceGenerator-873"><span class="linenos"> 873</span></a>        <span class="c1"># prepare Dataframe from generated prices:</span>
</span><span id="PriceGenerator-874"><a href="#PriceGenerator-874"><span class="linenos"> 874</span></a>        <span class="n">indx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span>
</span><span id="PriceGenerator-875"><a href="#PriceGenerator-875"><span class="linenos"> 875</span></a>            <span class="n">start</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeStart</span><span class="p">,</span>
</span><span id="PriceGenerator-876"><a href="#PriceGenerator-876"><span class="linenos"> 876</span></a>            <span class="n">end</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeStart</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">horizon</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span><span class="p">,</span>
</span><span id="PriceGenerator-877"><a href="#PriceGenerator-877"><span class="linenos"> 877</span></a>            <span class="n">freq</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span><span class="p">,</span>
</span><span id="PriceGenerator-878"><a href="#PriceGenerator-878"><span class="linenos"> 878</span></a>            <span class="n">tz</span><span class="o">=</span><span class="n">tzlocal</span><span class="p">(),</span>
</span><span id="PriceGenerator-879"><a href="#PriceGenerator-879"><span class="linenos"> 879</span></a>        <span class="p">)</span>
</span><span id="PriceGenerator-880"><a href="#PriceGenerator-880"><span class="linenos"> 880</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">candles</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dfHeaders</span><span class="p">)</span>
</span><span id="PriceGenerator-881"><a href="#PriceGenerator-881"><span class="linenos"> 881</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span> <span class="o">=</span> <span class="n">indx</span>
</span><span id="PriceGenerator-882"><a href="#PriceGenerator-882"><span class="linenos"> 882</span></a>
</span><span id="PriceGenerator-883"><a href="#PriceGenerator-883"><span class="linenos"> 883</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Showing last 5 rows of Pandas generated dataframe object:&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator-884"><a href="#PriceGenerator-884"><span class="linenos"> 884</span></a>        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dfHeaders</span><span class="p">][</span><span class="o">-</span><span class="mi">5</span><span class="p">:],</span> <span class="n">max_cols</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
</span><span id="PriceGenerator-885"><a href="#PriceGenerator-885"><span class="linenos"> 885</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span><span id="PriceGenerator-886"><a href="#PriceGenerator-886"><span class="linenos"> 886</span></a>
</span><span id="PriceGenerator-887"><a href="#PriceGenerator-887"><span class="linenos"> 887</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span>
</span><span id="PriceGenerator-888"><a href="#PriceGenerator-888"><span class="linenos"> 888</span></a>
</span><span id="PriceGenerator-889"><a href="#PriceGenerator-889"><span class="linenos"> 889</span></a>    <span class="k">def</span> <span class="nf">RenderBokeh</span><span class="p">(</span>
</span><span id="PriceGenerator-890"><a href="#PriceGenerator-890"><span class="linenos"> 890</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;index.html&quot;</span><span class="p">,</span> <span class="n">viewInBrowser</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PriceGenerator-891"><a href="#PriceGenerator-891"><span class="linenos"> 891</span></a>            <span class="n">darkTheme</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">markers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">lines</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PriceGenerator-892"><a href="#PriceGenerator-892"><span class="linenos"> 892</span></a>            <span class="n">title</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1800</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">940</span><span class="p">,</span>
</span><span id="PriceGenerator-893"><a href="#PriceGenerator-893"><span class="linenos"> 893</span></a>            <span class="n">showControlsOnChart</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">showStatOnChart</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">inline</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PriceGenerator-894"><a href="#PriceGenerator-894"><span class="linenos"> 894</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">gridplot</span><span class="p">]:</span>
</span><span id="PriceGenerator-895"><a href="#PriceGenerator-895"><span class="linenos"> 895</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="PriceGenerator-896"><a href="#PriceGenerator-896"><span class="linenos"> 896</span></a><span class="sd">        Rendering prices from Pandas DataFrame as OHLCV Bokeh chart of candlesticks and save it to HTML-file.</span>
</span><span id="PriceGenerator-897"><a href="#PriceGenerator-897"><span class="linenos"> 897</span></a><span class="sd">        Pandas DataFrame in `prices` variable must contain &quot;datetime&quot;, &quot;open&quot;, &quot;high&quot;, &quot;low&quot;, &quot;close&quot; and &quot;volume&quot; columns.</span>
</span><span id="PriceGenerator-898"><a href="#PriceGenerator-898"><span class="linenos"> 898</span></a>
</span><span id="PriceGenerator-899"><a href="#PriceGenerator-899"><span class="linenos"> 899</span></a><span class="sd">        See also: https://docs.bokeh.org/en/latest/docs/gallery/candlestick.html</span>
</span><span id="PriceGenerator-900"><a href="#PriceGenerator-900"><span class="linenos"> 900</span></a>
</span><span id="PriceGenerator-901"><a href="#PriceGenerator-901"><span class="linenos"> 901</span></a><span class="sd">        :param fileName: HTML-file path to save Bokeh chart. `index.html` by default.</span>
</span><span id="PriceGenerator-902"><a href="#PriceGenerator-902"><span class="linenos"> 902</span></a><span class="sd">        :param viewInBrowser: If `True`, then immediately opens HTML chart in browser after rendering. `False` by default.</span>
</span><span id="PriceGenerator-903"><a href="#PriceGenerator-903"><span class="linenos"> 903</span></a><span class="sd">        :param darkTheme: chart theme. `False` by default, mean that will be used light theme, `False` mean dark theme.</span>
</span><span id="PriceGenerator-904"><a href="#PriceGenerator-904"><span class="linenos"> 904</span></a><span class="sd">        :param markers: Pandas DataFrame with additional markers that will be placed on main series. `None` by default.</span>
</span><span id="PriceGenerator-905"><a href="#PriceGenerator-905"><span class="linenos"> 905</span></a><span class="sd">                        Marker is a custom symbol, example: ×, ↓ or ↑. Dataframe with markers must contain at least two columns.</span>
</span><span id="PriceGenerator-906"><a href="#PriceGenerator-906"><span class="linenos"> 906</span></a><span class="sd">                        There are `datetime` with date and time and some markers columns (`markersUpper`, `markersCenter` or `markersLower`).</span>
</span><span id="PriceGenerator-907"><a href="#PriceGenerator-907"><span class="linenos"> 907</span></a><span class="sd">                        Length of markers series must be equal to the length of main candles series.</span>
</span><span id="PriceGenerator-908"><a href="#PriceGenerator-908"><span class="linenos"> 908</span></a><span class="sd">        :param lines: list with custom series, where additional chart-lines will place on main series. `None` by default.</span>
</span><span id="PriceGenerator-909"><a href="#PriceGenerator-909"><span class="linenos"> 909</span></a><span class="sd">                      Line data must contain at least two columns. There are `datetime` with date and time and</span>
</span><span id="PriceGenerator-910"><a href="#PriceGenerator-910"><span class="linenos"> 910</span></a><span class="sd">                      `custom_line_name` with y-coordinates. Length of the chart-line dataframes must be equal to the length of main candle series.</span>
</span><span id="PriceGenerator-911"><a href="#PriceGenerator-911"><span class="linenos"> 911</span></a><span class="sd">        :param title: specific chart title. If `None`, then used auto-generated title. `None` by default.</span>
</span><span id="PriceGenerator-912"><a href="#PriceGenerator-912"><span class="linenos"> 912</span></a><span class="sd">        :param width: chart width. If `None`, then used auto-width. 1800 px by default.</span>
</span><span id="PriceGenerator-913"><a href="#PriceGenerator-913"><span class="linenos"> 913</span></a><span class="sd">        :param height: chart height. If `None`, then used auto-height. 940 px by default.</span>
</span><span id="PriceGenerator-914"><a href="#PriceGenerator-914"><span class="linenos"> 914</span></a><span class="sd">        :param showControlsOnChart: enable controls block in legend to hide/show some elements on chart, `True` by default.</span>
</span><span id="PriceGenerator-915"><a href="#PriceGenerator-915"><span class="linenos"> 915</span></a><span class="sd">        :param showStatOnChart: show statistics block on chart, `True` (by default) mean that will be calculating additional</span>
</span><span id="PriceGenerator-916"><a href="#PriceGenerator-916"><span class="linenos"> 916</span></a><span class="sd">                                series, like as Trend and Average Points. And some classical indicators, like as SMA, HMA,</span>
</span><span id="PriceGenerator-917"><a href="#PriceGenerator-917"><span class="linenos"> 917</span></a><span class="sd">                                VWMA, Bollinger Bands, Parabolic Stop and Reverse, Alligator and Zig-Zag indicator.</span>
</span><span id="PriceGenerator-918"><a href="#PriceGenerator-918"><span class="linenos"> 918</span></a><span class="sd">                                Warning! Calculate statistic takes more time. If you want to decrease chart rendering time,</span>
</span><span id="PriceGenerator-919"><a href="#PriceGenerator-919"><span class="linenos"> 919</span></a><span class="sd">                                then set this parameter to `False`.</span>
</span><span id="PriceGenerator-920"><a href="#PriceGenerator-920"><span class="linenos"> 920</span></a><span class="sd">        :param inline: if `True`, then output chart in Jupyter Notebook cell. `False` by default.</span>
</span><span id="PriceGenerator-921"><a href="#PriceGenerator-921"><span class="linenos"> 921</span></a><span class="sd">        :return: bokeh.layouts.gridplot with all layouts objects or None.</span>
</span><span id="PriceGenerator-922"><a href="#PriceGenerator-922"><span class="linenos"> 922</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PriceGenerator-923"><a href="#PriceGenerator-923"><span class="linenos"> 923</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="PriceGenerator-924"><a href="#PriceGenerator-924"><span class="linenos"> 924</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Empty price data! Generate or load prices before show as Bokeh chart!&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator-925"><a href="#PriceGenerator-925"><span class="linenos"> 925</span></a>
</span><span id="PriceGenerator-926"><a href="#PriceGenerator-926"><span class="linenos"> 926</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PriceGenerator-927"><a href="#PriceGenerator-927"><span class="linenos"> 927</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Rendering Pandas DataFrame as Bokeh chart...&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator-928"><a href="#PriceGenerator-928"><span class="linenos"> 928</span></a>
</span><span id="PriceGenerator-929"><a href="#PriceGenerator-929"><span class="linenos"> 929</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">DetectTimeframe</span><span class="p">()</span>  <span class="c1"># auto-detect time delta between last two neighbour candles</span>
</span><span id="PriceGenerator-930"><a href="#PriceGenerator-930"><span class="linenos"> 930</span></a>            <span class="n">infoBlock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetStatistics</span><span class="p">()</span> <span class="k">if</span> <span class="n">showStatOnChart</span> <span class="k">else</span> <span class="p">[]</span>  <span class="c1"># calculating some indicators</span>
</span><span id="PriceGenerator-931"><a href="#PriceGenerator-931"><span class="linenos"> 931</span></a>
</span><span id="PriceGenerator-932"><a href="#PriceGenerator-932"><span class="linenos"> 932</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chartTitle</span> <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">title</span> <span class="k">else</span> <span class="n">title</span>  <span class="c1"># chart title</span>
</span><span id="PriceGenerator-933"><a href="#PriceGenerator-933"><span class="linenos"> 933</span></a>            <span class="n">width</span> <span class="o">=</span> <span class="mi">1200</span> <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">width</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">width</span>  <span class="c1"># chart summary width</span>
</span><span id="PriceGenerator-934"><a href="#PriceGenerator-934"><span class="linenos"> 934</span></a>            <span class="n">height</span> <span class="o">=</span> <span class="mi">800</span> <span class="k">if</span> <span class="n">height</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">height</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">height</span> <span class="o">-</span> <span class="mi">90</span>  <span class="c1"># chart summary height</span>
</span><span id="PriceGenerator-935"><a href="#PriceGenerator-935"><span class="linenos"> 935</span></a>
</span><span id="PriceGenerator-936"><a href="#PriceGenerator-936"><span class="linenos"> 936</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Preparing Bokeh chart configuration...&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator-937"><a href="#PriceGenerator-937"><span class="linenos"> 937</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Title: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">title</span><span class="p">))</span>
</span><span id="PriceGenerator-938"><a href="#PriceGenerator-938"><span class="linenos"> 938</span></a>
</span><span id="PriceGenerator-939"><a href="#PriceGenerator-939"><span class="linenos"> 939</span></a>            <span class="k">if</span> <span class="n">inline</span><span class="p">:</span>
</span><span id="PriceGenerator-940"><a href="#PriceGenerator-940"><span class="linenos"> 940</span></a>                <span class="n">output_notebook</span><span class="p">(</span><span class="n">resources</span><span class="o">=</span><span class="n">INLINE</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">hide_banner</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># set output to notebook cell</span>
</span><span id="PriceGenerator-941"><a href="#PriceGenerator-941"><span class="linenos"> 941</span></a>
</span><span id="PriceGenerator-942"><a href="#PriceGenerator-942"><span class="linenos"> 942</span></a>            <span class="c1"># --- Preparing Main chart:</span>
</span><span id="PriceGenerator-943"><a href="#PriceGenerator-943"><span class="linenos"> 943</span></a>            <span class="n">chart</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span>
</span><span id="PriceGenerator-944"><a href="#PriceGenerator-944"><span class="linenos"> 944</span></a>                <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
</span><span id="PriceGenerator-945"><a href="#PriceGenerator-945"><span class="linenos"> 945</span></a>                <span class="n">x_axis_type</span><span class="o">=</span><span class="s2">&quot;datetime&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-946"><a href="#PriceGenerator-946"><span class="linenos"> 946</span></a>                <span class="n">x_axis_label</span><span class="o">=</span><span class="s2">&quot;Date and time&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-947"><a href="#PriceGenerator-947"><span class="linenos"> 947</span></a>                <span class="n">y_axis_label</span><span class="o">=</span><span class="s2">&quot;Price&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-948"><a href="#PriceGenerator-948"><span class="linenos"> 948</span></a>                <span class="n">outline_line_width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
</span><span id="PriceGenerator-949"><a href="#PriceGenerator-949"><span class="linenos"> 949</span></a>                <span class="n">outline_line_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-950"><a href="#PriceGenerator-950"><span class="linenos"> 950</span></a>                <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pan&quot;</span><span class="p">,</span> <span class="s2">&quot;wheel_zoom&quot;</span><span class="p">,</span> <span class="s2">&quot;box_zoom&quot;</span><span class="p">,</span> <span class="s2">&quot;hover&quot;</span><span class="p">,</span> <span class="s2">&quot;reset&quot;</span><span class="p">,</span> <span class="s2">&quot;save&quot;</span><span class="p">],</span>
</span><span id="PriceGenerator-951"><a href="#PriceGenerator-951"><span class="linenos"> 951</span></a>                <span class="n">toolbar_location</span><span class="o">=</span><span class="s2">&quot;above&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-952"><a href="#PriceGenerator-952"><span class="linenos"> 952</span></a>                <span class="n">active_scroll</span><span class="o">=</span><span class="s2">&quot;wheel_zoom&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-953"><a href="#PriceGenerator-953"><span class="linenos"> 953</span></a>                <span class="n">min_width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
</span><span id="PriceGenerator-954"><a href="#PriceGenerator-954"><span class="linenos"> 954</span></a>                <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
</span><span id="PriceGenerator-955"><a href="#PriceGenerator-955"><span class="linenos"> 955</span></a>                <span class="n">sizing_mode</span><span class="o">=</span><span class="s2">&quot;scale_width&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-956"><a href="#PriceGenerator-956"><span class="linenos"> 956</span></a>                <span class="n">background_fill_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-957"><a href="#PriceGenerator-957"><span class="linenos"> 957</span></a>                <span class="n">min_border_left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="PriceGenerator-958"><a href="#PriceGenerator-958"><span class="linenos"> 958</span></a>                <span class="n">min_border_right</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="PriceGenerator-959"><a href="#PriceGenerator-959"><span class="linenos"> 959</span></a>                <span class="n">min_border_top</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="PriceGenerator-960"><a href="#PriceGenerator-960"><span class="linenos"> 960</span></a>                <span class="n">min_border_bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="PriceGenerator-961"><a href="#PriceGenerator-961"><span class="linenos"> 961</span></a>                <span class="n">y_range</span><span class="o">=</span><span class="n">Range1d</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">low</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">high</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span><span class="p">),</span>
</span><span id="PriceGenerator-962"><a href="#PriceGenerator-962"><span class="linenos"> 962</span></a>            <span class="p">)</span>
</span><span id="PriceGenerator-963"><a href="#PriceGenerator-963"><span class="linenos"> 963</span></a>            <span class="n">chart</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">logo</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># remove bokeh logo and link to https://bokeh.org/</span>
</span><span id="PriceGenerator-964"><a href="#PriceGenerator-964"><span class="linenos"> 964</span></a>            <span class="n">chart</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">major_label_orientation</span> <span class="o">=</span> <span class="n">pi</span> <span class="o">/</span> <span class="mi">6</span>
</span><span id="PriceGenerator-965"><a href="#PriceGenerator-965"><span class="linenos"> 965</span></a>            <span class="n">chart</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">grid_line_dash</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</span><span id="PriceGenerator-966"><a href="#PriceGenerator-966"><span class="linenos"> 966</span></a>            <span class="n">chart</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">grid_line_alpha</span> <span class="o">=</span> <span class="mf">0.4</span>
</span><span id="PriceGenerator-967"><a href="#PriceGenerator-967"><span class="linenos"> 967</span></a>            <span class="n">chart</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">minor_grid_line_dash</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</span><span id="PriceGenerator-968"><a href="#PriceGenerator-968"><span class="linenos"> 968</span></a>            <span class="n">chart</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">minor_grid_line_alpha</span> <span class="o">=</span> <span class="mf">0.4</span>
</span><span id="PriceGenerator-969"><a href="#PriceGenerator-969"><span class="linenos"> 969</span></a>            <span class="n">chart</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">minor_grid_line_dash</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</span><span id="PriceGenerator-970"><a href="#PriceGenerator-970"><span class="linenos"> 970</span></a>            <span class="n">chart</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">minor_grid_line_alpha</span> <span class="o">=</span> <span class="mf">0.3</span>
</span><span id="PriceGenerator-971"><a href="#PriceGenerator-971"><span class="linenos"> 971</span></a>            <span class="n">chart</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">minor_grid_line_color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;gray&quot;</span>
</span><span id="PriceGenerator-972"><a href="#PriceGenerator-972"><span class="linenos"> 972</span></a>            <span class="n">chart</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">minor_grid_line_dash</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</span><span id="PriceGenerator-973"><a href="#PriceGenerator-973"><span class="linenos"> 973</span></a>            <span class="n">chart</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">minor_grid_line_alpha</span> <span class="o">=</span> <span class="mf">0.3</span>
</span><span id="PriceGenerator-974"><a href="#PriceGenerator-974"><span class="linenos"> 974</span></a>            <span class="n">chart</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">minor_grid_line_color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;gray&quot;</span>
</span><span id="PriceGenerator-975"><a href="#PriceGenerator-975"><span class="linenos"> 975</span></a>
</span><span id="PriceGenerator-976"><a href="#PriceGenerator-976"><span class="linenos"> 976</span></a>            <span class="k">if</span> <span class="n">showStatOnChart</span><span class="p">:</span>
</span><span id="PriceGenerator-977"><a href="#PriceGenerator-977"><span class="linenos"> 977</span></a>                <span class="n">summaryItems</span> <span class="o">=</span> <span class="p">[(</span><span class="n">info</span><span class="p">,</span> <span class="p">[])</span> <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">infoBlock</span><span class="p">]</span>
</span><span id="PriceGenerator-978"><a href="#PriceGenerator-978"><span class="linenos"> 978</span></a>                <span class="k">if</span> <span class="n">showControlsOnChart</span><span class="p">:</span>
</span><span id="PriceGenerator-979"><a href="#PriceGenerator-979"><span class="linenos"> 979</span></a>                    <span class="n">summaryItems</span> <span class="o">+=</span> <span class="p">[(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="p">[]),</span> <span class="p">(</span><span class="s2">&quot;Click to show/hide on chart:&quot;</span><span class="p">,</span> <span class="p">[])]</span>
</span><span id="PriceGenerator-980"><a href="#PriceGenerator-980"><span class="linenos"> 980</span></a>
</span><span id="PriceGenerator-981"><a href="#PriceGenerator-981"><span class="linenos"> 981</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PriceGenerator-982"><a href="#PriceGenerator-982"><span class="linenos"> 982</span></a>                <span class="n">summaryItems</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;Click to show/hide on chart:&quot;</span><span class="p">,</span> <span class="p">[])]</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="p">[(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="p">[])]</span>
</span><span id="PriceGenerator-983"><a href="#PriceGenerator-983"><span class="linenos"> 983</span></a>
</span><span id="PriceGenerator-984"><a href="#PriceGenerator-984"><span class="linenos"> 984</span></a>            <span class="n">summaryInfo</span> <span class="o">=</span> <span class="n">Legend</span><span class="p">(</span>
</span><span id="PriceGenerator-985"><a href="#PriceGenerator-985"><span class="linenos"> 985</span></a>                <span class="n">click_policy</span><span class="o">=</span><span class="s2">&quot;hide&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-986"><a href="#PriceGenerator-986"><span class="linenos"> 986</span></a>                <span class="n">items</span><span class="o">=</span><span class="n">summaryItems</span><span class="p">,</span>
</span><span id="PriceGenerator-987"><a href="#PriceGenerator-987"><span class="linenos"> 987</span></a>                <span class="n">location</span><span class="o">=</span><span class="s2">&quot;top_right&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-988"><a href="#PriceGenerator-988"><span class="linenos"> 988</span></a>                <span class="n">label_text_font_size</span><span class="o">=</span><span class="s2">&quot;8pt&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-989"><a href="#PriceGenerator-989"><span class="linenos"> 989</span></a>                <span class="n">margin</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
</span><span id="PriceGenerator-990"><a href="#PriceGenerator-990"><span class="linenos"> 990</span></a>                <span class="n">padding</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="PriceGenerator-991"><a href="#PriceGenerator-991"><span class="linenos"> 991</span></a>                <span class="n">spacing</span><span class="o">=-</span><span class="mi">5</span><span class="p">,</span>
</span><span id="PriceGenerator-992"><a href="#PriceGenerator-992"><span class="linenos"> 992</span></a>                <span class="n">label_text_font</span><span class="o">=</span><span class="s2">&quot;Lucida Console&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-993"><a href="#PriceGenerator-993"><span class="linenos"> 993</span></a>            <span class="p">)</span>
</span><span id="PriceGenerator-994"><a href="#PriceGenerator-994"><span class="linenos"> 994</span></a>            <span class="n">chart</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">summaryInfo</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator-995"><a href="#PriceGenerator-995"><span class="linenos"> 995</span></a>
</span><span id="PriceGenerator-996"><a href="#PriceGenerator-996"><span class="linenos"> 996</span></a>            <span class="c1"># preparing data for candles:</span>
</span><span id="PriceGenerator-997"><a href="#PriceGenerator-997"><span class="linenos"> 997</span></a>            <span class="n">inc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">open</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span>
</span><span id="PriceGenerator-998"><a href="#PriceGenerator-998"><span class="linenos"> 998</span></a>            <span class="n">dec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">open</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span>
</span><span id="PriceGenerator-999"><a href="#PriceGenerator-999"><span class="linenos"> 999</span></a>            <span class="n">candleWidth</span> <span class="o">=</span> <span class="mi">108000</span>  <span class="c1"># as for 5 minutes by default</span>
</span><span id="PriceGenerator-1000"><a href="#PriceGenerator-1000"><span class="linenos">1000</span></a>
</span><span id="PriceGenerator-1001"><a href="#PriceGenerator-1001"><span class="linenos">1001</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span> <span class="o">&lt;=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">31</span><span class="p">):</span>
</span><span id="PriceGenerator-1002"><a href="#PriceGenerator-1002"><span class="linenos">1002</span></a>                <span class="n">candleWidth</span> <span class="o">=</span> <span class="mi">864000000</span>  <span class="c1"># 12 * 60 * 60 * 25 * 800  # for 43200 minutes</span>
</span><span id="PriceGenerator-1003"><a href="#PriceGenerator-1003"><span class="linenos">1003</span></a>
</span><span id="PriceGenerator-1004"><a href="#PriceGenerator-1004"><span class="linenos">1004</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span> <span class="o">&lt;=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">):</span>
</span><span id="PriceGenerator-1005"><a href="#PriceGenerator-1005"><span class="linenos">1005</span></a>                <span class="n">candleWidth</span> <span class="o">=</span> <span class="mi">216000000</span>  <span class="c1"># 12 * 60 * 60 * 25 * 200  # for 10080 minutes</span>
</span><span id="PriceGenerator-1006"><a href="#PriceGenerator-1006"><span class="linenos">1006</span></a>
</span><span id="PriceGenerator-1007"><a href="#PriceGenerator-1007"><span class="linenos">1007</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span> <span class="o">&lt;=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
</span><span id="PriceGenerator-1008"><a href="#PriceGenerator-1008"><span class="linenos">1008</span></a>                <span class="n">candleWidth</span> <span class="o">=</span> <span class="mi">32400000</span>  <span class="c1"># 12 * 60 * 60 * 25 * 30  # for 1440 minutes</span>
</span><span id="PriceGenerator-1009"><a href="#PriceGenerator-1009"><span class="linenos">1009</span></a>
</span><span id="PriceGenerator-1010"><a href="#PriceGenerator-1010"><span class="linenos">1010</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span> <span class="o">&lt;=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
</span><span id="PriceGenerator-1011"><a href="#PriceGenerator-1011"><span class="linenos">1011</span></a>                <span class="n">candleWidth</span> <span class="o">=</span> <span class="mi">6480000</span>  <span class="c1"># 12 * 60 * 60 * 25 * 6  # for 240 minutes</span>
</span><span id="PriceGenerator-1012"><a href="#PriceGenerator-1012"><span class="linenos">1012</span></a>
</span><span id="PriceGenerator-1013"><a href="#PriceGenerator-1013"><span class="linenos">1013</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span> <span class="o">&lt;=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
</span><span id="PriceGenerator-1014"><a href="#PriceGenerator-1014"><span class="linenos">1014</span></a>                <span class="n">candleWidth</span> <span class="o">=</span> <span class="mi">1620000</span>  <span class="c1"># 12 * 60 * 60 * 25 * 1.5  # for 60 minutes</span>
</span><span id="PriceGenerator-1015"><a href="#PriceGenerator-1015"><span class="linenos">1015</span></a>
</span><span id="PriceGenerator-1016"><a href="#PriceGenerator-1016"><span class="linenos">1016</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span> <span class="o">&lt;=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>
</span><span id="PriceGenerator-1017"><a href="#PriceGenerator-1017"><span class="linenos">1017</span></a>                <span class="n">candleWidth</span> <span class="o">=</span> <span class="mi">648000</span>  <span class="c1"># 12 * 60 * 60 * 15  # for 30 minutes</span>
</span><span id="PriceGenerator-1018"><a href="#PriceGenerator-1018"><span class="linenos">1018</span></a>
</span><span id="PriceGenerator-1019"><a href="#PriceGenerator-1019"><span class="linenos">1019</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span> <span class="o">&lt;=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">15</span><span class="p">):</span>
</span><span id="PriceGenerator-1020"><a href="#PriceGenerator-1020"><span class="linenos">1020</span></a>                <span class="n">candleWidth</span> <span class="o">=</span> <span class="mi">345600</span>  <span class="c1"># 12 * 60 * 60 * 8  # for 15 minutes</span>
</span><span id="PriceGenerator-1021"><a href="#PriceGenerator-1021"><span class="linenos">1021</span></a>
</span><span id="PriceGenerator-1022"><a href="#PriceGenerator-1022"><span class="linenos">1022</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span> <span class="o">&lt;=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
</span><span id="PriceGenerator-1023"><a href="#PriceGenerator-1023"><span class="linenos">1023</span></a>                <span class="n">candleWidth</span> <span class="o">=</span> <span class="mi">108000</span>  <span class="c1"># 12 * 60 * 60 * 2.5  # for 5 minutes</span>
</span><span id="PriceGenerator-1024"><a href="#PriceGenerator-1024"><span class="linenos">1024</span></a>
</span><span id="PriceGenerator-1025"><a href="#PriceGenerator-1025"><span class="linenos">1025</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span> <span class="o">&lt;=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
</span><span id="PriceGenerator-1026"><a href="#PriceGenerator-1026"><span class="linenos">1026</span></a>                <span class="n">candleWidth</span> <span class="o">=</span> <span class="mi">21600</span>  <span class="c1"># 12 * 60 * 30   # for 1 minute</span>
</span><span id="PriceGenerator-1027"><a href="#PriceGenerator-1027"><span class="linenos">1027</span></a>
</span><span id="PriceGenerator-1028"><a href="#PriceGenerator-1028"><span class="linenos">1028</span></a>            <span class="n">disabledObjects</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># bokeh objects to hide by default when page is loaded</span>
</span><span id="PriceGenerator-1029"><a href="#PriceGenerator-1029"><span class="linenos">1029</span></a>
</span><span id="PriceGenerator-1030"><a href="#PriceGenerator-1030"><span class="linenos">1030</span></a>            <span class="c1"># preparing data for hover tooltips:</span>
</span><span id="PriceGenerator-1031"><a href="#PriceGenerator-1031"><span class="linenos">1031</span></a>            <span class="n">source</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="PriceGenerator-1032"><a href="#PriceGenerator-1032"><span class="linenos">1032</span></a>                <span class="s2">&quot;candle&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span>
</span><span id="PriceGenerator-1033"><a href="#PriceGenerator-1033"><span class="linenos">1033</span></a>                <span class="s2">&quot;datetime&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
</span><span id="PriceGenerator-1034"><a href="#PriceGenerator-1034"><span class="linenos">1034</span></a>                <span class="s2">&quot;open&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">open</span><span class="p">,</span>
</span><span id="PriceGenerator-1035"><a href="#PriceGenerator-1035"><span class="linenos">1035</span></a>                <span class="s2">&quot;high&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">high</span><span class="p">,</span>
</span><span id="PriceGenerator-1036"><a href="#PriceGenerator-1036"><span class="linenos">1036</span></a>                <span class="s2">&quot;low&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">low</span><span class="p">,</span>
</span><span id="PriceGenerator-1037"><a href="#PriceGenerator-1037"><span class="linenos">1037</span></a>                <span class="s2">&quot;close&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">,</span>
</span><span id="PriceGenerator-1038"><a href="#PriceGenerator-1038"><span class="linenos">1038</span></a>                <span class="s2">&quot;volume&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">volume</span><span class="p">,</span>
</span><span id="PriceGenerator-1039"><a href="#PriceGenerator-1039"><span class="linenos">1039</span></a>            <span class="p">}</span>
</span><span id="PriceGenerator-1040"><a href="#PriceGenerator-1040"><span class="linenos">1040</span></a>            <span class="n">hoverData</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">source</span><span class="p">)</span>
</span><span id="PriceGenerator-1041"><a href="#PriceGenerator-1041"><span class="linenos">1041</span></a>            <span class="n">hover</span> <span class="o">=</span> <span class="n">chart</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">HoverTool</span><span class="p">))</span>
</span><span id="PriceGenerator-1042"><a href="#PriceGenerator-1042"><span class="linenos">1042</span></a>            <span class="n">hover</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;candle&quot;</span>
</span><span id="PriceGenerator-1043"><a href="#PriceGenerator-1043"><span class="linenos">1043</span></a>            <span class="n">hover</span><span class="o">.</span><span class="n">tooltips</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="PriceGenerator-1044"><a href="#PriceGenerator-1044"><span class="linenos">1044</span></a>                <span class="p">(</span><span class="s2">&quot;Candle&quot;</span><span class="p">,</span> <span class="s2">&quot;@candle&quot;</span><span class="p">),</span>
</span><span id="PriceGenerator-1045"><a href="#PriceGenerator-1045"><span class="linenos">1045</span></a>                <span class="p">(</span><span class="s2">&quot;Date&quot;</span><span class="p">,</span> <span class="s2">&quot;@datetime{%Y-%m-</span><span class="si">%d</span><span class="s2">}&quot;</span><span class="p">),</span>
</span><span id="PriceGenerator-1046"><a href="#PriceGenerator-1046"><span class="linenos">1046</span></a>                <span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">,</span> <span class="s2">&quot;@datetime{%H:%M:%S}&quot;</span><span class="p">),</span>
</span><span id="PriceGenerator-1047"><a href="#PriceGenerator-1047"><span class="linenos">1047</span></a>                <span class="p">(</span><span class="s2">&quot;Open&quot;</span><span class="p">,</span> <span class="s2">&quot;@open</span><span class="si">{0.0000}</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="PriceGenerator-1048"><a href="#PriceGenerator-1048"><span class="linenos">1048</span></a>                <span class="p">(</span><span class="s2">&quot;High&quot;</span><span class="p">,</span> <span class="s2">&quot;@high</span><span class="si">{0.0000}</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="PriceGenerator-1049"><a href="#PriceGenerator-1049"><span class="linenos">1049</span></a>                <span class="p">(</span><span class="s2">&quot;Low&quot;</span><span class="p">,</span> <span class="s2">&quot;@low</span><span class="si">{0.0000}</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="PriceGenerator-1050"><a href="#PriceGenerator-1050"><span class="linenos">1050</span></a>                <span class="p">(</span><span class="s2">&quot;Close&quot;</span><span class="p">,</span> <span class="s2">&quot;@close</span><span class="si">{0.0000}</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="PriceGenerator-1051"><a href="#PriceGenerator-1051"><span class="linenos">1051</span></a>                <span class="p">(</span><span class="s2">&quot;Volume&quot;</span><span class="p">,</span> <span class="s2">&quot;@volume&quot;</span><span class="p">),</span>
</span><span id="PriceGenerator-1052"><a href="#PriceGenerator-1052"><span class="linenos">1052</span></a>            <span class="p">]</span>
</span><span id="PriceGenerator-1053"><a href="#PriceGenerator-1053"><span class="linenos">1053</span></a>            <span class="n">hover</span><span class="o">.</span><span class="n">formatters</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="PriceGenerator-1054"><a href="#PriceGenerator-1054"><span class="linenos">1054</span></a>                <span class="s2">&quot;@datetime&quot;</span><span class="p">:</span> <span class="s2">&quot;datetime&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1055"><a href="#PriceGenerator-1055"><span class="linenos">1055</span></a>                <span class="s2">&quot;@open&quot;</span><span class="p">:</span> <span class="s2">&quot;numeral&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1056"><a href="#PriceGenerator-1056"><span class="linenos">1056</span></a>                <span class="s2">&quot;@high&quot;</span><span class="p">:</span> <span class="s2">&quot;numeral&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1057"><a href="#PriceGenerator-1057"><span class="linenos">1057</span></a>                <span class="s2">&quot;@low&quot;</span><span class="p">:</span> <span class="s2">&quot;numeral&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1058"><a href="#PriceGenerator-1058"><span class="linenos">1058</span></a>                <span class="s2">&quot;@close&quot;</span><span class="p">:</span> <span class="s2">&quot;numeral&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1059"><a href="#PriceGenerator-1059"><span class="linenos">1059</span></a>            <span class="p">}</span>
</span><span id="PriceGenerator-1060"><a href="#PriceGenerator-1060"><span class="linenos">1060</span></a>            <span class="n">hover</span><span class="o">.</span><span class="n">point_policy</span> <span class="o">=</span> <span class="s2">&quot;snap_to_data&quot;</span>
</span><span id="PriceGenerator-1061"><a href="#PriceGenerator-1061"><span class="linenos">1061</span></a>            <span class="n">hover</span><span class="o">.</span><span class="n">line_policy</span> <span class="o">=</span> <span class="s2">&quot;nearest&quot;</span>
</span><span id="PriceGenerator-1062"><a href="#PriceGenerator-1062"><span class="linenos">1062</span></a>            <span class="n">hover</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;vline&quot;</span>
</span><span id="PriceGenerator-1063"><a href="#PriceGenerator-1063"><span class="linenos">1063</span></a>
</span><span id="PriceGenerator-1064"><a href="#PriceGenerator-1064"><span class="linenos">1064</span></a>            <span class="c1"># --- preparing body of candles:</span>
</span><span id="PriceGenerator-1065"><a href="#PriceGenerator-1065"><span class="linenos">1065</span></a>            <span class="n">hoverOnCandles</span> <span class="o">=</span> <span class="n">chart</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span>
</span><span id="PriceGenerator-1066"><a href="#PriceGenerator-1066"><span class="linenos">1066</span></a>                <span class="n">x0</span><span class="o">=</span><span class="s2">&quot;datetime&quot;</span><span class="p">,</span> <span class="n">y0</span><span class="o">=</span><span class="s2">&quot;high&quot;</span><span class="p">,</span> <span class="n">x1</span><span class="o">=</span><span class="s2">&quot;datetime&quot;</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="s2">&quot;low&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1067"><a href="#PriceGenerator-1067"><span class="linenos">1067</span></a>                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#20ff00&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1068"><a href="#PriceGenerator-1068"><span class="linenos">1068</span></a>                <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;candle&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">hoverData</span><span class="p">,</span>
</span><span id="PriceGenerator-1069"><a href="#PriceGenerator-1069"><span class="linenos">1069</span></a>            <span class="p">)</span>
</span><span id="PriceGenerator-1070"><a href="#PriceGenerator-1070"><span class="linenos">1070</span></a>            <span class="n">hover</span><span class="o">.</span><span class="n">renderers</span> <span class="o">=</span> <span class="p">[</span><span class="n">hoverOnCandles</span><span class="p">]</span>  <span class="c1"># hover on only for candle bodies</span>
</span><span id="PriceGenerator-1071"><a href="#PriceGenerator-1071"><span class="linenos">1071</span></a>            <span class="n">chart</span><span class="o">.</span><span class="n">vbar</span><span class="p">(</span>
</span><span id="PriceGenerator-1072"><a href="#PriceGenerator-1072"><span class="linenos">1072</span></a>                <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">[</span><span class="n">inc</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="n">candleWidth</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">open</span><span class="p">[</span><span class="n">inc</span><span class="p">],</span> <span class="n">top</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">[</span><span class="n">inc</span><span class="p">],</span>
</span><span id="PriceGenerator-1073"><a href="#PriceGenerator-1073"><span class="linenos">1073</span></a>                <span class="n">fill_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#20ff00&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1074"><a href="#PriceGenerator-1074"><span class="linenos">1074</span></a>                <span class="n">line_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fill_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator-1075"><a href="#PriceGenerator-1075"><span class="linenos">1075</span></a>            <span class="p">)</span>
</span><span id="PriceGenerator-1076"><a href="#PriceGenerator-1076"><span class="linenos">1076</span></a>            <span class="n">chart</span><span class="o">.</span><span class="n">vbar</span><span class="p">(</span>
</span><span id="PriceGenerator-1077"><a href="#PriceGenerator-1077"><span class="linenos">1077</span></a>                <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">[</span><span class="n">dec</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="n">candleWidth</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">open</span><span class="p">[</span><span class="n">dec</span><span class="p">],</span> <span class="n">top</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">[</span><span class="n">dec</span><span class="p">],</span>
</span><span id="PriceGenerator-1078"><a href="#PriceGenerator-1078"><span class="linenos">1078</span></a>                <span class="n">fill_color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#999999&quot;</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#20ff00&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1079"><a href="#PriceGenerator-1079"><span class="linenos">1079</span></a>                <span class="n">line_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fill_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator-1080"><a href="#PriceGenerator-1080"><span class="linenos">1080</span></a>            <span class="p">)</span>
</span><span id="PriceGenerator-1081"><a href="#PriceGenerator-1081"><span class="linenos">1081</span></a>
</span><span id="PriceGenerator-1082"><a href="#PriceGenerator-1082"><span class="linenos">1082</span></a>            <span class="k">if</span> <span class="n">showStatOnChart</span><span class="p">:</span>
</span><span id="PriceGenerator-1083"><a href="#PriceGenerator-1083"><span class="linenos">1083</span></a>                <span class="c1"># Summary section and controls:</span>
</span><span id="PriceGenerator-1084"><a href="#PriceGenerator-1084"><span class="linenos">1084</span></a>                <span class="n">legendNameMain</span> <span class="o">=</span> <span class="s2">&quot;Max close / Min close / Trend line&quot;</span>
</span><span id="PriceGenerator-1085"><a href="#PriceGenerator-1085"><span class="linenos">1085</span></a>                <span class="n">legendNameAvg</span> <span class="o">=</span> <span class="s2">&quot;Averages points (highs - deltas/2)&quot;</span>
</span><span id="PriceGenerator-1086"><a href="#PriceGenerator-1086"><span class="linenos">1086</span></a>                <span class="n">legendNameSMA</span> <span class="o">=</span> <span class="s2">&quot;Simple Moving Averages (SMA: 5, 20)&quot;</span>
</span><span id="PriceGenerator-1087"><a href="#PriceGenerator-1087"><span class="linenos">1087</span></a>                <span class="n">legendNameSMAlong</span> <span class="o">=</span> <span class="s2">&quot;Long Simple Moving Averages (SMA: 50, 200)&quot;</span>
</span><span id="PriceGenerator-1088"><a href="#PriceGenerator-1088"><span class="linenos">1088</span></a>                <span class="n">legendNameHMA</span> <span class="o">=</span> <span class="s2">&quot;Hull Moving Averages (HMA: 5, 20)&quot;</span>
</span><span id="PriceGenerator-1089"><a href="#PriceGenerator-1089"><span class="linenos">1089</span></a>                <span class="n">legendNameVWMA</span> <span class="o">=</span> <span class="s2">&quot;Volume Weighted Moving Averages (VWMA: 5, 20)&quot;</span>
</span><span id="PriceGenerator-1090"><a href="#PriceGenerator-1090"><span class="linenos">1090</span></a>                <span class="n">legendNameBBANDS</span> <span class="o">=</span> <span class="s2">&quot;Bollinger Bands (BBands)&quot;</span>
</span><span id="PriceGenerator-1091"><a href="#PriceGenerator-1091"><span class="linenos">1091</span></a>                <span class="n">legendNamePsar</span> <span class="o">=</span> <span class="s2">&quot;Parabolic Stop and Reverse (psar)&quot;</span>
</span><span id="PriceGenerator-1092"><a href="#PriceGenerator-1092"><span class="linenos">1092</span></a>                <span class="n">legendNameAlligator</span> <span class="o">=</span> <span class="s2">&quot;Alligator (based on HMA: 13, 8, 5)&quot;</span>
</span><span id="PriceGenerator-1093"><a href="#PriceGenerator-1093"><span class="linenos">1093</span></a>                <span class="n">legendNameZigZag</span> <span class="o">=</span> <span class="s2">&quot;Zig-Zag indicator (with </span><span class="si">{}% o</span><span class="s2">f difference)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zigZagDeviation</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="PriceGenerator-1094"><a href="#PriceGenerator-1094"><span class="linenos">1094</span></a>
</span><span id="PriceGenerator-1095"><a href="#PriceGenerator-1095"><span class="linenos">1095</span></a>                <span class="c1"># preparing for highest close line:</span>
</span><span id="PriceGenerator-1096"><a href="#PriceGenerator-1096"><span class="linenos">1096</span></a>                <span class="n">highestClose</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precision</span><span class="p">)</span>
</span><span id="PriceGenerator-1097"><a href="#PriceGenerator-1097"><span class="linenos">1097</span></a>                <span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="PriceGenerator-1098"><a href="#PriceGenerator-1098"><span class="linenos">1098</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">highestClose</span><span class="p">,</span>
</span><span id="PriceGenerator-1099"><a href="#PriceGenerator-1099"><span class="linenos">1099</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#339933&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator-1100"><a href="#PriceGenerator-1100"><span class="linenos">1100</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameMain</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1101"><a href="#PriceGenerator-1101"><span class="linenos">1101</span></a>                <span class="p">)</span>
</span><span id="PriceGenerator-1102"><a href="#PriceGenerator-1102"><span class="linenos">1102</span></a>                <span class="n">chart</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
</span><span id="PriceGenerator-1103"><a href="#PriceGenerator-1103"><span class="linenos">1103</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">highestClose</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deg10prec</span><span class="p">,</span>
</span><span id="PriceGenerator-1104"><a href="#PriceGenerator-1104"><span class="linenos">1104</span></a>                    <span class="n">text</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">highestClose</span><span class="p">)],</span> <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">text_color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#339933&quot;</span><span class="p">,</span> <span class="n">text_font_size</span><span class="o">=</span><span class="s2">&quot;9pt&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1105"><a href="#PriceGenerator-1105"><span class="linenos">1105</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameMain</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1106"><a href="#PriceGenerator-1106"><span class="linenos">1106</span></a>                <span class="p">)</span>
</span><span id="PriceGenerator-1107"><a href="#PriceGenerator-1107"><span class="linenos">1107</span></a>
</span><span id="PriceGenerator-1108"><a href="#PriceGenerator-1108"><span class="linenos">1108</span></a>                <span class="c1"># preparing for lowest close line:</span>
</span><span id="PriceGenerator-1109"><a href="#PriceGenerator-1109"><span class="linenos">1109</span></a>                <span class="n">lowestClose</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precision</span><span class="p">)</span>
</span><span id="PriceGenerator-1110"><a href="#PriceGenerator-1110"><span class="linenos">1110</span></a>                <span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="PriceGenerator-1111"><a href="#PriceGenerator-1111"><span class="linenos">1111</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">lowestClose</span><span class="p">,</span>
</span><span id="PriceGenerator-1112"><a href="#PriceGenerator-1112"><span class="linenos">1112</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#339933&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator-1113"><a href="#PriceGenerator-1113"><span class="linenos">1113</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameMain</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1114"><a href="#PriceGenerator-1114"><span class="linenos">1114</span></a>                <span class="p">)</span>
</span><span id="PriceGenerator-1115"><a href="#PriceGenerator-1115"><span class="linenos">1115</span></a>                <span class="n">chart</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
</span><span id="PriceGenerator-1116"><a href="#PriceGenerator-1116"><span class="linenos">1116</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">lowestClose</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deg10prec</span><span class="p">,</span>
</span><span id="PriceGenerator-1117"><a href="#PriceGenerator-1117"><span class="linenos">1117</span></a>                    <span class="n">text</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">lowestClose</span><span class="p">)],</span> <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">text_color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#339933&quot;</span><span class="p">,</span> <span class="n">text_font_size</span><span class="o">=</span><span class="s2">&quot;9pt&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1118"><a href="#PriceGenerator-1118"><span class="linenos">1118</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameMain</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1119"><a href="#PriceGenerator-1119"><span class="linenos">1119</span></a>                <span class="p">)</span>
</span><span id="PriceGenerator-1120"><a href="#PriceGenerator-1120"><span class="linenos">1120</span></a>
</span><span id="PriceGenerator-1121"><a href="#PriceGenerator-1121"><span class="linenos">1121</span></a>                <span class="c1"># preparing direction lines for all trends:</span>
</span><span id="PriceGenerator-1122"><a href="#PriceGenerator-1122"><span class="linenos">1122</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span><span class="p">:</span>
</span><span id="PriceGenerator-1123"><a href="#PriceGenerator-1123"><span class="linenos">1123</span></a>                    <span class="n">left</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="PriceGenerator-1124"><a href="#PriceGenerator-1124"><span class="linenos">1124</span></a>                    <span class="k">for</span> <span class="n">trendNum</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span><span class="p">)):</span>
</span><span id="PriceGenerator-1125"><a href="#PriceGenerator-1125"><span class="linenos">1125</span></a>                        <span class="n">right</span> <span class="o">=</span> <span class="n">left</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span><span class="p">[</span><span class="n">trendNum</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="PriceGenerator-1126"><a href="#PriceGenerator-1126"><span class="linenos">1126</span></a>                        <span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="PriceGenerator-1127"><a href="#PriceGenerator-1127"><span class="linenos">1127</span></a>                            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">left</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">right</span><span class="p">]],</span>
</span><span id="PriceGenerator-1128"><a href="#PriceGenerator-1128"><span class="linenos">1128</span></a>                            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">left</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">right</span><span class="p">]],</span>
</span><span id="PriceGenerator-1129"><a href="#PriceGenerator-1129"><span class="linenos">1129</span></a>                            <span class="n">line_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#666666&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">line_dash</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
</span><span id="PriceGenerator-1130"><a href="#PriceGenerator-1130"><span class="linenos">1130</span></a>                            <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameMain</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1131"><a href="#PriceGenerator-1131"><span class="linenos">1131</span></a>                        <span class="p">)</span>
</span><span id="PriceGenerator-1132"><a href="#PriceGenerator-1132"><span class="linenos">1132</span></a>                        <span class="n">left</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span><span class="p">[</span><span class="n">trendNum</span><span class="p">]</span>
</span><span id="PriceGenerator-1133"><a href="#PriceGenerator-1133"><span class="linenos">1133</span></a>
</span><span id="PriceGenerator-1134"><a href="#PriceGenerator-1134"><span class="linenos">1134</span></a>                <span class="c1"># preparing for main direction line:</span>
</span><span id="PriceGenerator-1135"><a href="#PriceGenerator-1135"><span class="linenos">1135</span></a>                <span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="PriceGenerator-1136"><a href="#PriceGenerator-1136"><span class="linenos">1136</span></a>                    <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span>
</span><span id="PriceGenerator-1137"><a href="#PriceGenerator-1137"><span class="linenos">1137</span></a>                    <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span>
</span><span id="PriceGenerator-1138"><a href="#PriceGenerator-1138"><span class="linenos">1138</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#666666&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">line_dash</span><span class="o">=</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
</span><span id="PriceGenerator-1139"><a href="#PriceGenerator-1139"><span class="linenos">1139</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameMain</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1140"><a href="#PriceGenerator-1140"><span class="linenos">1140</span></a>                <span class="p">)</span>
</span><span id="PriceGenerator-1141"><a href="#PriceGenerator-1141"><span class="linenos">1141</span></a>
</span><span id="PriceGenerator-1142"><a href="#PriceGenerator-1142"><span class="linenos">1142</span></a>                <span class="c1"># preparing candle&#39;s average points:</span>
</span><span id="PriceGenerator-1143"><a href="#PriceGenerator-1143"><span class="linenos">1143</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span>
</span><span id="PriceGenerator-1144"><a href="#PriceGenerator-1144"><span class="linenos">1144</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">avg</span><span class="p">,</span>
</span><span id="PriceGenerator-1145"><a href="#PriceGenerator-1145"><span class="linenos">1145</span></a>                    <span class="n">size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator-1146"><a href="#PriceGenerator-1146"><span class="linenos">1146</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameAvg</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1147"><a href="#PriceGenerator-1147"><span class="linenos">1147</span></a>                <span class="p">))</span>
</span><span id="PriceGenerator-1148"><a href="#PriceGenerator-1148"><span class="linenos">1148</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="PriceGenerator-1149"><a href="#PriceGenerator-1149"><span class="linenos">1149</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">avg</span><span class="p">,</span>
</span><span id="PriceGenerator-1150"><a href="#PriceGenerator-1150"><span class="linenos">1150</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator-1151"><a href="#PriceGenerator-1151"><span class="linenos">1151</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameAvg</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1152"><a href="#PriceGenerator-1152"><span class="linenos">1152</span></a>                <span class="p">))</span>
</span><span id="PriceGenerator-1153"><a href="#PriceGenerator-1153"><span class="linenos">1153</span></a>
</span><span id="PriceGenerator-1154"><a href="#PriceGenerator-1154"><span class="linenos">1154</span></a>                <span class="c1"># --- Preparing a lot of TA lines:</span>
</span><span id="PriceGenerator-1155"><a href="#PriceGenerator-1155"><span class="linenos">1155</span></a>
</span><span id="PriceGenerator-1156"><a href="#PriceGenerator-1156"><span class="linenos">1156</span></a>                <span class="c1"># Simple Moving Averages (SMA) 5, 20</span>
</span><span id="PriceGenerator-1157"><a href="#PriceGenerator-1157"><span class="linenos">1157</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="PriceGenerator-1158"><a href="#PriceGenerator-1158"><span class="linenos">1158</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;sma5&quot;</span><span class="p">],</span>
</span><span id="PriceGenerator-1159"><a href="#PriceGenerator-1159"><span class="linenos">1159</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#999432&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator-1160"><a href="#PriceGenerator-1160"><span class="linenos">1160</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameSMA</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1161"><a href="#PriceGenerator-1161"><span class="linenos">1161</span></a>                <span class="p">))</span>
</span><span id="PriceGenerator-1162"><a href="#PriceGenerator-1162"><span class="linenos">1162</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="PriceGenerator-1163"><a href="#PriceGenerator-1163"><span class="linenos">1163</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;sma20&quot;</span><span class="p">],</span>
</span><span id="PriceGenerator-1164"><a href="#PriceGenerator-1164"><span class="linenos">1164</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator-1165"><a href="#PriceGenerator-1165"><span class="linenos">1165</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameSMA</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1166"><a href="#PriceGenerator-1166"><span class="linenos">1166</span></a>                <span class="p">))</span>
</span><span id="PriceGenerator-1167"><a href="#PriceGenerator-1167"><span class="linenos">1167</span></a>
</span><span id="PriceGenerator-1168"><a href="#PriceGenerator-1168"><span class="linenos">1168</span></a>                <span class="c1"># Long Simple Moving Averages (SMA) 50, 200</span>
</span><span id="PriceGenerator-1169"><a href="#PriceGenerator-1169"><span class="linenos">1169</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="PriceGenerator-1170"><a href="#PriceGenerator-1170"><span class="linenos">1170</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;sma50&quot;</span><span class="p">],</span>
</span><span id="PriceGenerator-1171"><a href="#PriceGenerator-1171"><span class="linenos">1171</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#ffbf00&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator-1172"><a href="#PriceGenerator-1172"><span class="linenos">1172</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameSMAlong</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1173"><a href="#PriceGenerator-1173"><span class="linenos">1173</span></a>                <span class="p">))</span>
</span><span id="PriceGenerator-1174"><a href="#PriceGenerator-1174"><span class="linenos">1174</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="PriceGenerator-1175"><a href="#PriceGenerator-1175"><span class="linenos">1175</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;sma200&quot;</span><span class="p">],</span>
</span><span id="PriceGenerator-1176"><a href="#PriceGenerator-1176"><span class="linenos">1176</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#ff0040&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator-1177"><a href="#PriceGenerator-1177"><span class="linenos">1177</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameSMAlong</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1178"><a href="#PriceGenerator-1178"><span class="linenos">1178</span></a>                <span class="p">))</span>
</span><span id="PriceGenerator-1179"><a href="#PriceGenerator-1179"><span class="linenos">1179</span></a>
</span><span id="PriceGenerator-1180"><a href="#PriceGenerator-1180"><span class="linenos">1180</span></a>                <span class="c1"># Hull Moving Averages (HMA) 5, 20</span>
</span><span id="PriceGenerator-1181"><a href="#PriceGenerator-1181"><span class="linenos">1181</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="PriceGenerator-1182"><a href="#PriceGenerator-1182"><span class="linenos">1182</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;hma5&quot;</span><span class="p">],</span>
</span><span id="PriceGenerator-1183"><a href="#PriceGenerator-1183"><span class="linenos">1183</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#00ffff&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#336633&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator-1184"><a href="#PriceGenerator-1184"><span class="linenos">1184</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameHMA</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1185"><a href="#PriceGenerator-1185"><span class="linenos">1185</span></a>                <span class="p">))</span>
</span><span id="PriceGenerator-1186"><a href="#PriceGenerator-1186"><span class="linenos">1186</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="PriceGenerator-1187"><a href="#PriceGenerator-1187"><span class="linenos">1187</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;hma20&quot;</span><span class="p">],</span>
</span><span id="PriceGenerator-1188"><a href="#PriceGenerator-1188"><span class="linenos">1188</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#ff00ff&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#333333&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator-1189"><a href="#PriceGenerator-1189"><span class="linenos">1189</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameHMA</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1190"><a href="#PriceGenerator-1190"><span class="linenos">1190</span></a>                <span class="p">))</span>
</span><span id="PriceGenerator-1191"><a href="#PriceGenerator-1191"><span class="linenos">1191</span></a>
</span><span id="PriceGenerator-1192"><a href="#PriceGenerator-1192"><span class="linenos">1192</span></a>                <span class="c1"># Volume Weighted Moving Averages (VWMA) 5, 20</span>
</span><span id="PriceGenerator-1193"><a href="#PriceGenerator-1193"><span class="linenos">1193</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="PriceGenerator-1194"><a href="#PriceGenerator-1194"><span class="linenos">1194</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;vwma5&quot;</span><span class="p">],</span>
</span><span id="PriceGenerator-1195"><a href="#PriceGenerator-1195"><span class="linenos">1195</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#666633&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator-1196"><a href="#PriceGenerator-1196"><span class="linenos">1196</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameVWMA</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1197"><a href="#PriceGenerator-1197"><span class="linenos">1197</span></a>                <span class="p">))</span>
</span><span id="PriceGenerator-1198"><a href="#PriceGenerator-1198"><span class="linenos">1198</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="PriceGenerator-1199"><a href="#PriceGenerator-1199"><span class="linenos">1199</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;vwma20&quot;</span><span class="p">],</span>
</span><span id="PriceGenerator-1200"><a href="#PriceGenerator-1200"><span class="linenos">1200</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#ff8000&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#333333&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator-1201"><a href="#PriceGenerator-1201"><span class="linenos">1201</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameVWMA</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1202"><a href="#PriceGenerator-1202"><span class="linenos">1202</span></a>                <span class="p">))</span>
</span><span id="PriceGenerator-1203"><a href="#PriceGenerator-1203"><span class="linenos">1203</span></a>
</span><span id="PriceGenerator-1204"><a href="#PriceGenerator-1204"><span class="linenos">1204</span></a>                <span class="c1"># Bollinger Bands (BBands)</span>
</span><span id="PriceGenerator-1205"><a href="#PriceGenerator-1205"><span class="linenos">1205</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="PriceGenerator-1206"><a href="#PriceGenerator-1206"><span class="linenos">1206</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;bbands&quot;</span><span class="p">][</span><span class="s2">&quot;lower&quot;</span><span class="p">],</span>
</span><span id="PriceGenerator-1207"><a href="#PriceGenerator-1207"><span class="linenos">1207</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#66ffff&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#333333&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator-1208"><a href="#PriceGenerator-1208"><span class="linenos">1208</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameBBANDS</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1209"><a href="#PriceGenerator-1209"><span class="linenos">1209</span></a>                <span class="p">))</span>
</span><span id="PriceGenerator-1210"><a href="#PriceGenerator-1210"><span class="linenos">1210</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="PriceGenerator-1211"><a href="#PriceGenerator-1211"><span class="linenos">1211</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;bbands&quot;</span><span class="p">][</span><span class="s2">&quot;mid&quot;</span><span class="p">],</span>
</span><span id="PriceGenerator-1212"><a href="#PriceGenerator-1212"><span class="linenos">1212</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#66ffff&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#333333&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator-1213"><a href="#PriceGenerator-1213"><span class="linenos">1213</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameBBANDS</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1214"><a href="#PriceGenerator-1214"><span class="linenos">1214</span></a>                <span class="p">))</span>
</span><span id="PriceGenerator-1215"><a href="#PriceGenerator-1215"><span class="linenos">1215</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="PriceGenerator-1216"><a href="#PriceGenerator-1216"><span class="linenos">1216</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;bbands&quot;</span><span class="p">][</span><span class="s2">&quot;upper&quot;</span><span class="p">],</span>
</span><span id="PriceGenerator-1217"><a href="#PriceGenerator-1217"><span class="linenos">1217</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#66ffff&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#333333&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator-1218"><a href="#PriceGenerator-1218"><span class="linenos">1218</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameBBANDS</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1219"><a href="#PriceGenerator-1219"><span class="linenos">1219</span></a>                <span class="p">))</span>
</span><span id="PriceGenerator-1220"><a href="#PriceGenerator-1220"><span class="linenos">1220</span></a>
</span><span id="PriceGenerator-1221"><a href="#PriceGenerator-1221"><span class="linenos">1221</span></a>                <span class="c1"># Parabolic Stop and Reverse (psar)</span>
</span><span id="PriceGenerator-1222"><a href="#PriceGenerator-1222"><span class="linenos">1222</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span>
</span><span id="PriceGenerator-1223"><a href="#PriceGenerator-1223"><span class="linenos">1223</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;psar&quot;</span><span class="p">][</span><span class="s2">&quot;long&quot;</span><span class="p">],</span>
</span><span id="PriceGenerator-1224"><a href="#PriceGenerator-1224"><span class="linenos">1224</span></a>                    <span class="n">size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#00ffff&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#336633&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator-1225"><a href="#PriceGenerator-1225"><span class="linenos">1225</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNamePsar</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1226"><a href="#PriceGenerator-1226"><span class="linenos">1226</span></a>                <span class="p">))</span>
</span><span id="PriceGenerator-1227"><a href="#PriceGenerator-1227"><span class="linenos">1227</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span>
</span><span id="PriceGenerator-1228"><a href="#PriceGenerator-1228"><span class="linenos">1228</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;psar&quot;</span><span class="p">][</span><span class="s2">&quot;short&quot;</span><span class="p">],</span>
</span><span id="PriceGenerator-1229"><a href="#PriceGenerator-1229"><span class="linenos">1229</span></a>                    <span class="n">size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#ff00ff&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#663333&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator-1230"><a href="#PriceGenerator-1230"><span class="linenos">1230</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNamePsar</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1231"><a href="#PriceGenerator-1231"><span class="linenos">1231</span></a>                <span class="p">))</span>
</span><span id="PriceGenerator-1232"><a href="#PriceGenerator-1232"><span class="linenos">1232</span></a>
</span><span id="PriceGenerator-1233"><a href="#PriceGenerator-1233"><span class="linenos">1233</span></a>                <span class="c1"># Alligator (based on HMA 13, 8, 5) for the Alligator indicator (Jaw, Teeth, and Lips)</span>
</span><span id="PriceGenerator-1234"><a href="#PriceGenerator-1234"><span class="linenos">1234</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="PriceGenerator-1235"><a href="#PriceGenerator-1235"><span class="linenos">1235</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;hma13&quot;</span><span class="p">],</span>
</span><span id="PriceGenerator-1236"><a href="#PriceGenerator-1236"><span class="linenos">1236</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#1a1aff&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#2100A6&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator-1237"><a href="#PriceGenerator-1237"><span class="linenos">1237</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameAlligator</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1238"><a href="#PriceGenerator-1238"><span class="linenos">1238</span></a>                <span class="p">))</span>
</span><span id="PriceGenerator-1239"><a href="#PriceGenerator-1239"><span class="linenos">1239</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="PriceGenerator-1240"><a href="#PriceGenerator-1240"><span class="linenos">1240</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;hma8&quot;</span><span class="p">],</span>
</span><span id="PriceGenerator-1241"><a href="#PriceGenerator-1241"><span class="linenos">1241</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#ff1a1a&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#A6000C&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator-1242"><a href="#PriceGenerator-1242"><span class="linenos">1242</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameAlligator</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1243"><a href="#PriceGenerator-1243"><span class="linenos">1243</span></a>                <span class="p">))</span>
</span><span id="PriceGenerator-1244"><a href="#PriceGenerator-1244"><span class="linenos">1244</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="PriceGenerator-1245"><a href="#PriceGenerator-1245"><span class="linenos">1245</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;hma5&quot;</span><span class="p">],</span>
</span><span id="PriceGenerator-1246"><a href="#PriceGenerator-1246"><span class="linenos">1246</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#40ff00&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#17A600&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator-1247"><a href="#PriceGenerator-1247"><span class="linenos">1247</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameAlligator</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1248"><a href="#PriceGenerator-1248"><span class="linenos">1248</span></a>                <span class="p">))</span>
</span><span id="PriceGenerator-1249"><a href="#PriceGenerator-1249"><span class="linenos">1249</span></a>
</span><span id="PriceGenerator-1250"><a href="#PriceGenerator-1250"><span class="linenos">1250</span></a>                <span class="c1"># Zig-Zag indicator with self.zigZagDeviation of difference parameter</span>
</span><span id="PriceGenerator-1251"><a href="#PriceGenerator-1251"><span class="linenos">1251</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="PriceGenerator-1252"><a href="#PriceGenerator-1252"><span class="linenos">1252</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;zigzag3&quot;</span><span class="p">][</span><span class="s2">&quot;datetimes&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;zigzag3&quot;</span><span class="p">][</span><span class="s2">&quot;filtered&quot;</span><span class="p">],</span>
</span><span id="PriceGenerator-1253"><a href="#PriceGenerator-1253"><span class="linenos">1253</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;cyan&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#333333&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator-1254"><a href="#PriceGenerator-1254"><span class="linenos">1254</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameZigZag</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1255"><a href="#PriceGenerator-1255"><span class="linenos">1255</span></a>                <span class="p">))</span>
</span><span id="PriceGenerator-1256"><a href="#PriceGenerator-1256"><span class="linenos">1256</span></a>
</span><span id="PriceGenerator-1257"><a href="#PriceGenerator-1257"><span class="linenos">1257</span></a>                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">disabledObjects</span><span class="p">:</span>
</span><span id="PriceGenerator-1258"><a href="#PriceGenerator-1258"><span class="linenos">1258</span></a>                    <span class="n">item</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="PriceGenerator-1259"><a href="#PriceGenerator-1259"><span class="linenos">1259</span></a>
</span><span id="PriceGenerator-1260"><a href="#PriceGenerator-1260"><span class="linenos">1260</span></a>            <span class="c1"># --- Preparing custom markers:</span>
</span><span id="PriceGenerator-1261"><a href="#PriceGenerator-1261"><span class="linenos">1261</span></a>
</span><span id="PriceGenerator-1262"><a href="#PriceGenerator-1262"><span class="linenos">1262</span></a>            <span class="k">if</span> <span class="n">markers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">markers</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">markers</span><span class="o">.</span><span class="n">empty</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">markers</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="s2">&quot;datetime&quot;</span> <span class="ow">in</span> <span class="n">markers</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;markersUpper&quot;</span> <span class="ow">in</span> <span class="n">markers</span><span class="o">.</span><span class="n">columns</span> <span class="ow">or</span> <span class="s2">&quot;markersCenter&quot;</span> <span class="ow">in</span> <span class="n">markers</span><span class="o">.</span><span class="n">columns</span> <span class="ow">or</span> <span class="s2">&quot;markersLower&quot;</span> <span class="ow">in</span> <span class="n">markers</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
</span><span id="PriceGenerator-1263"><a href="#PriceGenerator-1263"><span class="linenos">1263</span></a>                <span class="k">if</span> <span class="s2">&quot;markersUpper&quot;</span> <span class="ow">in</span> <span class="n">markers</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="PriceGenerator-1264"><a href="#PriceGenerator-1264"><span class="linenos">1264</span></a>                    <span class="n">chart</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
</span><span id="PriceGenerator-1265"><a href="#PriceGenerator-1265"><span class="linenos">1265</span></a>                        <span class="n">markers</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">high</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span>
</span><span id="PriceGenerator-1266"><a href="#PriceGenerator-1266"><span class="linenos">1266</span></a>                        <span class="n">text_align</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">text_baseline</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">markers</span><span class="o">.</span><span class="n">markersUpper</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
</span><span id="PriceGenerator-1267"><a href="#PriceGenerator-1267"><span class="linenos">1267</span></a>                        <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">text_color</span><span class="o">=</span><span class="s2">&quot;lime&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">text_font_size</span><span class="o">=</span><span class="s2">&quot;13pt&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1268"><a href="#PriceGenerator-1268"><span class="linenos">1268</span></a>                        <span class="n">legend_label</span><span class="o">=</span><span class="s2">&quot;Markers: upper (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">markers</span><span class="o">.</span><span class="n">markersUpper</span><span class="p">[</span><span class="n">markers</span><span class="o">.</span><span class="n">markersUpper</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">]))</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1269"><a href="#PriceGenerator-1269"><span class="linenos">1269</span></a>                    <span class="p">)</span>
</span><span id="PriceGenerator-1270"><a href="#PriceGenerator-1270"><span class="linenos">1270</span></a>
</span><span id="PriceGenerator-1271"><a href="#PriceGenerator-1271"><span class="linenos">1271</span></a>                <span class="k">if</span> <span class="s2">&quot;markersCenter&quot;</span> <span class="ow">in</span> <span class="n">markers</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="PriceGenerator-1272"><a href="#PriceGenerator-1272"><span class="linenos">1272</span></a>                    <span class="k">if</span> <span class="s2">&quot;avg&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="PriceGenerator-1273"><a href="#PriceGenerator-1273"><span class="linenos">1273</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;avg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">high</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">low</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precision</span><span class="p">)</span>
</span><span id="PriceGenerator-1274"><a href="#PriceGenerator-1274"><span class="linenos">1274</span></a>
</span><span id="PriceGenerator-1275"><a href="#PriceGenerator-1275"><span class="linenos">1275</span></a>                    <span class="n">chart</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
</span><span id="PriceGenerator-1276"><a href="#PriceGenerator-1276"><span class="linenos">1276</span></a>                        <span class="n">markers</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">avg</span><span class="p">,</span>
</span><span id="PriceGenerator-1277"><a href="#PriceGenerator-1277"><span class="linenos">1277</span></a>                        <span class="n">text_align</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">text_baseline</span><span class="o">=</span><span class="s2">&quot;middle&quot;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">markers</span><span class="o">.</span><span class="n">markersCenter</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
</span><span id="PriceGenerator-1278"><a href="#PriceGenerator-1278"><span class="linenos">1278</span></a>                        <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">text_color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">text_font_size</span><span class="o">=</span><span class="s2">&quot;13pt&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1279"><a href="#PriceGenerator-1279"><span class="linenos">1279</span></a>                        <span class="n">legend_label</span><span class="o">=</span><span class="s2">&quot;Markers: center (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">markers</span><span class="o">.</span><span class="n">markersCenter</span><span class="p">[</span><span class="n">markers</span><span class="o">.</span><span class="n">markersCenter</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">]))</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1280"><a href="#PriceGenerator-1280"><span class="linenos">1280</span></a>                    <span class="p">)</span>
</span><span id="PriceGenerator-1281"><a href="#PriceGenerator-1281"><span class="linenos">1281</span></a>
</span><span id="PriceGenerator-1282"><a href="#PriceGenerator-1282"><span class="linenos">1282</span></a>                <span class="k">if</span> <span class="s2">&quot;markersLower&quot;</span> <span class="ow">in</span> <span class="n">markers</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="PriceGenerator-1283"><a href="#PriceGenerator-1283"><span class="linenos">1283</span></a>                    <span class="n">chart</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
</span><span id="PriceGenerator-1284"><a href="#PriceGenerator-1284"><span class="linenos">1284</span></a>                        <span class="n">markers</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">low</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span>
</span><span id="PriceGenerator-1285"><a href="#PriceGenerator-1285"><span class="linenos">1285</span></a>                        <span class="n">text_align</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">text_baseline</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">markers</span><span class="o">.</span><span class="n">markersLower</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
</span><span id="PriceGenerator-1286"><a href="#PriceGenerator-1286"><span class="linenos">1286</span></a>                        <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">text_color</span><span class="o">=</span><span class="s2">&quot;lime&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">text_font_size</span><span class="o">=</span><span class="s2">&quot;13pt&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1287"><a href="#PriceGenerator-1287"><span class="linenos">1287</span></a>                        <span class="n">legend_label</span><span class="o">=</span><span class="s2">&quot;Markers: lower (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">markers</span><span class="o">.</span><span class="n">markersLower</span><span class="p">[</span><span class="n">markers</span><span class="o">.</span><span class="n">markersLower</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">]))</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1288"><a href="#PriceGenerator-1288"><span class="linenos">1288</span></a>                    <span class="p">)</span>
</span><span id="PriceGenerator-1289"><a href="#PriceGenerator-1289"><span class="linenos">1289</span></a>
</span><span id="PriceGenerator-1290"><a href="#PriceGenerator-1290"><span class="linenos">1290</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PriceGenerator-1291"><a href="#PriceGenerator-1291"><span class="linenos">1291</span></a>                <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Marker data must be the Pandas DataFrame object! Or `None` (by default). Marker is a custom symbol, example: ×, ↓ or ↑. Dataframe with markers must contain at least two columns. There are `datetime` with date and time and some markers columns (`markersUpper`, `markersCenter` or `markersLower`). Length of markers series must be equal to the length of main candles series.&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator-1292"><a href="#PriceGenerator-1292"><span class="linenos">1292</span></a>
</span><span id="PriceGenerator-1293"><a href="#PriceGenerator-1293"><span class="linenos">1293</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">showControlsOnChart</span> <span class="ow">or</span> <span class="n">showStatOnChart</span><span class="p">):</span>
</span><span id="PriceGenerator-1294"><a href="#PriceGenerator-1294"><span class="linenos">1294</span></a>                <span class="n">summaryInfo</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="PriceGenerator-1295"><a href="#PriceGenerator-1295"><span class="linenos">1295</span></a>
</span><span id="PriceGenerator-1296"><a href="#PriceGenerator-1296"><span class="linenos">1296</span></a>            <span class="c1"># --- Preparing custom lines:</span>
</span><span id="PriceGenerator-1297"><a href="#PriceGenerator-1297"><span class="linenos">1297</span></a>
</span><span id="PriceGenerator-1298"><a href="#PriceGenerator-1298"><span class="linenos">1298</span></a>            <span class="k">if</span> <span class="n">lines</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="n">lines</span><span class="p">:</span>
</span><span id="PriceGenerator-1299"><a href="#PriceGenerator-1299"><span class="linenos">1299</span></a>                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
</span><span id="PriceGenerator-1300"><a href="#PriceGenerator-1300"><span class="linenos">1300</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="s2">&quot;datetime&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="PriceGenerator-1301"><a href="#PriceGenerator-1301"><span class="linenos">1301</span></a>                        <span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="PriceGenerator-1302"><a href="#PriceGenerator-1302"><span class="linenos">1302</span></a>                            <span class="n">line</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">line</span><span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
</span><span id="PriceGenerator-1303"><a href="#PriceGenerator-1303"><span class="linenos">1303</span></a>                            <span class="n">line_width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#666666&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator-1304"><a href="#PriceGenerator-1304"><span class="linenos">1304</span></a>                            <span class="n">legend_label</span><span class="o">=</span><span class="s2">&quot;Line: &quot;</span> <span class="o">+</span> <span class="n">line</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1305"><a href="#PriceGenerator-1305"><span class="linenos">1305</span></a>                        <span class="p">)</span>
</span><span id="PriceGenerator-1306"><a href="#PriceGenerator-1306"><span class="linenos">1306</span></a>
</span><span id="PriceGenerator-1307"><a href="#PriceGenerator-1307"><span class="linenos">1307</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="PriceGenerator-1308"><a href="#PriceGenerator-1308"><span class="linenos">1308</span></a>                        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Every custom line must be the Pandas DataFrame object! Line data must contain at least two columns: `datetime` with date and time and 2-nd column `custom_line_name` with y-coordinates. Length of the chart-line dataframes must be equal to the length of main candle series.&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator-1309"><a href="#PriceGenerator-1309"><span class="linenos">1309</span></a>
</span><span id="PriceGenerator-1310"><a href="#PriceGenerator-1310"><span class="linenos">1310</span></a>            <span class="c1"># --- Volume chart options:</span>
</span><span id="PriceGenerator-1311"><a href="#PriceGenerator-1311"><span class="linenos">1311</span></a>            <span class="n">volumeChart</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span>
</span><span id="PriceGenerator-1312"><a href="#PriceGenerator-1312"><span class="linenos">1312</span></a>                <span class="n">x_axis_type</span><span class="o">=</span><span class="s2">&quot;datetime&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1313"><a href="#PriceGenerator-1313"><span class="linenos">1313</span></a>                <span class="n">y_axis_label</span><span class="o">=</span><span class="s2">&quot;Volume&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1314"><a href="#PriceGenerator-1314"><span class="linenos">1314</span></a>                <span class="n">outline_line_width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
</span><span id="PriceGenerator-1315"><a href="#PriceGenerator-1315"><span class="linenos">1315</span></a>                <span class="n">outline_line_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1316"><a href="#PriceGenerator-1316"><span class="linenos">1316</span></a>                <span class="n">min_width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
</span><span id="PriceGenerator-1317"><a href="#PriceGenerator-1317"><span class="linenos">1317</span></a>                <span class="n">height</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
</span><span id="PriceGenerator-1318"><a href="#PriceGenerator-1318"><span class="linenos">1318</span></a>                <span class="n">sizing_mode</span><span class="o">=</span><span class="s2">&quot;scale_width&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1319"><a href="#PriceGenerator-1319"><span class="linenos">1319</span></a>                <span class="n">background_fill_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1320"><a href="#PriceGenerator-1320"><span class="linenos">1320</span></a>                <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pan&quot;</span><span class="p">,</span> <span class="s2">&quot;wheel_zoom&quot;</span><span class="p">,</span> <span class="s2">&quot;hover&quot;</span><span class="p">],</span>
</span><span id="PriceGenerator-1321"><a href="#PriceGenerator-1321"><span class="linenos">1321</span></a>                <span class="n">toolbar_location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="PriceGenerator-1322"><a href="#PriceGenerator-1322"><span class="linenos">1322</span></a>                <span class="n">active_scroll</span><span class="o">=</span><span class="s2">&quot;wheel_zoom&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1323"><a href="#PriceGenerator-1323"><span class="linenos">1323</span></a>                <span class="n">min_border_left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="PriceGenerator-1324"><a href="#PriceGenerator-1324"><span class="linenos">1324</span></a>                <span class="n">min_border_right</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="PriceGenerator-1325"><a href="#PriceGenerator-1325"><span class="linenos">1325</span></a>                <span class="n">min_border_top</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="PriceGenerator-1326"><a href="#PriceGenerator-1326"><span class="linenos">1326</span></a>                <span class="n">min_border_bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="PriceGenerator-1327"><a href="#PriceGenerator-1327"><span class="linenos">1327</span></a>                <span class="n">x_range</span><span class="o">=</span><span class="n">chart</span><span class="o">.</span><span class="n">x_range</span><span class="p">,</span>
</span><span id="PriceGenerator-1328"><a href="#PriceGenerator-1328"><span class="linenos">1328</span></a>                <span class="n">y_range</span><span class="o">=</span><span class="n">Range1d</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">volume</span><span class="p">),</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">volume</span><span class="p">))),</span>
</span><span id="PriceGenerator-1329"><a href="#PriceGenerator-1329"><span class="linenos">1329</span></a>            <span class="p">)</span>
</span><span id="PriceGenerator-1330"><a href="#PriceGenerator-1330"><span class="linenos">1330</span></a>            <span class="n">volumeChart</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">logo</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># remove bokeh logo and link to https://bokeh.org/</span>
</span><span id="PriceGenerator-1331"><a href="#PriceGenerator-1331"><span class="linenos">1331</span></a>            <span class="n">volumeChart</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">major_label_orientation</span> <span class="o">=</span> <span class="n">pi</span> <span class="o">/</span> <span class="mi">6</span>
</span><span id="PriceGenerator-1332"><a href="#PriceGenerator-1332"><span class="linenos">1332</span></a>            <span class="n">volumeChart</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="PriceGenerator-1333"><a href="#PriceGenerator-1333"><span class="linenos">1333</span></a>            <span class="n">volumeChart</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">formatter</span> <span class="o">=</span> <span class="n">NumeralTickFormatter</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s2">&quot;0a&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator-1334"><a href="#PriceGenerator-1334"><span class="linenos">1334</span></a>            <span class="n">volumeChart</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">grid_line_dash</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</span><span id="PriceGenerator-1335"><a href="#PriceGenerator-1335"><span class="linenos">1335</span></a>            <span class="n">volumeChart</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">grid_line_alpha</span> <span class="o">=</span> <span class="mf">0.5</span>
</span><span id="PriceGenerator-1336"><a href="#PriceGenerator-1336"><span class="linenos">1336</span></a>            <span class="n">volumeChart</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">minor_grid_line_dash</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</span><span id="PriceGenerator-1337"><a href="#PriceGenerator-1337"><span class="linenos">1337</span></a>            <span class="n">volumeChart</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">minor_grid_line_alpha</span> <span class="o">=</span> <span class="mf">0.5</span>
</span><span id="PriceGenerator-1338"><a href="#PriceGenerator-1338"><span class="linenos">1338</span></a>            <span class="n">volumeChart</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">minor_grid_line_dash</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</span><span id="PriceGenerator-1339"><a href="#PriceGenerator-1339"><span class="linenos">1339</span></a>            <span class="n">volumeChart</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">minor_grid_line_alpha</span> <span class="o">=</span> <span class="mf">0.3</span>
</span><span id="PriceGenerator-1340"><a href="#PriceGenerator-1340"><span class="linenos">1340</span></a>            <span class="n">volumeChart</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">minor_grid_line_color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;gray&quot;</span>
</span><span id="PriceGenerator-1341"><a href="#PriceGenerator-1341"><span class="linenos">1341</span></a>
</span><span id="PriceGenerator-1342"><a href="#PriceGenerator-1342"><span class="linenos">1342</span></a>            <span class="c1"># preparing data for hover tooltips:</span>
</span><span id="PriceGenerator-1343"><a href="#PriceGenerator-1343"><span class="linenos">1343</span></a>            <span class="n">volSource</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="PriceGenerator-1344"><a href="#PriceGenerator-1344"><span class="linenos">1344</span></a>                <span class="s2">&quot;candle&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span>
</span><span id="PriceGenerator-1345"><a href="#PriceGenerator-1345"><span class="linenos">1345</span></a>                <span class="s2">&quot;datetime&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
</span><span id="PriceGenerator-1346"><a href="#PriceGenerator-1346"><span class="linenos">1346</span></a>                <span class="s2">&quot;volume&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">volume</span><span class="p">,</span>
</span><span id="PriceGenerator-1347"><a href="#PriceGenerator-1347"><span class="linenos">1347</span></a>                <span class="s2">&quot;zero&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">volume</span><span class="p">),</span>
</span><span id="PriceGenerator-1348"><a href="#PriceGenerator-1348"><span class="linenos">1348</span></a>            <span class="p">}</span>
</span><span id="PriceGenerator-1349"><a href="#PriceGenerator-1349"><span class="linenos">1349</span></a>            <span class="n">volHoverData</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">volSource</span><span class="p">)</span>
</span><span id="PriceGenerator-1350"><a href="#PriceGenerator-1350"><span class="linenos">1350</span></a>            <span class="n">volHover</span> <span class="o">=</span> <span class="n">volumeChart</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">HoverTool</span><span class="p">))</span>
</span><span id="PriceGenerator-1351"><a href="#PriceGenerator-1351"><span class="linenos">1351</span></a>            <span class="n">volHover</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;volumes&quot;</span>
</span><span id="PriceGenerator-1352"><a href="#PriceGenerator-1352"><span class="linenos">1352</span></a>            <span class="n">volHover</span><span class="o">.</span><span class="n">tooltips</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="PriceGenerator-1353"><a href="#PriceGenerator-1353"><span class="linenos">1353</span></a>                <span class="p">(</span><span class="s2">&quot;Candle&quot;</span><span class="p">,</span> <span class="s2">&quot;@candle&quot;</span><span class="p">),</span>
</span><span id="PriceGenerator-1354"><a href="#PriceGenerator-1354"><span class="linenos">1354</span></a>                <span class="p">(</span><span class="s2">&quot;Date&quot;</span><span class="p">,</span> <span class="s2">&quot;@datetime{%Y-%m-</span><span class="si">%d</span><span class="s2">}&quot;</span><span class="p">),</span>
</span><span id="PriceGenerator-1355"><a href="#PriceGenerator-1355"><span class="linenos">1355</span></a>                <span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">,</span> <span class="s2">&quot;@datetime{%H:%M:%S}&quot;</span><span class="p">),</span>
</span><span id="PriceGenerator-1356"><a href="#PriceGenerator-1356"><span class="linenos">1356</span></a>                <span class="p">(</span><span class="s2">&quot;Volume&quot;</span><span class="p">,</span> <span class="s2">&quot;@volume&quot;</span><span class="p">),</span>
</span><span id="PriceGenerator-1357"><a href="#PriceGenerator-1357"><span class="linenos">1357</span></a>            <span class="p">]</span>
</span><span id="PriceGenerator-1358"><a href="#PriceGenerator-1358"><span class="linenos">1358</span></a>            <span class="n">volHover</span><span class="o">.</span><span class="n">formatters</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="PriceGenerator-1359"><a href="#PriceGenerator-1359"><span class="linenos">1359</span></a>                <span class="s2">&quot;@datetime&quot;</span><span class="p">:</span> <span class="s2">&quot;datetime&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1360"><a href="#PriceGenerator-1360"><span class="linenos">1360</span></a>            <span class="p">}</span>
</span><span id="PriceGenerator-1361"><a href="#PriceGenerator-1361"><span class="linenos">1361</span></a>            <span class="n">volHover</span><span class="o">.</span><span class="n">point_policy</span> <span class="o">=</span> <span class="s2">&quot;snap_to_data&quot;</span>
</span><span id="PriceGenerator-1362"><a href="#PriceGenerator-1362"><span class="linenos">1362</span></a>            <span class="n">volHover</span><span class="o">.</span><span class="n">line_policy</span> <span class="o">=</span> <span class="s2">&quot;nearest&quot;</span>
</span><span id="PriceGenerator-1363"><a href="#PriceGenerator-1363"><span class="linenos">1363</span></a>            <span class="n">volHover</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;vline&quot;</span>
</span><span id="PriceGenerator-1364"><a href="#PriceGenerator-1364"><span class="linenos">1364</span></a>
</span><span id="PriceGenerator-1365"><a href="#PriceGenerator-1365"><span class="linenos">1365</span></a>            <span class="c1"># preparing volume chart:</span>
</span><span id="PriceGenerator-1366"><a href="#PriceGenerator-1366"><span class="linenos">1366</span></a>            <span class="n">hoverOnVolumes</span> <span class="o">=</span> <span class="n">volumeChart</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span>
</span><span id="PriceGenerator-1367"><a href="#PriceGenerator-1367"><span class="linenos">1367</span></a>                <span class="n">x0</span><span class="o">=</span><span class="s2">&quot;datetime&quot;</span><span class="p">,</span> <span class="n">y0</span><span class="o">=</span><span class="s2">&quot;volume&quot;</span><span class="p">,</span> <span class="n">x1</span><span class="o">=</span><span class="s2">&quot;datetime&quot;</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="s2">&quot;zero&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1368"><a href="#PriceGenerator-1368"><span class="linenos">1368</span></a>                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;volumes&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">volHoverData</span><span class="p">,</span>
</span><span id="PriceGenerator-1369"><a href="#PriceGenerator-1369"><span class="linenos">1369</span></a>            <span class="p">)</span>
</span><span id="PriceGenerator-1370"><a href="#PriceGenerator-1370"><span class="linenos">1370</span></a>            <span class="n">volHover</span><span class="o">.</span><span class="n">renderers</span> <span class="o">=</span> <span class="p">[</span><span class="n">hoverOnVolumes</span><span class="p">]</span>  <span class="c1"># hover on only for volume bars</span>
</span><span id="PriceGenerator-1371"><a href="#PriceGenerator-1371"><span class="linenos">1371</span></a>            <span class="n">volumeChart</span><span class="o">.</span><span class="n">vbar</span><span class="p">(</span>
</span><span id="PriceGenerator-1372"><a href="#PriceGenerator-1372"><span class="linenos">1372</span></a>                <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">[</span><span class="n">inc</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="n">candleWidth</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">volume</span><span class="p">[</span><span class="n">inc</span><span class="p">],</span>
</span><span id="PriceGenerator-1373"><a href="#PriceGenerator-1373"><span class="linenos">1373</span></a>                <span class="n">fill_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#20ff00&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1374"><a href="#PriceGenerator-1374"><span class="linenos">1374</span></a>                <span class="n">line_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fill_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator-1375"><a href="#PriceGenerator-1375"><span class="linenos">1375</span></a>            <span class="p">)</span>
</span><span id="PriceGenerator-1376"><a href="#PriceGenerator-1376"><span class="linenos">1376</span></a>            <span class="n">volumeChart</span><span class="o">.</span><span class="n">vbar</span><span class="p">(</span>
</span><span id="PriceGenerator-1377"><a href="#PriceGenerator-1377"><span class="linenos">1377</span></a>                <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">[</span><span class="n">dec</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="n">candleWidth</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">volume</span><span class="p">[</span><span class="n">dec</span><span class="p">],</span>
</span><span id="PriceGenerator-1378"><a href="#PriceGenerator-1378"><span class="linenos">1378</span></a>                <span class="n">fill_color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#999999&quot;</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#20ff00&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1379"><a href="#PriceGenerator-1379"><span class="linenos">1379</span></a>                <span class="n">line_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fill_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator-1380"><a href="#PriceGenerator-1380"><span class="linenos">1380</span></a>            <span class="p">)</span>
</span><span id="PriceGenerator-1381"><a href="#PriceGenerator-1381"><span class="linenos">1381</span></a>
</span><span id="PriceGenerator-1382"><a href="#PriceGenerator-1382"><span class="linenos">1382</span></a>            <span class="c1"># Merge Main and Volume charts in one Bokeh gridplot object:</span>
</span><span id="PriceGenerator-1383"><a href="#PriceGenerator-1383"><span class="linenos">1383</span></a>            <span class="n">unionChart</span> <span class="o">=</span> <span class="n">gridplot</span><span class="p">(</span>
</span><span id="PriceGenerator-1384"><a href="#PriceGenerator-1384"><span class="linenos">1384</span></a>                <span class="n">children</span><span class="o">=</span><span class="p">[[</span><span class="n">chart</span><span class="p">],</span> <span class="p">[</span><span class="n">volumeChart</span><span class="p">]],</span>
</span><span id="PriceGenerator-1385"><a href="#PriceGenerator-1385"><span class="linenos">1385</span></a>                <span class="n">sizing_mode</span><span class="o">=</span><span class="s2">&quot;stretch_both&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator-1386"><a href="#PriceGenerator-1386"><span class="linenos">1386</span></a>                <span class="n">merge_tools</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="PriceGenerator-1387"><a href="#PriceGenerator-1387"><span class="linenos">1387</span></a>                <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
</span><span id="PriceGenerator-1388"><a href="#PriceGenerator-1388"><span class="linenos">1388</span></a>            <span class="p">)</span>
</span><span id="PriceGenerator-1389"><a href="#PriceGenerator-1389"><span class="linenos">1389</span></a>            <span class="n">unionChart</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">logo</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PriceGenerator-1390"><a href="#PriceGenerator-1390"><span class="linenos">1390</span></a>
</span><span id="PriceGenerator-1391"><a href="#PriceGenerator-1391"><span class="linenos">1391</span></a>            <span class="k">if</span> <span class="n">inline</span><span class="p">:</span>
</span><span id="PriceGenerator-1392"><a href="#PriceGenerator-1392"><span class="linenos">1392</span></a>                <span class="n">show</span><span class="p">(</span><span class="n">unionChart</span><span class="p">,</span> <span class="n">notebook_handle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="PriceGenerator-1393"><a href="#PriceGenerator-1393"><span class="linenos">1393</span></a>
</span><span id="PriceGenerator-1394"><a href="#PriceGenerator-1394"><span class="linenos">1394</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PriceGenerator-1395"><a href="#PriceGenerator-1395"><span class="linenos">1395</span></a>                <span class="c1"># preparing HTML-file chart and statistics in markdown:</span>
</span><span id="PriceGenerator-1396"><a href="#PriceGenerator-1396"><span class="linenos">1396</span></a>                <span class="k">if</span> <span class="n">fileName</span><span class="p">:</span>
</span><span id="PriceGenerator-1397"><a href="#PriceGenerator-1397"><span class="linenos">1397</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="PriceGenerator-1398"><a href="#PriceGenerator-1398"><span class="linenos">1398</span></a>                        <span class="n">output_file</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;cdn&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator-1399"><a href="#PriceGenerator-1399"><span class="linenos">1399</span></a>                        <span class="n">save</span><span class="p">(</span><span class="n">unionChart</span><span class="p">,</span> <span class="n">fileName</span><span class="p">)</span>
</span><span id="PriceGenerator-1400"><a href="#PriceGenerator-1400"><span class="linenos">1400</span></a>
</span><span id="PriceGenerator-1401"><a href="#PriceGenerator-1401"><span class="linenos">1401</span></a>                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="PriceGenerator-1402"><a href="#PriceGenerator-1402"><span class="linenos">1402</span></a>                        <span class="n">uLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Can&#39;t render HTML! Error message: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="PriceGenerator-1403"><a href="#PriceGenerator-1403"><span class="linenos">1403</span></a>
</span><span id="PriceGenerator-1404"><a href="#PriceGenerator-1404"><span class="linenos">1404</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="PriceGenerator-1405"><a href="#PriceGenerator-1405"><span class="linenos">1405</span></a>                        <span class="n">uLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Pandas DataFrame saved as HTML-file [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">fileName</span><span class="p">)))</span>
</span><span id="PriceGenerator-1406"><a href="#PriceGenerator-1406"><span class="linenos">1406</span></a>
</span><span id="PriceGenerator-1407"><a href="#PriceGenerator-1407"><span class="linenos">1407</span></a>                    <span class="k">if</span> <span class="n">showStatOnChart</span><span class="p">:</span>
</span><span id="PriceGenerator-1408"><a href="#PriceGenerator-1408"><span class="linenos">1408</span></a>                        <span class="n">mdFile</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.md&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>
</span><span id="PriceGenerator-1409"><a href="#PriceGenerator-1409"><span class="linenos">1409</span></a>                        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">mdFile</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fH</span><span class="p">:</span>
</span><span id="PriceGenerator-1410"><a href="#PriceGenerator-1410"><span class="linenos">1410</span></a>                            <span class="n">fH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">infoBlock</span><span class="p">))</span>
</span><span id="PriceGenerator-1411"><a href="#PriceGenerator-1411"><span class="linenos">1411</span></a>
</span><span id="PriceGenerator-1412"><a href="#PriceGenerator-1412"><span class="linenos">1412</span></a>                            <span class="n">uLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Statistics saved to [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">mdFile</span><span class="p">)))</span>
</span><span id="PriceGenerator-1413"><a href="#PriceGenerator-1413"><span class="linenos">1413</span></a>
</span><span id="PriceGenerator-1414"><a href="#PriceGenerator-1414"><span class="linenos">1414</span></a>                    <span class="k">if</span> <span class="n">viewInBrowser</span><span class="p">:</span>
</span><span id="PriceGenerator-1415"><a href="#PriceGenerator-1415"><span class="linenos">1415</span></a>                        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">fileName</span><span class="p">))</span>  <span class="c1"># view forecast chart in default browser immediately</span>
</span><span id="PriceGenerator-1416"><a href="#PriceGenerator-1416"><span class="linenos">1416</span></a>
</span><span id="PriceGenerator-1417"><a href="#PriceGenerator-1417"><span class="linenos">1417</span></a>            <span class="k">return</span> <span class="n">unionChart</span>
</span><span id="PriceGenerator-1418"><a href="#PriceGenerator-1418"><span class="linenos">1418</span></a>
</span><span id="PriceGenerator-1419"><a href="#PriceGenerator-1419"><span class="linenos">1419</span></a>    <span class="k">def</span> <span class="nf">RenderGoogle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;index.html&quot;</span><span class="p">,</span> <span class="n">viewInBrowser</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PriceGenerator-1420"><a href="#PriceGenerator-1420"><span class="linenos">1420</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="PriceGenerator-1421"><a href="#PriceGenerator-1421"><span class="linenos">1421</span></a><span class="sd">        Rendering prices from Pandas DataFrame as non-interactive Google Candlestick chart and save it to HTML-file.</span>
</span><span id="PriceGenerator-1422"><a href="#PriceGenerator-1422"><span class="linenos">1422</span></a>
</span><span id="PriceGenerator-1423"><a href="#PriceGenerator-1423"><span class="linenos">1423</span></a><span class="sd">        See also: https://developers.google.com/chart/interactive/docs/gallery/candlestickchart</span>
</span><span id="PriceGenerator-1424"><a href="#PriceGenerator-1424"><span class="linenos">1424</span></a>
</span><span id="PriceGenerator-1425"><a href="#PriceGenerator-1425"><span class="linenos">1425</span></a><span class="sd">        :param fileName: HTML-file path to save Google Candlestick chart.</span>
</span><span id="PriceGenerator-1426"><a href="#PriceGenerator-1426"><span class="linenos">1426</span></a><span class="sd">        :param viewInBrowser: If `True`, then immediately opens html in browser after rendering.</span>
</span><span id="PriceGenerator-1427"><a href="#PriceGenerator-1427"><span class="linenos">1427</span></a><span class="sd">        :param title: specific chart title. If `None`, then used auto-generated title. `None` by default.</span>
</span><span id="PriceGenerator-1428"><a href="#PriceGenerator-1428"><span class="linenos">1428</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PriceGenerator-1429"><a href="#PriceGenerator-1429"><span class="linenos">1429</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="PriceGenerator-1430"><a href="#PriceGenerator-1430"><span class="linenos">1430</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Empty price data! Generate or load prices before show as Google Candlestick chart!&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator-1431"><a href="#PriceGenerator-1431"><span class="linenos">1431</span></a>
</span><span id="PriceGenerator-1432"><a href="#PriceGenerator-1432"><span class="linenos">1432</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PriceGenerator-1433"><a href="#PriceGenerator-1433"><span class="linenos">1433</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Rendering Pandas DataFrame as Google Candlestick chart...&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator-1434"><a href="#PriceGenerator-1434"><span class="linenos">1434</span></a>
</span><span id="PriceGenerator-1435"><a href="#PriceGenerator-1435"><span class="linenos">1435</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">DetectTimeframe</span><span class="p">()</span>  <span class="c1"># auto-detect time delta between last two neighbour candles</span>
</span><span id="PriceGenerator-1436"><a href="#PriceGenerator-1436"><span class="linenos">1436</span></a>            <span class="n">infoBlock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetStatistics</span><span class="p">()</span>  <span class="c1"># calculating some indicators</span>
</span><span id="PriceGenerator-1437"><a href="#PriceGenerator-1437"><span class="linenos">1437</span></a>
</span><span id="PriceGenerator-1438"><a href="#PriceGenerator-1438"><span class="linenos">1438</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chartTitle</span> <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">title</span> <span class="k">else</span> <span class="n">title</span>  <span class="c1"># chart title</span>
</span><span id="PriceGenerator-1439"><a href="#PriceGenerator-1439"><span class="linenos">1439</span></a>
</span><span id="PriceGenerator-1440"><a href="#PriceGenerator-1440"><span class="linenos">1440</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">j2model</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">j2model</span><span class="p">:</span>
</span><span id="PriceGenerator-1441"><a href="#PriceGenerator-1441"><span class="linenos">1441</span></a>                <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Preparing Google Candlestick chart configuration...&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator-1442"><a href="#PriceGenerator-1442"><span class="linenos">1442</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">j2model</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;info&quot;</span><span class="p">:</span> <span class="n">infoBlock</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">title</span><span class="p">}</span>
</span><span id="PriceGenerator-1443"><a href="#PriceGenerator-1443"><span class="linenos">1443</span></a>                <span class="n">googleDates</span> <span class="o">=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">date</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
</span><span id="PriceGenerator-1444"><a href="#PriceGenerator-1444"><span class="linenos">1444</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">googleDates</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">low</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">open</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">high</span><span class="p">)</span>
</span><span id="PriceGenerator-1445"><a href="#PriceGenerator-1445"><span class="linenos">1445</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">j2model</span><span class="p">[</span><span class="s2">&quot;candlesData&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
</span><span id="PriceGenerator-1446"><a href="#PriceGenerator-1446"><span class="linenos">1446</span></a>
</span><span id="PriceGenerator-1447"><a href="#PriceGenerator-1447"><span class="linenos">1447</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PriceGenerator-1448"><a href="#PriceGenerator-1448"><span class="linenos">1448</span></a>                <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Using custom chart model&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator-1449"><a href="#PriceGenerator-1449"><span class="linenos">1449</span></a>
</span><span id="PriceGenerator-1450"><a href="#PriceGenerator-1450"><span class="linenos">1450</span></a>            <span class="c1"># --- Rendering and saving chart as HTML-file and markdown-file with statistics:</span>
</span><span id="PriceGenerator-1451"><a href="#PriceGenerator-1451"><span class="linenos">1451</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">j2template</span><span class="p">):</span>
</span><span id="PriceGenerator-1452"><a href="#PriceGenerator-1452"><span class="linenos">1452</span></a>                <span class="n">renderedTemplate</span> <span class="o">=</span> <span class="n">jinja2</span><span class="o">.</span><span class="n">Template</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">j2template</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span><span id="PriceGenerator-1453"><a href="#PriceGenerator-1453"><span class="linenos">1453</span></a>
</span><span id="PriceGenerator-1454"><a href="#PriceGenerator-1454"><span class="linenos">1454</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PriceGenerator-1455"><a href="#PriceGenerator-1455"><span class="linenos">1455</span></a>                <span class="n">renderedTemplate</span> <span class="o">=</span> <span class="n">jinja2</span><span class="o">.</span><span class="n">Template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">j2template</span><span class="p">)</span>
</span><span id="PriceGenerator-1456"><a href="#PriceGenerator-1456"><span class="linenos">1456</span></a>
</span><span id="PriceGenerator-1457"><a href="#PriceGenerator-1457"><span class="linenos">1457</span></a>            <span class="n">htmlMain</span> <span class="o">=</span> <span class="n">renderedTemplate</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">j2model</span><span class="p">)</span>
</span><span id="PriceGenerator-1458"><a href="#PriceGenerator-1458"><span class="linenos">1458</span></a>
</span><span id="PriceGenerator-1459"><a href="#PriceGenerator-1459"><span class="linenos">1459</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fH</span><span class="p">:</span>
</span><span id="PriceGenerator-1460"><a href="#PriceGenerator-1460"><span class="linenos">1460</span></a>                <span class="n">fH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">htmlMain</span><span class="p">)</span>
</span><span id="PriceGenerator-1461"><a href="#PriceGenerator-1461"><span class="linenos">1461</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.md&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fileName</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fH</span><span class="p">:</span>
</span><span id="PriceGenerator-1462"><a href="#PriceGenerator-1462"><span class="linenos">1462</span></a>                <span class="n">fH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">infoBlock</span><span class="p">))</span>
</span><span id="PriceGenerator-1463"><a href="#PriceGenerator-1463"><span class="linenos">1463</span></a>
</span><span id="PriceGenerator-1464"><a href="#PriceGenerator-1464"><span class="linenos">1464</span></a>            <span class="k">if</span> <span class="n">viewInBrowser</span><span class="p">:</span>
</span><span id="PriceGenerator-1465"><a href="#PriceGenerator-1465"><span class="linenos">1465</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">fileName</span><span class="p">))</span>  <span class="c1"># view forecast chart in default browser immediately</span>
</span><span id="PriceGenerator-1466"><a href="#PriceGenerator-1466"><span class="linenos">1466</span></a>
</span><span id="PriceGenerator-1467"><a href="#PriceGenerator-1467"><span class="linenos">1467</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Pandas DataFrame rendered as HTML-file [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">fileName</span><span class="p">)))</span>
</span></pre></div>


            <div class="docstring"><p>This class implements methods to generation of prices statistically similar to real ones.</p>

<p><strong>Model generated: OHLCV-candlesticks (open, high, low, close, volume).</strong></p>
</div>


                            <div id="PriceGenerator.__init__" class="classattr">
                                        <input id="PriceGenerator.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">PriceGenerator</span><span class="signature pdoc-code condensed">()</span>

                <label class="view-source-button" for="PriceGenerator.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PriceGenerator.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PriceGenerator.__init__-219"><a href="#PriceGenerator.__init__-219"><span class="linenos">219</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="PriceGenerator.__init__-220"><a href="#PriceGenerator.__init__-220"><span class="linenos">220</span></a>        <span class="sd">&quot;&quot;&quot;Main class init.&quot;&quot;&quot;</span>
</span><span id="PriceGenerator.__init__-221"><a href="#PriceGenerator.__init__-221"><span class="linenos">221</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PriceGenerator.__init__-222"><a href="#PriceGenerator.__init__-222"><span class="linenos">222</span></a>        <span class="sd">&quot;&quot;&quot;Generated or loaded prices will be available in this Pandas DataFrame variable.&quot;&quot;&quot;</span>
</span><span id="PriceGenerator.__init__-223"><a href="#PriceGenerator.__init__-223"><span class="linenos">223</span></a>
</span><span id="PriceGenerator.__init__-224"><a href="#PriceGenerator.__init__-224"><span class="linenos">224</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">csvHeaders</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;open&quot;</span><span class="p">,</span> <span class="s2">&quot;high&quot;</span><span class="p">,</span> <span class="s2">&quot;low&quot;</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">,</span> <span class="s2">&quot;volume&quot;</span><span class="p">]</span>
</span><span id="PriceGenerator.__init__-225"><a href="#PriceGenerator.__init__-225"><span class="linenos">225</span></a>        <span class="sd">&quot;&quot;&quot;Headers in .CSV-file. Default: `[&quot;date&quot;, &quot;time&quot;, &quot;open&quot;, &quot;high&quot;, &quot;low&quot;, &quot;close&quot;, &quot;volume&quot;]`.&quot;&quot;&quot;</span>
</span><span id="PriceGenerator.__init__-226"><a href="#PriceGenerator.__init__-226"><span class="linenos">226</span></a>
</span><span id="PriceGenerator.__init__-227"><a href="#PriceGenerator.__init__-227"><span class="linenos">227</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dfHeaders</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;datetime&quot;</span><span class="p">,</span> <span class="s2">&quot;open&quot;</span><span class="p">,</span> <span class="s2">&quot;high&quot;</span><span class="p">,</span> <span class="s2">&quot;low&quot;</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">,</span> <span class="s2">&quot;volume&quot;</span><span class="p">]</span>
</span><span id="PriceGenerator.__init__-228"><a href="#PriceGenerator.__init__-228"><span class="linenos">228</span></a>        <span class="sd">&quot;&quot;&quot;Headers in Pandas DataFrame. Default: `[&quot;datetime&quot;, &quot;open&quot;, &quot;high&quot;, &quot;low&quot;, &quot;close&quot;, &quot;volume&quot;]`.&quot;&quot;&quot;</span>
</span><span id="PriceGenerator.__init__-229"><a href="#PriceGenerator.__init__-229"><span class="linenos">229</span></a>
</span><span id="PriceGenerator.__init__-230"><a href="#PriceGenerator.__init__-230"><span class="linenos">230</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span>
</span><span id="PriceGenerator.__init__-231"><a href="#PriceGenerator.__init__-231"><span class="linenos">231</span></a>        <span class="sd">&quot;&quot;&quot;Separator in csv - file. Default: `,`&quot;&quot;&quot;</span>
</span><span id="PriceGenerator.__init__-232"><a href="#PriceGenerator.__init__-232"><span class="linenos">232</span></a>
</span><span id="PriceGenerator.__init__-233"><a href="#PriceGenerator.__init__-233"><span class="linenos">233</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">j2template</span> <span class="o">=</span> <span class="n">GOOGLE_TEMPLATE_J2</span>
</span><span id="PriceGenerator.__init__-234"><a href="#PriceGenerator.__init__-234"><span class="linenos">234</span></a>        <span class="sd">&quot;&quot;&quot;Full path to custom jinja2 html-template file (e.g. `google_template_example.j2`) or just set here a long multi-string variable. Default: `GOOGLE_TEMPLATE_J2` is a multi-string variable with internal template.&quot;&quot;&quot;</span>
</span><span id="PriceGenerator.__init__-235"><a href="#PriceGenerator.__init__-235"><span class="linenos">235</span></a>
</span><span id="PriceGenerator.__init__-236"><a href="#PriceGenerator.__init__-236"><span class="linenos">236</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">j2model</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PriceGenerator.__init__-237"><a href="#PriceGenerator.__init__-237"><span class="linenos">237</span></a>        <span class="sd">&quot;&quot;&quot;Dictionary of variables for jinja2 template. If `None` then used default variables for internal `GOOGLE_TEMPLATE_J2`&quot;&quot;&quot;</span>
</span><span id="PriceGenerator.__init__-238"><a href="#PriceGenerator.__init__-238"><span class="linenos">238</span></a>
</span><span id="PriceGenerator.__init__-239"><a href="#PriceGenerator.__init__-239"><span class="linenos">239</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_precision</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="PriceGenerator.__init__-240"><a href="#PriceGenerator.__init__-240"><span class="linenos">240</span></a>        <span class="sd">&quot;&quot;&quot;Signs after comma. Default: `2`.&quot;&quot;&quot;</span>
</span><span id="PriceGenerator.__init__-241"><a href="#PriceGenerator.__init__-241"><span class="linenos">241</span></a>
</span><span id="PriceGenerator.__init__-242"><a href="#PriceGenerator.__init__-242"><span class="linenos">242</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_deg10prec</span> <span class="o">=</span> <span class="mi">100</span>
</span><span id="PriceGenerator.__init__-243"><a href="#PriceGenerator.__init__-243"><span class="linenos">243</span></a>        <span class="sd">&quot;&quot;&quot;Constant 10^precision is used by some formulas. Not recommended to change it. Default: `100` (`10 ** precision`).&quot;&quot;&quot;</span>
</span><span id="PriceGenerator.__init__-244"><a href="#PriceGenerator.__init__-244"><span class="linenos">244</span></a>
</span><span id="PriceGenerator.__init__-245"><a href="#PriceGenerator.__init__-245"><span class="linenos">245</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ticker</span> <span class="o">=</span> <span class="s2">&quot;TEST&quot;</span>
</span><span id="PriceGenerator.__init__-246"><a href="#PriceGenerator.__init__-246"><span class="linenos">246</span></a>        <span class="sd">&quot;&quot;&quot;Some fake ticker name. Default: `Test`.&quot;&quot;&quot;</span>
</span><span id="PriceGenerator.__init__-247"><a href="#PriceGenerator.__init__-247"><span class="linenos">247</span></a>
</span><span id="PriceGenerator.__init__-248"><a href="#PriceGenerator.__init__-248"><span class="linenos">248</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="PriceGenerator.__init__-249"><a href="#PriceGenerator.__init__-249"><span class="linenos">249</span></a>        <span class="sd">&quot;&quot;&quot;Time delta between two neighbour candles. Default: `timedelta(hours=1)`.&quot;&quot;&quot;</span>
</span><span id="PriceGenerator.__init__-250"><a href="#PriceGenerator.__init__-250"><span class="linenos">250</span></a>
</span><span id="PriceGenerator.__init__-251"><a href="#PriceGenerator.__init__-251"><span class="linenos">251</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">timeStart</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">tzlocal</span><span class="p">())</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">microsecond</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">second</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="PriceGenerator.__init__-252"><a href="#PriceGenerator.__init__-252"><span class="linenos">252</span></a>        <span class="sd">&quot;&quot;&quot;First date and time for candles chain.&quot;&quot;&quot;</span>
</span><span id="PriceGenerator.__init__-253"><a href="#PriceGenerator.__init__-253"><span class="linenos">253</span></a>
</span><span id="PriceGenerator.__init__-254"><a href="#PriceGenerator.__init__-254"><span class="linenos">254</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PriceGenerator.__init__-255"><a href="#PriceGenerator.__init__-255"><span class="linenos">255</span></a>        <span class="sd">&quot;&quot;&quot;Candlesticks count in generated or loaded chain of prices, must be &gt;= 5. Default: `None` (means auto-detect length of chain if loaded from file).&quot;&quot;&quot;</span>
</span><span id="PriceGenerator.__init__-256"><a href="#PriceGenerator.__init__-256"><span class="linenos">256</span></a>
</span><span id="PriceGenerator.__init__-257"><a href="#PriceGenerator.__init__-257"><span class="linenos">257</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="PriceGenerator.__init__-258"><a href="#PriceGenerator.__init__-258"><span class="linenos">258</span></a>        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Set different trends, e.g. `trendSplit=&quot;/\-&quot;` means that generated candles has uptrend at first part, next downtrend and then no trend. Used only together with `splitCount` variable. Also, you can use words: `up`, `down`, `no` or chars: `u`, `d`, `n` with the hyphen symbol as separator, e.g. `trendSplit=up-down-no-up`, `trendSplit=u-d-n-u` etc. Default: `&quot;&quot;`, empty string mean that will be used random trend directions.&quot;&quot;&quot;</span>
</span><span id="PriceGenerator.__init__-259"><a href="#PriceGenerator.__init__-259"><span class="linenos">259</span></a>
</span><span id="PriceGenerator.__init__-260"><a href="#PriceGenerator.__init__-260"><span class="linenos">260</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="PriceGenerator.__init__-261"><a href="#PriceGenerator.__init__-261"><span class="linenos">261</span></a>        <span class="sd">&quot;&quot;&quot;Set candles count in different trends, e.g. `splitCount=[5, 10, 15]` means that generated candles has 3 trends with 5, 10 and 15 candles in chain, with sum must be equal to horizon. Used only together with `trendSplit` variable. Default: `[]`, empty list mean that will be used random candles count in trends.&quot;&quot;&quot;</span>
</span><span id="PriceGenerator.__init__-262"><a href="#PriceGenerator.__init__-262"><span class="linenos">262</span></a>
</span><span id="PriceGenerator.__init__-263"><a href="#PriceGenerator.__init__-263"><span class="linenos">263</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">maxClose</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">70</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
</span><span id="PriceGenerator.__init__-264"><a href="#PriceGenerator.__init__-264"><span class="linenos">264</span></a>        <span class="sd">&quot;&quot;&quot;Maximum of close prices must be &gt;= `minClose`. Default: random in interval `(70, 90)`.&quot;&quot;&quot;</span>
</span><span id="PriceGenerator.__init__-265"><a href="#PriceGenerator.__init__-265"><span class="linenos">265</span></a>
</span><span id="PriceGenerator.__init__-266"><a href="#PriceGenerator.__init__-266"><span class="linenos">266</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">minClose</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">70</span><span class="p">)</span>
</span><span id="PriceGenerator.__init__-267"><a href="#PriceGenerator.__init__-267"><span class="linenos">267</span></a>        <span class="sd">&quot;&quot;&quot;Minimum of close prices must be &lt;= `maxClose`. Default: random in interval `(60, 70)`.&quot;&quot;&quot;</span>
</span><span id="PriceGenerator.__init__-268"><a href="#PriceGenerator.__init__-268"><span class="linenos">268</span></a>
</span><span id="PriceGenerator.__init__-269"><a href="#PriceGenerator.__init__-269"><span class="linenos">269</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initClose</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PriceGenerator.__init__-270"><a href="#PriceGenerator.__init__-270"><span class="linenos">270</span></a>        <span class="sd">&quot;&quot;&quot;First candle close price value. If `None` then used random number in interval between `minClose` and `maxClose`. Default: `None`.&quot;&quot;&quot;</span>
</span><span id="PriceGenerator.__init__-271"><a href="#PriceGenerator.__init__-271"><span class="linenos">271</span></a>
</span><span id="PriceGenerator.__init__-272"><a href="#PriceGenerator.__init__-272"><span class="linenos">272</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">maxOutlier</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PriceGenerator.__init__-273"><a href="#PriceGenerator.__init__-273"><span class="linenos">273</span></a>        <span class="sd">&quot;&quot;&quot;Maximum size of outliers. If `None` then used value `(maxClose - minClose) / 10`. Default: `None`.&quot;&quot;&quot;</span>
</span><span id="PriceGenerator.__init__-274"><a href="#PriceGenerator.__init__-274"><span class="linenos">274</span></a>
</span><span id="PriceGenerator.__init__-275"><a href="#PriceGenerator.__init__-275"><span class="linenos">275</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">maxCandleBody</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PriceGenerator.__init__-276"><a href="#PriceGenerator.__init__-276"><span class="linenos">276</span></a>        <span class="sd">&quot;&quot;&quot;Maximum of candle body sizes: `abs(open - close)`. If `None` then used value `maxOutlier * 90%`. Default: `None`.&quot;&quot;&quot;</span>
</span><span id="PriceGenerator.__init__-277"><a href="#PriceGenerator.__init__-277"><span class="linenos">277</span></a>
</span><span id="PriceGenerator.__init__-278"><a href="#PriceGenerator.__init__-278"><span class="linenos">278</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_maxVolume</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100000</span><span class="p">)</span>
</span><span id="PriceGenerator.__init__-279"><a href="#PriceGenerator.__init__-279"><span class="linenos">279</span></a>        <span class="sd">&quot;&quot;&quot;Maximum of generated trade volumes. Default: random in interval `(0, 100000)`.&quot;&quot;&quot;</span>
</span><span id="PriceGenerator.__init__-280"><a href="#PriceGenerator.__init__-280"><span class="linenos">280</span></a>
</span><span id="PriceGenerator.__init__-281"><a href="#PriceGenerator.__init__-281"><span class="linenos">281</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_upCandlesProb</span> <span class="o">=</span> <span class="mf">0.5</span>
</span><span id="PriceGenerator.__init__-282"><a href="#PriceGenerator.__init__-282"><span class="linenos">282</span></a>        <span class="sd">&quot;&quot;&quot;Probability that next candle is up. Default: `0.5` (means 50% of probability).&quot;&quot;&quot;</span>
</span><span id="PriceGenerator.__init__-283"><a href="#PriceGenerator.__init__-283"><span class="linenos">283</span></a>
</span><span id="PriceGenerator.__init__-284"><a href="#PriceGenerator.__init__-284"><span class="linenos">284</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_outliersProb</span> <span class="o">=</span> <span class="mf">0.03</span>
</span><span id="PriceGenerator.__init__-285"><a href="#PriceGenerator.__init__-285"><span class="linenos">285</span></a>        <span class="sd">&quot;&quot;&quot;Outlier probability (price tails). Default: `0.03` (means 3% of probability).&quot;&quot;&quot;</span>
</span><span id="PriceGenerator.__init__-286"><a href="#PriceGenerator.__init__-286"><span class="linenos">286</span></a>
</span><span id="PriceGenerator.__init__-287"><a href="#PriceGenerator.__init__-287"><span class="linenos">287</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trendDeviation</span> <span class="o">=</span> <span class="mf">0.005</span>
</span><span id="PriceGenerator.__init__-288"><a href="#PriceGenerator.__init__-288"><span class="linenos">288</span></a>        <span class="sd">&quot;&quot;&quot;Relative deviation for trend detection. &quot;NO trend&quot; if `(1st_close - last_close) / 1st_close &lt;= self.trendDeviation`. Default: `0.005` (means ±0.5% of price deviation).&quot;&quot;&quot;</span>
</span><span id="PriceGenerator.__init__-289"><a href="#PriceGenerator.__init__-289"><span class="linenos">289</span></a>
</span><span id="PriceGenerator.__init__-290"><a href="#PriceGenerator.__init__-290"><span class="linenos">290</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_chartTitle</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="PriceGenerator.__init__-291"><a href="#PriceGenerator.__init__-291"><span class="linenos">291</span></a>        <span class="sd">&quot;&quot;&quot;Chart title. It will be auto-generated when loading or creating chain of candlesticks.&quot;&quot;&quot;</span>
</span><span id="PriceGenerator.__init__-292"><a href="#PriceGenerator.__init__-292"><span class="linenos">292</span></a>
</span><span id="PriceGenerator.__init__-293"><a href="#PriceGenerator.__init__-293"><span class="linenos">293</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_zigZagDeviation</span> <span class="o">=</span> <span class="mf">0.03</span>
</span><span id="PriceGenerator.__init__-294"><a href="#PriceGenerator.__init__-294"><span class="linenos">294</span></a>        <span class="sd">&quot;&quot;&quot;Relative deviation to detection next points used by Zig-Zag indicator. Default: `0.03` (means 3% of price deviation).&quot;&quot;&quot;</span>
</span><span id="PriceGenerator.__init__-295"><a href="#PriceGenerator.__init__-295"><span class="linenos">295</span></a>
</span><span id="PriceGenerator.__init__-296"><a href="#PriceGenerator.__init__-296"><span class="linenos">296</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="PriceGenerator.__init__-297"><a href="#PriceGenerator.__init__-297"><span class="linenos">297</span></a>            <span class="s2">&quot;candles&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># generated candlesticks count</span>
</span><span id="PriceGenerator.__init__-298"><a href="#PriceGenerator.__init__-298"><span class="linenos">298</span></a>            <span class="s2">&quot;precision&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>  <span class="c1"># generated candlesticks count</span>
</span><span id="PriceGenerator.__init__-299"><a href="#PriceGenerator.__init__-299"><span class="linenos">299</span></a>            <span class="s2">&quot;closeFirst&quot;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>  <span class="c1"># first close price</span>
</span><span id="PriceGenerator.__init__-300"><a href="#PriceGenerator.__init__-300"><span class="linenos">300</span></a>            <span class="s2">&quot;closeLast&quot;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>  <span class="c1"># last close price</span>
</span><span id="PriceGenerator.__init__-301"><a href="#PriceGenerator.__init__-301"><span class="linenos">301</span></a>            <span class="s2">&quot;closeMax&quot;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>  <span class="c1"># max close price</span>
</span><span id="PriceGenerator.__init__-302"><a href="#PriceGenerator.__init__-302"><span class="linenos">302</span></a>            <span class="s2">&quot;closeMix&quot;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>  <span class="c1"># min close price</span>
</span><span id="PriceGenerator.__init__-303"><a href="#PriceGenerator.__init__-303"><span class="linenos">303</span></a>            <span class="s2">&quot;diapason&quot;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>  <span class="c1"># diapason = closeMax - closeMin</span>
</span><span id="PriceGenerator.__init__-304"><a href="#PriceGenerator.__init__-304"><span class="linenos">304</span></a>            <span class="s2">&quot;trend&quot;</span><span class="p">:</span> <span class="s2">&quot;NO trend&quot;</span><span class="p">,</span>  <span class="c1"># &quot;UP trend&quot; or &quot;DOWN trend&quot; with uses ±self.trendDeviation</span>
</span><span id="PriceGenerator.__init__-305"><a href="#PriceGenerator.__init__-305"><span class="linenos">305</span></a>            <span class="s2">&quot;trendDev&quot;</span><span class="p">:</span> <span class="mf">0.005</span><span class="p">,</span>
</span><span id="PriceGenerator.__init__-306"><a href="#PriceGenerator.__init__-306"><span class="linenos">306</span></a>            <span class="s2">&quot;upCount&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># count of up candles</span>
</span><span id="PriceGenerator.__init__-307"><a href="#PriceGenerator.__init__-307"><span class="linenos">307</span></a>            <span class="s2">&quot;downCount&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># count of down candles</span>
</span><span id="PriceGenerator.__init__-308"><a href="#PriceGenerator.__init__-308"><span class="linenos">308</span></a>            <span class="s2">&quot;upCountChainMax&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># max chain count of up candles</span>
</span><span id="PriceGenerator.__init__-309"><a href="#PriceGenerator.__init__-309"><span class="linenos">309</span></a>            <span class="s2">&quot;downCountChainMax&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># max chain count of down candles</span>
</span><span id="PriceGenerator.__init__-310"><a href="#PriceGenerator.__init__-310"><span class="linenos">310</span></a>            <span class="s2">&quot;deltas&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="PriceGenerator.__init__-311"><a href="#PriceGenerator.__init__-311"><span class="linenos">311</span></a>                <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>  <span class="c1"># delta max = max(close_prices)</span>
</span><span id="PriceGenerator.__init__-312"><a href="#PriceGenerator.__init__-312"><span class="linenos">312</span></a>                <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>  <span class="c1"># delta min = min(close_prices)</span>
</span><span id="PriceGenerator.__init__-313"><a href="#PriceGenerator.__init__-313"><span class="linenos">313</span></a>                <span class="s2">&quot;stDev&quot;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>  <span class="c1"># standard deviation</span>
</span><span id="PriceGenerator.__init__-314"><a href="#PriceGenerator.__init__-314"><span class="linenos">314</span></a>                <span class="s2">&quot;q99&quot;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>  <span class="c1"># 99 percentile</span>
</span><span id="PriceGenerator.__init__-315"><a href="#PriceGenerator.__init__-315"><span class="linenos">315</span></a>                <span class="s2">&quot;q95&quot;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>  <span class="c1"># 95 percentile</span>
</span><span id="PriceGenerator.__init__-316"><a href="#PriceGenerator.__init__-316"><span class="linenos">316</span></a>                <span class="s2">&quot;q80&quot;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>  <span class="c1"># 80 percentile</span>
</span><span id="PriceGenerator.__init__-317"><a href="#PriceGenerator.__init__-317"><span class="linenos">317</span></a>                <span class="s2">&quot;q50&quot;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>  <span class="c1"># 50 percentile</span>
</span><span id="PriceGenerator.__init__-318"><a href="#PriceGenerator.__init__-318"><span class="linenos">318</span></a>            <span class="p">},</span>
</span><span id="PriceGenerator.__init__-319"><a href="#PriceGenerator.__init__-319"><span class="linenos">319</span></a>            <span class="s2">&quot;cumSumVolumes&quot;</span><span class="p">:</span> <span class="mi">0</span>  <span class="c1"># cumulative sum of volumes</span>
</span><span id="PriceGenerator.__init__-320"><a href="#PriceGenerator.__init__-320"><span class="linenos">320</span></a>        <span class="p">}</span>
</span><span id="PriceGenerator.__init__-321"><a href="#PriceGenerator.__init__-321"><span class="linenos">321</span></a>        <span class="sd">&quot;&quot;&quot;Some statistics available after candles loaded or generated.&quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Main class init.</p>
</div>


                            </div>
                            <div id="PriceGenerator.prices" class="classattr">
                                <div class="attr variable">
            <span class="name">prices</span>

        
    </div>
    <a class="headerlink" href="#PriceGenerator.prices"></a>
    
            <div class="docstring"><p>Generated or loaded prices will be available in this Pandas DataFrame variable.</p>
</div>


                            </div>
                            <div id="PriceGenerator.csvHeaders" class="classattr">
                                <div class="attr variable">
            <span class="name">csvHeaders</span>

        
    </div>
    <a class="headerlink" href="#PriceGenerator.csvHeaders"></a>
    
            <div class="docstring"><p>Headers in .CSV-file. Default: <code>["date", "time", "open", "high", "low", "close", "volume"]</code>.</p>
</div>


                            </div>
                            <div id="PriceGenerator.dfHeaders" class="classattr">
                                <div class="attr variable">
            <span class="name">dfHeaders</span>

        
    </div>
    <a class="headerlink" href="#PriceGenerator.dfHeaders"></a>
    
            <div class="docstring"><p>Headers in Pandas DataFrame. Default: <code>["datetime", "open", "high", "low", "close", "volume"]</code>.</p>
</div>


                            </div>
                            <div id="PriceGenerator.sep" class="classattr">
                                <div class="attr variable">
            <span class="name">sep</span>

        
    </div>
    <a class="headerlink" href="#PriceGenerator.sep"></a>
    
            <div class="docstring"><p>Separator in csv - file. Default: <code>,</code></p>
</div>


                            </div>
                            <div id="PriceGenerator.j2template" class="classattr">
                                <div class="attr variable">
            <span class="name">j2template</span>

        
    </div>
    <a class="headerlink" href="#PriceGenerator.j2template"></a>
    
            <div class="docstring"><p>Full path to custom jinja2 html-template file (e.g. <code>google_template_example.j2</code>) or just set here a long multi-string variable. Default: <code>GOOGLE_TEMPLATE_J2</code> is a multi-string variable with internal template.</p>
</div>


                            </div>
                            <div id="PriceGenerator.j2model" class="classattr">
                                <div class="attr variable">
            <span class="name">j2model</span>

        
    </div>
    <a class="headerlink" href="#PriceGenerator.j2model"></a>
    
            <div class="docstring"><p>Dictionary of variables for jinja2 template. If <code>None</code> then used default variables for internal <code>GOOGLE_TEMPLATE_J2</code></p>
</div>


                            </div>
                            <div id="PriceGenerator.ticker" class="classattr">
                                <div class="attr variable">
            <span class="name">ticker</span>

        
    </div>
    <a class="headerlink" href="#PriceGenerator.ticker"></a>
    
            <div class="docstring"><p>Some fake ticker name. Default: <code>Test</code>.</p>
</div>


                            </div>
                            <div id="PriceGenerator.timeframe" class="classattr">
                                <div class="attr variable">
            <span class="name">timeframe</span>

        
    </div>
    <a class="headerlink" href="#PriceGenerator.timeframe"></a>
    
            <div class="docstring"><p>Time delta between two neighbour candles. Default: <code>timedelta(hours=1)</code>.</p>
</div>


                            </div>
                            <div id="PriceGenerator.timeStart" class="classattr">
                                <div class="attr variable">
            <span class="name">timeStart</span>

        
    </div>
    <a class="headerlink" href="#PriceGenerator.timeStart"></a>
    
            <div class="docstring"><p>First date and time for candles chain.</p>
</div>


                            </div>
                            <div id="PriceGenerator.horizon" class="classattr">
                                <div class="attr variable">
            <span class="name">horizon</span>

        
    </div>
    <a class="headerlink" href="#PriceGenerator.horizon"></a>
    
            <div class="docstring"><p>Candlesticks count in generated or loaded chain of prices, must be &gt;= 5. Default: <code>None</code> (means auto-detect length of chain if loaded from file).</p>
</div>


                            </div>
                            <div id="PriceGenerator.trendSplit" class="classattr">
                                <div class="attr variable">
            <span class="name">trendSplit</span>

        
    </div>
    <a class="headerlink" href="#PriceGenerator.trendSplit"></a>
    
            <div class="docstring"><p>Set different trends, e.g. <code>trendSplit="/\-"</code> means that generated candles has uptrend at first part, next downtrend and then no trend. Used only together with <code><a href="#PriceGenerator.splitCount">splitCount</a></code> variable. Also, you can use words: <code>up</code>, <code>down</code>, <code>no</code> or chars: <code>u</code>, <code>d</code>, <code>n</code> with the hyphen symbol as separator, e.g. <code>trendSplit=up-down-no-up</code>, <code>trendSplit=u-d-n-u</code> etc. Default: <code>""</code>, empty string mean that will be used random trend directions.</p>
</div>


                            </div>
                            <div id="PriceGenerator.splitCount" class="classattr">
                                <div class="attr variable">
            <span class="name">splitCount</span>

        
    </div>
    <a class="headerlink" href="#PriceGenerator.splitCount"></a>
    
            <div class="docstring"><p>Set candles count in different trends, e.g. <code>splitCount=[5, 10, 15]</code> means that generated candles has 3 trends with 5, 10 and 15 candles in chain, with sum must be equal to horizon. Used only together with <code><a href="#PriceGenerator.trendSplit">trendSplit</a></code> variable. Default: <code>[]</code>, empty list mean that will be used random candles count in trends.</p>
</div>


                            </div>
                            <div id="PriceGenerator.maxClose" class="classattr">
                                <div class="attr variable">
            <span class="name">maxClose</span>

        
    </div>
    <a class="headerlink" href="#PriceGenerator.maxClose"></a>
    
            <div class="docstring"><p>Maximum of close prices must be &gt;= <code><a href="#PriceGenerator.minClose">minClose</a></code>. Default: random in interval <code>(70, 90)</code>.</p>
</div>


                            </div>
                            <div id="PriceGenerator.minClose" class="classattr">
                                <div class="attr variable">
            <span class="name">minClose</span>

        
    </div>
    <a class="headerlink" href="#PriceGenerator.minClose"></a>
    
            <div class="docstring"><p>Minimum of close prices must be &lt;= <code><a href="#PriceGenerator.maxClose">maxClose</a></code>. Default: random in interval <code>(60, 70)</code>.</p>
</div>


                            </div>
                            <div id="PriceGenerator.initClose" class="classattr">
                                <div class="attr variable">
            <span class="name">initClose</span>

        
    </div>
    <a class="headerlink" href="#PriceGenerator.initClose"></a>
    
            <div class="docstring"><p>First candle close price value. If <code>None</code> then used random number in interval between <code><a href="#PriceGenerator.minClose">minClose</a></code> and <code><a href="#PriceGenerator.maxClose">maxClose</a></code>. Default: <code>None</code>.</p>
</div>


                            </div>
                            <div id="PriceGenerator.maxOutlier" class="classattr">
                                <div class="attr variable">
            <span class="name">maxOutlier</span>

        
    </div>
    <a class="headerlink" href="#PriceGenerator.maxOutlier"></a>
    
            <div class="docstring"><p>Maximum size of outliers. If <code>None</code> then used value <code>(maxClose - minClose) / 10</code>. Default: <code>None</code>.</p>
</div>


                            </div>
                            <div id="PriceGenerator.maxCandleBody" class="classattr">
                                <div class="attr variable">
            <span class="name">maxCandleBody</span>

        
    </div>
    <a class="headerlink" href="#PriceGenerator.maxCandleBody"></a>
    
            <div class="docstring"><p>Maximum of candle body sizes: <code>abs(open - close)</code>. If <code>None</code> then used value <code>maxOutlier * 90%</code>. Default: <code>None</code>.</p>
</div>


                            </div>
                            <div id="PriceGenerator.upCandlesProb" class="classattr">
                                <div class="attr variable">
            <span class="name">upCandlesProb</span>

        
    </div>
    <a class="headerlink" href="#PriceGenerator.upCandlesProb"></a>
    
            <div class="docstring"><p>Probability that next candle is up. Default: <code>0.5</code> (means 50% of probability).</p>
</div>


                            </div>
                            <div id="PriceGenerator.outliersProb" class="classattr">
                                <div class="attr variable">
            <span class="name">outliersProb</span>

        
    </div>
    <a class="headerlink" href="#PriceGenerator.outliersProb"></a>
    
            <div class="docstring"><p>Outlier probability (price tails). Default: <code>0.03</code> (means 3% of probability).</p>
</div>


                            </div>
                            <div id="PriceGenerator.trendDeviation" class="classattr">
                                <div class="attr variable">
            <span class="name">trendDeviation</span>

        
    </div>
    <a class="headerlink" href="#PriceGenerator.trendDeviation"></a>
    
            <div class="docstring"><p>Relative deviation for trend detection. "NO trend" if <code>(1st_close - last_close) / 1st_close &lt;= self.trendDeviation</code>. Default: <code>0.005</code> (means ±0.5% of price deviation).</p>
</div>


                            </div>
                            <div id="PriceGenerator.maxVolume" class="classattr">
                                <div class="attr variable">
            <span class="name">maxVolume</span>

        
    </div>
    <a class="headerlink" href="#PriceGenerator.maxVolume"></a>
    
            <div class="docstring"><p>Maximum of generated trade volumes. Default: random in interval <code>(0, 100000)</code>.</p>
</div>


                            </div>
                            <div id="PriceGenerator.stat" class="classattr">
                                <div class="attr variable">
            <span class="name">stat</span><span class="annotation">: dict</span>

        
    </div>
    <a class="headerlink" href="#PriceGenerator.stat"></a>
    
            <div class="docstring"><p>Some statistics available after candles loaded or generated.</p>
</div>


                            </div>
                            <div id="PriceGenerator.precision" class="classattr">
                                <div class="attr variable">
            <span class="name">precision</span>

        
    </div>
    <a class="headerlink" href="#PriceGenerator.precision"></a>
    
            <div class="docstring"><p>Signs after comma.</p>
</div>


                            </div>
                            <div id="PriceGenerator.zigZagDeviation" class="classattr">
                                <div class="attr variable">
            <span class="name">zigZagDeviation</span>

        
    </div>
    <a class="headerlink" href="#PriceGenerator.zigZagDeviation"></a>
    
            <div class="docstring"><p>Relative deviation to detection next points used by Zig-Zag indicator. Default: 0.03 (means 3% of price deviation).</p>
</div>


                            </div>
                            <div id="PriceGenerator.FormattedDelta" class="classattr">
                                        <input id="PriceGenerator.FormattedDelta-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">FormattedDelta</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">tDelta</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span>, </span><span class="param"><span class="n">fmt</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="PriceGenerator.FormattedDelta-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PriceGenerator.FormattedDelta"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PriceGenerator.FormattedDelta-420"><a href="#PriceGenerator.FormattedDelta-420"><span class="linenos">420</span></a>    <span class="nd">@staticmethod</span>
</span><span id="PriceGenerator.FormattedDelta-421"><a href="#PriceGenerator.FormattedDelta-421"><span class="linenos">421</span></a>    <span class="k">def</span> <span class="nf">FormattedDelta</span><span class="p">(</span><span class="n">tDelta</span><span class="p">:</span> <span class="n">timedelta</span><span class="p">,</span> <span class="n">fmt</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="PriceGenerator.FormattedDelta-422"><a href="#PriceGenerator.FormattedDelta-422"><span class="linenos">422</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="PriceGenerator.FormattedDelta-423"><a href="#PriceGenerator.FormattedDelta-423"><span class="linenos">423</span></a><span class="sd">        Pretty format for timedelta objects.</span>
</span><span id="PriceGenerator.FormattedDelta-424"><a href="#PriceGenerator.FormattedDelta-424"><span class="linenos">424</span></a>
</span><span id="PriceGenerator.FormattedDelta-425"><a href="#PriceGenerator.FormattedDelta-425"><span class="linenos">425</span></a><span class="sd">        Example: `FormattedDelta(timedelta(days=2, hours=3, minutes=15, seconds=35), &quot;{days} days {hours}:{minutes}:{seconds}&quot;) -&gt; &quot;2 days 3:15:35&quot;`.</span>
</span><span id="PriceGenerator.FormattedDelta-426"><a href="#PriceGenerator.FormattedDelta-426"><span class="linenos">426</span></a>
</span><span id="PriceGenerator.FormattedDelta-427"><a href="#PriceGenerator.FormattedDelta-427"><span class="linenos">427</span></a><span class="sd">        :return: timedelta object formatted as a string.</span>
</span><span id="PriceGenerator.FormattedDelta-428"><a href="#PriceGenerator.FormattedDelta-428"><span class="linenos">428</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PriceGenerator.FormattedDelta-429"><a href="#PriceGenerator.FormattedDelta-429"><span class="linenos">429</span></a>        <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;days&quot;</span><span class="p">:</span> <span class="n">tDelta</span><span class="o">.</span><span class="n">days</span><span class="p">}</span>
</span><span id="PriceGenerator.FormattedDelta-430"><a href="#PriceGenerator.FormattedDelta-430"><span class="linenos">430</span></a>        <span class="n">d</span><span class="p">[</span><span class="s2">&quot;hours&quot;</span><span class="p">],</span> <span class="n">rem</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">tDelta</span><span class="o">.</span><span class="n">seconds</span><span class="p">,</span> <span class="mi">3600</span><span class="p">)</span>
</span><span id="PriceGenerator.FormattedDelta-431"><a href="#PriceGenerator.FormattedDelta-431"><span class="linenos">431</span></a>        <span class="n">d</span><span class="p">[</span><span class="s2">&quot;minutes&quot;</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;seconds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">rem</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
</span><span id="PriceGenerator.FormattedDelta-432"><a href="#PriceGenerator.FormattedDelta-432"><span class="linenos">432</span></a>
</span><span id="PriceGenerator.FormattedDelta-433"><a href="#PriceGenerator.FormattedDelta-433"><span class="linenos">433</span></a>        <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pretty format for timedelta objects.</p>

<p>Example: <code>FormattedDelta(timedelta(days=2, hours=3, minutes=15, seconds=35), "{days} days {hours}:{minutes}:{seconds}") -&gt; "2 days 3:15:35"</code>.</p>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>timedelta object formatted as a string.</p>
</blockquote>
</div>


                            </div>
                            <div id="PriceGenerator.DetectPrecision" class="classattr">
                                        <input id="PriceGenerator.DetectPrecision-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">DetectPrecision</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">examples</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="PriceGenerator.DetectPrecision-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PriceGenerator.DetectPrecision"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PriceGenerator.DetectPrecision-435"><a href="#PriceGenerator.DetectPrecision-435"><span class="linenos">435</span></a>    <span class="k">def</span> <span class="nf">DetectPrecision</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">examples</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="nb">list</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="PriceGenerator.DetectPrecision-436"><a href="#PriceGenerator.DetectPrecision-436"><span class="linenos">436</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="PriceGenerator.DetectPrecision-437"><a href="#PriceGenerator.DetectPrecision-437"><span class="linenos">437</span></a><span class="sd">        Auto-detect precision from example values. E.g. `0.123 -&gt; 3`, `0.12345 -&gt; 5` and so on.</span>
</span><span id="PriceGenerator.DetectPrecision-438"><a href="#PriceGenerator.DetectPrecision-438"><span class="linenos">438</span></a><span class="sd">        This method change `precision` variable after detect precision.</span>
</span><span id="PriceGenerator.DetectPrecision-439"><a href="#PriceGenerator.DetectPrecision-439"><span class="linenos">439</span></a>
</span><span id="PriceGenerator.DetectPrecision-440"><a href="#PriceGenerator.DetectPrecision-440"><span class="linenos">440</span></a><span class="sd">        See also about statistics.mode: https://docs.python.org/3.9/library/statistics.html#statistics.mode</span>
</span><span id="PriceGenerator.DetectPrecision-441"><a href="#PriceGenerator.DetectPrecision-441"><span class="linenos">441</span></a><span class="sd">        Changed in Python version &gt;= 3.8: Now mode() method handles multimodal datasets by returning the first mode encountered.</span>
</span><span id="PriceGenerator.DetectPrecision-442"><a href="#PriceGenerator.DetectPrecision-442"><span class="linenos">442</span></a><span class="sd">        Previously, it raised StatisticsError when more than one mode was found.</span>
</span><span id="PriceGenerator.DetectPrecision-443"><a href="#PriceGenerator.DetectPrecision-443"><span class="linenos">443</span></a>
</span><span id="PriceGenerator.DetectPrecision-444"><a href="#PriceGenerator.DetectPrecision-444"><span class="linenos">444</span></a><span class="sd">        :param examples: chain with examples of float values.</span>
</span><span id="PriceGenerator.DetectPrecision-445"><a href="#PriceGenerator.DetectPrecision-445"><span class="linenos">445</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PriceGenerator.DetectPrecision-446"><a href="#PriceGenerator.DetectPrecision-446"><span class="linenos">446</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Detecting precision of data values...&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator.DetectPrecision-447"><a href="#PriceGenerator.DetectPrecision-447"><span class="linenos">447</span></a>        <span class="n">precision</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="PriceGenerator.DetectPrecision-448"><a href="#PriceGenerator.DetectPrecision-448"><span class="linenos">448</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="PriceGenerator.DetectPrecision-449"><a href="#PriceGenerator.DetectPrecision-449"><span class="linenos">449</span></a>            <span class="n">precision</span> <span class="o">=</span> <span class="n">mode</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">examples</span><span class="p">)))</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="PriceGenerator.DetectPrecision-450"><a href="#PriceGenerator.DetectPrecision-450"><span class="linenos">450</span></a>
</span><span id="PriceGenerator.DetectPrecision-451"><a href="#PriceGenerator.DetectPrecision-451"><span class="linenos">451</span></a>        <span class="k">except</span> <span class="n">StatisticsError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="PriceGenerator.DetectPrecision-452"><a href="#PriceGenerator.DetectPrecision-452"><span class="linenos">452</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Statistic mode() method return an error! Precision is set to 2 (default). StatisticsError: &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="PriceGenerator.DetectPrecision-453"><a href="#PriceGenerator.DetectPrecision-453"><span class="linenos">453</span></a>            <span class="n">precision</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="PriceGenerator.DetectPrecision-454"><a href="#PriceGenerator.DetectPrecision-454"><span class="linenos">454</span></a>
</span><span id="PriceGenerator.DetectPrecision-455"><a href="#PriceGenerator.DetectPrecision-455"><span class="linenos">455</span></a>        <span class="k">finally</span><span class="p">:</span>
</span><span id="PriceGenerator.DetectPrecision-456"><a href="#PriceGenerator.DetectPrecision-456"><span class="linenos">456</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Auto-detected precision: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">precision</span><span class="p">))</span>
</span><span id="PriceGenerator.DetectPrecision-457"><a href="#PriceGenerator.DetectPrecision-457"><span class="linenos">457</span></a>
</span><span id="PriceGenerator.DetectPrecision-458"><a href="#PriceGenerator.DetectPrecision-458"><span class="linenos">458</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">precision</span> <span class="o">=</span> <span class="n">precision</span>
</span><span id="PriceGenerator.DetectPrecision-459"><a href="#PriceGenerator.DetectPrecision-459"><span class="linenos">459</span></a>
</span><span id="PriceGenerator.DetectPrecision-460"><a href="#PriceGenerator.DetectPrecision-460"><span class="linenos">460</span></a>        <span class="k">return</span> <span class="n">precision</span>
</span></pre></div>


            <div class="docstring"><p>Auto-detect precision from example values. E.g. <code>0.123 -&gt; 3</code>, <code>0.12345 -&gt; 5</code> and so on.
This method change <code><a href="#PriceGenerator.precision">precision</a></code> variable after detect precision.</p>

<p>See also about statistics.mode: <a href="https://docs.python.org/3.9/library/statistics.html#statistics.mode">https://docs.python.org/3.9/library/statistics.html#statistics.mode</a>
Changed in Python version &gt;= 3.8: Now mode() method handles multimodal datasets by returning the first mode encountered.
Previously, it raised StatisticsError when more than one mode was found.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>examples</strong>:  chain with examples of float values.</li>
</ul>
</div>


                            </div>
                            <div id="PriceGenerator.DetectTimeframe" class="classattr">
                                        <input id="PriceGenerator.DetectTimeframe-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">DetectTimeframe</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span>:</span></span>

                <label class="view-source-button" for="PriceGenerator.DetectTimeframe-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PriceGenerator.DetectTimeframe"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PriceGenerator.DetectTimeframe-462"><a href="#PriceGenerator.DetectTimeframe-462"><span class="linenos">462</span></a>    <span class="k">def</span> <span class="nf">DetectTimeframe</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">timedelta</span><span class="p">:</span>
</span><span id="PriceGenerator.DetectTimeframe-463"><a href="#PriceGenerator.DetectTimeframe-463"><span class="linenos">463</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="PriceGenerator.DetectTimeframe-464"><a href="#PriceGenerator.DetectTimeframe-464"><span class="linenos">464</span></a><span class="sd">        Auto-detect time delta between last two neighbour candles.</span>
</span><span id="PriceGenerator.DetectTimeframe-465"><a href="#PriceGenerator.DetectTimeframe-465"><span class="linenos">465</span></a>
</span><span id="PriceGenerator.DetectTimeframe-466"><a href="#PriceGenerator.DetectTimeframe-466"><span class="linenos">466</span></a><span class="sd">        :return: timedelta object, also saved to `timeframe`.</span>
</span><span id="PriceGenerator.DetectTimeframe-467"><a href="#PriceGenerator.DetectTimeframe-467"><span class="linenos">467</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PriceGenerator.DetectTimeframe-468"><a href="#PriceGenerator.DetectTimeframe-468"><span class="linenos">468</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
</span><span id="PriceGenerator.DetectTimeframe-469"><a href="#PriceGenerator.DetectTimeframe-469"><span class="linenos">469</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">datetime</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
</span><span id="PriceGenerator.DetectTimeframe-470"><a href="#PriceGenerator.DetectTimeframe-470"><span class="linenos">470</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">datetime</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">datetime</span>
</span><span id="PriceGenerator.DetectTimeframe-471"><a href="#PriceGenerator.DetectTimeframe-471"><span class="linenos">471</span></a>        <span class="p">)</span>
</span><span id="PriceGenerator.DetectTimeframe-472"><a href="#PriceGenerator.DetectTimeframe-472"><span class="linenos">472</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Auto-detected timeframe: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span><span class="p">))</span>
</span><span id="PriceGenerator.DetectTimeframe-473"><a href="#PriceGenerator.DetectTimeframe-473"><span class="linenos">473</span></a>
</span><span id="PriceGenerator.DetectTimeframe-474"><a href="#PriceGenerator.DetectTimeframe-474"><span class="linenos">474</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span>
</span></pre></div>


            <div class="docstring"><p>Auto-detect time delta between last two neighbour candles.</p>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>timedelta object, also saved to <code><a href="#PriceGenerator.timeframe">timeframe</a></code>.</p>
</blockquote>
</div>


                            </div>
                            <div id="PriceGenerator.LoadFromFile" class="classattr">
                                        <input id="PriceGenerator.LoadFromFile-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">LoadFromFile</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">fileName</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>:</span></span>

                <label class="view-source-button" for="PriceGenerator.LoadFromFile-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PriceGenerator.LoadFromFile"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PriceGenerator.LoadFromFile-476"><a href="#PriceGenerator.LoadFromFile-476"><span class="linenos">476</span></a>    <span class="k">def</span> <span class="nf">LoadFromFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="PriceGenerator.LoadFromFile-477"><a href="#PriceGenerator.LoadFromFile-477"><span class="linenos">477</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="PriceGenerator.LoadFromFile-478"><a href="#PriceGenerator.LoadFromFile-478"><span class="linenos">478</span></a><span class="sd">        Create Pandas OHLCV-model from CSV-file.</span>
</span><span id="PriceGenerator.LoadFromFile-479"><a href="#PriceGenerator.LoadFromFile-479"><span class="linenos">479</span></a><span class="sd">        Default columns in CSV-file are `[&quot;date&quot;, &quot;time&quot;, &quot;open&quot;, &quot;high&quot;, &quot;low&quot;, &quot;close&quot;, &quot;volume&quot;]`.</span>
</span><span id="PriceGenerator.LoadFromFile-480"><a href="#PriceGenerator.LoadFromFile-480"><span class="linenos">480</span></a>
</span><span id="PriceGenerator.LoadFromFile-481"><a href="#PriceGenerator.LoadFromFile-481"><span class="linenos">481</span></a><span class="sd">        :param fileName: path to CSV-file with OHLCV columns.</span>
</span><span id="PriceGenerator.LoadFromFile-482"><a href="#PriceGenerator.LoadFromFile-482"><span class="linenos">482</span></a><span class="sd">        :return: Pandas DataFrame.</span>
</span><span id="PriceGenerator.LoadFromFile-483"><a href="#PriceGenerator.LoadFromFile-483"><span class="linenos">483</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PriceGenerator.LoadFromFile-484"><a href="#PriceGenerator.LoadFromFile-484"><span class="linenos">484</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Loading, parse and preparing input data from [</span><span class="si">{}</span><span class="s2">]...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">fileName</span><span class="p">)))</span>
</span><span id="PriceGenerator.LoadFromFile-485"><a href="#PriceGenerator.LoadFromFile-485"><span class="linenos">485</span></a>
</span><span id="PriceGenerator.LoadFromFile-486"><a href="#PriceGenerator.LoadFromFile-486"><span class="linenos">486</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">csvHeaders</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;python&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;datetime&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">]})</span>
</span><span id="PriceGenerator.LoadFromFile-487"><a href="#PriceGenerator.LoadFromFile-487"><span class="linenos">487</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">):</span>
</span><span id="PriceGenerator.LoadFromFile-488"><a href="#PriceGenerator.LoadFromFile-488"><span class="linenos">488</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">)</span>  <span class="c1"># use loaded file &quot;as is&quot; with all candles</span>
</span><span id="PriceGenerator.LoadFromFile-489"><a href="#PriceGenerator.LoadFromFile-489"><span class="linenos">489</span></a>
</span><span id="PriceGenerator.LoadFromFile-490"><a href="#PriceGenerator.LoadFromFile-490"><span class="linenos">490</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PriceGenerator.LoadFromFile-491"><a href="#PriceGenerator.LoadFromFile-491"><span class="linenos">491</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">prices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">horizon</span><span class="p">)</span>  <span class="c1"># remove old candles, leave only the &quot;tail&quot; ...</span>
</span><span id="PriceGenerator.LoadFromFile-492"><a href="#PriceGenerator.LoadFromFile-492"><span class="linenos">492</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">horizon</span><span class="p">)</span>  <span class="c1"># ... and reindex</span>
</span><span id="PriceGenerator.LoadFromFile-493"><a href="#PriceGenerator.LoadFromFile-493"><span class="linenos">493</span></a>
</span><span id="PriceGenerator.LoadFromFile-494"><a href="#PriceGenerator.LoadFromFile-494"><span class="linenos">494</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ticker</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>
</span><span id="PriceGenerator.LoadFromFile-495"><a href="#PriceGenerator.LoadFromFile-495"><span class="linenos">495</span></a>
</span><span id="PriceGenerator.LoadFromFile-496"><a href="#PriceGenerator.LoadFromFile-496"><span class="linenos">496</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">DetectTimeframe</span><span class="p">()</span>  <span class="c1"># auto-detect time delta between last two neighbour candles</span>
</span><span id="PriceGenerator.LoadFromFile-497"><a href="#PriceGenerator.LoadFromFile-497"><span class="linenos">497</span></a>
</span><span id="PriceGenerator.LoadFromFile-498"><a href="#PriceGenerator.LoadFromFile-498"><span class="linenos">498</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;It was read </span><span class="si">{}</span><span class="s2"> rows&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">horizon</span><span class="p">))</span>
</span><span id="PriceGenerator.LoadFromFile-499"><a href="#PriceGenerator.LoadFromFile-499"><span class="linenos">499</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Showing last 5 rows as Pandas DataFrame:&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator.LoadFromFile-500"><a href="#PriceGenerator.LoadFromFile-500"><span class="linenos">500</span></a>        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dfHeaders</span><span class="p">][</span><span class="o">-</span><span class="mi">5</span><span class="p">:],</span> <span class="n">max_cols</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
</span><span id="PriceGenerator.LoadFromFile-501"><a href="#PriceGenerator.LoadFromFile-501"><span class="linenos">501</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span><span id="PriceGenerator.LoadFromFile-502"><a href="#PriceGenerator.LoadFromFile-502"><span class="linenos">502</span></a>
</span><span id="PriceGenerator.LoadFromFile-503"><a href="#PriceGenerator.LoadFromFile-503"><span class="linenos">503</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span>
</span></pre></div>


            <div class="docstring"><p>Create Pandas OHLCV-model from CSV-file.
Default columns in CSV-file are <code>["date", "time", "open", "high", "low", "close", "volume"]</code>.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>fileName</strong>:  path to CSV-file with OHLCV columns.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>Pandas DataFrame.</p>
</blockquote>
</div>


                            </div>
                            <div id="PriceGenerator.SaveToFile" class="classattr">
                                        <input id="PriceGenerator.SaveToFile-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">SaveToFile</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">fileName</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="PriceGenerator.SaveToFile-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PriceGenerator.SaveToFile"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PriceGenerator.SaveToFile-505"><a href="#PriceGenerator.SaveToFile-505"><span class="linenos">505</span></a>    <span class="k">def</span> <span class="nf">SaveToFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PriceGenerator.SaveToFile-506"><a href="#PriceGenerator.SaveToFile-506"><span class="linenos">506</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="PriceGenerator.SaveToFile-507"><a href="#PriceGenerator.SaveToFile-507"><span class="linenos">507</span></a><span class="sd">        Save Pandas OHLCV model to CSV-file.</span>
</span><span id="PriceGenerator.SaveToFile-508"><a href="#PriceGenerator.SaveToFile-508"><span class="linenos">508</span></a>
</span><span id="PriceGenerator.SaveToFile-509"><a href="#PriceGenerator.SaveToFile-509"><span class="linenos">509</span></a><span class="sd">        :param fileName: path to CSV-file.</span>
</span><span id="PriceGenerator.SaveToFile-510"><a href="#PriceGenerator.SaveToFile-510"><span class="linenos">510</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PriceGenerator.SaveToFile-511"><a href="#PriceGenerator.SaveToFile-511"><span class="linenos">511</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="PriceGenerator.SaveToFile-512"><a href="#PriceGenerator.SaveToFile-512"><span class="linenos">512</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Saving [</span><span class="si">{}</span><span class="s2">] rows of Pandas DataFrame with columns: </span><span class="si">{}</span><span class="s2">...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">csvHeaders</span><span class="p">))</span>
</span><span id="PriceGenerator.SaveToFile-513"><a href="#PriceGenerator.SaveToFile-513"><span class="linenos">513</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Delimeter: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sep</span><span class="p">))</span>
</span><span id="PriceGenerator.SaveToFile-514"><a href="#PriceGenerator.SaveToFile-514"><span class="linenos">514</span></a>            <span class="n">dataReplacedDateTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="PriceGenerator.SaveToFile-515"><a href="#PriceGenerator.SaveToFile-515"><span class="linenos">515</span></a>            <span class="n">dataReplacedDateTime</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">date</span><span class="p">()</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dataReplacedDateTime</span><span class="p">[</span><span class="s2">&quot;datetime&quot;</span><span class="p">]]</span>
</span><span id="PriceGenerator.SaveToFile-516"><a href="#PriceGenerator.SaveToFile-516"><span class="linenos">516</span></a>            <span class="n">dataReplacedDateTime</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dataReplacedDateTime</span><span class="p">[</span><span class="s2">&quot;datetime&quot;</span><span class="p">]]</span>
</span><span id="PriceGenerator.SaveToFile-517"><a href="#PriceGenerator.SaveToFile-517"><span class="linenos">517</span></a>            <span class="k">del</span> <span class="n">dataReplacedDateTime</span><span class="p">[</span><span class="s2">&quot;datetime&quot;</span><span class="p">]</span>
</span><span id="PriceGenerator.SaveToFile-518"><a href="#PriceGenerator.SaveToFile-518"><span class="linenos">518</span></a>            <span class="n">dataReplacedDateTime</span> <span class="o">=</span> <span class="n">dataReplacedDateTime</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">csvHeaders</span><span class="p">]</span>
</span><span id="PriceGenerator.SaveToFile-519"><a href="#PriceGenerator.SaveToFile-519"><span class="linenos">519</span></a>            <span class="n">dataReplacedDateTime</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="PriceGenerator.SaveToFile-520"><a href="#PriceGenerator.SaveToFile-520"><span class="linenos">520</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Pandas DataFrame saved to .CSV-file [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">fileName</span><span class="p">)))</span>
</span><span id="PriceGenerator.SaveToFile-521"><a href="#PriceGenerator.SaveToFile-521"><span class="linenos">521</span></a>
</span><span id="PriceGenerator.SaveToFile-522"><a href="#PriceGenerator.SaveToFile-522"><span class="linenos">522</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PriceGenerator.SaveToFile-523"><a href="#PriceGenerator.SaveToFile-523"><span class="linenos">523</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Empty price data! Generate or load prices before saving!&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Save Pandas OHLCV model to CSV-file.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>fileName</strong>:  path to CSV-file.</li>
</ul>
</div>


                            </div>
                            <div id="PriceGenerator.GetTrend" class="classattr">
                                        <input id="PriceGenerator.GetTrend-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">GetTrend</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">firstClose</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">lastClose</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">trendDeviation</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.005</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="PriceGenerator.GetTrend-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PriceGenerator.GetTrend"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PriceGenerator.GetTrend-525"><a href="#PriceGenerator.GetTrend-525"><span class="linenos">525</span></a>    <span class="nd">@staticmethod</span>
</span><span id="PriceGenerator.GetTrend-526"><a href="#PriceGenerator.GetTrend-526"><span class="linenos">526</span></a>    <span class="k">def</span> <span class="nf">GetTrend</span><span class="p">(</span><span class="n">firstClose</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">lastClose</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">trendDeviation</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.005</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="PriceGenerator.GetTrend-527"><a href="#PriceGenerator.GetTrend-527"><span class="linenos">527</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="PriceGenerator.GetTrend-528"><a href="#PriceGenerator.GetTrend-528"><span class="linenos">528</span></a><span class="sd">        Get string with trend: `&quot;UP trend&quot;`, `&quot;DOWN trend&quot;` or `&quot;NO trend&quot;`.</span>
</span><span id="PriceGenerator.GetTrend-529"><a href="#PriceGenerator.GetTrend-529"><span class="linenos">529</span></a>
</span><span id="PriceGenerator.GetTrend-530"><a href="#PriceGenerator.GetTrend-530"><span class="linenos">530</span></a><span class="sd">        :param firstClose: close of first candle.</span>
</span><span id="PriceGenerator.GetTrend-531"><a href="#PriceGenerator.GetTrend-531"><span class="linenos">531</span></a><span class="sd">        :param lastClose: close of last candle.</span>
</span><span id="PriceGenerator.GetTrend-532"><a href="#PriceGenerator.GetTrend-532"><span class="linenos">532</span></a><span class="sd">        :param trendDeviation: relative deviation for trend detection, 0.005 mean ±0.5% by default.</span>
</span><span id="PriceGenerator.GetTrend-533"><a href="#PriceGenerator.GetTrend-533"><span class="linenos">533</span></a><span class="sd">        :return: string with trend direction `&quot;NO trend&quot;`, `&quot;UP trend&quot;` or `&quot;DOWN trend&quot;`.</span>
</span><span id="PriceGenerator.GetTrend-534"><a href="#PriceGenerator.GetTrend-534"><span class="linenos">534</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PriceGenerator.GetTrend-535"><a href="#PriceGenerator.GetTrend-535"><span class="linenos">535</span></a>        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">firstClose</span> <span class="o">-</span> <span class="n">lastClose</span><span class="p">)</span> <span class="o">/</span> <span class="n">firstClose</span> <span class="o">&lt;=</span> <span class="n">trendDeviation</span><span class="p">:</span>
</span><span id="PriceGenerator.GetTrend-536"><a href="#PriceGenerator.GetTrend-536"><span class="linenos">536</span></a>            <span class="n">trend</span> <span class="o">=</span> <span class="s2">&quot;NO trend&quot;</span>
</span><span id="PriceGenerator.GetTrend-537"><a href="#PriceGenerator.GetTrend-537"><span class="linenos">537</span></a>
</span><span id="PriceGenerator.GetTrend-538"><a href="#PriceGenerator.GetTrend-538"><span class="linenos">538</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PriceGenerator.GetTrend-539"><a href="#PriceGenerator.GetTrend-539"><span class="linenos">539</span></a>            <span class="n">trend</span> <span class="o">=</span> <span class="s2">&quot;UP trend&quot;</span> <span class="k">if</span> <span class="n">firstClose</span> <span class="o">&lt;=</span> <span class="n">lastClose</span> <span class="k">else</span> <span class="s2">&quot;DOWN trend&quot;</span>
</span><span id="PriceGenerator.GetTrend-540"><a href="#PriceGenerator.GetTrend-540"><span class="linenos">540</span></a>
</span><span id="PriceGenerator.GetTrend-541"><a href="#PriceGenerator.GetTrend-541"><span class="linenos">541</span></a>        <span class="k">return</span> <span class="n">trend</span>
</span></pre></div>


            <div class="docstring"><p>Get string with trend: <code>"UP trend"</code>, <code>"DOWN trend"</code> or <code>"NO trend"</code>.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>firstClose</strong>:  close of first candle.</li>
<li><strong>lastClose</strong>:  close of last candle.</li>
<li><strong>trendDeviation</strong>:  relative deviation for trend detection, 0.005 mean ±0.5% by default.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>string with trend direction <code>"NO trend"</code>, <code>"UP trend"</code> or <code>"DOWN trend"</code>.</p>
</blockquote>
</div>


                            </div>
                            <div id="PriceGenerator.ZigZagFilter" class="classattr">
                                        <input id="PriceGenerator.ZigZagFilter-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">ZigZagFilter</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">datetimes</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">Series</span>,</span><span class="param">	<span class="n">values</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span>,</span><span class="param">	<span class="n">deviation</span><span class="p">:</span> <span class="nb">float</span></span><span class="return-annotation">) -> <span class="nb">dict</span>:</span></span>

                <label class="view-source-button" for="PriceGenerator.ZigZagFilter-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PriceGenerator.ZigZagFilter"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PriceGenerator.ZigZagFilter-543"><a href="#PriceGenerator.ZigZagFilter-543"><span class="linenos">543</span></a>    <span class="nd">@staticmethod</span>
</span><span id="PriceGenerator.ZigZagFilter-544"><a href="#PriceGenerator.ZigZagFilter-544"><span class="linenos">544</span></a>    <span class="k">def</span> <span class="nf">ZigZagFilter</span><span class="p">(</span><span class="n">datetimes</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="nb">list</span><span class="p">],</span> <span class="n">deviation</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="PriceGenerator.ZigZagFilter-545"><a href="#PriceGenerator.ZigZagFilter-545"><span class="linenos">545</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="PriceGenerator.ZigZagFilter-546"><a href="#PriceGenerator.ZigZagFilter-546"><span class="linenos">546</span></a><span class="sd">        This method filter input data as Zig-Zag indicator: when input value of candlestick price (e.g. close price)</span>
</span><span id="PriceGenerator.ZigZagFilter-547"><a href="#PriceGenerator.ZigZagFilter-547"><span class="linenos">547</span></a><span class="sd">        is difference with next values with define percent then this point is a point of Zig-Zag indicator.</span>
</span><span id="PriceGenerator.ZigZagFilter-548"><a href="#PriceGenerator.ZigZagFilter-548"><span class="linenos">548</span></a>
</span><span id="PriceGenerator.ZigZagFilter-549"><a href="#PriceGenerator.ZigZagFilter-549"><span class="linenos">549</span></a><span class="sd">        :param datetimes: input Pandas Series with datetime values.</span>
</span><span id="PriceGenerator.ZigZagFilter-550"><a href="#PriceGenerator.ZigZagFilter-550"><span class="linenos">550</span></a><span class="sd">        :param values: input Pandas Series or list, e.g. list of closes values of candlesticks.</span>
</span><span id="PriceGenerator.ZigZagFilter-551"><a href="#PriceGenerator.ZigZagFilter-551"><span class="linenos">551</span></a><span class="sd">        :param deviation: float number in `[0, 1]` interval is a relative difference between `i` and `i + 1` values to set as Zig-Zag point.</span>
</span><span id="PriceGenerator.ZigZagFilter-552"><a href="#PriceGenerator.ZigZagFilter-552"><span class="linenos">552</span></a><span class="sd">        :return: dict with Pandas Series filtered data `{&quot;datetimes&quot;: filtered_datetimes, &quot;filtered&quot;: filtered_values}`.</span>
</span><span id="PriceGenerator.ZigZagFilter-553"><a href="#PriceGenerator.ZigZagFilter-553"><span class="linenos">553</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PriceGenerator.ZigZagFilter-554"><a href="#PriceGenerator.ZigZagFilter-554"><span class="linenos">554</span></a>        <span class="n">filteredPoints</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span>
</span><span id="PriceGenerator.ZigZagFilter-555"><a href="#PriceGenerator.ZigZagFilter-555"><span class="linenos">555</span></a>        <span class="n">prev</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="PriceGenerator.ZigZagFilter-556"><a href="#PriceGenerator.ZigZagFilter-556"><span class="linenos">556</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)):</span>
</span><span id="PriceGenerator.ZigZagFilter-557"><a href="#PriceGenerator.ZigZagFilter-557"><span class="linenos">557</span></a>            <span class="n">difference</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">prev</span><span class="p">)</span> <span class="o">/</span> <span class="n">prev</span>
</span><span id="PriceGenerator.ZigZagFilter-558"><a href="#PriceGenerator.ZigZagFilter-558"><span class="linenos">558</span></a>            <span class="k">if</span> <span class="n">difference</span> <span class="o">&gt;=</span> <span class="n">deviation</span><span class="p">:</span>
</span><span id="PriceGenerator.ZigZagFilter-559"><a href="#PriceGenerator.ZigZagFilter-559"><span class="linenos">559</span></a>                <span class="n">filteredPoints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span><span id="PriceGenerator.ZigZagFilter-560"><a href="#PriceGenerator.ZigZagFilter-560"><span class="linenos">560</span></a>                <span class="n">prev</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="PriceGenerator.ZigZagFilter-561"><a href="#PriceGenerator.ZigZagFilter-561"><span class="linenos">561</span></a>
</span><span id="PriceGenerator.ZigZagFilter-562"><a href="#PriceGenerator.ZigZagFilter-562"><span class="linenos">562</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PriceGenerator.ZigZagFilter-563"><a href="#PriceGenerator.ZigZagFilter-563"><span class="linenos">563</span></a>                <span class="n">filteredPoints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</span><span id="PriceGenerator.ZigZagFilter-564"><a href="#PriceGenerator.ZigZagFilter-564"><span class="linenos">564</span></a>
</span><span id="PriceGenerator.ZigZagFilter-565"><a href="#PriceGenerator.ZigZagFilter-565"><span class="linenos">565</span></a>        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;datetimes&quot;</span><span class="p">:</span> <span class="n">datetimes</span><span class="p">[</span><span class="n">filteredPoints</span><span class="p">],</span> <span class="s2">&quot;filtered&quot;</span><span class="p">:</span> <span class="n">values</span><span class="p">[</span><span class="n">filteredPoints</span><span class="p">]}</span>
</span></pre></div>


            <div class="docstring"><p>This method filter input data as Zig-Zag indicator: when input value of candlestick price (e.g. close price)
is difference with next values with define percent then this point is a point of Zig-Zag indicator.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>datetimes</strong>:  input Pandas Series with datetime values.</li>
<li><strong>values</strong>:  input Pandas Series or list, e.g. list of closes values of candlesticks.</li>
<li><strong>deviation</strong>:  float number in <code>[0, 1]</code> interval is a relative difference between <code>i</code> and <code>i + 1</code> values to set as Zig-Zag point.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>dict with Pandas Series filtered data <code>{"datetimes": filtered_datetimes, "filtered": filtered_values}</code>.</p>
</blockquote>
</div>


                            </div>
                            <div id="PriceGenerator.GetStatistics" class="classattr">
                                        <input id="PriceGenerator.GetStatistics-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">GetStatistics</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="PriceGenerator.GetStatistics-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PriceGenerator.GetStatistics"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PriceGenerator.GetStatistics-567"><a href="#PriceGenerator.GetStatistics-567"><span class="linenos">567</span></a>    <span class="k">def</span> <span class="nf">GetStatistics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="PriceGenerator.GetStatistics-568"><a href="#PriceGenerator.GetStatistics-568"><span class="linenos">568</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="PriceGenerator.GetStatistics-569"><a href="#PriceGenerator.GetStatistics-569"><span class="linenos">569</span></a><span class="sd">        Calculates statistics of candles chain.</span>
</span><span id="PriceGenerator.GetStatistics-570"><a href="#PriceGenerator.GetStatistics-570"><span class="linenos">570</span></a>
</span><span id="PriceGenerator.GetStatistics-571"><a href="#PriceGenerator.GetStatistics-571"><span class="linenos">571</span></a><span class="sd">        :return: list with text in Markdown format with statistics.</span>
</span><span id="PriceGenerator.GetStatistics-572"><a href="#PriceGenerator.GetStatistics-572"><span class="linenos">572</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PriceGenerator.GetStatistics-573"><a href="#PriceGenerator.GetStatistics-573"><span class="linenos">573</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Calculating column with deltas between high and low values...&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator.GetStatistics-574"><a href="#PriceGenerator.GetStatistics-574"><span class="linenos">574</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;delta&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">high</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">low</span><span class="o">.</span><span class="n">values</span>
</span><span id="PriceGenerator.GetStatistics-575"><a href="#PriceGenerator.GetStatistics-575"><span class="linenos">575</span></a>
</span><span id="PriceGenerator.GetStatistics-576"><a href="#PriceGenerator.GetStatistics-576"><span class="linenos">576</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Calculating column with average values...&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator.GetStatistics-577"><a href="#PriceGenerator.GetStatistics-577"><span class="linenos">577</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;avg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">high</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">low</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precision</span><span class="p">)</span>
</span><span id="PriceGenerator.GetStatistics-578"><a href="#PriceGenerator.GetStatistics-578"><span class="linenos">578</span></a>
</span><span id="PriceGenerator.GetStatistics-579"><a href="#PriceGenerator.GetStatistics-579"><span class="linenos">579</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Calculating some technical analysis indicators...&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator.GetStatistics-580"><a href="#PriceGenerator.GetStatistics-580"><span class="linenos">580</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;sma5&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">sma</span><span class="p">(</span><span class="n">close</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="PriceGenerator.GetStatistics-581"><a href="#PriceGenerator.GetStatistics-581"><span class="linenos">581</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;sma20&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">sma</span><span class="p">(</span><span class="n">close</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="PriceGenerator.GetStatistics-582"><a href="#PriceGenerator.GetStatistics-582"><span class="linenos">582</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;sma50&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">sma</span><span class="p">(</span><span class="n">close</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="PriceGenerator.GetStatistics-583"><a href="#PriceGenerator.GetStatistics-583"><span class="linenos">583</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;sma200&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">sma</span><span class="p">(</span><span class="n">close</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="PriceGenerator.GetStatistics-584"><a href="#PriceGenerator.GetStatistics-584"><span class="linenos">584</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;hma5&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">hma</span><span class="p">(</span><span class="n">close</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="PriceGenerator.GetStatistics-585"><a href="#PriceGenerator.GetStatistics-585"><span class="linenos">585</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;hma20&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">hma</span><span class="p">(</span><span class="n">close</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="PriceGenerator.GetStatistics-586"><a href="#PriceGenerator.GetStatistics-586"><span class="linenos">586</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;vwma5&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">vwma</span><span class="p">(</span><span class="n">close</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">volume</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">volume</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="PriceGenerator.GetStatistics-587"><a href="#PriceGenerator.GetStatistics-587"><span class="linenos">587</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;vwma20&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">vwma</span><span class="p">(</span><span class="n">close</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">volume</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">volume</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="PriceGenerator.GetStatistics-588"><a href="#PriceGenerator.GetStatistics-588"><span class="linenos">588</span></a>        <span class="n">bbands</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">bbands</span><span class="p">(</span><span class="n">close</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mamode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="PriceGenerator.GetStatistics-589"><a href="#PriceGenerator.GetStatistics-589"><span class="linenos">589</span></a>        <span class="n">bbands</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;lower&quot;</span><span class="p">,</span> <span class="s2">&quot;mid&quot;</span><span class="p">,</span> <span class="s2">&quot;upper&quot;</span><span class="p">,</span> <span class="s2">&quot;bandwidth&quot;</span><span class="p">,</span> <span class="s2">&quot;percent&quot;</span><span class="p">]</span>
</span><span id="PriceGenerator.GetStatistics-590"><a href="#PriceGenerator.GetStatistics-590"><span class="linenos">590</span></a>        <span class="n">psar</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">psar</span><span class="p">(</span><span class="n">high</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">high</span><span class="p">,</span> <span class="n">low</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">low</span><span class="p">,</span> <span class="n">close</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">af</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">max_af</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="PriceGenerator.GetStatistics-591"><a href="#PriceGenerator.GetStatistics-591"><span class="linenos">591</span></a>        <span class="n">psar</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;long&quot;</span><span class="p">,</span> <span class="s2">&quot;short&quot;</span><span class="p">,</span> <span class="s2">&quot;af&quot;</span><span class="p">,</span> <span class="s2">&quot;reversal&quot;</span><span class="p">]</span>
</span><span id="PriceGenerator.GetStatistics-592"><a href="#PriceGenerator.GetStatistics-592"><span class="linenos">592</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;hma13&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">hma</span><span class="p">(</span><span class="n">close</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>  <span class="c1"># alligator Jaw</span>
</span><span id="PriceGenerator.GetStatistics-593"><a href="#PriceGenerator.GetStatistics-593"><span class="linenos">593</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;hma8&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">hma</span><span class="p">(</span><span class="n">close</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>  <span class="c1"># alligator Teeth</span>
</span><span id="PriceGenerator.GetStatistics-594"><a href="#PriceGenerator.GetStatistics-594"><span class="linenos">594</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;hma5&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">hma</span><span class="p">(</span><span class="n">close</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># alligator Lips</span>
</span><span id="PriceGenerator.GetStatistics-595"><a href="#PriceGenerator.GetStatistics-595"><span class="linenos">595</span></a>        <span class="n">zigzag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ZigZagFilter</span><span class="p">(</span><span class="n">datetimes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">deviation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zigZagDeviation</span><span class="p">)</span>  <span class="c1"># ZigZag indicator</span>
</span><span id="PriceGenerator.GetStatistics-596"><a href="#PriceGenerator.GetStatistics-596"><span class="linenos">596</span></a>
</span><span id="PriceGenerator.GetStatistics-597"><a href="#PriceGenerator.GetStatistics-597"><span class="linenos">597</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">DetectPrecision</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>  <span class="c1"># auto-detect precision</span>
</span><span id="PriceGenerator.GetStatistics-598"><a href="#PriceGenerator.GetStatistics-598"><span class="linenos">598</span></a>
</span><span id="PriceGenerator.GetStatistics-599"><a href="#PriceGenerator.GetStatistics-599"><span class="linenos">599</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_chartTitle</span> <span class="o">=</span> <span class="s2">&quot;Instrument: </span><span class="si">{}</span><span class="s2">, timeframe: </span><span class="si">{}</span><span class="s2">, horizon length: </span><span class="si">{}</span><span class="s2"> (from </span><span class="si">{}</span><span class="s2"> to </span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="PriceGenerator.GetStatistics-600"><a href="#PriceGenerator.GetStatistics-600"><span class="linenos">600</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">ticker</span><span class="p">,</span>
</span><span id="PriceGenerator.GetStatistics-601"><a href="#PriceGenerator.GetStatistics-601"><span class="linenos">601</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">FormattedDelta</span><span class="p">(</span>
</span><span id="PriceGenerator.GetStatistics-602"><a href="#PriceGenerator.GetStatistics-602"><span class="linenos">602</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{days}</span><span class="s2"> days </span><span class="si">{hours}</span><span class="s2">h </span><span class="si">{minutes}</span><span class="s2">m </span><span class="si">{seconds}</span><span class="s2">s&quot;</span>
</span><span id="PriceGenerator.GetStatistics-603"><a href="#PriceGenerator.GetStatistics-603"><span class="linenos">603</span></a>            <span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span> <span class="o">&gt;=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">FormattedDelta</span><span class="p">(</span>
</span><span id="PriceGenerator.GetStatistics-604"><a href="#PriceGenerator.GetStatistics-604"><span class="linenos">604</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{hours}</span><span class="s2">h </span><span class="si">{minutes}</span><span class="s2">m </span><span class="si">{seconds}</span><span class="s2">s&quot;</span>
</span><span id="PriceGenerator.GetStatistics-605"><a href="#PriceGenerator.GetStatistics-605"><span class="linenos">605</span></a>            <span class="p">),</span>
</span><span id="PriceGenerator.GetStatistics-606"><a href="#PriceGenerator.GetStatistics-606"><span class="linenos">606</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span><span class="p">,</span>
</span><span id="PriceGenerator.GetStatistics-607"><a href="#PriceGenerator.GetStatistics-607"><span class="linenos">607</span></a>            <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">),</span>
</span><span id="PriceGenerator.GetStatistics-608"><a href="#PriceGenerator.GetStatistics-608"><span class="linenos">608</span></a>            <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">),</span>
</span><span id="PriceGenerator.GetStatistics-609"><a href="#PriceGenerator.GetStatistics-609"><span class="linenos">609</span></a>        <span class="p">)</span>
</span><span id="PriceGenerator.GetStatistics-610"><a href="#PriceGenerator.GetStatistics-610"><span class="linenos">610</span></a>
</span><span id="PriceGenerator.GetStatistics-611"><a href="#PriceGenerator.GetStatistics-611"><span class="linenos">611</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;candles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">)</span>
</span><span id="PriceGenerator.GetStatistics-612"><a href="#PriceGenerator.GetStatistics-612"><span class="linenos">612</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;precision&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span>
</span><span id="PriceGenerator.GetStatistics-613"><a href="#PriceGenerator.GetStatistics-613"><span class="linenos">613</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;closeFirst&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="PriceGenerator.GetStatistics-614"><a href="#PriceGenerator.GetStatistics-614"><span class="linenos">614</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;closeLast&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="PriceGenerator.GetStatistics-615"><a href="#PriceGenerator.GetStatistics-615"><span class="linenos">615</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;closeMax&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
</span><span id="PriceGenerator.GetStatistics-616"><a href="#PriceGenerator.GetStatistics-616"><span class="linenos">616</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;closeMin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
</span><span id="PriceGenerator.GetStatistics-617"><a href="#PriceGenerator.GetStatistics-617"><span class="linenos">617</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;diapason&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;closeMax&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;closeMin&quot;</span><span class="p">]</span>
</span><span id="PriceGenerator.GetStatistics-618"><a href="#PriceGenerator.GetStatistics-618"><span class="linenos">618</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;trend&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetTrend</span><span class="p">(</span><span class="n">firstClose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;closeFirst&quot;</span><span class="p">],</span> <span class="n">lastClose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;closeLast&quot;</span><span class="p">],</span> <span class="n">trendDeviation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trendDeviation</span><span class="p">)</span>
</span><span id="PriceGenerator.GetStatistics-619"><a href="#PriceGenerator.GetStatistics-619"><span class="linenos">619</span></a>
</span><span id="PriceGenerator.GetStatistics-620"><a href="#PriceGenerator.GetStatistics-620"><span class="linenos">620</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;up&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">open</span>  <span class="c1"># True mean that is up candle, and False mean down</span>
</span><span id="PriceGenerator.GetStatistics-621"><a href="#PriceGenerator.GetStatistics-621"><span class="linenos">621</span></a>        <span class="n">upList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">up</span><span class="p">)</span>
</span><span id="PriceGenerator.GetStatistics-622"><a href="#PriceGenerator.GetStatistics-622"><span class="linenos">622</span></a>        <span class="n">upChainsLengths</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">chain</span><span class="p">))</span> <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">chain</span> <span class="ow">in</span> <span class="n">groupby</span><span class="p">(</span><span class="n">upList</span><span class="p">)</span> <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">]</span>
</span><span id="PriceGenerator.GetStatistics-623"><a href="#PriceGenerator.GetStatistics-623"><span class="linenos">623</span></a>        <span class="n">downChainsLengths</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">chain</span><span class="p">))</span> <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">chain</span> <span class="ow">in</span> <span class="n">groupby</span><span class="p">(</span><span class="n">upList</span><span class="p">)</span> <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">]</span>
</span><span id="PriceGenerator.GetStatistics-624"><a href="#PriceGenerator.GetStatistics-624"><span class="linenos">624</span></a>
</span><span id="PriceGenerator.GetStatistics-625"><a href="#PriceGenerator.GetStatistics-625"><span class="linenos">625</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;trendDev&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendDeviation</span>
</span><span id="PriceGenerator.GetStatistics-626"><a href="#PriceGenerator.GetStatistics-626"><span class="linenos">626</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;upCount&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">up</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">up</span> <span class="o">==</span> <span class="kc">True</span><span class="p">])</span>
</span><span id="PriceGenerator.GetStatistics-627"><a href="#PriceGenerator.GetStatistics-627"><span class="linenos">627</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;downCount&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">up</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">up</span> <span class="o">==</span> <span class="kc">False</span><span class="p">])</span>
</span><span id="PriceGenerator.GetStatistics-628"><a href="#PriceGenerator.GetStatistics-628"><span class="linenos">628</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;upCountChainMax&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">upChainsLengths</span><span class="p">)</span> <span class="k">if</span> <span class="n">upChainsLengths</span> <span class="k">else</span> <span class="mi">1</span>
</span><span id="PriceGenerator.GetStatistics-629"><a href="#PriceGenerator.GetStatistics-629"><span class="linenos">629</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;downCountChainMax&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">downChainsLengths</span><span class="p">)</span> <span class="k">if</span> <span class="n">downChainsLengths</span> <span class="k">else</span> <span class="mi">1</span>
</span><span id="PriceGenerator.GetStatistics-630"><a href="#PriceGenerator.GetStatistics-630"><span class="linenos">630</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;deltas&quot;</span><span class="p">][</span><span class="s2">&quot;max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">delta</span><span class="p">)</span>
</span><span id="PriceGenerator.GetStatistics-631"><a href="#PriceGenerator.GetStatistics-631"><span class="linenos">631</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;deltas&quot;</span><span class="p">][</span><span class="s2">&quot;min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">delta</span><span class="p">)</span>
</span><span id="PriceGenerator.GetStatistics-632"><a href="#PriceGenerator.GetStatistics-632"><span class="linenos">632</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;deltas&quot;</span><span class="p">][</span><span class="s2">&quot;stDev&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">pstdev</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">delta</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precision</span><span class="p">)</span>
</span><span id="PriceGenerator.GetStatistics-633"><a href="#PriceGenerator.GetStatistics-633"><span class="linenos">633</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;deltas&quot;</span><span class="p">][</span><span class="s2">&quot;q99&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">delta</span><span class="p">)</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precision</span><span class="p">)</span>
</span><span id="PriceGenerator.GetStatistics-634"><a href="#PriceGenerator.GetStatistics-634"><span class="linenos">634</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;deltas&quot;</span><span class="p">][</span><span class="s2">&quot;q95&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">delta</span><span class="p">)</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precision</span><span class="p">)</span>
</span><span id="PriceGenerator.GetStatistics-635"><a href="#PriceGenerator.GetStatistics-635"><span class="linenos">635</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;deltas&quot;</span><span class="p">][</span><span class="s2">&quot;q80&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">delta</span><span class="p">)</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="mf">0.80</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precision</span><span class="p">)</span>
</span><span id="PriceGenerator.GetStatistics-636"><a href="#PriceGenerator.GetStatistics-636"><span class="linenos">636</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;deltas&quot;</span><span class="p">][</span><span class="s2">&quot;q50&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">delta</span><span class="p">)</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="mf">0.50</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precision</span><span class="p">)</span>
</span><span id="PriceGenerator.GetStatistics-637"><a href="#PriceGenerator.GetStatistics-637"><span class="linenos">637</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;cumSumVolumes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">volume</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span id="PriceGenerator.GetStatistics-638"><a href="#PriceGenerator.GetStatistics-638"><span class="linenos">638</span></a>
</span><span id="PriceGenerator.GetStatistics-639"><a href="#PriceGenerator.GetStatistics-639"><span class="linenos">639</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;sma5&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;sma5&quot;</span><span class="p">]</span>
</span><span id="PriceGenerator.GetStatistics-640"><a href="#PriceGenerator.GetStatistics-640"><span class="linenos">640</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;sma20&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;sma20&quot;</span><span class="p">]</span>
</span><span id="PriceGenerator.GetStatistics-641"><a href="#PriceGenerator.GetStatistics-641"><span class="linenos">641</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;sma50&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;sma50&quot;</span><span class="p">]</span>
</span><span id="PriceGenerator.GetStatistics-642"><a href="#PriceGenerator.GetStatistics-642"><span class="linenos">642</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;sma200&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;sma200&quot;</span><span class="p">]</span>
</span><span id="PriceGenerator.GetStatistics-643"><a href="#PriceGenerator.GetStatistics-643"><span class="linenos">643</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;hma5&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;hma5&quot;</span><span class="p">]</span>
</span><span id="PriceGenerator.GetStatistics-644"><a href="#PriceGenerator.GetStatistics-644"><span class="linenos">644</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;hma20&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;hma20&quot;</span><span class="p">]</span>
</span><span id="PriceGenerator.GetStatistics-645"><a href="#PriceGenerator.GetStatistics-645"><span class="linenos">645</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;vwma5&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;vwma5&quot;</span><span class="p">]</span>
</span><span id="PriceGenerator.GetStatistics-646"><a href="#PriceGenerator.GetStatistics-646"><span class="linenos">646</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;vwma20&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;vwma20&quot;</span><span class="p">]</span>
</span><span id="PriceGenerator.GetStatistics-647"><a href="#PriceGenerator.GetStatistics-647"><span class="linenos">647</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;bbands&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bbands</span>
</span><span id="PriceGenerator.GetStatistics-648"><a href="#PriceGenerator.GetStatistics-648"><span class="linenos">648</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;psar&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">psar</span>
</span><span id="PriceGenerator.GetStatistics-649"><a href="#PriceGenerator.GetStatistics-649"><span class="linenos">649</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;hma13&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;hma13&quot;</span><span class="p">]</span>
</span><span id="PriceGenerator.GetStatistics-650"><a href="#PriceGenerator.GetStatistics-650"><span class="linenos">650</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;hma8&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;hma8&quot;</span><span class="p">]</span>
</span><span id="PriceGenerator.GetStatistics-651"><a href="#PriceGenerator.GetStatistics-651"><span class="linenos">651</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;hma5&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;hma5&quot;</span><span class="p">]</span>
</span><span id="PriceGenerator.GetStatistics-652"><a href="#PriceGenerator.GetStatistics-652"><span class="linenos">652</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stat</span><span class="p">[</span><span class="s2">&quot;zigzag3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">zigzag</span>
</span><span id="PriceGenerator.GetStatistics-653"><a href="#PriceGenerator.GetStatistics-653"><span class="linenos">653</span></a>
</span><span id="PriceGenerator.GetStatistics-654"><a href="#PriceGenerator.GetStatistics-654"><span class="linenos">654</span></a>        <span class="n">summary</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="PriceGenerator.GetStatistics-655"><a href="#PriceGenerator.GetStatistics-655"><span class="linenos">655</span></a>            <span class="s2">&quot;# Summary&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.GetStatistics-656"><a href="#PriceGenerator.GetStatistics-656"><span class="linenos">656</span></a>            <span class="s2">&quot;- Candles count: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;candles&quot;</span><span class="p">]),</span>
</span><span id="PriceGenerator.GetStatistics-657"><a href="#PriceGenerator.GetStatistics-657"><span class="linenos">657</span></a>            <span class="s2">&quot;- Timeframe: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span><span class="p">),</span>
</span><span id="PriceGenerator.GetStatistics-658"><a href="#PriceGenerator.GetStatistics-658"><span class="linenos">658</span></a>            <span class="s2">&quot;- Precision (signs after comma): </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;precision&quot;</span><span class="p">]),</span>
</span><span id="PriceGenerator.GetStatistics-659"><a href="#PriceGenerator.GetStatistics-659"><span class="linenos">659</span></a>            <span class="s2">&quot;- Close, first: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;closeFirst&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)),</span>
</span><span id="PriceGenerator.GetStatistics-660"><a href="#PriceGenerator.GetStatistics-660"><span class="linenos">660</span></a>            <span class="s2">&quot;- Close, last: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;closeLast&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)),</span>
</span><span id="PriceGenerator.GetStatistics-661"><a href="#PriceGenerator.GetStatistics-661"><span class="linenos">661</span></a>            <span class="s2">&quot;- Close, max: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;closeMax&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)),</span>
</span><span id="PriceGenerator.GetStatistics-662"><a href="#PriceGenerator.GetStatistics-662"><span class="linenos">662</span></a>            <span class="s2">&quot;- Close, min: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;closeMin&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)),</span>
</span><span id="PriceGenerator.GetStatistics-663"><a href="#PriceGenerator.GetStatistics-663"><span class="linenos">663</span></a>            <span class="s2">&quot;- Diapason, |close_max - close_min|: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;diapason&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)),</span>
</span><span id="PriceGenerator.GetStatistics-664"><a href="#PriceGenerator.GetStatistics-664"><span class="linenos">664</span></a>            <span class="s2">&quot;- Trend, |close_1st - close_last|: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;trend&quot;</span><span class="p">]),</span>
</span><span id="PriceGenerator.GetStatistics-665"><a href="#PriceGenerator.GetStatistics-665"><span class="linenos">665</span></a>            <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.GetStatistics-666"><a href="#PriceGenerator.GetStatistics-666"><span class="linenos">666</span></a>            <span class="s2">&quot;# Statistics&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.GetStatistics-667"><a href="#PriceGenerator.GetStatistics-667"><span class="linenos">667</span></a>            <span class="s2">&quot;- Up candles count: </span><span class="si">{}</span><span class="s2"> (</span><span class="si">{}</span><span class="s2">%)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;upCount&quot;</span><span class="p">],</span> <span class="nb">round</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;upCount&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;candles&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)),</span>
</span><span id="PriceGenerator.GetStatistics-668"><a href="#PriceGenerator.GetStatistics-668"><span class="linenos">668</span></a>            <span class="s2">&quot;- Down candles count: </span><span class="si">{}</span><span class="s2"> (</span><span class="si">{}</span><span class="s2">%)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;downCount&quot;</span><span class="p">],</span> <span class="nb">round</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;downCount&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;candles&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)),</span>
</span><span id="PriceGenerator.GetStatistics-669"><a href="#PriceGenerator.GetStatistics-669"><span class="linenos">669</span></a>            <span class="s2">&quot;- Max of up / down candle chains: </span><span class="si">{}</span><span class="s2"> / </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;upCountChainMax&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;downCountChainMax&quot;</span><span class="p">]),</span>
</span><span id="PriceGenerator.GetStatistics-670"><a href="#PriceGenerator.GetStatistics-670"><span class="linenos">670</span></a>            <span class="s2">&quot;- Max delta, |high - low|: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;deltas&quot;</span><span class="p">][</span><span class="s2">&quot;max&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)),</span>
</span><span id="PriceGenerator.GetStatistics-671"><a href="#PriceGenerator.GetStatistics-671"><span class="linenos">671</span></a>            <span class="s2">&quot;- Min delta, |high - low|: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;deltas&quot;</span><span class="p">][</span><span class="s2">&quot;min&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)),</span>
</span><span id="PriceGenerator.GetStatistics-672"><a href="#PriceGenerator.GetStatistics-672"><span class="linenos">672</span></a>            <span class="s2">&quot;- Delta&#39;s std. dev.: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;deltas&quot;</span><span class="p">][</span><span class="s2">&quot;stDev&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)),</span>
</span><span id="PriceGenerator.GetStatistics-673"><a href="#PriceGenerator.GetStatistics-673"><span class="linenos">673</span></a>            <span class="s2">&quot;  - 99 percentile: ≤ </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;deltas&quot;</span><span class="p">][</span><span class="s2">&quot;q99&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)),</span>
</span><span id="PriceGenerator.GetStatistics-674"><a href="#PriceGenerator.GetStatistics-674"><span class="linenos">674</span></a>            <span class="s2">&quot;  - 95 percentile: ≤ </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;deltas&quot;</span><span class="p">][</span><span class="s2">&quot;q95&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)),</span>
</span><span id="PriceGenerator.GetStatistics-675"><a href="#PriceGenerator.GetStatistics-675"><span class="linenos">675</span></a>            <span class="s2">&quot;  - 80 percentile: ≤ </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;deltas&quot;</span><span class="p">][</span><span class="s2">&quot;q80&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)),</span>
</span><span id="PriceGenerator.GetStatistics-676"><a href="#PriceGenerator.GetStatistics-676"><span class="linenos">676</span></a>            <span class="s2">&quot;- Cumulative sum of volumes: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;cumSumVolumes&quot;</span><span class="p">]),</span>
</span><span id="PriceGenerator.GetStatistics-677"><a href="#PriceGenerator.GetStatistics-677"><span class="linenos">677</span></a>        <span class="p">]</span>
</span><span id="PriceGenerator.GetStatistics-678"><a href="#PriceGenerator.GetStatistics-678"><span class="linenos">678</span></a>
</span><span id="PriceGenerator.GetStatistics-679"><a href="#PriceGenerator.GetStatistics-679"><span class="linenos">679</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Some statistics:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">summary</span><span class="p">)))</span>
</span><span id="PriceGenerator.GetStatistics-680"><a href="#PriceGenerator.GetStatistics-680"><span class="linenos">680</span></a>
</span><span id="PriceGenerator.GetStatistics-681"><a href="#PriceGenerator.GetStatistics-681"><span class="linenos">681</span></a>        <span class="k">return</span> <span class="n">summary</span>
</span></pre></div>


            <div class="docstring"><p>Calculates statistics of candles chain.</p>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>list with text in Markdown format with statistics.</p>
</blockquote>
</div>


                            </div>
                            <div id="PriceGenerator.Generate" class="classattr">
                                        <input id="PriceGenerator.Generate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">Generate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>:</span></span>

                <label class="view-source-button" for="PriceGenerator.Generate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PriceGenerator.Generate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PriceGenerator.Generate-726"><a href="#PriceGenerator.Generate-726"><span class="linenos">726</span></a>    <span class="k">def</span> <span class="nf">Generate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="PriceGenerator.Generate-727"><a href="#PriceGenerator.Generate-727"><span class="linenos">727</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="PriceGenerator.Generate-728"><a href="#PriceGenerator.Generate-728"><span class="linenos">728</span></a><span class="sd">        Main method to generating prices.</span>
</span><span id="PriceGenerator.Generate-729"><a href="#PriceGenerator.Generate-729"><span class="linenos">729</span></a>
</span><span id="PriceGenerator.Generate-730"><a href="#PriceGenerator.Generate-730"><span class="linenos">730</span></a><span class="sd">        :return Pandas DataFrame object with OHLCV-candlestick in every row and also saving it to the `prices`.</span>
</span><span id="PriceGenerator.Generate-731"><a href="#PriceGenerator.Generate-731"><span class="linenos">731</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PriceGenerator.Generate-732"><a href="#PriceGenerator.Generate-732"><span class="linenos">732</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
</span><span id="PriceGenerator.Generate-733"><a href="#PriceGenerator.Generate-733"><span class="linenos">733</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="PriceGenerator.Generate-734"><a href="#PriceGenerator.Generate-734"><span class="linenos">734</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Horizon length less than 5! It is set to 5 by default.&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator.Generate-735"><a href="#PriceGenerator.Generate-735"><span class="linenos">735</span></a>
</span><span id="PriceGenerator.Generate-736"><a href="#PriceGenerator.Generate-736"><span class="linenos">736</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PriceGenerator.Generate-737"><a href="#PriceGenerator.Generate-737"><span class="linenos">737</span></a>            <span class="c1"># Detecting input trend:</span>
</span><span id="PriceGenerator.Generate-738"><a href="#PriceGenerator.Generate-738"><span class="linenos">738</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="PriceGenerator.Generate-739"><a href="#PriceGenerator.Generate-739"><span class="linenos">739</span></a>            <span class="k">if</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span> <span class="ow">or</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span><span class="p">:</span>
</span><span id="PriceGenerator.Generate-740"><a href="#PriceGenerator.Generate-740"><span class="linenos">740</span></a>                <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Detected old-style string for split trend: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span><span class="p">))</span>
</span><span id="PriceGenerator.Generate-741"><a href="#PriceGenerator.Generate-741"><span class="linenos">741</span></a>
</span><span id="PriceGenerator.Generate-742"><a href="#PriceGenerator.Generate-742"><span class="linenos">742</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;-no-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;-up-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;-down-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator.Generate-743"><a href="#PriceGenerator.Generate-743"><span class="linenos">743</span></a>
</span><span id="PriceGenerator.Generate-744"><a href="#PriceGenerator.Generate-744"><span class="linenos">744</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PriceGenerator.Generate-745"><a href="#PriceGenerator.Generate-745"><span class="linenos">745</span></a>                <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Detected new-style string for split trend: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span><span class="p">))</span>
</span><span id="PriceGenerator.Generate-746"><a href="#PriceGenerator.Generate-746"><span class="linenos">746</span></a>
</span><span id="PriceGenerator.Generate-747"><a href="#PriceGenerator.Generate-747"><span class="linenos">747</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span> <span class="o">=</span> <span class="s2">&quot;-</span><span class="si">{}</span><span class="s2">-&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span><span class="p">)</span>
</span><span id="PriceGenerator.Generate-748"><a href="#PriceGenerator.Generate-748"><span class="linenos">748</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-u-&quot;</span><span class="p">,</span> <span class="s2">&quot;-up-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-d-&quot;</span><span class="p">,</span> <span class="s2">&quot;-down-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-n-&quot;</span><span class="p">,</span> <span class="s2">&quot;-no-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator.Generate-749"><a href="#PriceGenerator.Generate-749"><span class="linenos">749</span></a>
</span><span id="PriceGenerator.Generate-750"><a href="#PriceGenerator.Generate-750"><span class="linenos">750</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;New style string for trend split is set: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span><span class="p">))</span>
</span><span id="PriceGenerator.Generate-751"><a href="#PriceGenerator.Generate-751"><span class="linenos">751</span></a>
</span><span id="PriceGenerator.Generate-752"><a href="#PriceGenerator.Generate-752"><span class="linenos">752</span></a>            <span class="n">trends</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator.Generate-753"><a href="#PriceGenerator.Generate-753"><span class="linenos">753</span></a>
</span><span id="PriceGenerator.Generate-754"><a href="#PriceGenerator.Generate-754"><span class="linenos">754</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Trends list: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trends</span><span class="p">))</span>
</span><span id="PriceGenerator.Generate-755"><a href="#PriceGenerator.Generate-755"><span class="linenos">755</span></a>
</span><span id="PriceGenerator.Generate-756"><a href="#PriceGenerator.Generate-756"><span class="linenos">756</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trends</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span><span class="p">:</span>
</span><span id="PriceGenerator.Generate-757"><a href="#PriceGenerator.Generate-757"><span class="linenos">757</span></a>                <span class="n">trends</span> <span class="o">=</span> <span class="n">trends</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="PriceGenerator.Generate-758"><a href="#PriceGenerator.Generate-758"><span class="linenos">758</span></a>
</span><span id="PriceGenerator.Generate-759"><a href="#PriceGenerator.Generate-759"><span class="linenos">759</span></a>                <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Trend parts count (</span><span class="si">{}</span><span class="s2">) must be less than horizon (</span><span class="si">{}</span><span class="s2">)! New trend will be used: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">trends</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span><span class="p">,</span> <span class="n">trends</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="PriceGenerator.Generate-760"><a href="#PriceGenerator.Generate-760"><span class="linenos">760</span></a>
</span><span id="PriceGenerator.Generate-761"><a href="#PriceGenerator.Generate-761"><span class="linenos">761</span></a>            <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">trends</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="PriceGenerator.Generate-762"><a href="#PriceGenerator.Generate-762"><span class="linenos">762</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">horizon</span><span class="p">]</span>
</span><span id="PriceGenerator.Generate-763"><a href="#PriceGenerator.Generate-763"><span class="linenos">763</span></a>
</span><span id="PriceGenerator.Generate-764"><a href="#PriceGenerator.Generate-764"><span class="linenos">764</span></a>                <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Only one trend will be used with length equal to horizon: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span><span class="p">))</span>
</span><span id="PriceGenerator.Generate-765"><a href="#PriceGenerator.Generate-765"><span class="linenos">765</span></a>
</span><span id="PriceGenerator.Generate-766"><a href="#PriceGenerator.Generate-766"><span class="linenos">766</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">trends</span><span class="p">):</span>
</span><span id="PriceGenerator.Generate-767"><a href="#PriceGenerator.Generate-767"><span class="linenos">767</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PriceGenerator.Generate-768"><a href="#PriceGenerator.Generate-768"><span class="linenos">768</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PriceGenerator.Generate-769"><a href="#PriceGenerator.Generate-769"><span class="linenos">769</span></a>
</span><span id="PriceGenerator.Generate-770"><a href="#PriceGenerator.Generate-770"><span class="linenos">770</span></a>                <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Random trend direction will be used, because trends count not equal to split count!&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator.Generate-771"><a href="#PriceGenerator.Generate-771"><span class="linenos">771</span></a>
</span><span id="PriceGenerator.Generate-772"><a href="#PriceGenerator.Generate-772"><span class="linenos">772</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PriceGenerator.Generate-773"><a href="#PriceGenerator.Generate-773"><span class="linenos">773</span></a>            <span class="n">trends</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="PriceGenerator.Generate-774"><a href="#PriceGenerator.Generate-774"><span class="linenos">774</span></a>
</span><span id="PriceGenerator.Generate-775"><a href="#PriceGenerator.Generate-775"><span class="linenos">775</span></a>        <span class="c1"># maximum of candle sizes: (high - low), if None then used (maxClose - minClose) / 10</span>
</span><span id="PriceGenerator.Generate-776"><a href="#PriceGenerator.Generate-776"><span class="linenos">776</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxOutlier</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PriceGenerator.Generate-777"><a href="#PriceGenerator.Generate-777"><span class="linenos">777</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">maxOutlier</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxClose</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">minClose</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span>
</span><span id="PriceGenerator.Generate-778"><a href="#PriceGenerator.Generate-778"><span class="linenos">778</span></a>
</span><span id="PriceGenerator.Generate-779"><a href="#PriceGenerator.Generate-779"><span class="linenos">779</span></a>        <span class="c1"># maximum of candle body sizes: abs(open - close), if None then used maxOutlier * 90%</span>
</span><span id="PriceGenerator.Generate-780"><a href="#PriceGenerator.Generate-780"><span class="linenos">780</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxCandleBody</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PriceGenerator.Generate-781"><a href="#PriceGenerator.Generate-781"><span class="linenos">781</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">maxCandleBody</span> <span class="o">=</span> <span class="mf">0.9</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxOutlier</span>
</span><span id="PriceGenerator.Generate-782"><a href="#PriceGenerator.Generate-782"><span class="linenos">782</span></a>
</span><span id="PriceGenerator.Generate-783"><a href="#PriceGenerator.Generate-783"><span class="linenos">783</span></a>        <span class="c1"># initClose is the last close price (left on chart or &quot;before&quot; 1st generated candle), 1st candle[&quot;open&quot;] = initClose</span>
</span><span id="PriceGenerator.Generate-784"><a href="#PriceGenerator.Generate-784"><span class="linenos">784</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initClose</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PriceGenerator.Generate-785"><a href="#PriceGenerator.Generate-785"><span class="linenos">785</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">initClose</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">minClose</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">maxClose</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)</span>
</span><span id="PriceGenerator.Generate-786"><a href="#PriceGenerator.Generate-786"><span class="linenos">786</span></a>
</span><span id="PriceGenerator.Generate-787"><a href="#PriceGenerator.Generate-787"><span class="linenos">787</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generating prices...&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator.Generate-788"><a href="#PriceGenerator.Generate-788"><span class="linenos">788</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;- Ticker name: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ticker</span><span class="p">))</span>
</span><span id="PriceGenerator.Generate-789"><a href="#PriceGenerator.Generate-789"><span class="linenos">789</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;- Precision: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">))</span>
</span><span id="PriceGenerator.Generate-790"><a href="#PriceGenerator.Generate-790"><span class="linenos">790</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;- Interval or timeframe (time delta between two neighbour candles): </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span><span class="p">))</span>
</span><span id="PriceGenerator.Generate-791"><a href="#PriceGenerator.Generate-791"><span class="linenos">791</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;- Horizon length (candlesticks count): </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">horizon</span><span class="p">))</span>
</span><span id="PriceGenerator.Generate-792"><a href="#PriceGenerator.Generate-792"><span class="linenos">792</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span><span class="p">:</span>
</span><span id="PriceGenerator.Generate-793"><a href="#PriceGenerator.Generate-793"><span class="linenos">793</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;- Trend type: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span><span class="p">))</span>
</span><span id="PriceGenerator.Generate-794"><a href="#PriceGenerator.Generate-794"><span class="linenos">794</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;- Candlesticks count in every mini-trend: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span><span class="p">))</span>
</span><span id="PriceGenerator.Generate-795"><a href="#PriceGenerator.Generate-795"><span class="linenos">795</span></a>
</span><span id="PriceGenerator.Generate-796"><a href="#PriceGenerator.Generate-796"><span class="linenos">796</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;- Start time: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeStart</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)))</span>
</span><span id="PriceGenerator.Generate-797"><a href="#PriceGenerator.Generate-797"><span class="linenos">797</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;  |-&gt; end time: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">timeStart</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)))</span>
</span><span id="PriceGenerator.Generate-798"><a href="#PriceGenerator.Generate-798"><span class="linenos">798</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;- Maximum of close prices: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxClose</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)))</span>
</span><span id="PriceGenerator.Generate-799"><a href="#PriceGenerator.Generate-799"><span class="linenos">799</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;- Minimum of close prices: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minClose</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)))</span>
</span><span id="PriceGenerator.Generate-800"><a href="#PriceGenerator.Generate-800"><span class="linenos">800</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;- Maximum of candle body sizes: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxCandleBody</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)))</span>
</span><span id="PriceGenerator.Generate-801"><a href="#PriceGenerator.Generate-801"><span class="linenos">801</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;- Maximum of candle tails outlier sizes: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxOutlier</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)))</span>
</span><span id="PriceGenerator.Generate-802"><a href="#PriceGenerator.Generate-802"><span class="linenos">802</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;- Init close (1st open price in chain): </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initClose</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)))</span>
</span><span id="PriceGenerator.Generate-803"><a href="#PriceGenerator.Generate-803"><span class="linenos">803</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;- Maximum of volume of one candle: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxVolume</span><span class="p">))</span>
</span><span id="PriceGenerator.Generate-804"><a href="#PriceGenerator.Generate-804"><span class="linenos">804</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;- Probability that next candle is up: </span><span class="si">{}</span><span class="s2">%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">upCandlesProb</span> <span class="o">*</span> <span class="mi">100</span><span class="p">))</span>
</span><span id="PriceGenerator.Generate-805"><a href="#PriceGenerator.Generate-805"><span class="linenos">805</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;- Statistical outliers probability: </span><span class="si">{}</span><span class="s2">%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outliersProb</span> <span class="o">*</span> <span class="mi">100</span><span class="p">))</span>
</span><span id="PriceGenerator.Generate-806"><a href="#PriceGenerator.Generate-806"><span class="linenos">806</span></a>
</span><span id="PriceGenerator.Generate-807"><a href="#PriceGenerator.Generate-807"><span class="linenos">807</span></a>        <span class="c1"># -- Preparing candles chain:</span>
</span><span id="PriceGenerator.Generate-808"><a href="#PriceGenerator.Generate-808"><span class="linenos">808</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span><span class="p">:</span>
</span><span id="PriceGenerator.Generate-809"><a href="#PriceGenerator.Generate-809"><span class="linenos">809</span></a>            <span class="n">userProb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">upCandlesProb</span>
</span><span id="PriceGenerator.Generate-810"><a href="#PriceGenerator.Generate-810"><span class="linenos">810</span></a>            <span class="n">userHorizon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span>
</span><span id="PriceGenerator.Generate-811"><a href="#PriceGenerator.Generate-811"><span class="linenos">811</span></a>            <span class="n">userInitC</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initClose</span>
</span><span id="PriceGenerator.Generate-812"><a href="#PriceGenerator.Generate-812"><span class="linenos">812</span></a>            <span class="n">candles</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="PriceGenerator.Generate-813"><a href="#PriceGenerator.Generate-813"><span class="linenos">813</span></a>
</span><span id="PriceGenerator.Generate-814"><a href="#PriceGenerator.Generate-814"><span class="linenos">814</span></a>            <span class="k">for</span> <span class="n">trendNum</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">trends</span><span class="p">)):</span>
</span><span id="PriceGenerator.Generate-815"><a href="#PriceGenerator.Generate-815"><span class="linenos">815</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span><span class="p">[</span><span class="n">trendNum</span><span class="p">]</span>
</span><span id="PriceGenerator.Generate-816"><a href="#PriceGenerator.Generate-816"><span class="linenos">816</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">initClose</span> <span class="o">=</span> <span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">trendNum</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">initClose</span>
</span><span id="PriceGenerator.Generate-817"><a href="#PriceGenerator.Generate-817"><span class="linenos">817</span></a>
</span><span id="PriceGenerator.Generate-818"><a href="#PriceGenerator.Generate-818"><span class="linenos">818</span></a>                <span class="c1"># change probability of candles direction in next trend:</span>
</span><span id="PriceGenerator.Generate-819"><a href="#PriceGenerator.Generate-819"><span class="linenos">819</span></a>                <span class="k">if</span> <span class="n">trends</span><span class="p">[</span><span class="n">trendNum</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;up&quot;</span><span class="p">:</span>
</span><span id="PriceGenerator.Generate-820"><a href="#PriceGenerator.Generate-820"><span class="linenos">820</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">upCandlesProb</span> <span class="o">=</span> <span class="mf">0.51</span> <span class="k">if</span> <span class="n">userProb</span> <span class="o">&lt;=</span> <span class="mf">0.5</span> <span class="k">else</span> <span class="n">userProb</span>
</span><span id="PriceGenerator.Generate-821"><a href="#PriceGenerator.Generate-821"><span class="linenos">821</span></a>
</span><span id="PriceGenerator.Generate-822"><a href="#PriceGenerator.Generate-822"><span class="linenos">822</span></a>                <span class="k">elif</span> <span class="n">trends</span><span class="p">[</span><span class="n">trendNum</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;down&quot;</span><span class="p">:</span>
</span><span id="PriceGenerator.Generate-823"><a href="#PriceGenerator.Generate-823"><span class="linenos">823</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">upCandlesProb</span> <span class="o">=</span> <span class="mf">0.49</span> <span class="k">if</span> <span class="n">userProb</span> <span class="o">&gt;=</span> <span class="mf">0.5</span> <span class="k">else</span> <span class="n">userProb</span>
</span><span id="PriceGenerator.Generate-824"><a href="#PriceGenerator.Generate-824"><span class="linenos">824</span></a>
</span><span id="PriceGenerator.Generate-825"><a href="#PriceGenerator.Generate-825"><span class="linenos">825</span></a>                <span class="k">elif</span> <span class="n">trends</span><span class="p">[</span><span class="n">trendNum</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;no&quot;</span><span class="p">:</span>
</span><span id="PriceGenerator.Generate-826"><a href="#PriceGenerator.Generate-826"><span class="linenos">826</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">upCandlesProb</span> <span class="o">=</span> <span class="mf">0.5</span>
</span><span id="PriceGenerator.Generate-827"><a href="#PriceGenerator.Generate-827"><span class="linenos">827</span></a>
</span><span id="PriceGenerator.Generate-828"><a href="#PriceGenerator.Generate-828"><span class="linenos">828</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="PriceGenerator.Generate-829"><a href="#PriceGenerator.Generate-829"><span class="linenos">829</span></a>                    <span class="n">uLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Unknown direction used: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trends</span><span class="p">[</span><span class="n">trendNum</span><span class="p">]))</span>
</span><span id="PriceGenerator.Generate-830"><a href="#PriceGenerator.Generate-830"><span class="linenos">830</span></a>
</span><span id="PriceGenerator.Generate-831"><a href="#PriceGenerator.Generate-831"><span class="linenos">831</span></a>                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unknown direction&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator.Generate-832"><a href="#PriceGenerator.Generate-832"><span class="linenos">832</span></a>
</span><span id="PriceGenerator.Generate-833"><a href="#PriceGenerator.Generate-833"><span class="linenos">833</span></a>                <span class="n">firstCandle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_GenNextCandle</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initClose</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">))</span>  <span class="c1"># first candle in next trend</span>
</span><span id="PriceGenerator.Generate-834"><a href="#PriceGenerator.Generate-834"><span class="linenos">834</span></a>                <span class="n">candles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">firstCandle</span><span class="p">)</span>
</span><span id="PriceGenerator.Generate-835"><a href="#PriceGenerator.Generate-835"><span class="linenos">835</span></a>
</span><span id="PriceGenerator.Generate-836"><a href="#PriceGenerator.Generate-836"><span class="linenos">836</span></a>                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span><span class="p">):</span>
</span><span id="PriceGenerator.Generate-837"><a href="#PriceGenerator.Generate-837"><span class="linenos">837</span></a>                    <span class="n">candles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_GenNextCandle</span><span class="p">(</span><span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;close&quot;</span><span class="p">]))</span>
</span><span id="PriceGenerator.Generate-838"><a href="#PriceGenerator.Generate-838"><span class="linenos">838</span></a>
</span><span id="PriceGenerator.Generate-839"><a href="#PriceGenerator.Generate-839"><span class="linenos">839</span></a>                <span class="n">highDelta</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;high&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="nb">max</span><span class="p">(</span><span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;open&quot;</span><span class="p">],</span> <span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;close&quot;</span><span class="p">]))</span>  <span class="c1"># save higher shadow</span>
</span><span id="PriceGenerator.Generate-840"><a href="#PriceGenerator.Generate-840"><span class="linenos">840</span></a>                <span class="n">lowDelta</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;open&quot;</span><span class="p">],</span> <span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;close&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;low&quot;</span><span class="p">])</span>  <span class="c1"># save lower shadow</span>
</span><span id="PriceGenerator.Generate-841"><a href="#PriceGenerator.Generate-841"><span class="linenos">841</span></a>
</span><span id="PriceGenerator.Generate-842"><a href="#PriceGenerator.Generate-842"><span class="linenos">842</span></a>                <span class="c1"># -- Change last candle in every trend:</span>
</span><span id="PriceGenerator.Generate-843"><a href="#PriceGenerator.Generate-843"><span class="linenos">843</span></a>                <span class="k">if</span> <span class="n">trends</span><span class="p">[</span><span class="n">trendNum</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;up&quot;</span><span class="p">:</span>
</span><span id="PriceGenerator.Generate-844"><a href="#PriceGenerator.Generate-844"><span class="linenos">844</span></a>                    <span class="k">if</span> <span class="n">firstCandle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;close&quot;</span><span class="p">]:</span>
</span><span id="PriceGenerator.Generate-845"><a href="#PriceGenerator.Generate-845"><span class="linenos">845</span></a>                        <span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">firstCandle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">],</span> <span class="n">b</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">maxClose</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)</span>
</span><span id="PriceGenerator.Generate-846"><a href="#PriceGenerator.Generate-846"><span class="linenos">846</span></a>
</span><span id="PriceGenerator.Generate-847"><a href="#PriceGenerator.Generate-847"><span class="linenos">847</span></a>                <span class="k">elif</span> <span class="n">trends</span><span class="p">[</span><span class="n">trendNum</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;down&quot;</span><span class="p">:</span>
</span><span id="PriceGenerator.Generate-848"><a href="#PriceGenerator.Generate-848"><span class="linenos">848</span></a>                    <span class="k">if</span> <span class="n">firstCandle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;close&quot;</span><span class="p">]:</span>
</span><span id="PriceGenerator.Generate-849"><a href="#PriceGenerator.Generate-849"><span class="linenos">849</span></a>                        <span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">minClose</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">firstCandle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)</span>
</span><span id="PriceGenerator.Generate-850"><a href="#PriceGenerator.Generate-850"><span class="linenos">850</span></a>
</span><span id="PriceGenerator.Generate-851"><a href="#PriceGenerator.Generate-851"><span class="linenos">851</span></a>                <span class="k">else</span><span class="p">:</span>  <span class="c1"># if NO trend:</span>
</span><span id="PriceGenerator.Generate-852"><a href="#PriceGenerator.Generate-852"><span class="linenos">852</span></a>                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">firstCandle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;close&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="n">firstCandle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendDeviation</span><span class="p">:</span>
</span><span id="PriceGenerator.Generate-853"><a href="#PriceGenerator.Generate-853"><span class="linenos">853</span></a>                        <span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span>
</span><span id="PriceGenerator.Generate-854"><a href="#PriceGenerator.Generate-854"><span class="linenos">854</span></a>                            <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
</span><span id="PriceGenerator.Generate-855"><a href="#PriceGenerator.Generate-855"><span class="linenos">855</span></a>                                <span class="n">a</span><span class="o">=</span><span class="n">firstCandle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">firstCandle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendDeviation</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="PriceGenerator.Generate-856"><a href="#PriceGenerator.Generate-856"><span class="linenos">856</span></a>                                <span class="n">b</span><span class="o">=</span><span class="n">firstCandle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">firstCandle</span><span class="p">[</span><span class="s2">&quot;close&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendDeviation</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="PriceGenerator.Generate-857"><a href="#PriceGenerator.Generate-857"><span class="linenos">857</span></a>                            <span class="p">),</span>
</span><span id="PriceGenerator.Generate-858"><a href="#PriceGenerator.Generate-858"><span class="linenos">858</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">,</span>
</span><span id="PriceGenerator.Generate-859"><a href="#PriceGenerator.Generate-859"><span class="linenos">859</span></a>                        <span class="p">)</span>
</span><span id="PriceGenerator.Generate-860"><a href="#PriceGenerator.Generate-860"><span class="linenos">860</span></a>
</span><span id="PriceGenerator.Generate-861"><a href="#PriceGenerator.Generate-861"><span class="linenos">861</span></a>                <span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;high&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;open&quot;</span><span class="p">],</span> <span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;close&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="n">highDelta</span>  <span class="c1"># fixing higher shadow</span>
</span><span id="PriceGenerator.Generate-862"><a href="#PriceGenerator.Generate-862"><span class="linenos">862</span></a>                <span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;low&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;open&quot;</span><span class="p">],</span> <span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;close&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="n">lowDelta</span>  <span class="c1"># fixing lower shadow</span>
</span><span id="PriceGenerator.Generate-863"><a href="#PriceGenerator.Generate-863"><span class="linenos">863</span></a>
</span><span id="PriceGenerator.Generate-864"><a href="#PriceGenerator.Generate-864"><span class="linenos">864</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">upCandlesProb</span> <span class="o">=</span> <span class="n">userProb</span>
</span><span id="PriceGenerator.Generate-865"><a href="#PriceGenerator.Generate-865"><span class="linenos">865</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span> <span class="o">=</span> <span class="n">userHorizon</span>
</span><span id="PriceGenerator.Generate-866"><a href="#PriceGenerator.Generate-866"><span class="linenos">866</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">initClose</span> <span class="o">=</span> <span class="n">userInitC</span>
</span><span id="PriceGenerator.Generate-867"><a href="#PriceGenerator.Generate-867"><span class="linenos">867</span></a>
</span><span id="PriceGenerator.Generate-868"><a href="#PriceGenerator.Generate-868"><span class="linenos">868</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PriceGenerator.Generate-869"><a href="#PriceGenerator.Generate-869"><span class="linenos">869</span></a>            <span class="n">candles</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_GenNextCandle</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initClose</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">))]</span>  <span class="c1"># first candle in chain</span>
</span><span id="PriceGenerator.Generate-870"><a href="#PriceGenerator.Generate-870"><span class="linenos">870</span></a>            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span><span class="p">):</span>
</span><span id="PriceGenerator.Generate-871"><a href="#PriceGenerator.Generate-871"><span class="linenos">871</span></a>                <span class="n">candles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_GenNextCandle</span><span class="p">(</span><span class="n">candles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;close&quot;</span><span class="p">]))</span>
</span><span id="PriceGenerator.Generate-872"><a href="#PriceGenerator.Generate-872"><span class="linenos">872</span></a>
</span><span id="PriceGenerator.Generate-873"><a href="#PriceGenerator.Generate-873"><span class="linenos">873</span></a>        <span class="c1"># prepare Dataframe from generated prices:</span>
</span><span id="PriceGenerator.Generate-874"><a href="#PriceGenerator.Generate-874"><span class="linenos">874</span></a>        <span class="n">indx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span>
</span><span id="PriceGenerator.Generate-875"><a href="#PriceGenerator.Generate-875"><span class="linenos">875</span></a>            <span class="n">start</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeStart</span><span class="p">,</span>
</span><span id="PriceGenerator.Generate-876"><a href="#PriceGenerator.Generate-876"><span class="linenos">876</span></a>            <span class="n">end</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeStart</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">horizon</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span><span class="p">,</span>
</span><span id="PriceGenerator.Generate-877"><a href="#PriceGenerator.Generate-877"><span class="linenos">877</span></a>            <span class="n">freq</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span><span class="p">,</span>
</span><span id="PriceGenerator.Generate-878"><a href="#PriceGenerator.Generate-878"><span class="linenos">878</span></a>            <span class="n">tz</span><span class="o">=</span><span class="n">tzlocal</span><span class="p">(),</span>
</span><span id="PriceGenerator.Generate-879"><a href="#PriceGenerator.Generate-879"><span class="linenos">879</span></a>        <span class="p">)</span>
</span><span id="PriceGenerator.Generate-880"><a href="#PriceGenerator.Generate-880"><span class="linenos">880</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">candles</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dfHeaders</span><span class="p">)</span>
</span><span id="PriceGenerator.Generate-881"><a href="#PriceGenerator.Generate-881"><span class="linenos">881</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span> <span class="o">=</span> <span class="n">indx</span>
</span><span id="PriceGenerator.Generate-882"><a href="#PriceGenerator.Generate-882"><span class="linenos">882</span></a>
</span><span id="PriceGenerator.Generate-883"><a href="#PriceGenerator.Generate-883"><span class="linenos">883</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Showing last 5 rows of Pandas generated dataframe object:&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator.Generate-884"><a href="#PriceGenerator.Generate-884"><span class="linenos">884</span></a>        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dfHeaders</span><span class="p">][</span><span class="o">-</span><span class="mi">5</span><span class="p">:],</span> <span class="n">max_cols</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
</span><span id="PriceGenerator.Generate-885"><a href="#PriceGenerator.Generate-885"><span class="linenos">885</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span><span id="PriceGenerator.Generate-886"><a href="#PriceGenerator.Generate-886"><span class="linenos">886</span></a>
</span><span id="PriceGenerator.Generate-887"><a href="#PriceGenerator.Generate-887"><span class="linenos">887</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span>
</span></pre></div>


            <div class="docstring"><p>Main method to generating prices.</p>

<p>:return Pandas DataFrame object with OHLCV-candlestick in every row and also saving it to the <code><a href="#PriceGenerator.prices">prices</a></code>.</p>
</div>


                            </div>
                            <div id="PriceGenerator.RenderBokeh" class="classattr">
                                        <input id="PriceGenerator.RenderBokeh-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">RenderBokeh</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">fileName</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;index.html&#39;</span>,</span><span class="param">	<span class="n">viewInBrowser</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">darkTheme</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">markers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">lines</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">title</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">width</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1800</span>,</span><span class="param">	<span class="n">height</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">940</span>,</span><span class="param">	<span class="n">showControlsOnChart</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">showStatOnChart</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">inline</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">Optional</span><span class="p">[</span><span class="n">gridplot</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="PriceGenerator.RenderBokeh-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PriceGenerator.RenderBokeh"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PriceGenerator.RenderBokeh-889"><a href="#PriceGenerator.RenderBokeh-889"><span class="linenos"> 889</span></a>    <span class="k">def</span> <span class="nf">RenderBokeh</span><span class="p">(</span>
</span><span id="PriceGenerator.RenderBokeh-890"><a href="#PriceGenerator.RenderBokeh-890"><span class="linenos"> 890</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;index.html&quot;</span><span class="p">,</span> <span class="n">viewInBrowser</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-891"><a href="#PriceGenerator.RenderBokeh-891"><span class="linenos"> 891</span></a>            <span class="n">darkTheme</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">markers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">lines</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-892"><a href="#PriceGenerator.RenderBokeh-892"><span class="linenos"> 892</span></a>            <span class="n">title</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1800</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">940</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-893"><a href="#PriceGenerator.RenderBokeh-893"><span class="linenos"> 893</span></a>            <span class="n">showControlsOnChart</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">showStatOnChart</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">inline</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-894"><a href="#PriceGenerator.RenderBokeh-894"><span class="linenos"> 894</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">gridplot</span><span class="p">]:</span>
</span><span id="PriceGenerator.RenderBokeh-895"><a href="#PriceGenerator.RenderBokeh-895"><span class="linenos"> 895</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="PriceGenerator.RenderBokeh-896"><a href="#PriceGenerator.RenderBokeh-896"><span class="linenos"> 896</span></a><span class="sd">        Rendering prices from Pandas DataFrame as OHLCV Bokeh chart of candlesticks and save it to HTML-file.</span>
</span><span id="PriceGenerator.RenderBokeh-897"><a href="#PriceGenerator.RenderBokeh-897"><span class="linenos"> 897</span></a><span class="sd">        Pandas DataFrame in `prices` variable must contain &quot;datetime&quot;, &quot;open&quot;, &quot;high&quot;, &quot;low&quot;, &quot;close&quot; and &quot;volume&quot; columns.</span>
</span><span id="PriceGenerator.RenderBokeh-898"><a href="#PriceGenerator.RenderBokeh-898"><span class="linenos"> 898</span></a>
</span><span id="PriceGenerator.RenderBokeh-899"><a href="#PriceGenerator.RenderBokeh-899"><span class="linenos"> 899</span></a><span class="sd">        See also: https://docs.bokeh.org/en/latest/docs/gallery/candlestick.html</span>
</span><span id="PriceGenerator.RenderBokeh-900"><a href="#PriceGenerator.RenderBokeh-900"><span class="linenos"> 900</span></a>
</span><span id="PriceGenerator.RenderBokeh-901"><a href="#PriceGenerator.RenderBokeh-901"><span class="linenos"> 901</span></a><span class="sd">        :param fileName: HTML-file path to save Bokeh chart. `index.html` by default.</span>
</span><span id="PriceGenerator.RenderBokeh-902"><a href="#PriceGenerator.RenderBokeh-902"><span class="linenos"> 902</span></a><span class="sd">        :param viewInBrowser: If `True`, then immediately opens HTML chart in browser after rendering. `False` by default.</span>
</span><span id="PriceGenerator.RenderBokeh-903"><a href="#PriceGenerator.RenderBokeh-903"><span class="linenos"> 903</span></a><span class="sd">        :param darkTheme: chart theme. `False` by default, mean that will be used light theme, `False` mean dark theme.</span>
</span><span id="PriceGenerator.RenderBokeh-904"><a href="#PriceGenerator.RenderBokeh-904"><span class="linenos"> 904</span></a><span class="sd">        :param markers: Pandas DataFrame with additional markers that will be placed on main series. `None` by default.</span>
</span><span id="PriceGenerator.RenderBokeh-905"><a href="#PriceGenerator.RenderBokeh-905"><span class="linenos"> 905</span></a><span class="sd">                        Marker is a custom symbol, example: ×, ↓ or ↑. Dataframe with markers must contain at least two columns.</span>
</span><span id="PriceGenerator.RenderBokeh-906"><a href="#PriceGenerator.RenderBokeh-906"><span class="linenos"> 906</span></a><span class="sd">                        There are `datetime` with date and time and some markers columns (`markersUpper`, `markersCenter` or `markersLower`).</span>
</span><span id="PriceGenerator.RenderBokeh-907"><a href="#PriceGenerator.RenderBokeh-907"><span class="linenos"> 907</span></a><span class="sd">                        Length of markers series must be equal to the length of main candles series.</span>
</span><span id="PriceGenerator.RenderBokeh-908"><a href="#PriceGenerator.RenderBokeh-908"><span class="linenos"> 908</span></a><span class="sd">        :param lines: list with custom series, where additional chart-lines will place on main series. `None` by default.</span>
</span><span id="PriceGenerator.RenderBokeh-909"><a href="#PriceGenerator.RenderBokeh-909"><span class="linenos"> 909</span></a><span class="sd">                      Line data must contain at least two columns. There are `datetime` with date and time and</span>
</span><span id="PriceGenerator.RenderBokeh-910"><a href="#PriceGenerator.RenderBokeh-910"><span class="linenos"> 910</span></a><span class="sd">                      `custom_line_name` with y-coordinates. Length of the chart-line dataframes must be equal to the length of main candle series.</span>
</span><span id="PriceGenerator.RenderBokeh-911"><a href="#PriceGenerator.RenderBokeh-911"><span class="linenos"> 911</span></a><span class="sd">        :param title: specific chart title. If `None`, then used auto-generated title. `None` by default.</span>
</span><span id="PriceGenerator.RenderBokeh-912"><a href="#PriceGenerator.RenderBokeh-912"><span class="linenos"> 912</span></a><span class="sd">        :param width: chart width. If `None`, then used auto-width. 1800 px by default.</span>
</span><span id="PriceGenerator.RenderBokeh-913"><a href="#PriceGenerator.RenderBokeh-913"><span class="linenos"> 913</span></a><span class="sd">        :param height: chart height. If `None`, then used auto-height. 940 px by default.</span>
</span><span id="PriceGenerator.RenderBokeh-914"><a href="#PriceGenerator.RenderBokeh-914"><span class="linenos"> 914</span></a><span class="sd">        :param showControlsOnChart: enable controls block in legend to hide/show some elements on chart, `True` by default.</span>
</span><span id="PriceGenerator.RenderBokeh-915"><a href="#PriceGenerator.RenderBokeh-915"><span class="linenos"> 915</span></a><span class="sd">        :param showStatOnChart: show statistics block on chart, `True` (by default) mean that will be calculating additional</span>
</span><span id="PriceGenerator.RenderBokeh-916"><a href="#PriceGenerator.RenderBokeh-916"><span class="linenos"> 916</span></a><span class="sd">                                series, like as Trend and Average Points. And some classical indicators, like as SMA, HMA,</span>
</span><span id="PriceGenerator.RenderBokeh-917"><a href="#PriceGenerator.RenderBokeh-917"><span class="linenos"> 917</span></a><span class="sd">                                VWMA, Bollinger Bands, Parabolic Stop and Reverse, Alligator and Zig-Zag indicator.</span>
</span><span id="PriceGenerator.RenderBokeh-918"><a href="#PriceGenerator.RenderBokeh-918"><span class="linenos"> 918</span></a><span class="sd">                                Warning! Calculate statistic takes more time. If you want to decrease chart rendering time,</span>
</span><span id="PriceGenerator.RenderBokeh-919"><a href="#PriceGenerator.RenderBokeh-919"><span class="linenos"> 919</span></a><span class="sd">                                then set this parameter to `False`.</span>
</span><span id="PriceGenerator.RenderBokeh-920"><a href="#PriceGenerator.RenderBokeh-920"><span class="linenos"> 920</span></a><span class="sd">        :param inline: if `True`, then output chart in Jupyter Notebook cell. `False` by default.</span>
</span><span id="PriceGenerator.RenderBokeh-921"><a href="#PriceGenerator.RenderBokeh-921"><span class="linenos"> 921</span></a><span class="sd">        :return: bokeh.layouts.gridplot with all layouts objects or None.</span>
</span><span id="PriceGenerator.RenderBokeh-922"><a href="#PriceGenerator.RenderBokeh-922"><span class="linenos"> 922</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PriceGenerator.RenderBokeh-923"><a href="#PriceGenerator.RenderBokeh-923"><span class="linenos"> 923</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="PriceGenerator.RenderBokeh-924"><a href="#PriceGenerator.RenderBokeh-924"><span class="linenos"> 924</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Empty price data! Generate or load prices before show as Bokeh chart!&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator.RenderBokeh-925"><a href="#PriceGenerator.RenderBokeh-925"><span class="linenos"> 925</span></a>
</span><span id="PriceGenerator.RenderBokeh-926"><a href="#PriceGenerator.RenderBokeh-926"><span class="linenos"> 926</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PriceGenerator.RenderBokeh-927"><a href="#PriceGenerator.RenderBokeh-927"><span class="linenos"> 927</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Rendering Pandas DataFrame as Bokeh chart...&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator.RenderBokeh-928"><a href="#PriceGenerator.RenderBokeh-928"><span class="linenos"> 928</span></a>
</span><span id="PriceGenerator.RenderBokeh-929"><a href="#PriceGenerator.RenderBokeh-929"><span class="linenos"> 929</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">DetectTimeframe</span><span class="p">()</span>  <span class="c1"># auto-detect time delta between last two neighbour candles</span>
</span><span id="PriceGenerator.RenderBokeh-930"><a href="#PriceGenerator.RenderBokeh-930"><span class="linenos"> 930</span></a>            <span class="n">infoBlock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetStatistics</span><span class="p">()</span> <span class="k">if</span> <span class="n">showStatOnChart</span> <span class="k">else</span> <span class="p">[]</span>  <span class="c1"># calculating some indicators</span>
</span><span id="PriceGenerator.RenderBokeh-931"><a href="#PriceGenerator.RenderBokeh-931"><span class="linenos"> 931</span></a>
</span><span id="PriceGenerator.RenderBokeh-932"><a href="#PriceGenerator.RenderBokeh-932"><span class="linenos"> 932</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chartTitle</span> <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">title</span> <span class="k">else</span> <span class="n">title</span>  <span class="c1"># chart title</span>
</span><span id="PriceGenerator.RenderBokeh-933"><a href="#PriceGenerator.RenderBokeh-933"><span class="linenos"> 933</span></a>            <span class="n">width</span> <span class="o">=</span> <span class="mi">1200</span> <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">width</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">width</span>  <span class="c1"># chart summary width</span>
</span><span id="PriceGenerator.RenderBokeh-934"><a href="#PriceGenerator.RenderBokeh-934"><span class="linenos"> 934</span></a>            <span class="n">height</span> <span class="o">=</span> <span class="mi">800</span> <span class="k">if</span> <span class="n">height</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">height</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">height</span> <span class="o">-</span> <span class="mi">90</span>  <span class="c1"># chart summary height</span>
</span><span id="PriceGenerator.RenderBokeh-935"><a href="#PriceGenerator.RenderBokeh-935"><span class="linenos"> 935</span></a>
</span><span id="PriceGenerator.RenderBokeh-936"><a href="#PriceGenerator.RenderBokeh-936"><span class="linenos"> 936</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Preparing Bokeh chart configuration...&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator.RenderBokeh-937"><a href="#PriceGenerator.RenderBokeh-937"><span class="linenos"> 937</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Title: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">title</span><span class="p">))</span>
</span><span id="PriceGenerator.RenderBokeh-938"><a href="#PriceGenerator.RenderBokeh-938"><span class="linenos"> 938</span></a>
</span><span id="PriceGenerator.RenderBokeh-939"><a href="#PriceGenerator.RenderBokeh-939"><span class="linenos"> 939</span></a>            <span class="k">if</span> <span class="n">inline</span><span class="p">:</span>
</span><span id="PriceGenerator.RenderBokeh-940"><a href="#PriceGenerator.RenderBokeh-940"><span class="linenos"> 940</span></a>                <span class="n">output_notebook</span><span class="p">(</span><span class="n">resources</span><span class="o">=</span><span class="n">INLINE</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">hide_banner</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># set output to notebook cell</span>
</span><span id="PriceGenerator.RenderBokeh-941"><a href="#PriceGenerator.RenderBokeh-941"><span class="linenos"> 941</span></a>
</span><span id="PriceGenerator.RenderBokeh-942"><a href="#PriceGenerator.RenderBokeh-942"><span class="linenos"> 942</span></a>            <span class="c1"># --- Preparing Main chart:</span>
</span><span id="PriceGenerator.RenderBokeh-943"><a href="#PriceGenerator.RenderBokeh-943"><span class="linenos"> 943</span></a>            <span class="n">chart</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span>
</span><span id="PriceGenerator.RenderBokeh-944"><a href="#PriceGenerator.RenderBokeh-944"><span class="linenos"> 944</span></a>                <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-945"><a href="#PriceGenerator.RenderBokeh-945"><span class="linenos"> 945</span></a>                <span class="n">x_axis_type</span><span class="o">=</span><span class="s2">&quot;datetime&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-946"><a href="#PriceGenerator.RenderBokeh-946"><span class="linenos"> 946</span></a>                <span class="n">x_axis_label</span><span class="o">=</span><span class="s2">&quot;Date and time&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-947"><a href="#PriceGenerator.RenderBokeh-947"><span class="linenos"> 947</span></a>                <span class="n">y_axis_label</span><span class="o">=</span><span class="s2">&quot;Price&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-948"><a href="#PriceGenerator.RenderBokeh-948"><span class="linenos"> 948</span></a>                <span class="n">outline_line_width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-949"><a href="#PriceGenerator.RenderBokeh-949"><span class="linenos"> 949</span></a>                <span class="n">outline_line_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-950"><a href="#PriceGenerator.RenderBokeh-950"><span class="linenos"> 950</span></a>                <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pan&quot;</span><span class="p">,</span> <span class="s2">&quot;wheel_zoom&quot;</span><span class="p">,</span> <span class="s2">&quot;box_zoom&quot;</span><span class="p">,</span> <span class="s2">&quot;hover&quot;</span><span class="p">,</span> <span class="s2">&quot;reset&quot;</span><span class="p">,</span> <span class="s2">&quot;save&quot;</span><span class="p">],</span>
</span><span id="PriceGenerator.RenderBokeh-951"><a href="#PriceGenerator.RenderBokeh-951"><span class="linenos"> 951</span></a>                <span class="n">toolbar_location</span><span class="o">=</span><span class="s2">&quot;above&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-952"><a href="#PriceGenerator.RenderBokeh-952"><span class="linenos"> 952</span></a>                <span class="n">active_scroll</span><span class="o">=</span><span class="s2">&quot;wheel_zoom&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-953"><a href="#PriceGenerator.RenderBokeh-953"><span class="linenos"> 953</span></a>                <span class="n">min_width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-954"><a href="#PriceGenerator.RenderBokeh-954"><span class="linenos"> 954</span></a>                <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-955"><a href="#PriceGenerator.RenderBokeh-955"><span class="linenos"> 955</span></a>                <span class="n">sizing_mode</span><span class="o">=</span><span class="s2">&quot;scale_width&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-956"><a href="#PriceGenerator.RenderBokeh-956"><span class="linenos"> 956</span></a>                <span class="n">background_fill_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-957"><a href="#PriceGenerator.RenderBokeh-957"><span class="linenos"> 957</span></a>                <span class="n">min_border_left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-958"><a href="#PriceGenerator.RenderBokeh-958"><span class="linenos"> 958</span></a>                <span class="n">min_border_right</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-959"><a href="#PriceGenerator.RenderBokeh-959"><span class="linenos"> 959</span></a>                <span class="n">min_border_top</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-960"><a href="#PriceGenerator.RenderBokeh-960"><span class="linenos"> 960</span></a>                <span class="n">min_border_bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-961"><a href="#PriceGenerator.RenderBokeh-961"><span class="linenos"> 961</span></a>                <span class="n">y_range</span><span class="o">=</span><span class="n">Range1d</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">low</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">high</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span><span class="p">),</span>
</span><span id="PriceGenerator.RenderBokeh-962"><a href="#PriceGenerator.RenderBokeh-962"><span class="linenos"> 962</span></a>            <span class="p">)</span>
</span><span id="PriceGenerator.RenderBokeh-963"><a href="#PriceGenerator.RenderBokeh-963"><span class="linenos"> 963</span></a>            <span class="n">chart</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">logo</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># remove bokeh logo and link to https://bokeh.org/</span>
</span><span id="PriceGenerator.RenderBokeh-964"><a href="#PriceGenerator.RenderBokeh-964"><span class="linenos"> 964</span></a>            <span class="n">chart</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">major_label_orientation</span> <span class="o">=</span> <span class="n">pi</span> <span class="o">/</span> <span class="mi">6</span>
</span><span id="PriceGenerator.RenderBokeh-965"><a href="#PriceGenerator.RenderBokeh-965"><span class="linenos"> 965</span></a>            <span class="n">chart</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">grid_line_dash</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</span><span id="PriceGenerator.RenderBokeh-966"><a href="#PriceGenerator.RenderBokeh-966"><span class="linenos"> 966</span></a>            <span class="n">chart</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">grid_line_alpha</span> <span class="o">=</span> <span class="mf">0.4</span>
</span><span id="PriceGenerator.RenderBokeh-967"><a href="#PriceGenerator.RenderBokeh-967"><span class="linenos"> 967</span></a>            <span class="n">chart</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">minor_grid_line_dash</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</span><span id="PriceGenerator.RenderBokeh-968"><a href="#PriceGenerator.RenderBokeh-968"><span class="linenos"> 968</span></a>            <span class="n">chart</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">minor_grid_line_alpha</span> <span class="o">=</span> <span class="mf">0.4</span>
</span><span id="PriceGenerator.RenderBokeh-969"><a href="#PriceGenerator.RenderBokeh-969"><span class="linenos"> 969</span></a>            <span class="n">chart</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">minor_grid_line_dash</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</span><span id="PriceGenerator.RenderBokeh-970"><a href="#PriceGenerator.RenderBokeh-970"><span class="linenos"> 970</span></a>            <span class="n">chart</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">minor_grid_line_alpha</span> <span class="o">=</span> <span class="mf">0.3</span>
</span><span id="PriceGenerator.RenderBokeh-971"><a href="#PriceGenerator.RenderBokeh-971"><span class="linenos"> 971</span></a>            <span class="n">chart</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">minor_grid_line_color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;gray&quot;</span>
</span><span id="PriceGenerator.RenderBokeh-972"><a href="#PriceGenerator.RenderBokeh-972"><span class="linenos"> 972</span></a>            <span class="n">chart</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">minor_grid_line_dash</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</span><span id="PriceGenerator.RenderBokeh-973"><a href="#PriceGenerator.RenderBokeh-973"><span class="linenos"> 973</span></a>            <span class="n">chart</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">minor_grid_line_alpha</span> <span class="o">=</span> <span class="mf">0.3</span>
</span><span id="PriceGenerator.RenderBokeh-974"><a href="#PriceGenerator.RenderBokeh-974"><span class="linenos"> 974</span></a>            <span class="n">chart</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">minor_grid_line_color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;gray&quot;</span>
</span><span id="PriceGenerator.RenderBokeh-975"><a href="#PriceGenerator.RenderBokeh-975"><span class="linenos"> 975</span></a>
</span><span id="PriceGenerator.RenderBokeh-976"><a href="#PriceGenerator.RenderBokeh-976"><span class="linenos"> 976</span></a>            <span class="k">if</span> <span class="n">showStatOnChart</span><span class="p">:</span>
</span><span id="PriceGenerator.RenderBokeh-977"><a href="#PriceGenerator.RenderBokeh-977"><span class="linenos"> 977</span></a>                <span class="n">summaryItems</span> <span class="o">=</span> <span class="p">[(</span><span class="n">info</span><span class="p">,</span> <span class="p">[])</span> <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">infoBlock</span><span class="p">]</span>
</span><span id="PriceGenerator.RenderBokeh-978"><a href="#PriceGenerator.RenderBokeh-978"><span class="linenos"> 978</span></a>                <span class="k">if</span> <span class="n">showControlsOnChart</span><span class="p">:</span>
</span><span id="PriceGenerator.RenderBokeh-979"><a href="#PriceGenerator.RenderBokeh-979"><span class="linenos"> 979</span></a>                    <span class="n">summaryItems</span> <span class="o">+=</span> <span class="p">[(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="p">[]),</span> <span class="p">(</span><span class="s2">&quot;Click to show/hide on chart:&quot;</span><span class="p">,</span> <span class="p">[])]</span>
</span><span id="PriceGenerator.RenderBokeh-980"><a href="#PriceGenerator.RenderBokeh-980"><span class="linenos"> 980</span></a>
</span><span id="PriceGenerator.RenderBokeh-981"><a href="#PriceGenerator.RenderBokeh-981"><span class="linenos"> 981</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PriceGenerator.RenderBokeh-982"><a href="#PriceGenerator.RenderBokeh-982"><span class="linenos"> 982</span></a>                <span class="n">summaryItems</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;Click to show/hide on chart:&quot;</span><span class="p">,</span> <span class="p">[])]</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="p">[(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="p">[])]</span>
</span><span id="PriceGenerator.RenderBokeh-983"><a href="#PriceGenerator.RenderBokeh-983"><span class="linenos"> 983</span></a>
</span><span id="PriceGenerator.RenderBokeh-984"><a href="#PriceGenerator.RenderBokeh-984"><span class="linenos"> 984</span></a>            <span class="n">summaryInfo</span> <span class="o">=</span> <span class="n">Legend</span><span class="p">(</span>
</span><span id="PriceGenerator.RenderBokeh-985"><a href="#PriceGenerator.RenderBokeh-985"><span class="linenos"> 985</span></a>                <span class="n">click_policy</span><span class="o">=</span><span class="s2">&quot;hide&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-986"><a href="#PriceGenerator.RenderBokeh-986"><span class="linenos"> 986</span></a>                <span class="n">items</span><span class="o">=</span><span class="n">summaryItems</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-987"><a href="#PriceGenerator.RenderBokeh-987"><span class="linenos"> 987</span></a>                <span class="n">location</span><span class="o">=</span><span class="s2">&quot;top_right&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-988"><a href="#PriceGenerator.RenderBokeh-988"><span class="linenos"> 988</span></a>                <span class="n">label_text_font_size</span><span class="o">=</span><span class="s2">&quot;8pt&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-989"><a href="#PriceGenerator.RenderBokeh-989"><span class="linenos"> 989</span></a>                <span class="n">margin</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-990"><a href="#PriceGenerator.RenderBokeh-990"><span class="linenos"> 990</span></a>                <span class="n">padding</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-991"><a href="#PriceGenerator.RenderBokeh-991"><span class="linenos"> 991</span></a>                <span class="n">spacing</span><span class="o">=-</span><span class="mi">5</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-992"><a href="#PriceGenerator.RenderBokeh-992"><span class="linenos"> 992</span></a>                <span class="n">label_text_font</span><span class="o">=</span><span class="s2">&quot;Lucida Console&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-993"><a href="#PriceGenerator.RenderBokeh-993"><span class="linenos"> 993</span></a>            <span class="p">)</span>
</span><span id="PriceGenerator.RenderBokeh-994"><a href="#PriceGenerator.RenderBokeh-994"><span class="linenos"> 994</span></a>            <span class="n">chart</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">summaryInfo</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator.RenderBokeh-995"><a href="#PriceGenerator.RenderBokeh-995"><span class="linenos"> 995</span></a>
</span><span id="PriceGenerator.RenderBokeh-996"><a href="#PriceGenerator.RenderBokeh-996"><span class="linenos"> 996</span></a>            <span class="c1"># preparing data for candles:</span>
</span><span id="PriceGenerator.RenderBokeh-997"><a href="#PriceGenerator.RenderBokeh-997"><span class="linenos"> 997</span></a>            <span class="n">inc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">open</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span>
</span><span id="PriceGenerator.RenderBokeh-998"><a href="#PriceGenerator.RenderBokeh-998"><span class="linenos"> 998</span></a>            <span class="n">dec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">open</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span>
</span><span id="PriceGenerator.RenderBokeh-999"><a href="#PriceGenerator.RenderBokeh-999"><span class="linenos"> 999</span></a>            <span class="n">candleWidth</span> <span class="o">=</span> <span class="mi">108000</span>  <span class="c1"># as for 5 minutes by default</span>
</span><span id="PriceGenerator.RenderBokeh-1000"><a href="#PriceGenerator.RenderBokeh-1000"><span class="linenos">1000</span></a>
</span><span id="PriceGenerator.RenderBokeh-1001"><a href="#PriceGenerator.RenderBokeh-1001"><span class="linenos">1001</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span> <span class="o">&lt;=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">31</span><span class="p">):</span>
</span><span id="PriceGenerator.RenderBokeh-1002"><a href="#PriceGenerator.RenderBokeh-1002"><span class="linenos">1002</span></a>                <span class="n">candleWidth</span> <span class="o">=</span> <span class="mi">864000000</span>  <span class="c1"># 12 * 60 * 60 * 25 * 800  # for 43200 minutes</span>
</span><span id="PriceGenerator.RenderBokeh-1003"><a href="#PriceGenerator.RenderBokeh-1003"><span class="linenos">1003</span></a>
</span><span id="PriceGenerator.RenderBokeh-1004"><a href="#PriceGenerator.RenderBokeh-1004"><span class="linenos">1004</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span> <span class="o">&lt;=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">):</span>
</span><span id="PriceGenerator.RenderBokeh-1005"><a href="#PriceGenerator.RenderBokeh-1005"><span class="linenos">1005</span></a>                <span class="n">candleWidth</span> <span class="o">=</span> <span class="mi">216000000</span>  <span class="c1"># 12 * 60 * 60 * 25 * 200  # for 10080 minutes</span>
</span><span id="PriceGenerator.RenderBokeh-1006"><a href="#PriceGenerator.RenderBokeh-1006"><span class="linenos">1006</span></a>
</span><span id="PriceGenerator.RenderBokeh-1007"><a href="#PriceGenerator.RenderBokeh-1007"><span class="linenos">1007</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span> <span class="o">&lt;=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
</span><span id="PriceGenerator.RenderBokeh-1008"><a href="#PriceGenerator.RenderBokeh-1008"><span class="linenos">1008</span></a>                <span class="n">candleWidth</span> <span class="o">=</span> <span class="mi">32400000</span>  <span class="c1"># 12 * 60 * 60 * 25 * 30  # for 1440 minutes</span>
</span><span id="PriceGenerator.RenderBokeh-1009"><a href="#PriceGenerator.RenderBokeh-1009"><span class="linenos">1009</span></a>
</span><span id="PriceGenerator.RenderBokeh-1010"><a href="#PriceGenerator.RenderBokeh-1010"><span class="linenos">1010</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span> <span class="o">&lt;=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
</span><span id="PriceGenerator.RenderBokeh-1011"><a href="#PriceGenerator.RenderBokeh-1011"><span class="linenos">1011</span></a>                <span class="n">candleWidth</span> <span class="o">=</span> <span class="mi">6480000</span>  <span class="c1"># 12 * 60 * 60 * 25 * 6  # for 240 minutes</span>
</span><span id="PriceGenerator.RenderBokeh-1012"><a href="#PriceGenerator.RenderBokeh-1012"><span class="linenos">1012</span></a>
</span><span id="PriceGenerator.RenderBokeh-1013"><a href="#PriceGenerator.RenderBokeh-1013"><span class="linenos">1013</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span> <span class="o">&lt;=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
</span><span id="PriceGenerator.RenderBokeh-1014"><a href="#PriceGenerator.RenderBokeh-1014"><span class="linenos">1014</span></a>                <span class="n">candleWidth</span> <span class="o">=</span> <span class="mi">1620000</span>  <span class="c1"># 12 * 60 * 60 * 25 * 1.5  # for 60 minutes</span>
</span><span id="PriceGenerator.RenderBokeh-1015"><a href="#PriceGenerator.RenderBokeh-1015"><span class="linenos">1015</span></a>
</span><span id="PriceGenerator.RenderBokeh-1016"><a href="#PriceGenerator.RenderBokeh-1016"><span class="linenos">1016</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span> <span class="o">&lt;=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>
</span><span id="PriceGenerator.RenderBokeh-1017"><a href="#PriceGenerator.RenderBokeh-1017"><span class="linenos">1017</span></a>                <span class="n">candleWidth</span> <span class="o">=</span> <span class="mi">648000</span>  <span class="c1"># 12 * 60 * 60 * 15  # for 30 minutes</span>
</span><span id="PriceGenerator.RenderBokeh-1018"><a href="#PriceGenerator.RenderBokeh-1018"><span class="linenos">1018</span></a>
</span><span id="PriceGenerator.RenderBokeh-1019"><a href="#PriceGenerator.RenderBokeh-1019"><span class="linenos">1019</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span> <span class="o">&lt;=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">15</span><span class="p">):</span>
</span><span id="PriceGenerator.RenderBokeh-1020"><a href="#PriceGenerator.RenderBokeh-1020"><span class="linenos">1020</span></a>                <span class="n">candleWidth</span> <span class="o">=</span> <span class="mi">345600</span>  <span class="c1"># 12 * 60 * 60 * 8  # for 15 minutes</span>
</span><span id="PriceGenerator.RenderBokeh-1021"><a href="#PriceGenerator.RenderBokeh-1021"><span class="linenos">1021</span></a>
</span><span id="PriceGenerator.RenderBokeh-1022"><a href="#PriceGenerator.RenderBokeh-1022"><span class="linenos">1022</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span> <span class="o">&lt;=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
</span><span id="PriceGenerator.RenderBokeh-1023"><a href="#PriceGenerator.RenderBokeh-1023"><span class="linenos">1023</span></a>                <span class="n">candleWidth</span> <span class="o">=</span> <span class="mi">108000</span>  <span class="c1"># 12 * 60 * 60 * 2.5  # for 5 minutes</span>
</span><span id="PriceGenerator.RenderBokeh-1024"><a href="#PriceGenerator.RenderBokeh-1024"><span class="linenos">1024</span></a>
</span><span id="PriceGenerator.RenderBokeh-1025"><a href="#PriceGenerator.RenderBokeh-1025"><span class="linenos">1025</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span> <span class="o">&lt;=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
</span><span id="PriceGenerator.RenderBokeh-1026"><a href="#PriceGenerator.RenderBokeh-1026"><span class="linenos">1026</span></a>                <span class="n">candleWidth</span> <span class="o">=</span> <span class="mi">21600</span>  <span class="c1"># 12 * 60 * 30   # for 1 minute</span>
</span><span id="PriceGenerator.RenderBokeh-1027"><a href="#PriceGenerator.RenderBokeh-1027"><span class="linenos">1027</span></a>
</span><span id="PriceGenerator.RenderBokeh-1028"><a href="#PriceGenerator.RenderBokeh-1028"><span class="linenos">1028</span></a>            <span class="n">disabledObjects</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># bokeh objects to hide by default when page is loaded</span>
</span><span id="PriceGenerator.RenderBokeh-1029"><a href="#PriceGenerator.RenderBokeh-1029"><span class="linenos">1029</span></a>
</span><span id="PriceGenerator.RenderBokeh-1030"><a href="#PriceGenerator.RenderBokeh-1030"><span class="linenos">1030</span></a>            <span class="c1"># preparing data for hover tooltips:</span>
</span><span id="PriceGenerator.RenderBokeh-1031"><a href="#PriceGenerator.RenderBokeh-1031"><span class="linenos">1031</span></a>            <span class="n">source</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="PriceGenerator.RenderBokeh-1032"><a href="#PriceGenerator.RenderBokeh-1032"><span class="linenos">1032</span></a>                <span class="s2">&quot;candle&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span>
</span><span id="PriceGenerator.RenderBokeh-1033"><a href="#PriceGenerator.RenderBokeh-1033"><span class="linenos">1033</span></a>                <span class="s2">&quot;datetime&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1034"><a href="#PriceGenerator.RenderBokeh-1034"><span class="linenos">1034</span></a>                <span class="s2">&quot;open&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">open</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1035"><a href="#PriceGenerator.RenderBokeh-1035"><span class="linenos">1035</span></a>                <span class="s2">&quot;high&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">high</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1036"><a href="#PriceGenerator.RenderBokeh-1036"><span class="linenos">1036</span></a>                <span class="s2">&quot;low&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">low</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1037"><a href="#PriceGenerator.RenderBokeh-1037"><span class="linenos">1037</span></a>                <span class="s2">&quot;close&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1038"><a href="#PriceGenerator.RenderBokeh-1038"><span class="linenos">1038</span></a>                <span class="s2">&quot;volume&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">volume</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1039"><a href="#PriceGenerator.RenderBokeh-1039"><span class="linenos">1039</span></a>            <span class="p">}</span>
</span><span id="PriceGenerator.RenderBokeh-1040"><a href="#PriceGenerator.RenderBokeh-1040"><span class="linenos">1040</span></a>            <span class="n">hoverData</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">source</span><span class="p">)</span>
</span><span id="PriceGenerator.RenderBokeh-1041"><a href="#PriceGenerator.RenderBokeh-1041"><span class="linenos">1041</span></a>            <span class="n">hover</span> <span class="o">=</span> <span class="n">chart</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">HoverTool</span><span class="p">))</span>
</span><span id="PriceGenerator.RenderBokeh-1042"><a href="#PriceGenerator.RenderBokeh-1042"><span class="linenos">1042</span></a>            <span class="n">hover</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;candle&quot;</span>
</span><span id="PriceGenerator.RenderBokeh-1043"><a href="#PriceGenerator.RenderBokeh-1043"><span class="linenos">1043</span></a>            <span class="n">hover</span><span class="o">.</span><span class="n">tooltips</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="PriceGenerator.RenderBokeh-1044"><a href="#PriceGenerator.RenderBokeh-1044"><span class="linenos">1044</span></a>                <span class="p">(</span><span class="s2">&quot;Candle&quot;</span><span class="p">,</span> <span class="s2">&quot;@candle&quot;</span><span class="p">),</span>
</span><span id="PriceGenerator.RenderBokeh-1045"><a href="#PriceGenerator.RenderBokeh-1045"><span class="linenos">1045</span></a>                <span class="p">(</span><span class="s2">&quot;Date&quot;</span><span class="p">,</span> <span class="s2">&quot;@datetime{%Y-%m-</span><span class="si">%d</span><span class="s2">}&quot;</span><span class="p">),</span>
</span><span id="PriceGenerator.RenderBokeh-1046"><a href="#PriceGenerator.RenderBokeh-1046"><span class="linenos">1046</span></a>                <span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">,</span> <span class="s2">&quot;@datetime{%H:%M:%S}&quot;</span><span class="p">),</span>
</span><span id="PriceGenerator.RenderBokeh-1047"><a href="#PriceGenerator.RenderBokeh-1047"><span class="linenos">1047</span></a>                <span class="p">(</span><span class="s2">&quot;Open&quot;</span><span class="p">,</span> <span class="s2">&quot;@open</span><span class="si">{0.0000}</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="PriceGenerator.RenderBokeh-1048"><a href="#PriceGenerator.RenderBokeh-1048"><span class="linenos">1048</span></a>                <span class="p">(</span><span class="s2">&quot;High&quot;</span><span class="p">,</span> <span class="s2">&quot;@high</span><span class="si">{0.0000}</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="PriceGenerator.RenderBokeh-1049"><a href="#PriceGenerator.RenderBokeh-1049"><span class="linenos">1049</span></a>                <span class="p">(</span><span class="s2">&quot;Low&quot;</span><span class="p">,</span> <span class="s2">&quot;@low</span><span class="si">{0.0000}</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="PriceGenerator.RenderBokeh-1050"><a href="#PriceGenerator.RenderBokeh-1050"><span class="linenos">1050</span></a>                <span class="p">(</span><span class="s2">&quot;Close&quot;</span><span class="p">,</span> <span class="s2">&quot;@close</span><span class="si">{0.0000}</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="PriceGenerator.RenderBokeh-1051"><a href="#PriceGenerator.RenderBokeh-1051"><span class="linenos">1051</span></a>                <span class="p">(</span><span class="s2">&quot;Volume&quot;</span><span class="p">,</span> <span class="s2">&quot;@volume&quot;</span><span class="p">),</span>
</span><span id="PriceGenerator.RenderBokeh-1052"><a href="#PriceGenerator.RenderBokeh-1052"><span class="linenos">1052</span></a>            <span class="p">]</span>
</span><span id="PriceGenerator.RenderBokeh-1053"><a href="#PriceGenerator.RenderBokeh-1053"><span class="linenos">1053</span></a>            <span class="n">hover</span><span class="o">.</span><span class="n">formatters</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="PriceGenerator.RenderBokeh-1054"><a href="#PriceGenerator.RenderBokeh-1054"><span class="linenos">1054</span></a>                <span class="s2">&quot;@datetime&quot;</span><span class="p">:</span> <span class="s2">&quot;datetime&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1055"><a href="#PriceGenerator.RenderBokeh-1055"><span class="linenos">1055</span></a>                <span class="s2">&quot;@open&quot;</span><span class="p">:</span> <span class="s2">&quot;numeral&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1056"><a href="#PriceGenerator.RenderBokeh-1056"><span class="linenos">1056</span></a>                <span class="s2">&quot;@high&quot;</span><span class="p">:</span> <span class="s2">&quot;numeral&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1057"><a href="#PriceGenerator.RenderBokeh-1057"><span class="linenos">1057</span></a>                <span class="s2">&quot;@low&quot;</span><span class="p">:</span> <span class="s2">&quot;numeral&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1058"><a href="#PriceGenerator.RenderBokeh-1058"><span class="linenos">1058</span></a>                <span class="s2">&quot;@close&quot;</span><span class="p">:</span> <span class="s2">&quot;numeral&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1059"><a href="#PriceGenerator.RenderBokeh-1059"><span class="linenos">1059</span></a>            <span class="p">}</span>
</span><span id="PriceGenerator.RenderBokeh-1060"><a href="#PriceGenerator.RenderBokeh-1060"><span class="linenos">1060</span></a>            <span class="n">hover</span><span class="o">.</span><span class="n">point_policy</span> <span class="o">=</span> <span class="s2">&quot;snap_to_data&quot;</span>
</span><span id="PriceGenerator.RenderBokeh-1061"><a href="#PriceGenerator.RenderBokeh-1061"><span class="linenos">1061</span></a>            <span class="n">hover</span><span class="o">.</span><span class="n">line_policy</span> <span class="o">=</span> <span class="s2">&quot;nearest&quot;</span>
</span><span id="PriceGenerator.RenderBokeh-1062"><a href="#PriceGenerator.RenderBokeh-1062"><span class="linenos">1062</span></a>            <span class="n">hover</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;vline&quot;</span>
</span><span id="PriceGenerator.RenderBokeh-1063"><a href="#PriceGenerator.RenderBokeh-1063"><span class="linenos">1063</span></a>
</span><span id="PriceGenerator.RenderBokeh-1064"><a href="#PriceGenerator.RenderBokeh-1064"><span class="linenos">1064</span></a>            <span class="c1"># --- preparing body of candles:</span>
</span><span id="PriceGenerator.RenderBokeh-1065"><a href="#PriceGenerator.RenderBokeh-1065"><span class="linenos">1065</span></a>            <span class="n">hoverOnCandles</span> <span class="o">=</span> <span class="n">chart</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span>
</span><span id="PriceGenerator.RenderBokeh-1066"><a href="#PriceGenerator.RenderBokeh-1066"><span class="linenos">1066</span></a>                <span class="n">x0</span><span class="o">=</span><span class="s2">&quot;datetime&quot;</span><span class="p">,</span> <span class="n">y0</span><span class="o">=</span><span class="s2">&quot;high&quot;</span><span class="p">,</span> <span class="n">x1</span><span class="o">=</span><span class="s2">&quot;datetime&quot;</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="s2">&quot;low&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1067"><a href="#PriceGenerator.RenderBokeh-1067"><span class="linenos">1067</span></a>                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#20ff00&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1068"><a href="#PriceGenerator.RenderBokeh-1068"><span class="linenos">1068</span></a>                <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;candle&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">hoverData</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1069"><a href="#PriceGenerator.RenderBokeh-1069"><span class="linenos">1069</span></a>            <span class="p">)</span>
</span><span id="PriceGenerator.RenderBokeh-1070"><a href="#PriceGenerator.RenderBokeh-1070"><span class="linenos">1070</span></a>            <span class="n">hover</span><span class="o">.</span><span class="n">renderers</span> <span class="o">=</span> <span class="p">[</span><span class="n">hoverOnCandles</span><span class="p">]</span>  <span class="c1"># hover on only for candle bodies</span>
</span><span id="PriceGenerator.RenderBokeh-1071"><a href="#PriceGenerator.RenderBokeh-1071"><span class="linenos">1071</span></a>            <span class="n">chart</span><span class="o">.</span><span class="n">vbar</span><span class="p">(</span>
</span><span id="PriceGenerator.RenderBokeh-1072"><a href="#PriceGenerator.RenderBokeh-1072"><span class="linenos">1072</span></a>                <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">[</span><span class="n">inc</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="n">candleWidth</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">open</span><span class="p">[</span><span class="n">inc</span><span class="p">],</span> <span class="n">top</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">[</span><span class="n">inc</span><span class="p">],</span>
</span><span id="PriceGenerator.RenderBokeh-1073"><a href="#PriceGenerator.RenderBokeh-1073"><span class="linenos">1073</span></a>                <span class="n">fill_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#20ff00&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1074"><a href="#PriceGenerator.RenderBokeh-1074"><span class="linenos">1074</span></a>                <span class="n">line_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fill_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1075"><a href="#PriceGenerator.RenderBokeh-1075"><span class="linenos">1075</span></a>            <span class="p">)</span>
</span><span id="PriceGenerator.RenderBokeh-1076"><a href="#PriceGenerator.RenderBokeh-1076"><span class="linenos">1076</span></a>            <span class="n">chart</span><span class="o">.</span><span class="n">vbar</span><span class="p">(</span>
</span><span id="PriceGenerator.RenderBokeh-1077"><a href="#PriceGenerator.RenderBokeh-1077"><span class="linenos">1077</span></a>                <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">[</span><span class="n">dec</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="n">candleWidth</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">open</span><span class="p">[</span><span class="n">dec</span><span class="p">],</span> <span class="n">top</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">[</span><span class="n">dec</span><span class="p">],</span>
</span><span id="PriceGenerator.RenderBokeh-1078"><a href="#PriceGenerator.RenderBokeh-1078"><span class="linenos">1078</span></a>                <span class="n">fill_color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#999999&quot;</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#20ff00&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1079"><a href="#PriceGenerator.RenderBokeh-1079"><span class="linenos">1079</span></a>                <span class="n">line_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fill_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1080"><a href="#PriceGenerator.RenderBokeh-1080"><span class="linenos">1080</span></a>            <span class="p">)</span>
</span><span id="PriceGenerator.RenderBokeh-1081"><a href="#PriceGenerator.RenderBokeh-1081"><span class="linenos">1081</span></a>
</span><span id="PriceGenerator.RenderBokeh-1082"><a href="#PriceGenerator.RenderBokeh-1082"><span class="linenos">1082</span></a>            <span class="k">if</span> <span class="n">showStatOnChart</span><span class="p">:</span>
</span><span id="PriceGenerator.RenderBokeh-1083"><a href="#PriceGenerator.RenderBokeh-1083"><span class="linenos">1083</span></a>                <span class="c1"># Summary section and controls:</span>
</span><span id="PriceGenerator.RenderBokeh-1084"><a href="#PriceGenerator.RenderBokeh-1084"><span class="linenos">1084</span></a>                <span class="n">legendNameMain</span> <span class="o">=</span> <span class="s2">&quot;Max close / Min close / Trend line&quot;</span>
</span><span id="PriceGenerator.RenderBokeh-1085"><a href="#PriceGenerator.RenderBokeh-1085"><span class="linenos">1085</span></a>                <span class="n">legendNameAvg</span> <span class="o">=</span> <span class="s2">&quot;Averages points (highs - deltas/2)&quot;</span>
</span><span id="PriceGenerator.RenderBokeh-1086"><a href="#PriceGenerator.RenderBokeh-1086"><span class="linenos">1086</span></a>                <span class="n">legendNameSMA</span> <span class="o">=</span> <span class="s2">&quot;Simple Moving Averages (SMA: 5, 20)&quot;</span>
</span><span id="PriceGenerator.RenderBokeh-1087"><a href="#PriceGenerator.RenderBokeh-1087"><span class="linenos">1087</span></a>                <span class="n">legendNameSMAlong</span> <span class="o">=</span> <span class="s2">&quot;Long Simple Moving Averages (SMA: 50, 200)&quot;</span>
</span><span id="PriceGenerator.RenderBokeh-1088"><a href="#PriceGenerator.RenderBokeh-1088"><span class="linenos">1088</span></a>                <span class="n">legendNameHMA</span> <span class="o">=</span> <span class="s2">&quot;Hull Moving Averages (HMA: 5, 20)&quot;</span>
</span><span id="PriceGenerator.RenderBokeh-1089"><a href="#PriceGenerator.RenderBokeh-1089"><span class="linenos">1089</span></a>                <span class="n">legendNameVWMA</span> <span class="o">=</span> <span class="s2">&quot;Volume Weighted Moving Averages (VWMA: 5, 20)&quot;</span>
</span><span id="PriceGenerator.RenderBokeh-1090"><a href="#PriceGenerator.RenderBokeh-1090"><span class="linenos">1090</span></a>                <span class="n">legendNameBBANDS</span> <span class="o">=</span> <span class="s2">&quot;Bollinger Bands (BBands)&quot;</span>
</span><span id="PriceGenerator.RenderBokeh-1091"><a href="#PriceGenerator.RenderBokeh-1091"><span class="linenos">1091</span></a>                <span class="n">legendNamePsar</span> <span class="o">=</span> <span class="s2">&quot;Parabolic Stop and Reverse (psar)&quot;</span>
</span><span id="PriceGenerator.RenderBokeh-1092"><a href="#PriceGenerator.RenderBokeh-1092"><span class="linenos">1092</span></a>                <span class="n">legendNameAlligator</span> <span class="o">=</span> <span class="s2">&quot;Alligator (based on HMA: 13, 8, 5)&quot;</span>
</span><span id="PriceGenerator.RenderBokeh-1093"><a href="#PriceGenerator.RenderBokeh-1093"><span class="linenos">1093</span></a>                <span class="n">legendNameZigZag</span> <span class="o">=</span> <span class="s2">&quot;Zig-Zag indicator (with </span><span class="si">{}% o</span><span class="s2">f difference)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zigZagDeviation</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="PriceGenerator.RenderBokeh-1094"><a href="#PriceGenerator.RenderBokeh-1094"><span class="linenos">1094</span></a>
</span><span id="PriceGenerator.RenderBokeh-1095"><a href="#PriceGenerator.RenderBokeh-1095"><span class="linenos">1095</span></a>                <span class="c1"># preparing for highest close line:</span>
</span><span id="PriceGenerator.RenderBokeh-1096"><a href="#PriceGenerator.RenderBokeh-1096"><span class="linenos">1096</span></a>                <span class="n">highestClose</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precision</span><span class="p">)</span>
</span><span id="PriceGenerator.RenderBokeh-1097"><a href="#PriceGenerator.RenderBokeh-1097"><span class="linenos">1097</span></a>                <span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="PriceGenerator.RenderBokeh-1098"><a href="#PriceGenerator.RenderBokeh-1098"><span class="linenos">1098</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">highestClose</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1099"><a href="#PriceGenerator.RenderBokeh-1099"><span class="linenos">1099</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#339933&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1100"><a href="#PriceGenerator.RenderBokeh-1100"><span class="linenos">1100</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameMain</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1101"><a href="#PriceGenerator.RenderBokeh-1101"><span class="linenos">1101</span></a>                <span class="p">)</span>
</span><span id="PriceGenerator.RenderBokeh-1102"><a href="#PriceGenerator.RenderBokeh-1102"><span class="linenos">1102</span></a>                <span class="n">chart</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
</span><span id="PriceGenerator.RenderBokeh-1103"><a href="#PriceGenerator.RenderBokeh-1103"><span class="linenos">1103</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">highestClose</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deg10prec</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1104"><a href="#PriceGenerator.RenderBokeh-1104"><span class="linenos">1104</span></a>                    <span class="n">text</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">highestClose</span><span class="p">)],</span> <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">text_color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#339933&quot;</span><span class="p">,</span> <span class="n">text_font_size</span><span class="o">=</span><span class="s2">&quot;9pt&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1105"><a href="#PriceGenerator.RenderBokeh-1105"><span class="linenos">1105</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameMain</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1106"><a href="#PriceGenerator.RenderBokeh-1106"><span class="linenos">1106</span></a>                <span class="p">)</span>
</span><span id="PriceGenerator.RenderBokeh-1107"><a href="#PriceGenerator.RenderBokeh-1107"><span class="linenos">1107</span></a>
</span><span id="PriceGenerator.RenderBokeh-1108"><a href="#PriceGenerator.RenderBokeh-1108"><span class="linenos">1108</span></a>                <span class="c1"># preparing for lowest close line:</span>
</span><span id="PriceGenerator.RenderBokeh-1109"><a href="#PriceGenerator.RenderBokeh-1109"><span class="linenos">1109</span></a>                <span class="n">lowestClose</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precision</span><span class="p">)</span>
</span><span id="PriceGenerator.RenderBokeh-1110"><a href="#PriceGenerator.RenderBokeh-1110"><span class="linenos">1110</span></a>                <span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="PriceGenerator.RenderBokeh-1111"><a href="#PriceGenerator.RenderBokeh-1111"><span class="linenos">1111</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">lowestClose</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1112"><a href="#PriceGenerator.RenderBokeh-1112"><span class="linenos">1112</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#339933&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1113"><a href="#PriceGenerator.RenderBokeh-1113"><span class="linenos">1113</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameMain</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1114"><a href="#PriceGenerator.RenderBokeh-1114"><span class="linenos">1114</span></a>                <span class="p">)</span>
</span><span id="PriceGenerator.RenderBokeh-1115"><a href="#PriceGenerator.RenderBokeh-1115"><span class="linenos">1115</span></a>                <span class="n">chart</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
</span><span id="PriceGenerator.RenderBokeh-1116"><a href="#PriceGenerator.RenderBokeh-1116"><span class="linenos">1116</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">lowestClose</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deg10prec</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1117"><a href="#PriceGenerator.RenderBokeh-1117"><span class="linenos">1117</span></a>                    <span class="n">text</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">lowestClose</span><span class="p">)],</span> <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">text_color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#339933&quot;</span><span class="p">,</span> <span class="n">text_font_size</span><span class="o">=</span><span class="s2">&quot;9pt&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1118"><a href="#PriceGenerator.RenderBokeh-1118"><span class="linenos">1118</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameMain</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1119"><a href="#PriceGenerator.RenderBokeh-1119"><span class="linenos">1119</span></a>                <span class="p">)</span>
</span><span id="PriceGenerator.RenderBokeh-1120"><a href="#PriceGenerator.RenderBokeh-1120"><span class="linenos">1120</span></a>
</span><span id="PriceGenerator.RenderBokeh-1121"><a href="#PriceGenerator.RenderBokeh-1121"><span class="linenos">1121</span></a>                <span class="c1"># preparing direction lines for all trends:</span>
</span><span id="PriceGenerator.RenderBokeh-1122"><a href="#PriceGenerator.RenderBokeh-1122"><span class="linenos">1122</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSplit</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span><span class="p">:</span>
</span><span id="PriceGenerator.RenderBokeh-1123"><a href="#PriceGenerator.RenderBokeh-1123"><span class="linenos">1123</span></a>                    <span class="n">left</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="PriceGenerator.RenderBokeh-1124"><a href="#PriceGenerator.RenderBokeh-1124"><span class="linenos">1124</span></a>                    <span class="k">for</span> <span class="n">trendNum</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span><span class="p">)):</span>
</span><span id="PriceGenerator.RenderBokeh-1125"><a href="#PriceGenerator.RenderBokeh-1125"><span class="linenos">1125</span></a>                        <span class="n">right</span> <span class="o">=</span> <span class="n">left</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span><span class="p">[</span><span class="n">trendNum</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="PriceGenerator.RenderBokeh-1126"><a href="#PriceGenerator.RenderBokeh-1126"><span class="linenos">1126</span></a>                        <span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="PriceGenerator.RenderBokeh-1127"><a href="#PriceGenerator.RenderBokeh-1127"><span class="linenos">1127</span></a>                            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">left</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">right</span><span class="p">]],</span>
</span><span id="PriceGenerator.RenderBokeh-1128"><a href="#PriceGenerator.RenderBokeh-1128"><span class="linenos">1128</span></a>                            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">left</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">right</span><span class="p">]],</span>
</span><span id="PriceGenerator.RenderBokeh-1129"><a href="#PriceGenerator.RenderBokeh-1129"><span class="linenos">1129</span></a>                            <span class="n">line_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#666666&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">line_dash</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
</span><span id="PriceGenerator.RenderBokeh-1130"><a href="#PriceGenerator.RenderBokeh-1130"><span class="linenos">1130</span></a>                            <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameMain</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1131"><a href="#PriceGenerator.RenderBokeh-1131"><span class="linenos">1131</span></a>                        <span class="p">)</span>
</span><span id="PriceGenerator.RenderBokeh-1132"><a href="#PriceGenerator.RenderBokeh-1132"><span class="linenos">1132</span></a>                        <span class="n">left</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitCount</span><span class="p">[</span><span class="n">trendNum</span><span class="p">]</span>
</span><span id="PriceGenerator.RenderBokeh-1133"><a href="#PriceGenerator.RenderBokeh-1133"><span class="linenos">1133</span></a>
</span><span id="PriceGenerator.RenderBokeh-1134"><a href="#PriceGenerator.RenderBokeh-1134"><span class="linenos">1134</span></a>                <span class="c1"># preparing for main direction line:</span>
</span><span id="PriceGenerator.RenderBokeh-1135"><a href="#PriceGenerator.RenderBokeh-1135"><span class="linenos">1135</span></a>                <span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="PriceGenerator.RenderBokeh-1136"><a href="#PriceGenerator.RenderBokeh-1136"><span class="linenos">1136</span></a>                    <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span>
</span><span id="PriceGenerator.RenderBokeh-1137"><a href="#PriceGenerator.RenderBokeh-1137"><span class="linenos">1137</span></a>                    <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span>
</span><span id="PriceGenerator.RenderBokeh-1138"><a href="#PriceGenerator.RenderBokeh-1138"><span class="linenos">1138</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#666666&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">line_dash</span><span class="o">=</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
</span><span id="PriceGenerator.RenderBokeh-1139"><a href="#PriceGenerator.RenderBokeh-1139"><span class="linenos">1139</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameMain</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1140"><a href="#PriceGenerator.RenderBokeh-1140"><span class="linenos">1140</span></a>                <span class="p">)</span>
</span><span id="PriceGenerator.RenderBokeh-1141"><a href="#PriceGenerator.RenderBokeh-1141"><span class="linenos">1141</span></a>
</span><span id="PriceGenerator.RenderBokeh-1142"><a href="#PriceGenerator.RenderBokeh-1142"><span class="linenos">1142</span></a>                <span class="c1"># preparing candle&#39;s average points:</span>
</span><span id="PriceGenerator.RenderBokeh-1143"><a href="#PriceGenerator.RenderBokeh-1143"><span class="linenos">1143</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span>
</span><span id="PriceGenerator.RenderBokeh-1144"><a href="#PriceGenerator.RenderBokeh-1144"><span class="linenos">1144</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">avg</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1145"><a href="#PriceGenerator.RenderBokeh-1145"><span class="linenos">1145</span></a>                    <span class="n">size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1146"><a href="#PriceGenerator.RenderBokeh-1146"><span class="linenos">1146</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameAvg</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1147"><a href="#PriceGenerator.RenderBokeh-1147"><span class="linenos">1147</span></a>                <span class="p">))</span>
</span><span id="PriceGenerator.RenderBokeh-1148"><a href="#PriceGenerator.RenderBokeh-1148"><span class="linenos">1148</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="PriceGenerator.RenderBokeh-1149"><a href="#PriceGenerator.RenderBokeh-1149"><span class="linenos">1149</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">avg</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1150"><a href="#PriceGenerator.RenderBokeh-1150"><span class="linenos">1150</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1151"><a href="#PriceGenerator.RenderBokeh-1151"><span class="linenos">1151</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameAvg</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1152"><a href="#PriceGenerator.RenderBokeh-1152"><span class="linenos">1152</span></a>                <span class="p">))</span>
</span><span id="PriceGenerator.RenderBokeh-1153"><a href="#PriceGenerator.RenderBokeh-1153"><span class="linenos">1153</span></a>
</span><span id="PriceGenerator.RenderBokeh-1154"><a href="#PriceGenerator.RenderBokeh-1154"><span class="linenos">1154</span></a>                <span class="c1"># --- Preparing a lot of TA lines:</span>
</span><span id="PriceGenerator.RenderBokeh-1155"><a href="#PriceGenerator.RenderBokeh-1155"><span class="linenos">1155</span></a>
</span><span id="PriceGenerator.RenderBokeh-1156"><a href="#PriceGenerator.RenderBokeh-1156"><span class="linenos">1156</span></a>                <span class="c1"># Simple Moving Averages (SMA) 5, 20</span>
</span><span id="PriceGenerator.RenderBokeh-1157"><a href="#PriceGenerator.RenderBokeh-1157"><span class="linenos">1157</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="PriceGenerator.RenderBokeh-1158"><a href="#PriceGenerator.RenderBokeh-1158"><span class="linenos">1158</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;sma5&quot;</span><span class="p">],</span>
</span><span id="PriceGenerator.RenderBokeh-1159"><a href="#PriceGenerator.RenderBokeh-1159"><span class="linenos">1159</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#999432&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1160"><a href="#PriceGenerator.RenderBokeh-1160"><span class="linenos">1160</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameSMA</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1161"><a href="#PriceGenerator.RenderBokeh-1161"><span class="linenos">1161</span></a>                <span class="p">))</span>
</span><span id="PriceGenerator.RenderBokeh-1162"><a href="#PriceGenerator.RenderBokeh-1162"><span class="linenos">1162</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="PriceGenerator.RenderBokeh-1163"><a href="#PriceGenerator.RenderBokeh-1163"><span class="linenos">1163</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;sma20&quot;</span><span class="p">],</span>
</span><span id="PriceGenerator.RenderBokeh-1164"><a href="#PriceGenerator.RenderBokeh-1164"><span class="linenos">1164</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1165"><a href="#PriceGenerator.RenderBokeh-1165"><span class="linenos">1165</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameSMA</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1166"><a href="#PriceGenerator.RenderBokeh-1166"><span class="linenos">1166</span></a>                <span class="p">))</span>
</span><span id="PriceGenerator.RenderBokeh-1167"><a href="#PriceGenerator.RenderBokeh-1167"><span class="linenos">1167</span></a>
</span><span id="PriceGenerator.RenderBokeh-1168"><a href="#PriceGenerator.RenderBokeh-1168"><span class="linenos">1168</span></a>                <span class="c1"># Long Simple Moving Averages (SMA) 50, 200</span>
</span><span id="PriceGenerator.RenderBokeh-1169"><a href="#PriceGenerator.RenderBokeh-1169"><span class="linenos">1169</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="PriceGenerator.RenderBokeh-1170"><a href="#PriceGenerator.RenderBokeh-1170"><span class="linenos">1170</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;sma50&quot;</span><span class="p">],</span>
</span><span id="PriceGenerator.RenderBokeh-1171"><a href="#PriceGenerator.RenderBokeh-1171"><span class="linenos">1171</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#ffbf00&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1172"><a href="#PriceGenerator.RenderBokeh-1172"><span class="linenos">1172</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameSMAlong</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1173"><a href="#PriceGenerator.RenderBokeh-1173"><span class="linenos">1173</span></a>                <span class="p">))</span>
</span><span id="PriceGenerator.RenderBokeh-1174"><a href="#PriceGenerator.RenderBokeh-1174"><span class="linenos">1174</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="PriceGenerator.RenderBokeh-1175"><a href="#PriceGenerator.RenderBokeh-1175"><span class="linenos">1175</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;sma200&quot;</span><span class="p">],</span>
</span><span id="PriceGenerator.RenderBokeh-1176"><a href="#PriceGenerator.RenderBokeh-1176"><span class="linenos">1176</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#ff0040&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1177"><a href="#PriceGenerator.RenderBokeh-1177"><span class="linenos">1177</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameSMAlong</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1178"><a href="#PriceGenerator.RenderBokeh-1178"><span class="linenos">1178</span></a>                <span class="p">))</span>
</span><span id="PriceGenerator.RenderBokeh-1179"><a href="#PriceGenerator.RenderBokeh-1179"><span class="linenos">1179</span></a>
</span><span id="PriceGenerator.RenderBokeh-1180"><a href="#PriceGenerator.RenderBokeh-1180"><span class="linenos">1180</span></a>                <span class="c1"># Hull Moving Averages (HMA) 5, 20</span>
</span><span id="PriceGenerator.RenderBokeh-1181"><a href="#PriceGenerator.RenderBokeh-1181"><span class="linenos">1181</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="PriceGenerator.RenderBokeh-1182"><a href="#PriceGenerator.RenderBokeh-1182"><span class="linenos">1182</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;hma5&quot;</span><span class="p">],</span>
</span><span id="PriceGenerator.RenderBokeh-1183"><a href="#PriceGenerator.RenderBokeh-1183"><span class="linenos">1183</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#00ffff&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#336633&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1184"><a href="#PriceGenerator.RenderBokeh-1184"><span class="linenos">1184</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameHMA</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1185"><a href="#PriceGenerator.RenderBokeh-1185"><span class="linenos">1185</span></a>                <span class="p">))</span>
</span><span id="PriceGenerator.RenderBokeh-1186"><a href="#PriceGenerator.RenderBokeh-1186"><span class="linenos">1186</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="PriceGenerator.RenderBokeh-1187"><a href="#PriceGenerator.RenderBokeh-1187"><span class="linenos">1187</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;hma20&quot;</span><span class="p">],</span>
</span><span id="PriceGenerator.RenderBokeh-1188"><a href="#PriceGenerator.RenderBokeh-1188"><span class="linenos">1188</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#ff00ff&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#333333&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1189"><a href="#PriceGenerator.RenderBokeh-1189"><span class="linenos">1189</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameHMA</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1190"><a href="#PriceGenerator.RenderBokeh-1190"><span class="linenos">1190</span></a>                <span class="p">))</span>
</span><span id="PriceGenerator.RenderBokeh-1191"><a href="#PriceGenerator.RenderBokeh-1191"><span class="linenos">1191</span></a>
</span><span id="PriceGenerator.RenderBokeh-1192"><a href="#PriceGenerator.RenderBokeh-1192"><span class="linenos">1192</span></a>                <span class="c1"># Volume Weighted Moving Averages (VWMA) 5, 20</span>
</span><span id="PriceGenerator.RenderBokeh-1193"><a href="#PriceGenerator.RenderBokeh-1193"><span class="linenos">1193</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="PriceGenerator.RenderBokeh-1194"><a href="#PriceGenerator.RenderBokeh-1194"><span class="linenos">1194</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;vwma5&quot;</span><span class="p">],</span>
</span><span id="PriceGenerator.RenderBokeh-1195"><a href="#PriceGenerator.RenderBokeh-1195"><span class="linenos">1195</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#666633&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1196"><a href="#PriceGenerator.RenderBokeh-1196"><span class="linenos">1196</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameVWMA</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1197"><a href="#PriceGenerator.RenderBokeh-1197"><span class="linenos">1197</span></a>                <span class="p">))</span>
</span><span id="PriceGenerator.RenderBokeh-1198"><a href="#PriceGenerator.RenderBokeh-1198"><span class="linenos">1198</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="PriceGenerator.RenderBokeh-1199"><a href="#PriceGenerator.RenderBokeh-1199"><span class="linenos">1199</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;vwma20&quot;</span><span class="p">],</span>
</span><span id="PriceGenerator.RenderBokeh-1200"><a href="#PriceGenerator.RenderBokeh-1200"><span class="linenos">1200</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#ff8000&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#333333&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1201"><a href="#PriceGenerator.RenderBokeh-1201"><span class="linenos">1201</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameVWMA</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1202"><a href="#PriceGenerator.RenderBokeh-1202"><span class="linenos">1202</span></a>                <span class="p">))</span>
</span><span id="PriceGenerator.RenderBokeh-1203"><a href="#PriceGenerator.RenderBokeh-1203"><span class="linenos">1203</span></a>
</span><span id="PriceGenerator.RenderBokeh-1204"><a href="#PriceGenerator.RenderBokeh-1204"><span class="linenos">1204</span></a>                <span class="c1"># Bollinger Bands (BBands)</span>
</span><span id="PriceGenerator.RenderBokeh-1205"><a href="#PriceGenerator.RenderBokeh-1205"><span class="linenos">1205</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="PriceGenerator.RenderBokeh-1206"><a href="#PriceGenerator.RenderBokeh-1206"><span class="linenos">1206</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;bbands&quot;</span><span class="p">][</span><span class="s2">&quot;lower&quot;</span><span class="p">],</span>
</span><span id="PriceGenerator.RenderBokeh-1207"><a href="#PriceGenerator.RenderBokeh-1207"><span class="linenos">1207</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#66ffff&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#333333&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1208"><a href="#PriceGenerator.RenderBokeh-1208"><span class="linenos">1208</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameBBANDS</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1209"><a href="#PriceGenerator.RenderBokeh-1209"><span class="linenos">1209</span></a>                <span class="p">))</span>
</span><span id="PriceGenerator.RenderBokeh-1210"><a href="#PriceGenerator.RenderBokeh-1210"><span class="linenos">1210</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="PriceGenerator.RenderBokeh-1211"><a href="#PriceGenerator.RenderBokeh-1211"><span class="linenos">1211</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;bbands&quot;</span><span class="p">][</span><span class="s2">&quot;mid&quot;</span><span class="p">],</span>
</span><span id="PriceGenerator.RenderBokeh-1212"><a href="#PriceGenerator.RenderBokeh-1212"><span class="linenos">1212</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#66ffff&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#333333&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1213"><a href="#PriceGenerator.RenderBokeh-1213"><span class="linenos">1213</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameBBANDS</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1214"><a href="#PriceGenerator.RenderBokeh-1214"><span class="linenos">1214</span></a>                <span class="p">))</span>
</span><span id="PriceGenerator.RenderBokeh-1215"><a href="#PriceGenerator.RenderBokeh-1215"><span class="linenos">1215</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="PriceGenerator.RenderBokeh-1216"><a href="#PriceGenerator.RenderBokeh-1216"><span class="linenos">1216</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;bbands&quot;</span><span class="p">][</span><span class="s2">&quot;upper&quot;</span><span class="p">],</span>
</span><span id="PriceGenerator.RenderBokeh-1217"><a href="#PriceGenerator.RenderBokeh-1217"><span class="linenos">1217</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#66ffff&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#333333&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1218"><a href="#PriceGenerator.RenderBokeh-1218"><span class="linenos">1218</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameBBANDS</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1219"><a href="#PriceGenerator.RenderBokeh-1219"><span class="linenos">1219</span></a>                <span class="p">))</span>
</span><span id="PriceGenerator.RenderBokeh-1220"><a href="#PriceGenerator.RenderBokeh-1220"><span class="linenos">1220</span></a>
</span><span id="PriceGenerator.RenderBokeh-1221"><a href="#PriceGenerator.RenderBokeh-1221"><span class="linenos">1221</span></a>                <span class="c1"># Parabolic Stop and Reverse (psar)</span>
</span><span id="PriceGenerator.RenderBokeh-1222"><a href="#PriceGenerator.RenderBokeh-1222"><span class="linenos">1222</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span>
</span><span id="PriceGenerator.RenderBokeh-1223"><a href="#PriceGenerator.RenderBokeh-1223"><span class="linenos">1223</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;psar&quot;</span><span class="p">][</span><span class="s2">&quot;long&quot;</span><span class="p">],</span>
</span><span id="PriceGenerator.RenderBokeh-1224"><a href="#PriceGenerator.RenderBokeh-1224"><span class="linenos">1224</span></a>                    <span class="n">size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#00ffff&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#336633&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1225"><a href="#PriceGenerator.RenderBokeh-1225"><span class="linenos">1225</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNamePsar</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1226"><a href="#PriceGenerator.RenderBokeh-1226"><span class="linenos">1226</span></a>                <span class="p">))</span>
</span><span id="PriceGenerator.RenderBokeh-1227"><a href="#PriceGenerator.RenderBokeh-1227"><span class="linenos">1227</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span>
</span><span id="PriceGenerator.RenderBokeh-1228"><a href="#PriceGenerator.RenderBokeh-1228"><span class="linenos">1228</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;psar&quot;</span><span class="p">][</span><span class="s2">&quot;short&quot;</span><span class="p">],</span>
</span><span id="PriceGenerator.RenderBokeh-1229"><a href="#PriceGenerator.RenderBokeh-1229"><span class="linenos">1229</span></a>                    <span class="n">size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#ff00ff&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#663333&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1230"><a href="#PriceGenerator.RenderBokeh-1230"><span class="linenos">1230</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNamePsar</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1231"><a href="#PriceGenerator.RenderBokeh-1231"><span class="linenos">1231</span></a>                <span class="p">))</span>
</span><span id="PriceGenerator.RenderBokeh-1232"><a href="#PriceGenerator.RenderBokeh-1232"><span class="linenos">1232</span></a>
</span><span id="PriceGenerator.RenderBokeh-1233"><a href="#PriceGenerator.RenderBokeh-1233"><span class="linenos">1233</span></a>                <span class="c1"># Alligator (based on HMA 13, 8, 5) for the Alligator indicator (Jaw, Teeth, and Lips)</span>
</span><span id="PriceGenerator.RenderBokeh-1234"><a href="#PriceGenerator.RenderBokeh-1234"><span class="linenos">1234</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="PriceGenerator.RenderBokeh-1235"><a href="#PriceGenerator.RenderBokeh-1235"><span class="linenos">1235</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;hma13&quot;</span><span class="p">],</span>
</span><span id="PriceGenerator.RenderBokeh-1236"><a href="#PriceGenerator.RenderBokeh-1236"><span class="linenos">1236</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#1a1aff&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#2100A6&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1237"><a href="#PriceGenerator.RenderBokeh-1237"><span class="linenos">1237</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameAlligator</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1238"><a href="#PriceGenerator.RenderBokeh-1238"><span class="linenos">1238</span></a>                <span class="p">))</span>
</span><span id="PriceGenerator.RenderBokeh-1239"><a href="#PriceGenerator.RenderBokeh-1239"><span class="linenos">1239</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="PriceGenerator.RenderBokeh-1240"><a href="#PriceGenerator.RenderBokeh-1240"><span class="linenos">1240</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;hma8&quot;</span><span class="p">],</span>
</span><span id="PriceGenerator.RenderBokeh-1241"><a href="#PriceGenerator.RenderBokeh-1241"><span class="linenos">1241</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#ff1a1a&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#A6000C&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1242"><a href="#PriceGenerator.RenderBokeh-1242"><span class="linenos">1242</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameAlligator</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1243"><a href="#PriceGenerator.RenderBokeh-1243"><span class="linenos">1243</span></a>                <span class="p">))</span>
</span><span id="PriceGenerator.RenderBokeh-1244"><a href="#PriceGenerator.RenderBokeh-1244"><span class="linenos">1244</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="PriceGenerator.RenderBokeh-1245"><a href="#PriceGenerator.RenderBokeh-1245"><span class="linenos">1245</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;hma5&quot;</span><span class="p">],</span>
</span><span id="PriceGenerator.RenderBokeh-1246"><a href="#PriceGenerator.RenderBokeh-1246"><span class="linenos">1246</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#40ff00&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#17A600&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1247"><a href="#PriceGenerator.RenderBokeh-1247"><span class="linenos">1247</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameAlligator</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1248"><a href="#PriceGenerator.RenderBokeh-1248"><span class="linenos">1248</span></a>                <span class="p">))</span>
</span><span id="PriceGenerator.RenderBokeh-1249"><a href="#PriceGenerator.RenderBokeh-1249"><span class="linenos">1249</span></a>
</span><span id="PriceGenerator.RenderBokeh-1250"><a href="#PriceGenerator.RenderBokeh-1250"><span class="linenos">1250</span></a>                <span class="c1"># Zig-Zag indicator with self.zigZagDeviation of difference parameter</span>
</span><span id="PriceGenerator.RenderBokeh-1251"><a href="#PriceGenerator.RenderBokeh-1251"><span class="linenos">1251</span></a>                <span class="n">disabledObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="PriceGenerator.RenderBokeh-1252"><a href="#PriceGenerator.RenderBokeh-1252"><span class="linenos">1252</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;zigzag3&quot;</span><span class="p">][</span><span class="s2">&quot;datetimes&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="s2">&quot;zigzag3&quot;</span><span class="p">][</span><span class="s2">&quot;filtered&quot;</span><span class="p">],</span>
</span><span id="PriceGenerator.RenderBokeh-1253"><a href="#PriceGenerator.RenderBokeh-1253"><span class="linenos">1253</span></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;cyan&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#333333&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1254"><a href="#PriceGenerator.RenderBokeh-1254"><span class="linenos">1254</span></a>                    <span class="n">legend_label</span><span class="o">=</span><span class="n">legendNameZigZag</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1255"><a href="#PriceGenerator.RenderBokeh-1255"><span class="linenos">1255</span></a>                <span class="p">))</span>
</span><span id="PriceGenerator.RenderBokeh-1256"><a href="#PriceGenerator.RenderBokeh-1256"><span class="linenos">1256</span></a>
</span><span id="PriceGenerator.RenderBokeh-1257"><a href="#PriceGenerator.RenderBokeh-1257"><span class="linenos">1257</span></a>                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">disabledObjects</span><span class="p">:</span>
</span><span id="PriceGenerator.RenderBokeh-1258"><a href="#PriceGenerator.RenderBokeh-1258"><span class="linenos">1258</span></a>                    <span class="n">item</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="PriceGenerator.RenderBokeh-1259"><a href="#PriceGenerator.RenderBokeh-1259"><span class="linenos">1259</span></a>
</span><span id="PriceGenerator.RenderBokeh-1260"><a href="#PriceGenerator.RenderBokeh-1260"><span class="linenos">1260</span></a>            <span class="c1"># --- Preparing custom markers:</span>
</span><span id="PriceGenerator.RenderBokeh-1261"><a href="#PriceGenerator.RenderBokeh-1261"><span class="linenos">1261</span></a>
</span><span id="PriceGenerator.RenderBokeh-1262"><a href="#PriceGenerator.RenderBokeh-1262"><span class="linenos">1262</span></a>            <span class="k">if</span> <span class="n">markers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">markers</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">markers</span><span class="o">.</span><span class="n">empty</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">markers</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="s2">&quot;datetime&quot;</span> <span class="ow">in</span> <span class="n">markers</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;markersUpper&quot;</span> <span class="ow">in</span> <span class="n">markers</span><span class="o">.</span><span class="n">columns</span> <span class="ow">or</span> <span class="s2">&quot;markersCenter&quot;</span> <span class="ow">in</span> <span class="n">markers</span><span class="o">.</span><span class="n">columns</span> <span class="ow">or</span> <span class="s2">&quot;markersLower&quot;</span> <span class="ow">in</span> <span class="n">markers</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
</span><span id="PriceGenerator.RenderBokeh-1263"><a href="#PriceGenerator.RenderBokeh-1263"><span class="linenos">1263</span></a>                <span class="k">if</span> <span class="s2">&quot;markersUpper&quot;</span> <span class="ow">in</span> <span class="n">markers</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="PriceGenerator.RenderBokeh-1264"><a href="#PriceGenerator.RenderBokeh-1264"><span class="linenos">1264</span></a>                    <span class="n">chart</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
</span><span id="PriceGenerator.RenderBokeh-1265"><a href="#PriceGenerator.RenderBokeh-1265"><span class="linenos">1265</span></a>                        <span class="n">markers</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">high</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1266"><a href="#PriceGenerator.RenderBokeh-1266"><span class="linenos">1266</span></a>                        <span class="n">text_align</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">text_baseline</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">markers</span><span class="o">.</span><span class="n">markersUpper</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1267"><a href="#PriceGenerator.RenderBokeh-1267"><span class="linenos">1267</span></a>                        <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">text_color</span><span class="o">=</span><span class="s2">&quot;lime&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">text_font_size</span><span class="o">=</span><span class="s2">&quot;13pt&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1268"><a href="#PriceGenerator.RenderBokeh-1268"><span class="linenos">1268</span></a>                        <span class="n">legend_label</span><span class="o">=</span><span class="s2">&quot;Markers: upper (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">markers</span><span class="o">.</span><span class="n">markersUpper</span><span class="p">[</span><span class="n">markers</span><span class="o">.</span><span class="n">markersUpper</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">]))</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1269"><a href="#PriceGenerator.RenderBokeh-1269"><span class="linenos">1269</span></a>                    <span class="p">)</span>
</span><span id="PriceGenerator.RenderBokeh-1270"><a href="#PriceGenerator.RenderBokeh-1270"><span class="linenos">1270</span></a>
</span><span id="PriceGenerator.RenderBokeh-1271"><a href="#PriceGenerator.RenderBokeh-1271"><span class="linenos">1271</span></a>                <span class="k">if</span> <span class="s2">&quot;markersCenter&quot;</span> <span class="ow">in</span> <span class="n">markers</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="PriceGenerator.RenderBokeh-1272"><a href="#PriceGenerator.RenderBokeh-1272"><span class="linenos">1272</span></a>                    <span class="k">if</span> <span class="s2">&quot;avg&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="PriceGenerator.RenderBokeh-1273"><a href="#PriceGenerator.RenderBokeh-1273"><span class="linenos">1273</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="s2">&quot;avg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">high</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">low</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precision</span><span class="p">)</span>
</span><span id="PriceGenerator.RenderBokeh-1274"><a href="#PriceGenerator.RenderBokeh-1274"><span class="linenos">1274</span></a>
</span><span id="PriceGenerator.RenderBokeh-1275"><a href="#PriceGenerator.RenderBokeh-1275"><span class="linenos">1275</span></a>                    <span class="n">chart</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
</span><span id="PriceGenerator.RenderBokeh-1276"><a href="#PriceGenerator.RenderBokeh-1276"><span class="linenos">1276</span></a>                        <span class="n">markers</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">avg</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1277"><a href="#PriceGenerator.RenderBokeh-1277"><span class="linenos">1277</span></a>                        <span class="n">text_align</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">text_baseline</span><span class="o">=</span><span class="s2">&quot;middle&quot;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">markers</span><span class="o">.</span><span class="n">markersCenter</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1278"><a href="#PriceGenerator.RenderBokeh-1278"><span class="linenos">1278</span></a>                        <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">text_color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">text_font_size</span><span class="o">=</span><span class="s2">&quot;13pt&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1279"><a href="#PriceGenerator.RenderBokeh-1279"><span class="linenos">1279</span></a>                        <span class="n">legend_label</span><span class="o">=</span><span class="s2">&quot;Markers: center (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">markers</span><span class="o">.</span><span class="n">markersCenter</span><span class="p">[</span><span class="n">markers</span><span class="o">.</span><span class="n">markersCenter</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">]))</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1280"><a href="#PriceGenerator.RenderBokeh-1280"><span class="linenos">1280</span></a>                    <span class="p">)</span>
</span><span id="PriceGenerator.RenderBokeh-1281"><a href="#PriceGenerator.RenderBokeh-1281"><span class="linenos">1281</span></a>
</span><span id="PriceGenerator.RenderBokeh-1282"><a href="#PriceGenerator.RenderBokeh-1282"><span class="linenos">1282</span></a>                <span class="k">if</span> <span class="s2">&quot;markersLower&quot;</span> <span class="ow">in</span> <span class="n">markers</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="PriceGenerator.RenderBokeh-1283"><a href="#PriceGenerator.RenderBokeh-1283"><span class="linenos">1283</span></a>                    <span class="n">chart</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
</span><span id="PriceGenerator.RenderBokeh-1284"><a href="#PriceGenerator.RenderBokeh-1284"><span class="linenos">1284</span></a>                        <span class="n">markers</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">low</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1285"><a href="#PriceGenerator.RenderBokeh-1285"><span class="linenos">1285</span></a>                        <span class="n">text_align</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">text_baseline</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">markers</span><span class="o">.</span><span class="n">markersLower</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1286"><a href="#PriceGenerator.RenderBokeh-1286"><span class="linenos">1286</span></a>                        <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">text_color</span><span class="o">=</span><span class="s2">&quot;lime&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">text_font_size</span><span class="o">=</span><span class="s2">&quot;13pt&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1287"><a href="#PriceGenerator.RenderBokeh-1287"><span class="linenos">1287</span></a>                        <span class="n">legend_label</span><span class="o">=</span><span class="s2">&quot;Markers: lower (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">markers</span><span class="o">.</span><span class="n">markersLower</span><span class="p">[</span><span class="n">markers</span><span class="o">.</span><span class="n">markersLower</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">]))</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1288"><a href="#PriceGenerator.RenderBokeh-1288"><span class="linenos">1288</span></a>                    <span class="p">)</span>
</span><span id="PriceGenerator.RenderBokeh-1289"><a href="#PriceGenerator.RenderBokeh-1289"><span class="linenos">1289</span></a>
</span><span id="PriceGenerator.RenderBokeh-1290"><a href="#PriceGenerator.RenderBokeh-1290"><span class="linenos">1290</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PriceGenerator.RenderBokeh-1291"><a href="#PriceGenerator.RenderBokeh-1291"><span class="linenos">1291</span></a>                <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Marker data must be the Pandas DataFrame object! Or `None` (by default). Marker is a custom symbol, example: ×, ↓ or ↑. Dataframe with markers must contain at least two columns. There are `datetime` with date and time and some markers columns (`markersUpper`, `markersCenter` or `markersLower`). Length of markers series must be equal to the length of main candles series.&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator.RenderBokeh-1292"><a href="#PriceGenerator.RenderBokeh-1292"><span class="linenos">1292</span></a>
</span><span id="PriceGenerator.RenderBokeh-1293"><a href="#PriceGenerator.RenderBokeh-1293"><span class="linenos">1293</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">showControlsOnChart</span> <span class="ow">or</span> <span class="n">showStatOnChart</span><span class="p">):</span>
</span><span id="PriceGenerator.RenderBokeh-1294"><a href="#PriceGenerator.RenderBokeh-1294"><span class="linenos">1294</span></a>                <span class="n">summaryInfo</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="PriceGenerator.RenderBokeh-1295"><a href="#PriceGenerator.RenderBokeh-1295"><span class="linenos">1295</span></a>
</span><span id="PriceGenerator.RenderBokeh-1296"><a href="#PriceGenerator.RenderBokeh-1296"><span class="linenos">1296</span></a>            <span class="c1"># --- Preparing custom lines:</span>
</span><span id="PriceGenerator.RenderBokeh-1297"><a href="#PriceGenerator.RenderBokeh-1297"><span class="linenos">1297</span></a>
</span><span id="PriceGenerator.RenderBokeh-1298"><a href="#PriceGenerator.RenderBokeh-1298"><span class="linenos">1298</span></a>            <span class="k">if</span> <span class="n">lines</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="n">lines</span><span class="p">:</span>
</span><span id="PriceGenerator.RenderBokeh-1299"><a href="#PriceGenerator.RenderBokeh-1299"><span class="linenos">1299</span></a>                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
</span><span id="PriceGenerator.RenderBokeh-1300"><a href="#PriceGenerator.RenderBokeh-1300"><span class="linenos">1300</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="s2">&quot;datetime&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="PriceGenerator.RenderBokeh-1301"><a href="#PriceGenerator.RenderBokeh-1301"><span class="linenos">1301</span></a>                        <span class="n">chart</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
</span><span id="PriceGenerator.RenderBokeh-1302"><a href="#PriceGenerator.RenderBokeh-1302"><span class="linenos">1302</span></a>                            <span class="n">line</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">line</span><span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
</span><span id="PriceGenerator.RenderBokeh-1303"><a href="#PriceGenerator.RenderBokeh-1303"><span class="linenos">1303</span></a>                            <span class="n">line_width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#666666&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1304"><a href="#PriceGenerator.RenderBokeh-1304"><span class="linenos">1304</span></a>                            <span class="n">legend_label</span><span class="o">=</span><span class="s2">&quot;Line: &quot;</span> <span class="o">+</span> <span class="n">line</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">showControlsOnChart</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1305"><a href="#PriceGenerator.RenderBokeh-1305"><span class="linenos">1305</span></a>                        <span class="p">)</span>
</span><span id="PriceGenerator.RenderBokeh-1306"><a href="#PriceGenerator.RenderBokeh-1306"><span class="linenos">1306</span></a>
</span><span id="PriceGenerator.RenderBokeh-1307"><a href="#PriceGenerator.RenderBokeh-1307"><span class="linenos">1307</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="PriceGenerator.RenderBokeh-1308"><a href="#PriceGenerator.RenderBokeh-1308"><span class="linenos">1308</span></a>                        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Every custom line must be the Pandas DataFrame object! Line data must contain at least two columns: `datetime` with date and time and 2-nd column `custom_line_name` with y-coordinates. Length of the chart-line dataframes must be equal to the length of main candle series.&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator.RenderBokeh-1309"><a href="#PriceGenerator.RenderBokeh-1309"><span class="linenos">1309</span></a>
</span><span id="PriceGenerator.RenderBokeh-1310"><a href="#PriceGenerator.RenderBokeh-1310"><span class="linenos">1310</span></a>            <span class="c1"># --- Volume chart options:</span>
</span><span id="PriceGenerator.RenderBokeh-1311"><a href="#PriceGenerator.RenderBokeh-1311"><span class="linenos">1311</span></a>            <span class="n">volumeChart</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span>
</span><span id="PriceGenerator.RenderBokeh-1312"><a href="#PriceGenerator.RenderBokeh-1312"><span class="linenos">1312</span></a>                <span class="n">x_axis_type</span><span class="o">=</span><span class="s2">&quot;datetime&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1313"><a href="#PriceGenerator.RenderBokeh-1313"><span class="linenos">1313</span></a>                <span class="n">y_axis_label</span><span class="o">=</span><span class="s2">&quot;Volume&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1314"><a href="#PriceGenerator.RenderBokeh-1314"><span class="linenos">1314</span></a>                <span class="n">outline_line_width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1315"><a href="#PriceGenerator.RenderBokeh-1315"><span class="linenos">1315</span></a>                <span class="n">outline_line_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1316"><a href="#PriceGenerator.RenderBokeh-1316"><span class="linenos">1316</span></a>                <span class="n">min_width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1317"><a href="#PriceGenerator.RenderBokeh-1317"><span class="linenos">1317</span></a>                <span class="n">height</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1318"><a href="#PriceGenerator.RenderBokeh-1318"><span class="linenos">1318</span></a>                <span class="n">sizing_mode</span><span class="o">=</span><span class="s2">&quot;scale_width&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1319"><a href="#PriceGenerator.RenderBokeh-1319"><span class="linenos">1319</span></a>                <span class="n">background_fill_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1320"><a href="#PriceGenerator.RenderBokeh-1320"><span class="linenos">1320</span></a>                <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pan&quot;</span><span class="p">,</span> <span class="s2">&quot;wheel_zoom&quot;</span><span class="p">,</span> <span class="s2">&quot;hover&quot;</span><span class="p">],</span>
</span><span id="PriceGenerator.RenderBokeh-1321"><a href="#PriceGenerator.RenderBokeh-1321"><span class="linenos">1321</span></a>                <span class="n">toolbar_location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1322"><a href="#PriceGenerator.RenderBokeh-1322"><span class="linenos">1322</span></a>                <span class="n">active_scroll</span><span class="o">=</span><span class="s2">&quot;wheel_zoom&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1323"><a href="#PriceGenerator.RenderBokeh-1323"><span class="linenos">1323</span></a>                <span class="n">min_border_left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1324"><a href="#PriceGenerator.RenderBokeh-1324"><span class="linenos">1324</span></a>                <span class="n">min_border_right</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1325"><a href="#PriceGenerator.RenderBokeh-1325"><span class="linenos">1325</span></a>                <span class="n">min_border_top</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1326"><a href="#PriceGenerator.RenderBokeh-1326"><span class="linenos">1326</span></a>                <span class="n">min_border_bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1327"><a href="#PriceGenerator.RenderBokeh-1327"><span class="linenos">1327</span></a>                <span class="n">x_range</span><span class="o">=</span><span class="n">chart</span><span class="o">.</span><span class="n">x_range</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1328"><a href="#PriceGenerator.RenderBokeh-1328"><span class="linenos">1328</span></a>                <span class="n">y_range</span><span class="o">=</span><span class="n">Range1d</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">volume</span><span class="p">),</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">volume</span><span class="p">))),</span>
</span><span id="PriceGenerator.RenderBokeh-1329"><a href="#PriceGenerator.RenderBokeh-1329"><span class="linenos">1329</span></a>            <span class="p">)</span>
</span><span id="PriceGenerator.RenderBokeh-1330"><a href="#PriceGenerator.RenderBokeh-1330"><span class="linenos">1330</span></a>            <span class="n">volumeChart</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">logo</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># remove bokeh logo and link to https://bokeh.org/</span>
</span><span id="PriceGenerator.RenderBokeh-1331"><a href="#PriceGenerator.RenderBokeh-1331"><span class="linenos">1331</span></a>            <span class="n">volumeChart</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">major_label_orientation</span> <span class="o">=</span> <span class="n">pi</span> <span class="o">/</span> <span class="mi">6</span>
</span><span id="PriceGenerator.RenderBokeh-1332"><a href="#PriceGenerator.RenderBokeh-1332"><span class="linenos">1332</span></a>            <span class="n">volumeChart</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="PriceGenerator.RenderBokeh-1333"><a href="#PriceGenerator.RenderBokeh-1333"><span class="linenos">1333</span></a>            <span class="n">volumeChart</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">formatter</span> <span class="o">=</span> <span class="n">NumeralTickFormatter</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s2">&quot;0a&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator.RenderBokeh-1334"><a href="#PriceGenerator.RenderBokeh-1334"><span class="linenos">1334</span></a>            <span class="n">volumeChart</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">grid_line_dash</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</span><span id="PriceGenerator.RenderBokeh-1335"><a href="#PriceGenerator.RenderBokeh-1335"><span class="linenos">1335</span></a>            <span class="n">volumeChart</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">grid_line_alpha</span> <span class="o">=</span> <span class="mf">0.5</span>
</span><span id="PriceGenerator.RenderBokeh-1336"><a href="#PriceGenerator.RenderBokeh-1336"><span class="linenos">1336</span></a>            <span class="n">volumeChart</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">minor_grid_line_dash</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</span><span id="PriceGenerator.RenderBokeh-1337"><a href="#PriceGenerator.RenderBokeh-1337"><span class="linenos">1337</span></a>            <span class="n">volumeChart</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">minor_grid_line_alpha</span> <span class="o">=</span> <span class="mf">0.5</span>
</span><span id="PriceGenerator.RenderBokeh-1338"><a href="#PriceGenerator.RenderBokeh-1338"><span class="linenos">1338</span></a>            <span class="n">volumeChart</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">minor_grid_line_dash</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</span><span id="PriceGenerator.RenderBokeh-1339"><a href="#PriceGenerator.RenderBokeh-1339"><span class="linenos">1339</span></a>            <span class="n">volumeChart</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">minor_grid_line_alpha</span> <span class="o">=</span> <span class="mf">0.3</span>
</span><span id="PriceGenerator.RenderBokeh-1340"><a href="#PriceGenerator.RenderBokeh-1340"><span class="linenos">1340</span></a>            <span class="n">volumeChart</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">minor_grid_line_color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;gray&quot;</span>
</span><span id="PriceGenerator.RenderBokeh-1341"><a href="#PriceGenerator.RenderBokeh-1341"><span class="linenos">1341</span></a>
</span><span id="PriceGenerator.RenderBokeh-1342"><a href="#PriceGenerator.RenderBokeh-1342"><span class="linenos">1342</span></a>            <span class="c1"># preparing data for hover tooltips:</span>
</span><span id="PriceGenerator.RenderBokeh-1343"><a href="#PriceGenerator.RenderBokeh-1343"><span class="linenos">1343</span></a>            <span class="n">volSource</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="PriceGenerator.RenderBokeh-1344"><a href="#PriceGenerator.RenderBokeh-1344"><span class="linenos">1344</span></a>                <span class="s2">&quot;candle&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span>
</span><span id="PriceGenerator.RenderBokeh-1345"><a href="#PriceGenerator.RenderBokeh-1345"><span class="linenos">1345</span></a>                <span class="s2">&quot;datetime&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1346"><a href="#PriceGenerator.RenderBokeh-1346"><span class="linenos">1346</span></a>                <span class="s2">&quot;volume&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">volume</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1347"><a href="#PriceGenerator.RenderBokeh-1347"><span class="linenos">1347</span></a>                <span class="s2">&quot;zero&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">volume</span><span class="p">),</span>
</span><span id="PriceGenerator.RenderBokeh-1348"><a href="#PriceGenerator.RenderBokeh-1348"><span class="linenos">1348</span></a>            <span class="p">}</span>
</span><span id="PriceGenerator.RenderBokeh-1349"><a href="#PriceGenerator.RenderBokeh-1349"><span class="linenos">1349</span></a>            <span class="n">volHoverData</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">volSource</span><span class="p">)</span>
</span><span id="PriceGenerator.RenderBokeh-1350"><a href="#PriceGenerator.RenderBokeh-1350"><span class="linenos">1350</span></a>            <span class="n">volHover</span> <span class="o">=</span> <span class="n">volumeChart</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">HoverTool</span><span class="p">))</span>
</span><span id="PriceGenerator.RenderBokeh-1351"><a href="#PriceGenerator.RenderBokeh-1351"><span class="linenos">1351</span></a>            <span class="n">volHover</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;volumes&quot;</span>
</span><span id="PriceGenerator.RenderBokeh-1352"><a href="#PriceGenerator.RenderBokeh-1352"><span class="linenos">1352</span></a>            <span class="n">volHover</span><span class="o">.</span><span class="n">tooltips</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="PriceGenerator.RenderBokeh-1353"><a href="#PriceGenerator.RenderBokeh-1353"><span class="linenos">1353</span></a>                <span class="p">(</span><span class="s2">&quot;Candle&quot;</span><span class="p">,</span> <span class="s2">&quot;@candle&quot;</span><span class="p">),</span>
</span><span id="PriceGenerator.RenderBokeh-1354"><a href="#PriceGenerator.RenderBokeh-1354"><span class="linenos">1354</span></a>                <span class="p">(</span><span class="s2">&quot;Date&quot;</span><span class="p">,</span> <span class="s2">&quot;@datetime{%Y-%m-</span><span class="si">%d</span><span class="s2">}&quot;</span><span class="p">),</span>
</span><span id="PriceGenerator.RenderBokeh-1355"><a href="#PriceGenerator.RenderBokeh-1355"><span class="linenos">1355</span></a>                <span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">,</span> <span class="s2">&quot;@datetime{%H:%M:%S}&quot;</span><span class="p">),</span>
</span><span id="PriceGenerator.RenderBokeh-1356"><a href="#PriceGenerator.RenderBokeh-1356"><span class="linenos">1356</span></a>                <span class="p">(</span><span class="s2">&quot;Volume&quot;</span><span class="p">,</span> <span class="s2">&quot;@volume&quot;</span><span class="p">),</span>
</span><span id="PriceGenerator.RenderBokeh-1357"><a href="#PriceGenerator.RenderBokeh-1357"><span class="linenos">1357</span></a>            <span class="p">]</span>
</span><span id="PriceGenerator.RenderBokeh-1358"><a href="#PriceGenerator.RenderBokeh-1358"><span class="linenos">1358</span></a>            <span class="n">volHover</span><span class="o">.</span><span class="n">formatters</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="PriceGenerator.RenderBokeh-1359"><a href="#PriceGenerator.RenderBokeh-1359"><span class="linenos">1359</span></a>                <span class="s2">&quot;@datetime&quot;</span><span class="p">:</span> <span class="s2">&quot;datetime&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1360"><a href="#PriceGenerator.RenderBokeh-1360"><span class="linenos">1360</span></a>            <span class="p">}</span>
</span><span id="PriceGenerator.RenderBokeh-1361"><a href="#PriceGenerator.RenderBokeh-1361"><span class="linenos">1361</span></a>            <span class="n">volHover</span><span class="o">.</span><span class="n">point_policy</span> <span class="o">=</span> <span class="s2">&quot;snap_to_data&quot;</span>
</span><span id="PriceGenerator.RenderBokeh-1362"><a href="#PriceGenerator.RenderBokeh-1362"><span class="linenos">1362</span></a>            <span class="n">volHover</span><span class="o">.</span><span class="n">line_policy</span> <span class="o">=</span> <span class="s2">&quot;nearest&quot;</span>
</span><span id="PriceGenerator.RenderBokeh-1363"><a href="#PriceGenerator.RenderBokeh-1363"><span class="linenos">1363</span></a>            <span class="n">volHover</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;vline&quot;</span>
</span><span id="PriceGenerator.RenderBokeh-1364"><a href="#PriceGenerator.RenderBokeh-1364"><span class="linenos">1364</span></a>
</span><span id="PriceGenerator.RenderBokeh-1365"><a href="#PriceGenerator.RenderBokeh-1365"><span class="linenos">1365</span></a>            <span class="c1"># preparing volume chart:</span>
</span><span id="PriceGenerator.RenderBokeh-1366"><a href="#PriceGenerator.RenderBokeh-1366"><span class="linenos">1366</span></a>            <span class="n">hoverOnVolumes</span> <span class="o">=</span> <span class="n">volumeChart</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span>
</span><span id="PriceGenerator.RenderBokeh-1367"><a href="#PriceGenerator.RenderBokeh-1367"><span class="linenos">1367</span></a>                <span class="n">x0</span><span class="o">=</span><span class="s2">&quot;datetime&quot;</span><span class="p">,</span> <span class="n">y0</span><span class="o">=</span><span class="s2">&quot;volume&quot;</span><span class="p">,</span> <span class="n">x1</span><span class="o">=</span><span class="s2">&quot;datetime&quot;</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="s2">&quot;zero&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1368"><a href="#PriceGenerator.RenderBokeh-1368"><span class="linenos">1368</span></a>                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;volumes&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">volHoverData</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1369"><a href="#PriceGenerator.RenderBokeh-1369"><span class="linenos">1369</span></a>            <span class="p">)</span>
</span><span id="PriceGenerator.RenderBokeh-1370"><a href="#PriceGenerator.RenderBokeh-1370"><span class="linenos">1370</span></a>            <span class="n">volHover</span><span class="o">.</span><span class="n">renderers</span> <span class="o">=</span> <span class="p">[</span><span class="n">hoverOnVolumes</span><span class="p">]</span>  <span class="c1"># hover on only for volume bars</span>
</span><span id="PriceGenerator.RenderBokeh-1371"><a href="#PriceGenerator.RenderBokeh-1371"><span class="linenos">1371</span></a>            <span class="n">volumeChart</span><span class="o">.</span><span class="n">vbar</span><span class="p">(</span>
</span><span id="PriceGenerator.RenderBokeh-1372"><a href="#PriceGenerator.RenderBokeh-1372"><span class="linenos">1372</span></a>                <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">[</span><span class="n">inc</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="n">candleWidth</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">volume</span><span class="p">[</span><span class="n">inc</span><span class="p">],</span>
</span><span id="PriceGenerator.RenderBokeh-1373"><a href="#PriceGenerator.RenderBokeh-1373"><span class="linenos">1373</span></a>                <span class="n">fill_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#20ff00&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1374"><a href="#PriceGenerator.RenderBokeh-1374"><span class="linenos">1374</span></a>                <span class="n">line_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fill_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1375"><a href="#PriceGenerator.RenderBokeh-1375"><span class="linenos">1375</span></a>            <span class="p">)</span>
</span><span id="PriceGenerator.RenderBokeh-1376"><a href="#PriceGenerator.RenderBokeh-1376"><span class="linenos">1376</span></a>            <span class="n">volumeChart</span><span class="o">.</span><span class="n">vbar</span><span class="p">(</span>
</span><span id="PriceGenerator.RenderBokeh-1377"><a href="#PriceGenerator.RenderBokeh-1377"><span class="linenos">1377</span></a>                <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="p">[</span><span class="n">dec</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="n">candleWidth</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">volume</span><span class="p">[</span><span class="n">dec</span><span class="p">],</span>
</span><span id="PriceGenerator.RenderBokeh-1378"><a href="#PriceGenerator.RenderBokeh-1378"><span class="linenos">1378</span></a>                <span class="n">fill_color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;#999999&quot;</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#20ff00&quot;</span> <span class="k">if</span> <span class="n">darkTheme</span> <span class="k">else</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1379"><a href="#PriceGenerator.RenderBokeh-1379"><span class="linenos">1379</span></a>                <span class="n">line_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fill_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1380"><a href="#PriceGenerator.RenderBokeh-1380"><span class="linenos">1380</span></a>            <span class="p">)</span>
</span><span id="PriceGenerator.RenderBokeh-1381"><a href="#PriceGenerator.RenderBokeh-1381"><span class="linenos">1381</span></a>
</span><span id="PriceGenerator.RenderBokeh-1382"><a href="#PriceGenerator.RenderBokeh-1382"><span class="linenos">1382</span></a>            <span class="c1"># Merge Main and Volume charts in one Bokeh gridplot object:</span>
</span><span id="PriceGenerator.RenderBokeh-1383"><a href="#PriceGenerator.RenderBokeh-1383"><span class="linenos">1383</span></a>            <span class="n">unionChart</span> <span class="o">=</span> <span class="n">gridplot</span><span class="p">(</span>
</span><span id="PriceGenerator.RenderBokeh-1384"><a href="#PriceGenerator.RenderBokeh-1384"><span class="linenos">1384</span></a>                <span class="n">children</span><span class="o">=</span><span class="p">[[</span><span class="n">chart</span><span class="p">],</span> <span class="p">[</span><span class="n">volumeChart</span><span class="p">]],</span>
</span><span id="PriceGenerator.RenderBokeh-1385"><a href="#PriceGenerator.RenderBokeh-1385"><span class="linenos">1385</span></a>                <span class="n">sizing_mode</span><span class="o">=</span><span class="s2">&quot;stretch_both&quot;</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1386"><a href="#PriceGenerator.RenderBokeh-1386"><span class="linenos">1386</span></a>                <span class="n">merge_tools</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1387"><a href="#PriceGenerator.RenderBokeh-1387"><span class="linenos">1387</span></a>                <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
</span><span id="PriceGenerator.RenderBokeh-1388"><a href="#PriceGenerator.RenderBokeh-1388"><span class="linenos">1388</span></a>            <span class="p">)</span>
</span><span id="PriceGenerator.RenderBokeh-1389"><a href="#PriceGenerator.RenderBokeh-1389"><span class="linenos">1389</span></a>            <span class="n">unionChart</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">logo</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PriceGenerator.RenderBokeh-1390"><a href="#PriceGenerator.RenderBokeh-1390"><span class="linenos">1390</span></a>
</span><span id="PriceGenerator.RenderBokeh-1391"><a href="#PriceGenerator.RenderBokeh-1391"><span class="linenos">1391</span></a>            <span class="k">if</span> <span class="n">inline</span><span class="p">:</span>
</span><span id="PriceGenerator.RenderBokeh-1392"><a href="#PriceGenerator.RenderBokeh-1392"><span class="linenos">1392</span></a>                <span class="n">show</span><span class="p">(</span><span class="n">unionChart</span><span class="p">,</span> <span class="n">notebook_handle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="PriceGenerator.RenderBokeh-1393"><a href="#PriceGenerator.RenderBokeh-1393"><span class="linenos">1393</span></a>
</span><span id="PriceGenerator.RenderBokeh-1394"><a href="#PriceGenerator.RenderBokeh-1394"><span class="linenos">1394</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PriceGenerator.RenderBokeh-1395"><a href="#PriceGenerator.RenderBokeh-1395"><span class="linenos">1395</span></a>                <span class="c1"># preparing HTML-file chart and statistics in markdown:</span>
</span><span id="PriceGenerator.RenderBokeh-1396"><a href="#PriceGenerator.RenderBokeh-1396"><span class="linenos">1396</span></a>                <span class="k">if</span> <span class="n">fileName</span><span class="p">:</span>
</span><span id="PriceGenerator.RenderBokeh-1397"><a href="#PriceGenerator.RenderBokeh-1397"><span class="linenos">1397</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="PriceGenerator.RenderBokeh-1398"><a href="#PriceGenerator.RenderBokeh-1398"><span class="linenos">1398</span></a>                        <span class="n">output_file</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;cdn&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator.RenderBokeh-1399"><a href="#PriceGenerator.RenderBokeh-1399"><span class="linenos">1399</span></a>                        <span class="n">save</span><span class="p">(</span><span class="n">unionChart</span><span class="p">,</span> <span class="n">fileName</span><span class="p">)</span>
</span><span id="PriceGenerator.RenderBokeh-1400"><a href="#PriceGenerator.RenderBokeh-1400"><span class="linenos">1400</span></a>
</span><span id="PriceGenerator.RenderBokeh-1401"><a href="#PriceGenerator.RenderBokeh-1401"><span class="linenos">1401</span></a>                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="PriceGenerator.RenderBokeh-1402"><a href="#PriceGenerator.RenderBokeh-1402"><span class="linenos">1402</span></a>                        <span class="n">uLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Can&#39;t render HTML! Error message: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="PriceGenerator.RenderBokeh-1403"><a href="#PriceGenerator.RenderBokeh-1403"><span class="linenos">1403</span></a>
</span><span id="PriceGenerator.RenderBokeh-1404"><a href="#PriceGenerator.RenderBokeh-1404"><span class="linenos">1404</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="PriceGenerator.RenderBokeh-1405"><a href="#PriceGenerator.RenderBokeh-1405"><span class="linenos">1405</span></a>                        <span class="n">uLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Pandas DataFrame saved as HTML-file [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">fileName</span><span class="p">)))</span>
</span><span id="PriceGenerator.RenderBokeh-1406"><a href="#PriceGenerator.RenderBokeh-1406"><span class="linenos">1406</span></a>
</span><span id="PriceGenerator.RenderBokeh-1407"><a href="#PriceGenerator.RenderBokeh-1407"><span class="linenos">1407</span></a>                    <span class="k">if</span> <span class="n">showStatOnChart</span><span class="p">:</span>
</span><span id="PriceGenerator.RenderBokeh-1408"><a href="#PriceGenerator.RenderBokeh-1408"><span class="linenos">1408</span></a>                        <span class="n">mdFile</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.md&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>
</span><span id="PriceGenerator.RenderBokeh-1409"><a href="#PriceGenerator.RenderBokeh-1409"><span class="linenos">1409</span></a>                        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">mdFile</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fH</span><span class="p">:</span>
</span><span id="PriceGenerator.RenderBokeh-1410"><a href="#PriceGenerator.RenderBokeh-1410"><span class="linenos">1410</span></a>                            <span class="n">fH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">infoBlock</span><span class="p">))</span>
</span><span id="PriceGenerator.RenderBokeh-1411"><a href="#PriceGenerator.RenderBokeh-1411"><span class="linenos">1411</span></a>
</span><span id="PriceGenerator.RenderBokeh-1412"><a href="#PriceGenerator.RenderBokeh-1412"><span class="linenos">1412</span></a>                            <span class="n">uLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Statistics saved to [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">mdFile</span><span class="p">)))</span>
</span><span id="PriceGenerator.RenderBokeh-1413"><a href="#PriceGenerator.RenderBokeh-1413"><span class="linenos">1413</span></a>
</span><span id="PriceGenerator.RenderBokeh-1414"><a href="#PriceGenerator.RenderBokeh-1414"><span class="linenos">1414</span></a>                    <span class="k">if</span> <span class="n">viewInBrowser</span><span class="p">:</span>
</span><span id="PriceGenerator.RenderBokeh-1415"><a href="#PriceGenerator.RenderBokeh-1415"><span class="linenos">1415</span></a>                        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">fileName</span><span class="p">))</span>  <span class="c1"># view forecast chart in default browser immediately</span>
</span><span id="PriceGenerator.RenderBokeh-1416"><a href="#PriceGenerator.RenderBokeh-1416"><span class="linenos">1416</span></a>
</span><span id="PriceGenerator.RenderBokeh-1417"><a href="#PriceGenerator.RenderBokeh-1417"><span class="linenos">1417</span></a>            <span class="k">return</span> <span class="n">unionChart</span>
</span></pre></div>


            <div class="docstring"><p>Rendering prices from Pandas DataFrame as OHLCV Bokeh chart of candlesticks and save it to HTML-file.
Pandas DataFrame in <code><a href="#PriceGenerator.prices">prices</a></code> variable must contain "datetime", "open", "high", "low", "close" and "volume" columns.</p>

<p>See also: <a href="https://docs.bokeh.org/en/latest/docs/gallery/candlestick.html">https://docs.bokeh.org/en/latest/docs/gallery/candlestick.html</a></p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>fileName</strong>:  HTML-file path to save Bokeh chart. <code>index.html</code> by default.</li>
<li><strong>viewInBrowser</strong>:  If <code>True</code>, then immediately opens HTML chart in browser after rendering. <code>False</code> by default.</li>
<li><strong>darkTheme</strong>:  chart theme. <code>False</code> by default, mean that will be used light theme, <code>False</code> mean dark theme.</li>
<li><strong>markers</strong>:  Pandas DataFrame with additional markers that will be placed on main series. <code>None</code> by default.
Marker is a custom symbol, example: ×, ↓ or ↑. Dataframe with markers must contain at least two columns.
There are <code>datetime</code> with date and time and some markers columns (<code>markersUpper</code>, <code>markersCenter</code> or <code>markersLower</code>).
Length of markers series must be equal to the length of main candles series.</li>
<li><strong>lines</strong>:  list with custom series, where additional chart-lines will place on main series. <code>None</code> by default.
Line data must contain at least two columns. There are <code>datetime</code> with date and time and
<code>custom_line_name</code> with y-coordinates. Length of the chart-line dataframes must be equal to the length of main candle series.</li>
<li><strong>title</strong>:  specific chart title. If <code>None</code>, then used auto-generated title. <code>None</code> by default.</li>
<li><strong>width</strong>:  chart width. If <code>None</code>, then used auto-width. 1800 px by default.</li>
<li><strong>height</strong>:  chart height. If <code>None</code>, then used auto-height. 940 px by default.</li>
<li><strong>showControlsOnChart</strong>:  enable controls block in legend to hide/show some elements on chart, <code>True</code> by default.</li>
<li><strong>showStatOnChart</strong>:  show statistics block on chart, <code>True</code> (by default) mean that will be calculating additional
series, like as Trend and Average Points. And some classical indicators, like as SMA, HMA,
VWMA, Bollinger Bands, Parabolic Stop and Reverse, Alligator and Zig-Zag indicator.
Warning! Calculate statistic takes more time. If you want to decrease chart rendering time,
then set this parameter to <code>False</code>.</li>
<li><strong>inline</strong>:  if <code>True</code>, then output chart in Jupyter Notebook cell. <code>False</code> by default.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>bokeh.layouts.gridplot with all layouts objects or None.</p>
</blockquote>
</div>


                            </div>
                            <div id="PriceGenerator.RenderGoogle" class="classattr">
                                        <input id="PriceGenerator.RenderGoogle-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">RenderGoogle</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">fileName</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;index.html&#39;</span>,</span><span class="param">	<span class="n">viewInBrowser</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">title</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="PriceGenerator.RenderGoogle-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PriceGenerator.RenderGoogle"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PriceGenerator.RenderGoogle-1419"><a href="#PriceGenerator.RenderGoogle-1419"><span class="linenos">1419</span></a>    <span class="k">def</span> <span class="nf">RenderGoogle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;index.html&quot;</span><span class="p">,</span> <span class="n">viewInBrowser</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PriceGenerator.RenderGoogle-1420"><a href="#PriceGenerator.RenderGoogle-1420"><span class="linenos">1420</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="PriceGenerator.RenderGoogle-1421"><a href="#PriceGenerator.RenderGoogle-1421"><span class="linenos">1421</span></a><span class="sd">        Rendering prices from Pandas DataFrame as non-interactive Google Candlestick chart and save it to HTML-file.</span>
</span><span id="PriceGenerator.RenderGoogle-1422"><a href="#PriceGenerator.RenderGoogle-1422"><span class="linenos">1422</span></a>
</span><span id="PriceGenerator.RenderGoogle-1423"><a href="#PriceGenerator.RenderGoogle-1423"><span class="linenos">1423</span></a><span class="sd">        See also: https://developers.google.com/chart/interactive/docs/gallery/candlestickchart</span>
</span><span id="PriceGenerator.RenderGoogle-1424"><a href="#PriceGenerator.RenderGoogle-1424"><span class="linenos">1424</span></a>
</span><span id="PriceGenerator.RenderGoogle-1425"><a href="#PriceGenerator.RenderGoogle-1425"><span class="linenos">1425</span></a><span class="sd">        :param fileName: HTML-file path to save Google Candlestick chart.</span>
</span><span id="PriceGenerator.RenderGoogle-1426"><a href="#PriceGenerator.RenderGoogle-1426"><span class="linenos">1426</span></a><span class="sd">        :param viewInBrowser: If `True`, then immediately opens html in browser after rendering.</span>
</span><span id="PriceGenerator.RenderGoogle-1427"><a href="#PriceGenerator.RenderGoogle-1427"><span class="linenos">1427</span></a><span class="sd">        :param title: specific chart title. If `None`, then used auto-generated title. `None` by default.</span>
</span><span id="PriceGenerator.RenderGoogle-1428"><a href="#PriceGenerator.RenderGoogle-1428"><span class="linenos">1428</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PriceGenerator.RenderGoogle-1429"><a href="#PriceGenerator.RenderGoogle-1429"><span class="linenos">1429</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="PriceGenerator.RenderGoogle-1430"><a href="#PriceGenerator.RenderGoogle-1430"><span class="linenos">1430</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Empty price data! Generate or load prices before show as Google Candlestick chart!&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator.RenderGoogle-1431"><a href="#PriceGenerator.RenderGoogle-1431"><span class="linenos">1431</span></a>
</span><span id="PriceGenerator.RenderGoogle-1432"><a href="#PriceGenerator.RenderGoogle-1432"><span class="linenos">1432</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PriceGenerator.RenderGoogle-1433"><a href="#PriceGenerator.RenderGoogle-1433"><span class="linenos">1433</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Rendering Pandas DataFrame as Google Candlestick chart...&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator.RenderGoogle-1434"><a href="#PriceGenerator.RenderGoogle-1434"><span class="linenos">1434</span></a>
</span><span id="PriceGenerator.RenderGoogle-1435"><a href="#PriceGenerator.RenderGoogle-1435"><span class="linenos">1435</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">DetectTimeframe</span><span class="p">()</span>  <span class="c1"># auto-detect time delta between last two neighbour candles</span>
</span><span id="PriceGenerator.RenderGoogle-1436"><a href="#PriceGenerator.RenderGoogle-1436"><span class="linenos">1436</span></a>            <span class="n">infoBlock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetStatistics</span><span class="p">()</span>  <span class="c1"># calculating some indicators</span>
</span><span id="PriceGenerator.RenderGoogle-1437"><a href="#PriceGenerator.RenderGoogle-1437"><span class="linenos">1437</span></a>
</span><span id="PriceGenerator.RenderGoogle-1438"><a href="#PriceGenerator.RenderGoogle-1438"><span class="linenos">1438</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chartTitle</span> <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">title</span> <span class="k">else</span> <span class="n">title</span>  <span class="c1"># chart title</span>
</span><span id="PriceGenerator.RenderGoogle-1439"><a href="#PriceGenerator.RenderGoogle-1439"><span class="linenos">1439</span></a>
</span><span id="PriceGenerator.RenderGoogle-1440"><a href="#PriceGenerator.RenderGoogle-1440"><span class="linenos">1440</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">j2model</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">j2model</span><span class="p">:</span>
</span><span id="PriceGenerator.RenderGoogle-1441"><a href="#PriceGenerator.RenderGoogle-1441"><span class="linenos">1441</span></a>                <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Preparing Google Candlestick chart configuration...&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator.RenderGoogle-1442"><a href="#PriceGenerator.RenderGoogle-1442"><span class="linenos">1442</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">j2model</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;info&quot;</span><span class="p">:</span> <span class="n">infoBlock</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">title</span><span class="p">}</span>
</span><span id="PriceGenerator.RenderGoogle-1443"><a href="#PriceGenerator.RenderGoogle-1443"><span class="linenos">1443</span></a>                <span class="n">googleDates</span> <span class="o">=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">date</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
</span><span id="PriceGenerator.RenderGoogle-1444"><a href="#PriceGenerator.RenderGoogle-1444"><span class="linenos">1444</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">googleDates</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">low</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">open</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">high</span><span class="p">)</span>
</span><span id="PriceGenerator.RenderGoogle-1445"><a href="#PriceGenerator.RenderGoogle-1445"><span class="linenos">1445</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">j2model</span><span class="p">[</span><span class="s2">&quot;candlesData&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
</span><span id="PriceGenerator.RenderGoogle-1446"><a href="#PriceGenerator.RenderGoogle-1446"><span class="linenos">1446</span></a>
</span><span id="PriceGenerator.RenderGoogle-1447"><a href="#PriceGenerator.RenderGoogle-1447"><span class="linenos">1447</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PriceGenerator.RenderGoogle-1448"><a href="#PriceGenerator.RenderGoogle-1448"><span class="linenos">1448</span></a>                <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Using custom chart model&quot;</span><span class="p">)</span>
</span><span id="PriceGenerator.RenderGoogle-1449"><a href="#PriceGenerator.RenderGoogle-1449"><span class="linenos">1449</span></a>
</span><span id="PriceGenerator.RenderGoogle-1450"><a href="#PriceGenerator.RenderGoogle-1450"><span class="linenos">1450</span></a>            <span class="c1"># --- Rendering and saving chart as HTML-file and markdown-file with statistics:</span>
</span><span id="PriceGenerator.RenderGoogle-1451"><a href="#PriceGenerator.RenderGoogle-1451"><span class="linenos">1451</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">j2template</span><span class="p">):</span>
</span><span id="PriceGenerator.RenderGoogle-1452"><a href="#PriceGenerator.RenderGoogle-1452"><span class="linenos">1452</span></a>                <span class="n">renderedTemplate</span> <span class="o">=</span> <span class="n">jinja2</span><span class="o">.</span><span class="n">Template</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">j2template</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span><span id="PriceGenerator.RenderGoogle-1453"><a href="#PriceGenerator.RenderGoogle-1453"><span class="linenos">1453</span></a>
</span><span id="PriceGenerator.RenderGoogle-1454"><a href="#PriceGenerator.RenderGoogle-1454"><span class="linenos">1454</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PriceGenerator.RenderGoogle-1455"><a href="#PriceGenerator.RenderGoogle-1455"><span class="linenos">1455</span></a>                <span class="n">renderedTemplate</span> <span class="o">=</span> <span class="n">jinja2</span><span class="o">.</span><span class="n">Template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">j2template</span><span class="p">)</span>
</span><span id="PriceGenerator.RenderGoogle-1456"><a href="#PriceGenerator.RenderGoogle-1456"><span class="linenos">1456</span></a>
</span><span id="PriceGenerator.RenderGoogle-1457"><a href="#PriceGenerator.RenderGoogle-1457"><span class="linenos">1457</span></a>            <span class="n">htmlMain</span> <span class="o">=</span> <span class="n">renderedTemplate</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">j2model</span><span class="p">)</span>
</span><span id="PriceGenerator.RenderGoogle-1458"><a href="#PriceGenerator.RenderGoogle-1458"><span class="linenos">1458</span></a>
</span><span id="PriceGenerator.RenderGoogle-1459"><a href="#PriceGenerator.RenderGoogle-1459"><span class="linenos">1459</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fH</span><span class="p">:</span>
</span><span id="PriceGenerator.RenderGoogle-1460"><a href="#PriceGenerator.RenderGoogle-1460"><span class="linenos">1460</span></a>                <span class="n">fH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">htmlMain</span><span class="p">)</span>
</span><span id="PriceGenerator.RenderGoogle-1461"><a href="#PriceGenerator.RenderGoogle-1461"><span class="linenos">1461</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.md&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fileName</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fH</span><span class="p">:</span>
</span><span id="PriceGenerator.RenderGoogle-1462"><a href="#PriceGenerator.RenderGoogle-1462"><span class="linenos">1462</span></a>                <span class="n">fH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">infoBlock</span><span class="p">))</span>
</span><span id="PriceGenerator.RenderGoogle-1463"><a href="#PriceGenerator.RenderGoogle-1463"><span class="linenos">1463</span></a>
</span><span id="PriceGenerator.RenderGoogle-1464"><a href="#PriceGenerator.RenderGoogle-1464"><span class="linenos">1464</span></a>            <span class="k">if</span> <span class="n">viewInBrowser</span><span class="p">:</span>
</span><span id="PriceGenerator.RenderGoogle-1465"><a href="#PriceGenerator.RenderGoogle-1465"><span class="linenos">1465</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">fileName</span><span class="p">))</span>  <span class="c1"># view forecast chart in default browser immediately</span>
</span><span id="PriceGenerator.RenderGoogle-1466"><a href="#PriceGenerator.RenderGoogle-1466"><span class="linenos">1466</span></a>
</span><span id="PriceGenerator.RenderGoogle-1467"><a href="#PriceGenerator.RenderGoogle-1467"><span class="linenos">1467</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Pandas DataFrame rendered as HTML-file [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">fileName</span><span class="p">)))</span>
</span></pre></div>


            <div class="docstring"><p>Rendering prices from Pandas DataFrame as non-interactive Google Candlestick chart and save it to HTML-file.</p>

<p>See also: <a href="https://developers.google.com/chart/interactive/docs/gallery/candlestickchart">https://developers.google.com/chart/interactive/docs/gallery/candlestickchart</a></p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>fileName</strong>:  HTML-file path to save Google Candlestick chart.</li>
<li><strong>viewInBrowser</strong>:  If <code>True</code>, then immediately opens html in browser after rendering.</li>
<li><strong>title</strong>:  specific chart title. If <code>None</code>, then used auto-generated title. <code>None</code> by default.</li>
</ul>
</div>


                            </div>
                </section>
                <section id="ParseArgs">
                            <input id="ParseArgs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">ParseArgs</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ParseArgs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ParseArgs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ParseArgs-1470"><a href="#ParseArgs-1470"><span class="linenos">1470</span></a><span class="k">def</span> <span class="nf">ParseArgs</span><span class="p">():</span>
</span><span id="ParseArgs-1471"><a href="#ParseArgs-1471"><span class="linenos">1471</span></a>    <span class="sd">&quot;&quot;&quot;This function get and parse command line keys.&quot;&quot;&quot;</span>
</span><span id="ParseArgs-1472"><a href="#ParseArgs-1472"><span class="linenos">1472</span></a>    <span class="n">parser</span> <span class="o">=</span> <span class="n">ArgumentParser</span><span class="p">()</span>  <span class="c1"># command-line string parser</span>
</span><span id="ParseArgs-1473"><a href="#ParseArgs-1473"><span class="linenos">1473</span></a>
</span><span id="ParseArgs-1474"><a href="#ParseArgs-1474"><span class="linenos">1474</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;PriceGenerator is the platform for generating prices similar to real stock prices, but you can control the statistics of their distribution. Generates chain of candlesticks with predefined statistical parameters, return Pandas DataFrame or saving as .CSV-file with OHLCV-candlestick in every string. Use PriceGenerator to generate synthetic data to test your trading strategy. See examples: https://tim55667757.github.io/PriceGenerator&quot;</span>
</span><span id="ParseArgs-1475"><a href="#ParseArgs-1475"><span class="linenos">1475</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">usage</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">/as module/ python PriceGenerator.py [some options] [one command]</span><span class="se">\n</span><span class="s2">/as CLI tool/ pricegenerator [some options] [one command]&quot;</span>
</span><span id="ParseArgs-1476"><a href="#ParseArgs-1476"><span class="linenos">1476</span></a>
</span><span id="ParseArgs-1477"><a href="#ParseArgs-1477"><span class="linenos">1477</span></a>    <span class="c1"># options:</span>
</span><span id="ParseArgs-1478"><a href="#ParseArgs-1478"><span class="linenos">1478</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--ticker&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;TEST&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Option: some fake ticker name, &#39;TEST&#39; by default.&quot;</span><span class="p">)</span>
</span><span id="ParseArgs-1479"><a href="#ParseArgs-1479"><span class="linenos">1479</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--precision&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Option: precision is count of digits after comma, 2 by default.&quot;</span><span class="p">)</span>
</span><span id="ParseArgs-1480"><a href="#ParseArgs-1480"><span class="linenos">1480</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--timeframe&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Option: time delta between two neighbour candles in minutes, 60 (1 hour) by default.&quot;</span><span class="p">)</span>
</span><span id="ParseArgs-1481"><a href="#ParseArgs-1481"><span class="linenos">1481</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--start&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Option: start time of 1st candle as string with format &#39;year-month-day hour:min&#39;, e.g. &#39;2021-01-02 12:00&#39;.&quot;</span><span class="p">)</span>
</span><span id="ParseArgs-1482"><a href="#ParseArgs-1482"><span class="linenos">1482</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--horizon&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Option: candlesticks count. Default: 30.&quot;</span><span class="p">)</span>
</span><span id="ParseArgs-1483"><a href="#ParseArgs-1483"><span class="linenos">1483</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--split-trend&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Option: set different trends, e.g. `--split-trend=/\-` means that generated candles has uptrend at first part, next downtrend and then no trend. Used only together with `--split-count` key. Also, you can use words: `up`, `down`, `no` or chars: `u`, `d`, `n` with the hyphen symbol as separator, e.g. `--split-trend=up-down-no-up`, `--split-trend=u-d-n-u` etc. Default: empty string, mean that will be used random trend directions.&quot;</span><span class="p">)</span>
</span><span id="ParseArgs-1484"><a href="#ParseArgs-1484"><span class="linenos">1484</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--split-count&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Option: set candles count in different trends, e.g. `--split-count 5 10 15` means that generated candles has 3 trends with 5, 10 and 15 candles in chain, with sum must be equal to `--horizon` value. Used only together with `--split-trend` key. Default: [], empty list mean that will be used random candles count in trends.&quot;</span><span class="p">)</span>
</span><span id="ParseArgs-1485"><a href="#ParseArgs-1485"><span class="linenos">1485</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--max-close&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Option: maximum of all close prices.&quot;</span><span class="p">)</span>
</span><span id="ParseArgs-1486"><a href="#ParseArgs-1486"><span class="linenos">1486</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--min-close&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Option: minimum of all close prices.&quot;</span><span class="p">)</span>
</span><span id="ParseArgs-1487"><a href="#ParseArgs-1487"><span class="linenos">1487</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--init-close&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Option: generator started 1st open price equal to this last close price.&quot;</span><span class="p">)</span>
</span><span id="ParseArgs-1488"><a href="#ParseArgs-1488"><span class="linenos">1488</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--max-outlier&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Option: maximum of outlier size of candle tails, by default used (max_close - min_close) / 10.&quot;</span><span class="p">)</span>
</span><span id="ParseArgs-1489"><a href="#ParseArgs-1489"><span class="linenos">1489</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--max-body&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Option: maximum of candle body sizes: abs(open - close), by default used max_outlier * 0.9.&quot;</span><span class="p">)</span>
</span><span id="ParseArgs-1490"><a href="#ParseArgs-1490"><span class="linenos">1490</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--max-volume&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Option: maximum of trade volumes.&quot;</span><span class="p">)</span>
</span><span id="ParseArgs-1491"><a href="#ParseArgs-1491"><span class="linenos">1491</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--up-candles-prob&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Option: float number in [0; 1] is a probability that next candle is up, 0.5 by default.&quot;</span><span class="p">)</span>
</span><span id="ParseArgs-1492"><a href="#ParseArgs-1492"><span class="linenos">1492</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--outliers-prob&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.03</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Option: float number in [0; 1] is an outliers probability (price tails), 0.03 by default.&quot;</span><span class="p">)</span>
</span><span id="ParseArgs-1493"><a href="#ParseArgs-1493"><span class="linenos">1493</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--trend-deviation&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.005</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Option: relative deviation for trend detection, 0.005 mean ±0.005 by default. No trend if (1st_close - last_close) / 1st_close &lt;= trend_deviation.&quot;</span><span class="p">)</span>
</span><span id="ParseArgs-1494"><a href="#ParseArgs-1494"><span class="linenos">1494</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--zigzag&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.03</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Option: relative deviation to detection points of Zig-Zag indicator, 0.03 by default.&quot;</span><span class="p">)</span>
</span><span id="ParseArgs-1495"><a href="#ParseArgs-1495"><span class="linenos">1495</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--sep&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Option: separator in CSV-file, if None then auto-detecting enable.&quot;</span><span class="p">)</span>
</span><span id="ParseArgs-1496"><a href="#ParseArgs-1496"><span class="linenos">1496</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--dark&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Option: if key present, then will be used dark theme for the `--render-bokeh` key. `False` by default for light theme.&quot;</span><span class="p">)</span>
</span><span id="ParseArgs-1497"><a href="#ParseArgs-1497"><span class="linenos">1497</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--debug-level&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Option: showing STDOUT messages of minimal debug level, e.g., 10 = DEBUG, 20 = INFO, 30 = WARNING, 40 = ERROR, 50 = CRITICAL.&quot;</span><span class="p">)</span>
</span><span id="ParseArgs-1498"><a href="#ParseArgs-1498"><span class="linenos">1498</span></a>
</span><span id="ParseArgs-1499"><a href="#ParseArgs-1499"><span class="linenos">1499</span></a>    <span class="c1"># commands:</span>
</span><span id="ParseArgs-1500"><a href="#ParseArgs-1500"><span class="linenos">1500</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--load-from&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Command: load .cvs-file to Pandas DataFrame. You can draw chart in additional with `--render-bokeh` or `--render-google` key.&quot;</span><span class="p">)</span>
</span><span id="ParseArgs-1501"><a href="#ParseArgs-1501"><span class="linenos">1501</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--generate&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Command: generates chain of candlesticks with predefined statistical parameters and save stock history as Pandas DataFrame or .CSV-file if `--save-to` key is defined. You can draw chart in additional with `--render-bokeh` or `--render-google` keys.&quot;</span><span class="p">)</span>
</span><span id="ParseArgs-1502"><a href="#ParseArgs-1502"><span class="linenos">1502</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--save-to&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Command: save generated or loaded dataframe to .CSV-file. You can draw chart in additional with `--render-bokeh` or `--render-google` keys.&quot;</span><span class="p">)</span>
</span><span id="ParseArgs-1503"><a href="#ParseArgs-1503"><span class="linenos">1503</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--render-bokeh&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Command: show chain of candlesticks as interactive Bokeh chart. Used only together with `--load-from` or `--generate` keys.&quot;</span><span class="p">)</span>
</span><span id="ParseArgs-1504"><a href="#ParseArgs-1504"><span class="linenos">1504</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--render-google&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Command: show chain of candlesticks as non-interactive Google Candlestick chart. Used only together with `--load-from` or `--generate` keys.&quot;</span><span class="p">)</span>
</span><span id="ParseArgs-1505"><a href="#ParseArgs-1505"><span class="linenos">1505</span></a>
</span><span id="ParseArgs-1506"><a href="#ParseArgs-1506"><span class="linenos">1506</span></a>    <span class="n">cmdArgs</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</span><span id="ParseArgs-1507"><a href="#ParseArgs-1507"><span class="linenos">1507</span></a>    <span class="k">return</span> <span class="n">cmdArgs</span>
</span></pre></div>


            <div class="docstring"><p>This function get and parse command line keys.</p>
</div>


                </section>
                <section id="Main">
                            <input id="Main-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">Main</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Main-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Main"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Main-1510"><a href="#Main-1510"><span class="linenos">1510</span></a><span class="k">def</span> <span class="nf">Main</span><span class="p">():</span>
</span><span id="Main-1511"><a href="#Main-1511"><span class="linenos">1511</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Main-1512"><a href="#Main-1512"><span class="linenos">1512</span></a><span class="sd">    Main function for work with PriceGenerator in the console.</span>
</span><span id="Main-1513"><a href="#Main-1513"><span class="linenos">1513</span></a>
</span><span id="Main-1514"><a href="#Main-1514"><span class="linenos">1514</span></a><span class="sd">    See examples:</span>
</span><span id="Main-1515"><a href="#Main-1515"><span class="linenos">1515</span></a><span class="sd">    - in english: https://github.com/Tim55667757/PriceGenerator/blob/master/README.md</span>
</span><span id="Main-1516"><a href="#Main-1516"><span class="linenos">1516</span></a><span class="sd">    - in russian: https://github.com/Tim55667757/PriceGenerator/blob/master/README_RU.md</span>
</span><span id="Main-1517"><a href="#Main-1517"><span class="linenos">1517</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Main-1518"><a href="#Main-1518"><span class="linenos">1518</span></a>    <span class="n">args</span> <span class="o">=</span> <span class="n">ParseArgs</span><span class="p">()</span>  <span class="c1"># get and parse command-line parameters</span>
</span><span id="Main-1519"><a href="#Main-1519"><span class="linenos">1519</span></a>    <span class="n">exitCode</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Main-1520"><a href="#Main-1520"><span class="linenos">1520</span></a>
</span><span id="Main-1521"><a href="#Main-1521"><span class="linenos">1521</span></a>    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">debug_level</span><span class="p">:</span>
</span><span id="Main-1522"><a href="#Main-1522"><span class="linenos">1522</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># always debug level by default</span>
</span><span id="Main-1523"><a href="#Main-1523"><span class="linenos">1523</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">handlers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">debug_level</span>  <span class="c1"># level for STDOUT</span>
</span><span id="Main-1524"><a href="#Main-1524"><span class="linenos">1524</span></a>        <span class="c1"># uLogger.handlers[1].level = 10  # always debug level for log.txt</span>
</span><span id="Main-1525"><a href="#Main-1525"><span class="linenos">1525</span></a>
</span><span id="Main-1526"><a href="#Main-1526"><span class="linenos">1526</span></a>    <span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">tzlocal</span><span class="p">())</span>
</span><span id="Main-1527"><a href="#Main-1527"><span class="linenos">1527</span></a>    <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">uLog</span><span class="o">.</span><span class="n">sepLine</span><span class="p">)</span>
</span><span id="Main-1528"><a href="#Main-1528"><span class="linenos">1528</span></a>    <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;PriceGenerator started: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">start</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)))</span>
</span><span id="Main-1529"><a href="#Main-1529"><span class="linenos">1529</span></a>
</span><span id="Main-1530"><a href="#Main-1530"><span class="linenos">1530</span></a>    <span class="n">priceModel</span> <span class="o">=</span> <span class="n">PriceGenerator</span><span class="p">()</span>
</span><span id="Main-1531"><a href="#Main-1531"><span class="linenos">1531</span></a>
</span><span id="Main-1532"><a href="#Main-1532"><span class="linenos">1532</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="Main-1533"><a href="#Main-1533"><span class="linenos">1533</span></a>        <span class="c1"># --- set options:</span>
</span><span id="Main-1534"><a href="#Main-1534"><span class="linenos">1534</span></a>
</span><span id="Main-1535"><a href="#Main-1535"><span class="linenos">1535</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">sep</span><span class="p">:</span>
</span><span id="Main-1536"><a href="#Main-1536"><span class="linenos">1536</span></a>            <span class="n">priceModel</span><span class="o">.</span><span class="n">sep</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">sep</span>  <span class="c1"># separator in .CSV-file</span>
</span><span id="Main-1537"><a href="#Main-1537"><span class="linenos">1537</span></a>
</span><span id="Main-1538"><a href="#Main-1538"><span class="linenos">1538</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">ticker</span><span class="p">:</span>
</span><span id="Main-1539"><a href="#Main-1539"><span class="linenos">1539</span></a>            <span class="n">priceModel</span><span class="o">.</span><span class="n">ticker</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">ticker</span>  <span class="c1"># some fake ticker name, &quot;TEST&quot; by default</span>
</span><span id="Main-1540"><a href="#Main-1540"><span class="linenos">1540</span></a>
</span><span id="Main-1541"><a href="#Main-1541"><span class="linenos">1541</span></a>        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">precision</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Main-1542"><a href="#Main-1542"><span class="linenos">1542</span></a>            <span class="n">priceModel</span><span class="o">.</span><span class="n">precision</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">precision</span>  <span class="c1"># precision is count of digits after comma, 2 by default</span>
</span><span id="Main-1543"><a href="#Main-1543"><span class="linenos">1543</span></a>
</span><span id="Main-1544"><a href="#Main-1544"><span class="linenos">1544</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">timeframe</span><span class="p">:</span>
</span><span id="Main-1545"><a href="#Main-1545"><span class="linenos">1545</span></a>            <span class="n">priceModel</span><span class="o">.</span><span class="n">timeframe</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">timeframe</span><span class="p">)</span>  <span class="c1"># time delta between two neighbour candles in minutes, 60 (1 hour) by default</span>
</span><span id="Main-1546"><a href="#Main-1546"><span class="linenos">1546</span></a>
</span><span id="Main-1547"><a href="#Main-1547"><span class="linenos">1547</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">start</span><span class="p">:</span>
</span><span id="Main-1548"><a href="#Main-1548"><span class="linenos">1548</span></a>            <span class="n">priceModel</span><span class="o">.</span><span class="n">timeStart</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M&quot;</span><span class="p">)</span>
</span><span id="Main-1549"><a href="#Main-1549"><span class="linenos">1549</span></a>
</span><span id="Main-1550"><a href="#Main-1550"><span class="linenos">1550</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">horizon</span><span class="p">:</span>
</span><span id="Main-1551"><a href="#Main-1551"><span class="linenos">1551</span></a>            <span class="n">priceModel</span><span class="o">.</span><span class="n">horizon</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">horizon</span>  <span class="c1"># generating candlesticks count</span>
</span><span id="Main-1552"><a href="#Main-1552"><span class="linenos">1552</span></a>
</span><span id="Main-1553"><a href="#Main-1553"><span class="linenos">1553</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">split_trend</span><span class="p">:</span>
</span><span id="Main-1554"><a href="#Main-1554"><span class="linenos">1554</span></a>            <span class="n">priceModel</span><span class="o">.</span><span class="n">trendSplit</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">split_trend</span>  <span class="c1"># difference periods</span>
</span><span id="Main-1555"><a href="#Main-1555"><span class="linenos">1555</span></a>
</span><span id="Main-1556"><a href="#Main-1556"><span class="linenos">1556</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">split_count</span><span class="p">:</span>
</span><span id="Main-1557"><a href="#Main-1557"><span class="linenos">1557</span></a>            <span class="n">priceModel</span><span class="o">.</span><span class="n">splitCount</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">split_count</span>  <span class="c1"># candles in every period</span>
</span><span id="Main-1558"><a href="#Main-1558"><span class="linenos">1558</span></a>
</span><span id="Main-1559"><a href="#Main-1559"><span class="linenos">1559</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">min_close</span><span class="p">:</span>
</span><span id="Main-1560"><a href="#Main-1560"><span class="linenos">1560</span></a>            <span class="n">priceModel</span><span class="o">.</span><span class="n">minClose</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">min_close</span>  <span class="c1"># minimum of all close prices</span>
</span><span id="Main-1561"><a href="#Main-1561"><span class="linenos">1561</span></a>
</span><span id="Main-1562"><a href="#Main-1562"><span class="linenos">1562</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">init_close</span><span class="p">:</span>
</span><span id="Main-1563"><a href="#Main-1563"><span class="linenos">1563</span></a>            <span class="n">priceModel</span><span class="o">.</span><span class="n">initClose</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">init_close</span>  <span class="c1"># generator started 1st open price of chain from this &quot;last&quot; close price</span>
</span><span id="Main-1564"><a href="#Main-1564"><span class="linenos">1564</span></a>
</span><span id="Main-1565"><a href="#Main-1565"><span class="linenos">1565</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">max_outlier</span><span class="p">:</span>
</span><span id="Main-1566"><a href="#Main-1566"><span class="linenos">1566</span></a>            <span class="n">priceModel</span><span class="o">.</span><span class="n">maxOutlier</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">max_outlier</span>  <span class="c1"># maximum of outlier size of candle tails, by default used (max-close - min-close) / 10</span>
</span><span id="Main-1567"><a href="#Main-1567"><span class="linenos">1567</span></a>
</span><span id="Main-1568"><a href="#Main-1568"><span class="linenos">1568</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">max_body</span><span class="p">:</span>
</span><span id="Main-1569"><a href="#Main-1569"><span class="linenos">1569</span></a>            <span class="n">priceModel</span><span class="o">.</span><span class="n">maxCandleBody</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">max_body</span>  <span class="c1"># maximum of candle body sizes: abs(open - close), by default used max-outlier * 90%</span>
</span><span id="Main-1570"><a href="#Main-1570"><span class="linenos">1570</span></a>
</span><span id="Main-1571"><a href="#Main-1571"><span class="linenos">1571</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">max_volume</span><span class="p">:</span>
</span><span id="Main-1572"><a href="#Main-1572"><span class="linenos">1572</span></a>            <span class="n">priceModel</span><span class="o">.</span><span class="n">maxVolume</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">max_volume</span>  <span class="c1"># maximum of trade volumes</span>
</span><span id="Main-1573"><a href="#Main-1573"><span class="linenos">1573</span></a>
</span><span id="Main-1574"><a href="#Main-1574"><span class="linenos">1574</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">up_candles_prob</span><span class="p">:</span>
</span><span id="Main-1575"><a href="#Main-1575"><span class="linenos">1575</span></a>            <span class="n">priceModel</span><span class="o">.</span><span class="n">upCandlesProb</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">up_candles_prob</span>  <span class="c1"># float number in [0; 1] is a probability that next candle is up, 0.5 = 50% by default</span>
</span><span id="Main-1576"><a href="#Main-1576"><span class="linenos">1576</span></a>
</span><span id="Main-1577"><a href="#Main-1577"><span class="linenos">1577</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">outliers_prob</span><span class="p">:</span>
</span><span id="Main-1578"><a href="#Main-1578"><span class="linenos">1578</span></a>            <span class="n">priceModel</span><span class="o">.</span><span class="n">outliersProb</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">outliers_prob</span>  <span class="c1"># float number in [0; 1] is a statistical outlier probability (price &quot;tails&quot;), 0.03 = 3% by default</span>
</span><span id="Main-1579"><a href="#Main-1579"><span class="linenos">1579</span></a>
</span><span id="Main-1580"><a href="#Main-1580"><span class="linenos">1580</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">trend_deviation</span><span class="p">:</span>
</span><span id="Main-1581"><a href="#Main-1581"><span class="linenos">1581</span></a>            <span class="n">priceModel</span><span class="o">.</span><span class="n">trendDeviation</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">trend_deviation</span>  <span class="c1"># relative deviation for trend detection, 0.005 mean ±0.5% by default. &quot;NO trend&quot; if (1st_close - last_close) / 1st_close &lt;= trend-deviation</span>
</span><span id="Main-1582"><a href="#Main-1582"><span class="linenos">1582</span></a>
</span><span id="Main-1583"><a href="#Main-1583"><span class="linenos">1583</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">zigzag</span><span class="p">:</span>
</span><span id="Main-1584"><a href="#Main-1584"><span class="linenos">1584</span></a>            <span class="n">priceModel</span><span class="o">.</span><span class="n">zigZagDeviation</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">zigzag</span>  <span class="c1"># relative deviation to detection points of ZigZag indicator, 0.03 by default</span>
</span><span id="Main-1585"><a href="#Main-1585"><span class="linenos">1585</span></a>
</span><span id="Main-1586"><a href="#Main-1586"><span class="linenos">1586</span></a>        <span class="c1"># --- do one or more commands:</span>
</span><span id="Main-1587"><a href="#Main-1587"><span class="linenos">1587</span></a>
</span><span id="Main-1588"><a href="#Main-1588"><span class="linenos">1588</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">load_from</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">generate</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">save_to</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">render_bokeh</span><span class="p">:</span>
</span><span id="Main-1589"><a href="#Main-1589"><span class="linenos">1589</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;At least one command must be selected! See: python PriceGenerator.py --help&quot;</span><span class="p">)</span>
</span><span id="Main-1590"><a href="#Main-1590"><span class="linenos">1590</span></a>
</span><span id="Main-1591"><a href="#Main-1591"><span class="linenos">1591</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">load_from</span><span class="p">:</span>
</span><span id="Main-1592"><a href="#Main-1592"><span class="linenos">1592</span></a>            <span class="n">priceModel</span><span class="o">.</span><span class="n">LoadFromFile</span><span class="p">(</span><span class="n">fileName</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">load_from</span><span class="p">)</span>
</span><span id="Main-1593"><a href="#Main-1593"><span class="linenos">1593</span></a>
</span><span id="Main-1594"><a href="#Main-1594"><span class="linenos">1594</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">generate</span><span class="p">:</span>
</span><span id="Main-1595"><a href="#Main-1595"><span class="linenos">1595</span></a>            <span class="n">priceModel</span><span class="o">.</span><span class="n">Generate</span><span class="p">()</span>
</span><span id="Main-1596"><a href="#Main-1596"><span class="linenos">1596</span></a>
</span><span id="Main-1597"><a href="#Main-1597"><span class="linenos">1597</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">save_to</span><span class="p">:</span>
</span><span id="Main-1598"><a href="#Main-1598"><span class="linenos">1598</span></a>            <span class="n">priceModel</span><span class="o">.</span><span class="n">SaveToFile</span><span class="p">(</span><span class="n">fileName</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">save_to</span><span class="p">)</span>
</span><span id="Main-1599"><a href="#Main-1599"><span class="linenos">1599</span></a>
</span><span id="Main-1600"><a href="#Main-1600"><span class="linenos">1600</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">render_bokeh</span><span class="p">:</span>
</span><span id="Main-1601"><a href="#Main-1601"><span class="linenos">1601</span></a>            <span class="n">priceModel</span><span class="o">.</span><span class="n">RenderBokeh</span><span class="p">(</span>
</span><span id="Main-1602"><a href="#Main-1602"><span class="linenos">1602</span></a>                <span class="n">fileName</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">render_bokeh</span><span class="p">,</span>
</span><span id="Main-1603"><a href="#Main-1603"><span class="linenos">1603</span></a>                <span class="n">viewInBrowser</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Main-1604"><a href="#Main-1604"><span class="linenos">1604</span></a>                <span class="n">darkTheme</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">dark</span><span class="p">,</span>
</span><span id="Main-1605"><a href="#Main-1605"><span class="linenos">1605</span></a>                <span class="n">width</span><span class="o">=</span><span class="mi">1800</span><span class="p">,</span>
</span><span id="Main-1606"><a href="#Main-1606"><span class="linenos">1606</span></a>                <span class="n">height</span><span class="o">=</span><span class="mi">940</span><span class="p">,</span>
</span><span id="Main-1607"><a href="#Main-1607"><span class="linenos">1607</span></a>                <span class="n">showControlsOnChart</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Main-1608"><a href="#Main-1608"><span class="linenos">1608</span></a>                <span class="n">showStatOnChart</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Main-1609"><a href="#Main-1609"><span class="linenos">1609</span></a>                <span class="n">inline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="Main-1610"><a href="#Main-1610"><span class="linenos">1610</span></a>            <span class="p">)</span>
</span><span id="Main-1611"><a href="#Main-1611"><span class="linenos">1611</span></a>
</span><span id="Main-1612"><a href="#Main-1612"><span class="linenos">1612</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">render_google</span><span class="p">:</span>
</span><span id="Main-1613"><a href="#Main-1613"><span class="linenos">1613</span></a>            <span class="n">priceModel</span><span class="o">.</span><span class="n">RenderGoogle</span><span class="p">(</span>
</span><span id="Main-1614"><a href="#Main-1614"><span class="linenos">1614</span></a>                <span class="n">fileName</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">render_google</span><span class="p">,</span>
</span><span id="Main-1615"><a href="#Main-1615"><span class="linenos">1615</span></a>                <span class="n">viewInBrowser</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Main-1616"><a href="#Main-1616"><span class="linenos">1616</span></a>            <span class="p">)</span>
</span><span id="Main-1617"><a href="#Main-1617"><span class="linenos">1617</span></a>
</span><span id="Main-1618"><a href="#Main-1618"><span class="linenos">1618</span></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="Main-1619"><a href="#Main-1619"><span class="linenos">1619</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="Main-1620"><a href="#Main-1620"><span class="linenos">1620</span></a>        <span class="n">exc</span> <span class="o">=</span> <span class="n">tb</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Main-1621"><a href="#Main-1621"><span class="linenos">1621</span></a>        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">exc</span><span class="p">:</span>
</span><span id="Main-1622"><a href="#Main-1622"><span class="linenos">1622</span></a>            <span class="k">if</span> <span class="n">line</span><span class="p">:</span>
</span><span id="Main-1623"><a href="#Main-1623"><span class="linenos">1623</span></a>                <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span><span id="Main-1624"><a href="#Main-1624"><span class="linenos">1624</span></a>        <span class="n">exitCode</span> <span class="o">=</span> <span class="mi">255</span>
</span><span id="Main-1625"><a href="#Main-1625"><span class="linenos">1625</span></a>
</span><span id="Main-1626"><a href="#Main-1626"><span class="linenos">1626</span></a>    <span class="k">finally</span><span class="p">:</span>
</span><span id="Main-1627"><a href="#Main-1627"><span class="linenos">1627</span></a>        <span class="n">finish</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">tzlocal</span><span class="p">())</span>
</span><span id="Main-1628"><a href="#Main-1628"><span class="linenos">1628</span></a>
</span><span id="Main-1629"><a href="#Main-1629"><span class="linenos">1629</span></a>        <span class="k">if</span> <span class="n">exitCode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Main-1630"><a href="#Main-1630"><span class="linenos">1630</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;All PriceGenerator operations are finished success (summary code is 0).&quot;</span><span class="p">)</span>
</span><span id="Main-1631"><a href="#Main-1631"><span class="linenos">1631</span></a>
</span><span id="Main-1632"><a href="#Main-1632"><span class="linenos">1632</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Main-1633"><a href="#Main-1633"><span class="linenos">1633</span></a>            <span class="n">uLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;An errors occurred during the work! See full debug log with --debug-level 10. Summary code: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">exitCode</span><span class="p">))</span>
</span><span id="Main-1634"><a href="#Main-1634"><span class="linenos">1634</span></a>
</span><span id="Main-1635"><a href="#Main-1635"><span class="linenos">1635</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;PriceGenerator work duration: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">finish</span> <span class="o">-</span> <span class="n">start</span><span class="p">))</span>
</span><span id="Main-1636"><a href="#Main-1636"><span class="linenos">1636</span></a>        <span class="n">uLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;PriceGenerator work finished: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">finish</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)))</span>
</span><span id="Main-1637"><a href="#Main-1637"><span class="linenos">1637</span></a>
</span><span id="Main-1638"><a href="#Main-1638"><span class="linenos">1638</span></a>        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">exitCode</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Main function for work with PriceGenerator in the console.</p>

<p>See examples:</p>

<ul>
<li>in english: <a href="https://github.com/Tim55667757/PriceGenerator/blob/master/README.md">https://github.com/Tim55667757/PriceGenerator/blob/master/README.md</a></li>
<li>in russian: <a href="https://github.com/Tim55667757/PriceGenerator/blob/master/README_RU.md">https://github.com/Tim55667757/PriceGenerator/blob/master/README_RU.md</a></li>
</ul>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value">${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>